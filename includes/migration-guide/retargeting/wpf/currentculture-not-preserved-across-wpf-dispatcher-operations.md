---
ms.openlocfilehash: 190bca720504535cb54e498ca8da23fbb6634ad4
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/15/2020
ms.locfileid: "67804513"
---
### <a name="currentculture-is-not-preserved-across-wpf-dispatcher-operations"></a><span data-ttu-id="34a38-101">CurrentCulture が、複数の WPF ディスパッチャー操作にわたって維持されない</span><span class="sxs-lookup"><span data-stu-id="34a38-101">CurrentCulture is not preserved across WPF Dispatcher operations</span></span>

|   |   |
|---|---|
|<span data-ttu-id="34a38-102">説明</span><span class="sxs-lookup"><span data-stu-id="34a38-102">Details</span></span>|<span data-ttu-id="34a38-103">.NET Framework 4.6 以降では、<xref:System.Windows.Threading.Dispatcher?displayProperty=name> 内で <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> または <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> に加えられた変更は、そのディスパッチャー操作の終了時に失われます。</span><span class="sxs-lookup"><span data-stu-id="34a38-103">Beginning in the .NET Framework 4.6, changes to <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> made within a <xref:System.Windows.Threading.Dispatcher?displayProperty=name> will be lost at the end of that dispatcher operation.</span></span> <span data-ttu-id="34a38-104">同様に、ディスパッチャー操作の外部で <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> または <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> に加えられた変更は、その操作の実行時には反映されない場合があります。具体的に言うと、<xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> と <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> の変更は、WPF UI コールバックと WPF アプリケーション内の他のコードの間でフローされない場合があるということです。これは、<xref:System.Threading.ExecutionContext?displayProperty=name> の変更によるものであり、この変更により、.NET Framework 4.6 以降を対象とするアプリでは、<xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> および <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> は実行コンテキストに格納されます。</span><span class="sxs-lookup"><span data-stu-id="34a38-104">Similarly, changes to <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> made outside of a Dispatcher operation may not be reflected when that operation executes.Practically speaking, this means that <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> changes may not flow between WPF UI callbacks and other code in a WPF application.This is due to a change in <xref:System.Threading.ExecutionContext?displayProperty=name> that causes <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> to be stored in the execution context beginning with apps targeting the .NET Framework 4.6.</span></span> <span data-ttu-id="34a38-105">WPF ディスパッチャー操作は、操作を開始するために使用された実行コンテキストを格納して、操作が完了したときに、以前のコンテキストを復元します。</span><span class="sxs-lookup"><span data-stu-id="34a38-105">WPF dispatcher operations store the execution context used to begin the operation and restore the previous context when the operation is completed.</span></span> <span data-ttu-id="34a38-106"><xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> と <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> がそのコンテキストの一部になったため、ディスパッチャー操作内でそれらに加えられた変更は、操作の外部では保持されません。</span><span class="sxs-lookup"><span data-stu-id="34a38-106">Because <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> are now part of that context, changes to them within a dispatcher operation are not persisted outside of the operation.</span></span>|
|<span data-ttu-id="34a38-107">提案される解決策</span><span class="sxs-lookup"><span data-stu-id="34a38-107">Suggestion</span></span>|<span data-ttu-id="34a38-108">この変更による影響を受けるアプリは、望ましい <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> または <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> をフィールドに格納し、すべてのディスパッチャー操作の本体 (UI イベントのコールバック ハンドラーを含む) で、正しい <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> と <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> が設定されていることを確認することによって回避できます。</span><span class="sxs-lookup"><span data-stu-id="34a38-108">Apps affected by this change may work around it by storing the desired <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> in a field and checking in all Dispatcher operation bodies (including UI event callback handlers) that the correct <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name> are set.</span></span> <span data-ttu-id="34a38-109">または、この WPF の変更の元となっている ExecutionContext の変更は、.NET Framework 4.6 以降を対象とするアプリのみに影響するため、.NET Framework 4.5.2 を対象とすることによって、この問題を回避できます。また、.NET Framework 4.6 以降を対象とするアプリでは、以下の互換性スイッチを設定することでこの問題を回避することができます。</span><span class="sxs-lookup"><span data-stu-id="34a38-109">Alternatively, because the ExecutionContext change underlying this WPF change only affects apps targeting the .NET Framework 4.6 or newer, this break can be avoided by targeting the .NET Framework 4.5.2.Apps that target .NET Framework 4.6 or later can also work around this by setting the following compatibility switch:</span></span><pre><code class="lang-csharp">AppContext.SetSwitch(&quot;Switch.System.Globalization.NoAsyncCurrentCulture&quot;, true);&#13;&#10;</code></pre><span data-ttu-id="34a38-110">この問題は、.NET Framework 4.6.2 の WPF で修正されました。</span><span class="sxs-lookup"><span data-stu-id="34a38-110">This issue has been fixed by WPF in .NET Framework 4.6.2.</span></span> <span data-ttu-id="34a38-111">また、.NET Frameworks 4.6、4.6.1 では [KB 3139549](https://support.microsoft.com/kb/3139549) を通じて修正されました。</span><span class="sxs-lookup"><span data-stu-id="34a38-111">It has also been fixed in .NET Frameworks 4.6, 4.6.1 through [KB 3139549](https://support.microsoft.com/kb/3139549).</span></span> <span data-ttu-id="34a38-112">.NET Framework 4.6 以降を対象とするアプリケーションでは WPF アプリケーション (<xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name>/<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>) の正しい動作が自動的に取得されます。これは、ディスパッチャー操作にわたって維持されます。</span><span class="sxs-lookup"><span data-stu-id="34a38-112">Applications targeting .NET Framework 4.6 or later will automatically get the right behavior in WPF applications - <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=name>/<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=name>) would be preserved across Dispatcher operations.</span></span>|
|<span data-ttu-id="34a38-113">スコープ</span><span class="sxs-lookup"><span data-stu-id="34a38-113">Scope</span></span>|<span data-ttu-id="34a38-114">マイナー</span><span class="sxs-lookup"><span data-stu-id="34a38-114">Minor</span></span>|
|<span data-ttu-id="34a38-115">バージョン</span><span class="sxs-lookup"><span data-stu-id="34a38-115">Version</span></span>|<span data-ttu-id="34a38-116">4.6</span><span class="sxs-lookup"><span data-stu-id="34a38-116">4.6</span></span>|
|<span data-ttu-id="34a38-117">種類</span><span class="sxs-lookup"><span data-stu-id="34a38-117">Type</span></span>|<span data-ttu-id="34a38-118">再ターゲット中</span><span class="sxs-lookup"><span data-stu-id="34a38-118">Retargeting</span></span>|
