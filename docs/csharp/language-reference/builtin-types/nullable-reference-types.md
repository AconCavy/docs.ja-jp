---
title: Null 許容参照型 - C# リファレンス
description: C# の Null 許容参照型とその使用方法について説明します
ms.date: 04/06/2020
ms.openlocfilehash: d961af9ba3b4776e6b4ec3eeea5392fb0d0394ce
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/18/2020
ms.locfileid: "94822426"
---
# <a name="nullable-reference-types-c-reference"></a><span data-ttu-id="4e9f0-103">Null 許容参照型 (C# リファレンス)</span><span class="sxs-lookup"><span data-stu-id="4e9f0-103">Nullable reference types (C# reference)</span></span>

> [!NOTE]
> <span data-ttu-id="4e9f0-104">この記事では、Null 許容参照型について説明します。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-104">This article covers nullable reference types.</span></span> <span data-ttu-id="4e9f0-105">また、[Null 許容値型](nullable-value-types.md)を宣言することもできます。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-105">You can also declare [nullable value types](nullable-value-types.md).</span></span>

<span data-ttu-id="4e9f0-106">Null 許容参照型は、C# 8.0 以降、"*Null 許容認識コンテキスト*" にオプトインしたコードで使用できます。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-106">Nullable reference types are available beginning with C# 8.0, in code that has opted in to a *nullable aware context*.</span></span> <span data-ttu-id="4e9f0-107">Null 許容参照型、Null スタティック分析の警告、[Null 免除演算子](../operators/null-forgiving.md)は、オプションの言語機能です。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-107">Nullable reference types, the null static analysis warnings, and the [null-forgiving operator](../operators/null-forgiving.md) are optional language features.</span></span> <span data-ttu-id="4e9f0-108">既定では、すべてオフになっています。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-108">All are turned off by default.</span></span> <span data-ttu-id="4e9f0-109">"*Null 許容コンテキスト*" は、プロジェクト レベルでビルド設定を使用して、またはコード内で pragma を使用して制御されます。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-109">A *nullable context* is controlled at the project level using build settings, or in code using pragmas.</span></span>

 <span data-ttu-id="4e9f0-110">Null 許容認識コンテキストでは、次の規則が使用されます。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-110">In a nullable aware context:</span></span>

- <span data-ttu-id="4e9f0-111">参照型 `T`の変数は、Null 以外で初期化する必要があり、`null`の可能性がある値が割り当てられない場合があります。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-111">A variable of a reference type `T` must be initialized with non-null, and may never be assigned a value that may be `null`.</span></span>
- <span data-ttu-id="4e9f0-112">参照型 `T?` の変数は、`null` で初期化することも、`null` を割り当てることもできます。ただし、逆参照する前に、`null` かどうかをチェックする必要があります。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-112">A variable of a reference type `T?` may be initialized with `null` or assigned `null`, but is required to be checked against `null` before de-referencing.</span></span>
- <span data-ttu-id="4e9f0-113">型 `T?` の変数 `m` は、`m!` のように Null 免除演算子を適用する場合、Null ではないと見なされます。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-113">A variable `m` of type `T?` is considered to be non-null when you apply the null-forgiving operator, as in `m!`.</span></span>

<span data-ttu-id="4e9f0-114">Null 非許容参照型 `T` と Null 許容参照型 `T?` の区別は、コンパイラによる前述の規則の解釈によって適用されます。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-114">The distinctions between a non-nullable reference type `T` and a nullable reference type `T?` are enforced by the compiler's interpretation of the preceding rules.</span></span> <span data-ttu-id="4e9f0-115">型 `T` の変数と型 `T?` の変数は、同じ .NET 型で表されます。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-115">A variable of type `T` and a variable of type `T?` are represented by the same .NET type.</span></span> <span data-ttu-id="4e9f0-116">次の例は、Null 非許容文字列と Null 許容文字列を宣言し、Null 免除演算子を使用して、値を Null 非許容文字列に割り当てます。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-116">The following example declares a non-nullable string and a nullable string, and then uses the null-forgiving operator to assign a value to a non-nullable string:</span></span>

:::code language="csharp" source="snippets/shared/NullableReferenceTypes.cs" id="SnippetCoreSyntax":::

<span data-ttu-id="4e9f0-117">変数 `notNull` と `nullable` は両方とも、<xref:System.String> 型で表されます。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-117">The variables `notNull` and `nullable` are both represented by the <xref:System.String> type.</span></span> <span data-ttu-id="4e9f0-118">Null 非許容型と Null 許容型は両方とも、同じ型に格納されるため、Null 許容参照型を使用できない場所がいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-118">Because the non-nullable and nullable types are both stored as the same type, there are several locations where using a nullable reference type isn't allowed.</span></span> <span data-ttu-id="4e9f0-119">通常、Null 許容参照型は、基底クラスまたは実装されたインターフェイスとして使用できません。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-119">In general, a nullable reference type can't be used as a base class or implemented interface.</span></span> <span data-ttu-id="4e9f0-120">Null 許容参照型は、オブジェクトの作成または型のテスト式で使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-120">A nullable reference type can't be used in any object creation or type testing expression.</span></span> <span data-ttu-id="4e9f0-121">Null 許容参照型は、メンバー アクセス式の型にすることはできません。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-121">A nullable reference type can't be the type of a member access expression.</span></span> <span data-ttu-id="4e9f0-122">次の例は、これらのコンストラクトを示します。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-122">The following examples show these constructs:</span></span>

```csharp
public MyClass : System.Object? // not allowed
{
}

var nullEmpty = System.String?.Empty; // Not allowed
var maybeObject = new object?(); // Not allowed
try
{
    if (thing is string? nullableString) // not allowed
        Console.WriteLine(nullableString);
} catch (Exception? e) // Not Allowed
{
    Console.WriteLine("error");
}
```

## <a name="nullable-references-and-static-analysis"></a><span data-ttu-id="4e9f0-123">Null 許容参照とスタティック分析</span><span class="sxs-lookup"><span data-stu-id="4e9f0-123">Nullable references and static analysis</span></span>

<span data-ttu-id="4e9f0-124">前のセクションの例は、Null 許容参照型の特性を示しています。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-124">The examples in the previous section illustrate the nature of nullable reference types.</span></span> <span data-ttu-id="4e9f0-125">Null 許容参照型は新しいクラスの型ではなく、既存の参照型に対する注釈です。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-125">Nullable reference types aren't new class types, but rather annotations on existing reference types.</span></span> <span data-ttu-id="4e9f0-126">コンパイラは、これらの注釈を使用して、ユーザーがコード内で発生する可能性のある Null 参照エラーを検出しやすくします。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-126">The compiler uses those annotations to help you find potential null reference errors in your code.</span></span> <span data-ttu-id="4e9f0-127">Null 非許容参照型と Null 参照型の間には、ランタイムの違いはありません。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-127">There's no runtime difference between a non-nullable reference type and a nullable reference type.</span></span> <span data-ttu-id="4e9f0-128">コンパイラは、Null 非許容参照型のランタイム チェックを追加しません。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-128">The compiler doesn't add any runtime checking for non-nullable reference types.</span></span> <span data-ttu-id="4e9f0-129">この利点は、コンパイル時分析にあります。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-129">The benefits are in the compile-time analysis.</span></span> <span data-ttu-id="4e9f0-130">コンパイラは、コード内で発生する可能性のある Null エラーの検出と修正に役立つ警告を生成します。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-130">The compiler generates warnings that help you find and fix potential null errors in your code.</span></span> <span data-ttu-id="4e9f0-131">意図を宣言すると、コンパイラは、コードがその意図に違反したときに警告を発行します。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-131">You declare your intent, and the compiler warns you when your code violates that intent.</span></span>

<span data-ttu-id="4e9f0-132">Null 許容の有効なコンテキストでは、コンパイラは、Null 許容と Null 非許容の両方の参照型の変数に対してスタティック分析を実行します。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-132">In a nullable enabled context, the compiler performs static analysis on variables of any reference type, both nullable and non-nullable.</span></span> <span data-ttu-id="4e9f0-133">コンパイラは、各参照変数の null 状態を "*null ではない*" または "*null かもしれない*" として追跡します。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-133">The compiler tracks the null state of each reference variable as either *not null* or *maybe null*.</span></span> <span data-ttu-id="4e9f0-134">Null 非許容参照の既定の状態は、"*null ではない*" です。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-134">The default state of a non-nullable reference is *not null*.</span></span> <span data-ttu-id="4e9f0-135">Null 許容参照の既定の状態は、"*null かもしれない*" です。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-135">The default state of a nullable reference is *maybe null*.</span></span>

<span data-ttu-id="4e9f0-136">Null 非許容参照型の null 状態は "*null ではない*" であるため、この型は常に安全に逆参照できます。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-136">Non-nullable reference types should always be safe to dereference because their null state is *not null*.</span></span> <span data-ttu-id="4e9f0-137">この規則を適用するために、Null 非許容参照型が Null 以外の値に初期化されていない場合、コンパイラは警告を発行します。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-137">To enforce that rule, the compiler issues warnings if a non-nullable reference type isn't initialized to a non-null value.</span></span> <span data-ttu-id="4e9f0-138">ローカル変数は、宣言されている場所に割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-138">Local variables must be assigned where they're declared.</span></span> <span data-ttu-id="4e9f0-139">すべてのコンストラクターは、その本体または呼び出されるコンストラクター内で、またはフィールド初期化子を使用してすべてのフィールドに割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-139">Every constructor must assign every field, either in its body, a called constructor, or using a field initializer.</span></span> <span data-ttu-id="4e9f0-140">状態が "*null かもしれない*" である参照に、Null 非許容参照が割り当てられている場合、コンパイラは警告を発行します。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-140">The compiler issues warnings if a non-nullable reference is assigned to a reference whose state is *maybe null*.</span></span> <span data-ttu-id="4e9f0-141">しかし、Null 非許容参照は"*null ではない*" であるため、これらの変数が逆参照される場合、警告は変更されません。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-141">However, because a non-nullable reference is *not null*, no warnings are issued when those variables are de-referenced.</span></span>

<span data-ttu-id="4e9f0-142">Null 許容参照型は、`null`に初期化することも、割り当てることもできます。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-142">Nullable reference types may be initialized or assigned to `null`.</span></span> <span data-ttu-id="4e9f0-143">したがって、スタティック分析では、変数が逆参照される前に、それが "*null ではない*" であることを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-143">Therefore, static analysis must determine that a variable is *not null* before it's dereferenced.</span></span> <span data-ttu-id="4e9f0-144">Null 許容参照が "*null かもしれない*" であると判断された場合、それを Null 非許容参照変数に割り当てることはできません。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-144">If a nullable reference is determined to be *maybe null*, it can't be assigned to a non-nullable reference variable.</span></span> <span data-ttu-id="4e9f0-145">次のクラスは、これらの警告の例を示します。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-145">The following class shows examples of these warnings:</span></span>

:::code language="csharp" source="snippets/shared/NullableReferenceTypes.cs" id="SnippetClassWithNullable":::

<span data-ttu-id="4e9f0-146">次のスニペットは、このクラスを使用したときにコンパイラが警告を発行する場所を示します。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-146">The following snippet shows where the compiler emits warnings when using this class:</span></span>

:::code language="csharp" source="snippets/shared/NullableReferenceTypes.cs" id="SnippetLocalWarnings":::

<span data-ttu-id="4e9f0-147">上記の例は、参照変数の null 状態を判断するコンパイラのスタティック分析を示しています。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-147">The preceding examples demonstrate the compiler's static analysis to determine the null state of reference variables.</span></span> <span data-ttu-id="4e9f0-148">コンパイラは、null のチェックと割り当てに関する言語規則を適用して、その分析を通知します。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-148">The compiler applies language rules for null checks and assignments to inform its analysis.</span></span>  <span data-ttu-id="4e9f0-149">コンパイラは、メソッドまたはプロパティのセマンティクスについて想定することはできません。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-149">The compiler can't make assumptions about the semantics of methods or properties.</span></span> <span data-ttu-id="4e9f0-150">null チェックを実行するメソッドを呼び出した場合、コンパイラは、それらのメソッドが変数の null 状態に影響することを認識できません。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-150">If you call methods that perform null checks, the compiler can't know those methods affect a variable's null state.</span></span> <span data-ttu-id="4e9f0-151">API が引数と戻り値のセマンティクスについてコンパイラに通知するために追加できる属性がいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-151">There are a number of attributes you can add to your APIs to inform the compiler about the semantics of arguments and return values.</span></span> <span data-ttu-id="4e9f0-152">これらの属性は、.NET Core ライブラリ内の多数の一般的な API に適用されています。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-152">These attributes have been applied to many common APIs in the .NET Core libraries.</span></span> <span data-ttu-id="4e9f0-153">たとえば、<xref:System.String.IsNullOrEmpty%2A> は更新され、コンパイラは、そのメソッドを null チェックとして正しく解釈します。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-153">For example, <xref:System.String.IsNullOrEmpty%2A> has been updated, and the compiler correctly interprets that method as a null check.</span></span> <span data-ttu-id="4e9f0-154">null 状態のスタティック分析に適用される属性の詳細については、[Null 許容属性](../attributes/nullable-analysis.md)に関する記事を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-154">For more information about the attributes that apply to null state static analysis, see the article on [Nullable attributes](../attributes/nullable-analysis.md).</span></span>

## <a name="setting-the-nullable-context"></a><span data-ttu-id="4e9f0-155">Null 許容コンテキストの設定</span><span class="sxs-lookup"><span data-stu-id="4e9f0-155">Setting the nullable context</span></span>

<span data-ttu-id="4e9f0-156">Null 許容コンテキストを制御するには、2 つの方法があります。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-156">There are two ways to control the nullable context.</span></span> <span data-ttu-id="4e9f0-157">プロジェクト レベルでは、`<Nullable>enable</Nullable>` プロジェクトを追加できます。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-157">At the project level, you can add the `<Nullable>enable</Nullable>` project setting.</span></span> <span data-ttu-id="4e9f0-158">単一の C# ソース ファイルでは、`#nullable enable` pragma を追加して、Null 許容コンテキストを有効にすることができます。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-158">In a single C# source file, you can add the `#nullable enable` pragma to enable the nullable context.</span></span> <span data-ttu-id="4e9f0-159">[Null 許容戦略の設定](../../nullable-migration-strategies.md) に関する記事を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-159">See the article on [setting a nullable strategy](../../nullable-migration-strategies.md).</span></span>

## <a name="c-language-specification"></a><span data-ttu-id="4e9f0-160">C# 言語仕様</span><span class="sxs-lookup"><span data-stu-id="4e9f0-160">C# language specification</span></span>

<span data-ttu-id="4e9f0-161">詳細については、[C# 言語仕様](~/_csharplang/spec/introduction.md)に関する次の提案を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4e9f0-161">For more information, see the following proposals for the [C# language specification](~/_csharplang/spec/introduction.md):</span></span>

- [<span data-ttu-id="4e9f0-162">Null 許容参照型</span><span class="sxs-lookup"><span data-stu-id="4e9f0-162">Nullable reference types</span></span>](~/_csharplang/proposals/csharp-8.0/nullable-reference-types.md)
- [<span data-ttu-id="4e9f0-163">null 許容参照型仕様の下書き</span><span class="sxs-lookup"><span data-stu-id="4e9f0-163">Draft nullable reference types specification</span></span>](~/_csharplang/proposals/csharp-9.0/nullable-reference-types-specification.md)

## <a name="see-also"></a><span data-ttu-id="4e9f0-164">関連項目</span><span class="sxs-lookup"><span data-stu-id="4e9f0-164">See also</span></span>

- [<span data-ttu-id="4e9f0-165">C# リファレンス</span><span class="sxs-lookup"><span data-stu-id="4e9f0-165">C# reference</span></span>](../index.md)
- [<span data-ttu-id="4e9f0-166">null 許容値型</span><span class="sxs-lookup"><span data-stu-id="4e9f0-166">Nullable value types</span></span>](nullable-value-types.md)
