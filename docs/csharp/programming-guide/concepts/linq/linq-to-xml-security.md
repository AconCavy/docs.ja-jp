---
title: LINQ to XML のセキュリティ (C#)
description: セキュリティ上の脆弱性を緩和するためのガイダンスを含む、LINQ to XML に関連するセキュリティの問題について学習します。
ms.date: 07/20/2015
ms.assetid: ef2c0dc9-ecf9-4c17-b24e-144184ab725f
ms.openlocfilehash: dc9fd13f19dcf6d9cbbb2b0b7608009cc4da1108
ms.sourcegitcommit: 87cfeb69226fef01acb17c56c86f978f4f4a13db
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/24/2020
ms.locfileid: "87165312"
---
# <a name="linq-to-xml-security-c"></a><span data-ttu-id="8a3bf-103">LINQ to XML のセキュリティ (C#)</span><span class="sxs-lookup"><span data-stu-id="8a3bf-103">LINQ to XML Security (C#)</span></span>
<span data-ttu-id="8a3bf-104">ここでは、LINQ to XML に関連するセキュリティの問題について説明し、</span><span class="sxs-lookup"><span data-stu-id="8a3bf-104">This topic describes security issues associated with LINQ to XML.</span></span> <span data-ttu-id="8a3bf-105">セキュリティ上の脆弱性を緩和するためのガイドラインを紹介します。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-105">In addition, it provides some guidance for mitigating security exposure.</span></span>  
  
## <a name="linq-to-xml-security-overview"></a><span data-ttu-id="8a3bf-106">LINQ to XML のセキュリティの概要</span><span class="sxs-lookup"><span data-stu-id="8a3bf-106">LINQ to XML Security Overview</span></span>  
 <span data-ttu-id="8a3bf-107">LINQ to XML は、厳密なセキュリティ要件が必要なサーバー側アプリケーション向けというよりも、プログラミングの利便性に重点を置いて設計されています。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-107">LINQ to XML is designed more for programming convenience than for server-side applications with stringent security requirements.</span></span> <span data-ttu-id="8a3bf-108">ほとんどの XML のシナリオでは、サーバーにアップロードされる信頼できない XML ドキュメントではなく、信頼できる XML ドキュメントが処理されます。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-108">Most XML scenarios consist of processing trusted XML documents, rather than processing untrusted XML documents that are uploaded to a server.</span></span> <span data-ttu-id="8a3bf-109">LINQ to XML は、こうした一般的なシナリオに最適化されています。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-109">LINQ to XML is optimized for these scenarios.</span></span>  
  
 <span data-ttu-id="8a3bf-110">ソースが不明な信頼できないデータを処理する必要がある場合は、既知の XML サービス拒否 (DoS) 攻撃をフィルターで除外するように構成された <xref:System.Xml.XmlReader> クラスのインスタンスを使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-110">If you must process untrusted data from unknown sources, Microsoft recommends that you use an instance of the <xref:System.Xml.XmlReader> class that has been configured to filter out known XML denial of service (DoS) attacks.</span></span>  
  
 <span data-ttu-id="8a3bf-111">サービス拒否攻撃を緩和するように <xref:System.Xml.XmlReader> を構成したら、それを使用して LINQ to XML ツリーを設定できます。これにより、LINQ to XML によるプログラミングの生産性向上のメリットも受けられます。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-111">If you have configured an <xref:System.Xml.XmlReader> to mitigate denial of service attacks, you can use that reader to populate a LINQ to XML tree and still benefit from the programmer productivity enhancements of LINQ to XML.</span></span> <span data-ttu-id="8a3bf-112">このように、セキュリティの問題を緩和するように構成されたリーダーを作成し、その構成済みのリーダーを使用して XML ツリーをインスタンス化する方法は、多くの軽減技法で利用されています。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-112">Many mitigation techniques involve creating readers that are configured to mitigate the security issue, and then instantiating an XML tree through the configured reader.</span></span>  
  
 <span data-ttu-id="8a3bf-113">XML は、ドキュメントのサイズ、深さ、要素名のサイズなどの制限がないため、サービス拒否攻撃に対して本質的に脆弱です。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-113">XML is intrinsically vulnerable to denial of service attacks because documents are unbounded in size, depth, element name size, and more.</span></span> <span data-ttu-id="8a3bf-114">XML の処理に使用するコンポーネントに関係なく、リソースが過剰に使用されている場合は、常にアプリケーション ドメインを再利用できるようにしておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-114">Regardless of the component that you use to process XML, you should always be prepared to recycle the application domain if it uses excessive resources.</span></span>  
  
## <a name="mitigation-of-xml-xsd-xpath-and-xslt-attacks"></a><span data-ttu-id="8a3bf-115">XML、XSD、XPath、および XSLT の攻撃の緩和</span><span class="sxs-lookup"><span data-stu-id="8a3bf-115">Mitigation of XML, XSD, XPath, and XSLT Attacks</span></span>  
 <span data-ttu-id="8a3bf-116">LINQ to XML は、<xref:System.Xml.XmlReader> と <xref:System.Xml.XmlWriter> に基づいて構築されており、</span><span class="sxs-lookup"><span data-stu-id="8a3bf-116">LINQ to XML is built upon <xref:System.Xml.XmlReader> and <xref:System.Xml.XmlWriter>.</span></span> <span data-ttu-id="8a3bf-117"><xref:System.Xml.Schema?displayProperty=nameWithType> 名前空間と <xref:System.Xml.XPath?displayProperty=nameWithType> 名前空間の拡張メソッドによって XSD と XPath をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-117">LINQ to XML supports XSD and XPath through extension methods in the <xref:System.Xml.Schema?displayProperty=nameWithType> and <xref:System.Xml.XPath?displayProperty=nameWithType> namespaces.</span></span> <span data-ttu-id="8a3bf-118"><xref:System.Xml.XmlReader>、<xref:System.Xml.XPath.XPathNavigator>、および <xref:System.Xml.XmlWriter> の各クラスを LINQ to XML と組み合わせて使用することにより、XSLT を呼び出して XML ツリーを変換することができます。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-118">Using the <xref:System.Xml.XmlReader>, <xref:System.Xml.XPath.XPathNavigator>, and <xref:System.Xml.XmlWriter> classes in conjunction with LINQ to XML, you can invoke XSLT to transform XML trees.</span></span>  
  
 <span data-ttu-id="8a3bf-119">運用環境の安全性が高くない場合は、XML や <xref:System.Xml?displayProperty=nameWithType>、<xref:System.Xml.Schema?displayProperty=nameWithType>、<xref:System.Xml.XPath?displayProperty=nameWithType>、および <xref:System.Xml.Xsl?displayProperty=nameWithType> の各クラスの使用に関連するセキュリティの問題が発生する可能性が高いといえます。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-119">If you are operating in a less secure environment, there are a number of security issues that are associated with XML and the use of the classes in <xref:System.Xml?displayProperty=nameWithType>, <xref:System.Xml.Schema?displayProperty=nameWithType>, <xref:System.Xml.XPath?displayProperty=nameWithType>, and <xref:System.Xml.Xsl?displayProperty=nameWithType>.</span></span> <span data-ttu-id="8a3bf-120">そのような問題の一部を次に示します。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-120">These issues include, but are not limited to, the following:</span></span>  
  
- <span data-ttu-id="8a3bf-121">XSD、XPath、および XSLT は文字列に基づく言語であり、時間やメモリを大量に消費する操作を指定することができます。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-121">XSD, XPath, and XSLT are string-based languages in which you can specify operations that consume a lot of time or memory.</span></span> <span data-ttu-id="8a3bf-122">信頼されていないソースの XSD、XPath、または XSLT の文字列を受け取る場合、アプリケーション プログラマは、その文字列が悪意のあるものでないかどうかを検証する必要があります。また、その文字列の評価によってシステム リソースが過剰に消費されないように監視し、過剰に消費された場合はその状況を緩和する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-122">It is the responsibility of application programmers who take XSD, XPath, or XSLT strings from untrusted sources to validate that the strings are not malicious, or to monitor and mitigate the possibility that evaluating these strings will lead to excessive system resource consumption.</span></span>  
  
- <span data-ttu-id="8a3bf-123">XSD スキーマ (インライン スキーマを含む) は、サービス拒否攻撃に対して本質的に脆弱です。信頼できないソースのスキーマは受け入れないようにしてください。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-123">XSD schemas (including inline schemas) are inherently vulnerable to denial of service attacks; you should not accept schemas from untrusted sources.</span></span>  
  
- <span data-ttu-id="8a3bf-124">XSD や XSLT には他のファイルへの参照が含まれている場合があり、それらの参照が原因で、ゾーンやドメインを越えた攻撃を受ける可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-124">XSD and XSLT can include references to other files, and such references can result in cross-zone and cross-domain attacks.</span></span>  
  
- <span data-ttu-id="8a3bf-125">DTD 内の外部エンティティが原因で、ゾーンやドメインを越えた攻撃を受ける可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-125">External entities in DTDs can result in cross-zone and cross-domain attacks.</span></span>  
  
- <span data-ttu-id="8a3bf-126">DTD はサービス拒否攻撃に対して脆弱です。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-126">DTDs are vulnerable to denial of service attacks.</span></span>  
  
- <span data-ttu-id="8a3bf-127">極端に階層の深い XML ドキュメントが原因で、サービス拒否攻撃を受ける可能性があります。XML ドキュメントの階層を制限することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-127">Exceptionally deep XML documents can pose denial of service issues; you might want to limit the depth of XML documents.</span></span>  
  
- <span data-ttu-id="8a3bf-128">信頼できないアセンブリからの <xref:System.Xml.NameTable>、<xref:System.Xml.XmlNamespaceManager>、および <xref:System.Xml.XmlResolver> オブジェクトなどのサポート コンポーネントは受け入れないようにします。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-128">Do not accept supporting components, such as <xref:System.Xml.NameTable>, <xref:System.Xml.XmlNamespaceManager>, and <xref:System.Xml.XmlResolver> objects, from untrusted assemblies.</span></span>  
  
- <span data-ttu-id="8a3bf-129">サイズの大きなドキュメントによる攻撃を緩和するためにデータをチャンク単位で読み取ります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-129">Read data in chunks to mitigate large document attacks.</span></span>  
  
- <span data-ttu-id="8a3bf-130">XSLT スタイル シート内のスクリプト ブロックが原因で、多くの攻撃を受ける場合があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-130">Script blocks in XSLT style sheets can expose a number of attacks.</span></span>  
  
- <span data-ttu-id="8a3bf-131">動的な XPath 式を作成する場合は事前に慎重に検証します。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-131">Validate carefully before constructing dynamic XPath expressions.</span></span>  
  
## <a name="linq-to-xml-security-issues"></a><span data-ttu-id="8a3bf-132">LINQ to XML のセキュリティの問題</span><span class="sxs-lookup"><span data-stu-id="8a3bf-132">LINQ to XML Security Issues</span></span>  
 <span data-ttu-id="8a3bf-133">ここに示されているセキュリティの問題には、特に優先順位はありません。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-133">The security issues in this topic are not presented in any particular order.</span></span> <span data-ttu-id="8a3bf-134">すべての問題が重要であり、それぞれに適切に対処する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-134">All issues are important and should be addressed as appropriate.</span></span>  
  
 <span data-ttu-id="8a3bf-135">権限の昇格攻撃が成功すると、悪意のあるアセンブリがその環境をより自由に制御できるようになります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-135">A successful elevation of privilege attack gives a malicious assembly more control over its environment.</span></span> <span data-ttu-id="8a3bf-136">その結果、データの公開攻撃やサービス拒否攻撃などを受ける可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-136">A successful elevation of privilege attack can result in disclosure of data, denial of service, and more.</span></span>  
  
 <span data-ttu-id="8a3bf-137">アプリケーションでは、権限のないユーザーにデータを公開しないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-137">Applications should not disclose data to users who are not authorized to see that data.</span></span>  
  
 <span data-ttu-id="8a3bf-138">サービス拒否攻撃を受けると、XML パーサーや LINQ to XML がメモリや CPU 時間を大量に消費するようになります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-138">Denial of service attacks cause the XML parser or LINQ to XML to consume excessive amounts of memory or CPU time.</span></span> <span data-ttu-id="8a3bf-139">サービス拒否攻撃は、権限の昇格攻撃やデータの公開攻撃ほど重大に捉えられていませんが、</span><span class="sxs-lookup"><span data-stu-id="8a3bf-139">Denial of service attacks are considered to be less severe than elevation of privilege attacks or disclosure of data attacks.</span></span> <span data-ttu-id="8a3bf-140">信頼できないソースからの XML ドキュメントをサーバーで処理する必要があるシナリオでは重大な問題です。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-140">However, they are important in a scenario where a server needs to process XML documents from untrusted sources.</span></span>  
  
### <a name="exceptions-and-error-messages-might-reveal-data"></a><span data-ttu-id="8a3bf-141">例外やエラー メッセージによってデータが漏洩する可能性がある</span><span class="sxs-lookup"><span data-stu-id="8a3bf-141">Exceptions and Error Messages Might Reveal Data</span></span>  
 <span data-ttu-id="8a3bf-142">変換されるデータ、ファイル名、実装の詳細などのデータが、エラーの説明から漏洩する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-142">The description of an error might reveal data, such as the data being transformed, file names, or implementation details.</span></span> <span data-ttu-id="8a3bf-143">信頼されていない呼び出し元に対してはエラー メッセージが表示されないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-143">Error messages should not be exposed to callers that are not trusted.</span></span> <span data-ttu-id="8a3bf-144">すべてのエラーをキャッチして、カスタム エラー メッセージでエラーを報告するようにしてください。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-144">You should catch all errors and report errors with your own custom error messages.</span></span>  
  
### <a name="do-not-call-codeaccesspermissionsassert-in-an-event-handler"></a><span data-ttu-id="8a3bf-145">イベント ハンドラーで CodeAccessPermissions.Assert を呼び出さない</span><span class="sxs-lookup"><span data-stu-id="8a3bf-145">Do Not Call CodeAccessPermissions.Assert in an Event Handler</span></span>  
 <span data-ttu-id="8a3bf-146">アセンブリの権限は、低い場合もあれば高い場合もあります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-146">An assembly can have lesser or greater permissions.</span></span> <span data-ttu-id="8a3bf-147">高い権限を持つアセンブリは、コンピューターやその環境をより自由に制御できます。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-147">An assembly that has greater permissions has greater control over the computer and its environments.</span></span>  
  
 <span data-ttu-id="8a3bf-148">高い権限を持つアセンブリのコードがイベント ハンドラーで <xref:System.Security.CodeAccessPermission.Assert%2A?displayProperty=nameWithType> を呼び出した後に、権限が制限されている悪意のあるアセンブリに XML ツリーが渡されると、悪意のあるアセンブリによってイベントが発生させられる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-148">If code in an assembly with greater permissions calls <xref:System.Security.CodeAccessPermission.Assert%2A?displayProperty=nameWithType> in an event handler, and then the XML tree is passed to a malicious assembly that has restricted permissions, the malicious assembly can cause an event to be raised.</span></span> <span data-ttu-id="8a3bf-149">このイベントは、高い権限を持つアセンブリ内のコードを実行するため、悪意のあるアセンブリが高度な特権で動作するようになります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-149">Because the event runs code that is in the assembly with greater permissions, the malicious assembly would then be operating with elevated privileges.</span></span>  
  
 <span data-ttu-id="8a3bf-150">イベント ハンドラーでは <xref:System.Security.CodeAccessPermission.Assert%2A?displayProperty=nameWithType> を呼び出さないようにすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-150">Microsoft recommends that you never call <xref:System.Security.CodeAccessPermission.Assert%2A?displayProperty=nameWithType> in an event handler.</span></span>  
  
### <a name="dtds-are-not-secure"></a><span data-ttu-id="8a3bf-151">DTD は安全ではない</span><span class="sxs-lookup"><span data-stu-id="8a3bf-151">DTDs are Not Secure</span></span>  
 <span data-ttu-id="8a3bf-152">DTD 内のエンティティは、本質的に安全ではありません。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-152">Entities in DTDs are inherently not secure.</span></span> <span data-ttu-id="8a3bf-153">DTD を含む悪意のある XML ドキュメントが原因で、サービス拒否攻撃を受け、メモリと CPU 時間のすべてがパーサーによって使用されるといった状況が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-153">It is possible for a malicious XML document that contains a DTD to cause the parser to use all memory and CPU time, causing a denial of service attack.</span></span> <span data-ttu-id="8a3bf-154">このため、LINQ to XML では DTD の処理が既定で無効になっています。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-154">Therefore, in LINQ to XML, DTD processing is turned off by default.</span></span> <span data-ttu-id="8a3bf-155">信頼されていないソースの DTD は受け入れないようにしてください。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-155">You should not accept DTDs from untrusted sources.</span></span>  
  
 <span data-ttu-id="8a3bf-156">たとえば、DTD を参照する XML ファイルと DTD ファイルをアップロードすることを Web ユーザーに対して許可する Web アプリケーションは、信頼されていないソースの DTD を受け入れる例の 1 つです。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-156">One example of accepting DTDs from untrusted sources is a Web application that allows Web users to upload an XML file that references a DTD and a DTD file.</span></span> <span data-ttu-id="8a3bf-157">この場合は、ファイルの検証の際に、悪意のある DTD によってサーバーに対するサービス拒否攻撃が行われる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-157">Upon validation of the file, a malicious DTD could execute a denial of service attack on your server.</span></span> <span data-ttu-id="8a3bf-158">そのほか、匿名 FTP アクセスが許可されているネットワーク共有の DTD を参照する場合も、信頼されていないソースの DTD を受け入れる例になります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-158">Another example of accepting DTDs from untrusted sources is to reference a DTD on a network share that also allows anonymous FTP access.</span></span>  
  
### <a name="avoid-excessive-buffer-allocation"></a><span data-ttu-id="8a3bf-159">過剰なバッファーの割り当てを回避する</span><span class="sxs-lookup"><span data-stu-id="8a3bf-159">Avoid Excessive Buffer Allocation</span></span>  
 <span data-ttu-id="8a3bf-160">アプリケーション開発者は、極端に大きなデータ ソースが原因でリソース消費攻撃やサービス拒否攻撃を受ける可能性があることを認識しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-160">Application developers should be aware that extremely large data sources can lead to resource exhaustion and denial of service attacks.</span></span>  
  
 <span data-ttu-id="8a3bf-161">悪意のあるユーザーによって非常に大きな XML ドキュメントが送信されたり、アップロードされたりすると、LINQ to XML がシステム リソースを過剰に消費するようになります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-161">If a malicious user submits or uploads a very large XML document, it could cause LINQ to XML to consume excessive system resources.</span></span> <span data-ttu-id="8a3bf-162">このような状況が、サービス拒否攻撃の原因となる場合があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-162">This can constitute a denial of service attack.</span></span> <span data-ttu-id="8a3bf-163">これを防ぐには、<xref:System.Xml.XmlReaderSettings.MaxCharactersInDocument%2A?displayProperty=nameWithType> プロパティを設定して、読み込むことのできるドキュメントのサイズが制限されたリーダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-163">To prevent this, you can set the <xref:System.Xml.XmlReaderSettings.MaxCharactersInDocument%2A?displayProperty=nameWithType> property, and create a reader that is then limited in the size of document that it can load.</span></span> <span data-ttu-id="8a3bf-164">その後、そのリーダーを使用して XML ツリーを作成します。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-164">You then use the reader to create the XML tree.</span></span>  
  
 <span data-ttu-id="8a3bf-165">たとえば、信頼されていないソースからの XML ドキュメントの最大サイズが 50K バイト未満と予測される場合は、<xref:System.Xml.XmlReaderSettings.MaxCharactersInDocument%2A?displayProperty=nameWithType> を 100,000 に設定します。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-165">For example, if you know that the maximum expected size of your XML documents coming from an untrusted source will be less than 50K bytes, set <xref:System.Xml.XmlReaderSettings.MaxCharactersInDocument%2A?displayProperty=nameWithType> to 100,000.</span></span> <span data-ttu-id="8a3bf-166">これにより、XML ドキュメントの処理を妨げずに、大量のメモリを消費するドキュメントがアップロードされるサービス拒否攻撃の脅威を緩和できます。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-166">This will not encumber your processing of XML documents, and at the same time it will mitigate denial of service threats where documents might be uploaded that would consume large amounts of memory.</span></span>  
  
### <a name="avoid-excess-entity-expansion"></a><span data-ttu-id="8a3bf-167">過剰なエンティティの展開を回避する</span><span class="sxs-lookup"><span data-stu-id="8a3bf-167">Avoid Excess Entity Expansion</span></span>  
 <span data-ttu-id="8a3bf-168">DTD の使用時に発生するサービス拒否攻撃の 1 つに、エンティティを過剰に展開するドキュメントによる攻撃があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-168">One of the known denial of service attacks when using a DTD is a document that causes excessive entity expansion.</span></span> <span data-ttu-id="8a3bf-169">これを防ぐには、<xref:System.Xml.XmlReaderSettings.MaxCharactersFromEntities%2A?displayProperty=nameWithType> プロパティを設定して、エンティティの展開により生成される文字数が制限されたリーダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-169">To prevent this, you can set the <xref:System.Xml.XmlReaderSettings.MaxCharactersFromEntities%2A?displayProperty=nameWithType> property, and create a reader that is then limited in the number of characters that result from entity expansion.</span></span> <span data-ttu-id="8a3bf-170">その後、そのリーダーを使用して XML ツリーを作成します。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-170">You then use the reader to create the XML tree.</span></span>  
  
### <a name="limit-the-depth-of-the-xml-hierarchy"></a><span data-ttu-id="8a3bf-171">XML 階層の深さを制限する</span><span class="sxs-lookup"><span data-stu-id="8a3bf-171">Limit the Depth of the XML Hierarchy</span></span>  
 <span data-ttu-id="8a3bf-172">サービス拒否攻撃は、極端に深い階層を持つドキュメントが送信された場合にも発生します。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-172">One possible denial of service attack is when a document is submitted that has excessive depth of hierarchy.</span></span> <span data-ttu-id="8a3bf-173">これを防ぐには、要素の深さをカウントする独自のクラスで <xref:System.Xml.XmlReader> をラップします。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-173">To prevent this, you can wrap a <xref:System.Xml.XmlReader> in your own class that counts the depth of elements.</span></span> <span data-ttu-id="8a3bf-174">これにより、要素の深さが事前に設定したレベルを超えている場合に、その悪意のあるドキュメントの処理を終了できます。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-174">If the depth exceeds a predetermined reasonable level, you can terminate the processing of the malicious document.</span></span>  
  
### <a name="protect-against-untrusted-xmlreader-or-xmlwriter-implementations"></a><span data-ttu-id="8a3bf-175">信頼されていない XmlReader や XmlWriter の実装から保護する</span><span class="sxs-lookup"><span data-stu-id="8a3bf-175">Protect Against Untrusted XmlReader or XmlWriter Implementations</span></span>  
 <span data-ttu-id="8a3bf-176">管理者は、外部から提供された <xref:System.Xml.XmlReader> や <xref:System.Xml.XmlWriter> の実装について、厳密な名前が使用されているかどうか、コンピューターの構成に登録されているかどうかを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-176">Administrators should verify that any externally supplied <xref:System.Xml.XmlReader> or <xref:System.Xml.XmlWriter> implementations have strong names and have been registered in the machine configuration.</span></span> <span data-ttu-id="8a3bf-177">これにより、リーダーやライターを装った悪意のあるコードが読み込まれるのを防ぐことができます。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-177">This prevents malicious code masquerading as a reader or writer from being loaded.</span></span>  
  
### <a name="periodically-free-objects-that-reference-xname"></a><span data-ttu-id="8a3bf-178">XName を参照するオブジェクトを定期的に解放する</span><span class="sxs-lookup"><span data-stu-id="8a3bf-178">Periodically Free Objects that Reference XName</span></span>  
 <span data-ttu-id="8a3bf-179">アプリケーション プログラマは、ある種の攻撃に対する保護のために、アプリケーション ドメインで <xref:System.Xml.Linq.XName> オブジェクトを参照しているすべてのオブジェクトを定期的に解放する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-179">To protect against certain kinds of attacks, application programmers should free all objects that reference an <xref:System.Xml.Linq.XName> object in the application domain on a regular basis.</span></span>  
  
### <a name="protect-against-random-xml-names"></a><span data-ttu-id="8a3bf-180">ランダムな XML 名から保護する</span><span class="sxs-lookup"><span data-stu-id="8a3bf-180">Protect Against Random XML Names</span></span>  
 <span data-ttu-id="8a3bf-181">信頼されていないソースのデータを受け取るアプリケーションを作成する場合、<xref:System.Xml.XmlReader> をカスタム コードでラップして使用し、ランダムな XML 名や XML 名前空間の使用を検査するように考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-181">Applications that take data from untrusted sources should consider using an <xref:System.Xml.XmlReader> that is wrapped in custom code to inspect for the possibility of random XML names and namespaces.</span></span> <span data-ttu-id="8a3bf-182">これにより、ランダムな XML 名や XML 名前空間が検出された場合に、アプリケーションでその悪意のあるドキュメントの処理を終了できます。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-182">If such random XML names and namespaces are detected, the application can then terminate the processing of the malicious document.</span></span>  
  
 <span data-ttu-id="8a3bf-183">特定の名前空間の名前の数 (および名前空間に含まれない名前の数) を制限することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-183">You might want to limit the number of names in any given namespace (including names in no namespace) to a reasonable limit.</span></span>  
  
### <a name="annotations-are-accessible-by-software-components-that-share-a-linq-to-xml-tree"></a><span data-ttu-id="8a3bf-184">LINQ to XML ツリーを共有するソフトウェア コンポーネントは注釈にアクセスできる</span><span class="sxs-lookup"><span data-stu-id="8a3bf-184">Annotations Are Accessible by Software Components that Share a LINQ to XML Tree</span></span>  
 <span data-ttu-id="8a3bf-185">LINQ to XML を使用すると、さまざまなアプリケーション コンポーネントによって XML データの読み込み、検証、クエリ、変換、更新、および保存が行われる処理パイプラインを構築できます。XML データは、XML ツリーとしてコンポーネント間で受け渡されます。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-185">LINQ to XML could be used to build processing pipelines in which different application components load, validate, query, transform, update, and save XML data that is passed between components as XML trees.</span></span> <span data-ttu-id="8a3bf-186">この場合、オブジェクトを読み込んで XML テキストにシリアル化する際のオーバーヘッドがパイプラインの最後にしか発生しないため、パフォーマンスを最適化することができます。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-186">This can help optimize performance, because the overhead of loading and serializing objects to XML text is done only at the ends of the pipeline.</span></span> <span data-ttu-id="8a3bf-187">ただし、開発者は、あるコンポーネントによって作成される注釈やイベント ハンドラーはすべて、他のコンポーネントからもアクセスできることを認識しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-187">Developers must be aware, however, that all annotations and event handlers created by one component are accessible to other components.</span></span> <span data-ttu-id="8a3bf-188">このことは、異なる信頼レベルのコンポーネントが混在している場合に数々の脆弱性の原因になります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-188">This can create a number of vulnerabilities if the components have different levels of trust.</span></span> <span data-ttu-id="8a3bf-189">信頼レベルの低いコンポーネントが含まれる場合に安全なパイプラインを構築するには、信頼されていないコンポーネントにデータを渡す前に LINQ to XML オブジェクトを XML テキストにシリアル化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-189">To build secure pipelines across less trusted components, you must serialize LINQ to XML objects to XML text before passing the data to an untrusted component.</span></span>  
  
 <span data-ttu-id="8a3bf-190">ある程度のセキュリティが共通言語ランタイム (CLR) によって提供されます。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-190">Some security is provided by the common language runtime (CLR).</span></span> <span data-ttu-id="8a3bf-191">たとえば、プライベート クラスを含まないコンポーネントは、そのクラスによってキー指定された注釈にはアクセスできません。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-191">For example, a component that does not include a private class cannot access annotations keyed by that class.</span></span> <span data-ttu-id="8a3bf-192">ただし、注釈を読み取れないコンポーネントでも、注釈を削除することはできます。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-192">However, annotations can be deleted by components that cannot read them.</span></span> <span data-ttu-id="8a3bf-193">このことが、改ざん攻撃に利用される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8a3bf-193">This could be used as a tampering attack.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8a3bf-194">関連項目</span><span class="sxs-lookup"><span data-stu-id="8a3bf-194">See also</span></span>

- [<span data-ttu-id="8a3bf-195">プログラミング ガイド (LINQ to XML) (C#)</span><span class="sxs-lookup"><span data-stu-id="8a3bf-195">Programming Guide (LINQ to XML) (C#)</span></span>](linq-to-xml-overview.md)
