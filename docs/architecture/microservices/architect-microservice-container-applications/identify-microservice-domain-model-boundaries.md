---
title: マイクロサービスごとにドメイン モデルの境界を識別する
description: 大型のアプリケーションをマイクロサービスに分割し、堅実なアーキテクチャを実現することの本質を探ります。
ms.date: 09/20/2018
ms.openlocfilehash: 9c433066dd8e93dbb09b15e58c9c85617775723d
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/14/2020
ms.locfileid: "71834415"
---
# <a name="identify-domain-model-boundaries-for-each-microservice"></a><span data-ttu-id="2772b-103">マイクロサービスごとにドメイン モデルの境界を識別する</span><span class="sxs-lookup"><span data-stu-id="2772b-103">Identify domain-model boundaries for each microservice</span></span>

<span data-ttu-id="2772b-104">可能であればマイクロサービスの規模は傾向的に小さくする必要があります。しかしながら、各マイクロサービスのモデルの境界とサイズを識別する場合の目標は、できる限り細かい分離を実現することではありません。</span><span class="sxs-lookup"><span data-stu-id="2772b-104">The goal when identifying model boundaries and size for each microservice isn't to get to the most granular separation possible, although you should tend toward small microservices if possible.</span></span> <span data-ttu-id="2772b-105">ドメイン知識に従って最も意味のある分離を実現することに目標を設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2772b-105">Instead, your goal should be to get to the most meaningful separation guided by your domain knowledge.</span></span> <span data-ttu-id="2772b-106">重点を置くのはサイズではなく、ビジネス機能です。</span><span class="sxs-lookup"><span data-stu-id="2772b-106">The emphasis isn't on the size, but instead on business capabilities.</span></span> <span data-ttu-id="2772b-107">加えて、多くの依存関係に基づくアプリケーションの特定の領域に対してクリアな凝集度が必要である場合は、単一のマイクロサービスに対してもそのことが必要になります。</span><span class="sxs-lookup"><span data-stu-id="2772b-107">In addition, if there's clear cohesion needed for a certain area of the application based on a high number of dependencies, that indicates the need for a single microservice, too.</span></span> <span data-ttu-id="2772b-108">凝集度とは、マイクロサービスをどのように分離またはグループ化するかを識別する方法です。</span><span class="sxs-lookup"><span data-stu-id="2772b-108">Cohesion is a way to identify how to break apart or group together microservices.</span></span> <span data-ttu-id="2772b-109">最終的には、ドメインに関する知識をより多く取得しながら、マイクロサービスのサイズを繰り返し調整する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2772b-109">Ultimately, while you gain more knowledge about the domain, you should adapt the size of your microservice, iteratively.</span></span> <span data-ttu-id="2772b-110">適切なサイズを見つけるには、複数回のプロセスが必要です。</span><span class="sxs-lookup"><span data-stu-id="2772b-110">Finding the right size isn't a one-shot process.</span></span>

<span data-ttu-id="2772b-111">マイクロサービスの推奨者として認知され、書籍『[Building Microservices](https://samnewman.io/books/building_microservices/)』 (マイクロサービスの構築) の著者でもある [Sam Newman](https://samnewman.io/) 氏は、以前に紹介した Bounded Context (BC) パターン (ドメインドリブン設計の一部) に基づいてマイクロサービスを設計する必要があることを強調しています。</span><span class="sxs-lookup"><span data-stu-id="2772b-111">[Sam Newman](https://samnewman.io/), a recognized promoter of microservices and author of the book [Building Microservices](https://samnewman.io/books/building_microservices/), highlights that you should design your microservices based on the Bounded Context (BC) pattern (part of domain-driven design), as introduced earlier.</span></span> <span data-ttu-id="2772b-112">場合によって、1 つの BC を複数の物理サービスで構成することが可能ですが、その逆は成立しません。</span><span class="sxs-lookup"><span data-stu-id="2772b-112">Sometimes, a BC could be composed of several physical services, but not vice versa.</span></span>

<span data-ttu-id="2772b-113">具体的な BC またはマイクロサービス内では、特定のドメイン エンティティを持つドメイン モデルが適用されます。</span><span class="sxs-lookup"><span data-stu-id="2772b-113">A domain model with specific domain entities applies within a concrete BC or microservice.</span></span> <span data-ttu-id="2772b-114">BC によってドメイン モデルの適用性の範囲が定められ、開発チームのメンバーは結束性が必要であるもの、および個別に開発できるものを明確に理解し、その理解を共有することができます。</span><span class="sxs-lookup"><span data-stu-id="2772b-114">A BC delimits the applicability of a domain model and gives developer team members a clear and shared understanding of what must be cohesive and what can be developed independently.</span></span> <span data-ttu-id="2772b-115">これらの目標はマイクロサービスと同じです。</span><span class="sxs-lookup"><span data-stu-id="2772b-115">These are the same goals for microservices.</span></span>

<span data-ttu-id="2772b-116">適切な設計を知らせてくれる別のツールとして、[Conway の法則](https://en.wikipedia.org/wiki/Conway%27s_law)があります。この法則によれば、アプリケーションは、それを作成した組織のソーシャル境界を反映すると言うことです。</span><span class="sxs-lookup"><span data-stu-id="2772b-116">Another tool that informs your design choice is [Conway's law](https://en.wikipedia.org/wiki/Conway%27s_law), which states that an application will reflect the social boundaries of the organization that produced it.</span></span> <span data-ttu-id="2772b-117">ただし、場合によっては反対のことも言えます。すなわち、会社の組織はソフトウェアによって形成されるということです。</span><span class="sxs-lookup"><span data-stu-id="2772b-117">But sometimes the opposite is true -the company's organization is formed by the software.</span></span> <span data-ttu-id="2772b-118">Conway の法則とは反対の方法で、会社の編成方法に応じて境界を構築することが必要な場合があります (ビジネス プロセス コンサルティングへの傾倒)。</span><span class="sxs-lookup"><span data-stu-id="2772b-118">You might need to reverse Conway's law and build the boundaries the way you want the company to be organized, leaning toward business process consulting.</span></span>

<span data-ttu-id="2772b-119">境界のあるコンテキストを識別するために、[コンテキスト マッピング パターン](https://www.infoq.com/articles/ddd-contextmapping)と呼ばれている DDD パターンを使用できます。</span><span class="sxs-lookup"><span data-stu-id="2772b-119">To identify bounded contexts, you can use a DDD pattern called the [Context Mapping pattern](https://www.infoq.com/articles/ddd-contextmapping).</span></span> <span data-ttu-id="2772b-120">コンテキスト マッピングでは、アプリケーション内の各種コンテキストとその境界を識別します。</span><span class="sxs-lookup"><span data-stu-id="2772b-120">With Context Mapping, you identify the various contexts in the application and their boundaries.</span></span> <span data-ttu-id="2772b-121">たとえば、小規模なサブシステムごとに異なるコンテキストおよび境界を設定するのが一般的です。</span><span class="sxs-lookup"><span data-stu-id="2772b-121">It's common to have a different context and boundary for each small subsystem, for instance.</span></span> <span data-ttu-id="2772b-122">コンテキスト マッピングは、ドメイン間のそのような境界を定義し、明示するための方法です。</span><span class="sxs-lookup"><span data-stu-id="2772b-122">The Context Map is a way to define and make explicit those boundaries between domains.</span></span> <span data-ttu-id="2772b-123">BC は自律的に機能し、単一ドメインの詳細 (ドメインのエンティティなどの詳細) を含み、その他の BC との統合コントラクトを定義します。</span><span class="sxs-lookup"><span data-stu-id="2772b-123">A BC is autonomous and includes the details of a single domain -details like the domain entities- and defines integration contracts with other BCs.</span></span> <span data-ttu-id="2772b-124">これはマイクロサービスの定義に似ています。マイクロサービスは自律的に機能し、特定のドメインの機能を実装します。また、マイクロサービスはインターフェイスを提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2772b-124">This is similar to the definition of a microservice: it's autonomous, it implements certain domain capability, and it must provide interfaces.</span></span> <span data-ttu-id="2772b-125">このため、コンテキスト マッピングと Bounded Context パターンは、マイクロサービスのドメイン モデル境界を識別するのに適した方法となります。</span><span class="sxs-lookup"><span data-stu-id="2772b-125">This is why Context Mapping and the Bounded Context pattern are good approaches for identifying the domain model boundaries of your microservices.</span></span>

<span data-ttu-id="2772b-126">大規模なアプリケーションを設計する場合、そのドメイン モデルをフラグメント化する方法が表示されます。たとえば、カタログ ドメインからのドメイン エキスパートは、カタログ ドメインおよびインベントリ ドメイン内のエントリに、シッピング ドメイン エキスパートとは異なる方法で名前を付けます。</span><span class="sxs-lookup"><span data-stu-id="2772b-126">When designing a large application, you'll see how its domain model can be fragmented - a domain expert from the catalog domain will name entities differently in the catalog and inventory domains than a shipping domain expert, for instance.</span></span> <span data-ttu-id="2772b-127">または、顧客に関するすべての詳細を格納する CRM エキスパートに対処する場合と、顧客に関する部分的なデータのみを必要とするオーダリング ドメイン エキスパートに対処する場合とでは、ユーザー ドメイン エンティティの属性のサイズと数が異なる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="2772b-127">Or the user domain entity might be different in size and number of attributes when dealing with a CRM expert who wants to store every detail about the customer than for an ordering domain expert who just needs partial data about the customer.</span></span> <span data-ttu-id="2772b-128">大規模なアプリケーションに関連するすべてのドメイン間ですべてのドメイン用語を区別するのは非常に困難です。</span><span class="sxs-lookup"><span data-stu-id="2772b-128">It's very hard to disambiguate all domain terms across all the domains related to a large application.</span></span> <span data-ttu-id="2772b-129">ただし、最も重要な点は用語の統一を試みるのでなく、</span><span class="sxs-lookup"><span data-stu-id="2772b-129">But the most important thing is that you shouldn't try to unify the terms.</span></span> <span data-ttu-id="2772b-130">各ドメインによってもたらされる相違点と豊富さを受け入れることです。</span><span class="sxs-lookup"><span data-stu-id="2772b-130">Instead, accept the differences and richness provided by each domain.</span></span> <span data-ttu-id="2772b-131">アプリケーション全体に対して統一されたデータベースの使用を試みる場合、統一されたボキャブラリの試みには注意を要し、それは複数のドメイン エキスパートのいずれに対しても疑問が生じます。</span><span class="sxs-lookup"><span data-stu-id="2772b-131">If you try to have a unified database for the whole application, attempts at a unified vocabulary will be awkward and won't sound right to any of the multiple domain experts.</span></span> <span data-ttu-id="2772b-132">BC (マイクロサービスとして実装された) を使用すれば、特定のドメイン用語を使用できる場所、およびシステムを分割してそれぞれのドメインで追加の BC を作成する必要が生じる場所を容易に明確にすることができます。</span><span class="sxs-lookup"><span data-stu-id="2772b-132">Therefore, BCs (implemented as microservices) will help you to clarify where you can use certain domain terms and where you'll need to split the system and create additional BCs with different domains.</span></span>

<span data-ttu-id="2772b-133">ドメイン モデル間に強力なリレーションシップがほとんどない場合は各 BC およびドメイン モデルの適切な境界とサイズが取得済みであること、および通常のアプリケーション操作を実行する際は複数のドメイン モデルからの情報をマージすることが一般に必要ないことがわかります。</span><span class="sxs-lookup"><span data-stu-id="2772b-133">You'll know that you got the right boundaries and sizes of each BC and domain model if you have few strong relationships between domain models, and you do not usually need to merge information from multiple domain models when performing typical application operations.</span></span>

<span data-ttu-id="2772b-134">各マイクロサービスのドメイン モデルをどれくらいの大きさにすればよいかという質問に対する最良の回答は、次のようになるでしょう: 自律的な BC (可能な限り分離された) を備えている必要があります。これにより、他のコンテキスト (他のマイクロサービスのモデル) にたびたび切り替えなくても作業が行えます。</span><span class="sxs-lookup"><span data-stu-id="2772b-134">Perhaps the best answer to the question of how large a domain model for each microservice should be is the following: it should have an autonomous BC, as isolated as possible, that enables you to work without having to constantly switch to other contexts (other microservice's models).</span></span> <span data-ttu-id="2772b-135">図 4-10 では、アプリケーション内で識別された各ドメインに関する特定の要件に応じて、複数のマイクロサービス (複数の BC) のそれぞれで独自のモデルを備える方法、およびそれらのエンティティを定義する方法を確認できます。</span><span class="sxs-lookup"><span data-stu-id="2772b-135">In Figure 4-10, you can see how multiple microservices (multiple BCs) each has their own model and how their entities can be defined, depending on the specific requirements for each of the identified domains in your application.</span></span>

![いくつかのモデル境界内のエンティティを示す図。](./media/identify-microservice-domain-model-boundaries/identify-entities-microservice-model-boundries.png)

<span data-ttu-id="2772b-137">**図 4-10**</span><span class="sxs-lookup"><span data-stu-id="2772b-137">**Figure 4-10**.</span></span> <span data-ttu-id="2772b-138">エンティティとマイクロサービス モデルの境界を識別する</span><span class="sxs-lookup"><span data-stu-id="2772b-138">Identifying entities and microservice model boundaries</span></span>

<span data-ttu-id="2772b-139">図 4-10 に、オンライン会議管理システムに関連するサンプル シナリオを示します。</span><span class="sxs-lookup"><span data-stu-id="2772b-139">Figure 4-10 illustrates a sample scenario related to an online conference management system.</span></span> <span data-ttu-id="2772b-140">境界付けられたコンテキストに応じて、同じエンティティが "ユーザー"、"購入者"、"保険会社"、"顧客" と表示されます。</span><span class="sxs-lookup"><span data-stu-id="2772b-140">The same entity appears as "Users", "Buyers", "Payers", and "Customers" depending on the bounded context.</span></span> <span data-ttu-id="2772b-141">ドメイン エキスパートが代わりに定義したドメインに基づいて、マイクロサービスとして実装可能な複数の BC を識別しました。</span><span class="sxs-lookup"><span data-stu-id="2772b-141">You've identified several BCs that could be implemented as microservices, based on domains that domain experts defined for you.</span></span> <span data-ttu-id="2772b-142">ご覧のように、単一のマイクロサービス モデル内にのみ存在するエンティティがあります ("Payment" マイクロサービス内の "Payments" など)。</span><span class="sxs-lookup"><span data-stu-id="2772b-142">As you can see, there are entities that are present just in a single microservice model, like Payments in the Payment microservice.</span></span> <span data-ttu-id="2772b-143">それらを実装することは簡単です。</span><span class="sxs-lookup"><span data-stu-id="2772b-143">Those will be easy to implement.</span></span>

<span data-ttu-id="2772b-144">ただし、複数のマイクロサービスからの複数のドメイン モデル間で、シェイプは異なるが同じ識別情報を共有するエンティティが存在する場合もあります。</span><span class="sxs-lookup"><span data-stu-id="2772b-144">However, you might also have entities that have a different shape but share the same identity across the multiple domain models from the multiple microservices.</span></span> <span data-ttu-id="2772b-145">たとえば、User エンティティは "Conferences Management" マイクロサービスで識別されます。</span><span class="sxs-lookup"><span data-stu-id="2772b-145">For example, the User entity is identified in the Conferences Management microservice.</span></span> <span data-ttu-id="2772b-146">その同一のユーザー (同一の識別情報が割り当てられた) は "Ordering" マイクロサービスでは "Buyers" という名前になり、"Payment" マイクロサービスでは "Payer" という名前になり、さらに "Customer Service" マイクロサービスでは "Customer" という名前になります。</span><span class="sxs-lookup"><span data-stu-id="2772b-146">That same user, with the same identity, is the one named Buyers in the Ordering microservice, or the one named Payer in the Payment microservice, and even the one named Customer in the Customer Service microservice.</span></span> <span data-ttu-id="2772b-147">各ドメイン エキスパートが使用している[ユビキタス言語](https://martinfowler.com/bliki/UbiquitousLanguage.html)に基づいて、ユーザーは、さまざまな属性も使用して異なる分析観点で見る場合があるために、このようなことが生じます。</span><span class="sxs-lookup"><span data-stu-id="2772b-147">This is because, depending on the [ubiquitous language](https://martinfowler.com/bliki/UbiquitousLanguage.html) that each domain expert is using, a user might have a different perspective even with different attributes.</span></span> <span data-ttu-id="2772b-148">"Conferences Management" という名前のマイクロサービス モデルのユーザー エンティティには、その個人データ属性のほとんどが含まれる場合があります。</span><span class="sxs-lookup"><span data-stu-id="2772b-148">The user entity in the microservice model named Conferences Management might have most of its personal data attributes.</span></span> <span data-ttu-id="2772b-149">ただし、"Payment" マイクロサービスの "Payer" のシェイプ内のユーザー、または "Customer Service" マイクロサービスの "Customer" のシェイプ内のユーザーは同じユーザーであっても、同じ属性リストを必要としない場合があります。</span><span class="sxs-lookup"><span data-stu-id="2772b-149">However, that same user in the shape of Payer in the microservice Payment or in the shape of Customer in the microservice Customer Service might not need the same list of attributes.</span></span>

<span data-ttu-id="2772b-150">同様のアプローチを図 4-11 に示します。</span><span class="sxs-lookup"><span data-stu-id="2772b-150">A similar approach is illustrated in Figure 4-11.</span></span>

![データ モデルを複数のドメイン モデルに分解する方法を示す図。](./media/identify-microservice-domain-model-boundaries/decompose-traditional-data-models.png)

<span data-ttu-id="2772b-152">**図 4-11**</span><span class="sxs-lookup"><span data-stu-id="2772b-152">**Figure 4-11**.</span></span> <span data-ttu-id="2772b-153">従来のデータ モデルを複数のドメイン モデルに分解する</span><span class="sxs-lookup"><span data-stu-id="2772b-153">Decomposing traditional data models into multiple domain models</span></span>

<span data-ttu-id="2772b-154">境界付きコンテキストで従来のデータ モデルを分解するとき、同じ ID を共有するエンティティ (バイヤーはユーザーでもあります) でも境界付きコンテキストごとに属性が異なる場合があります。</span><span class="sxs-lookup"><span data-stu-id="2772b-154">When decomposing a traditional data model between bounded contexts, you can have different entities that share the same identity (a buyer is also a user) with different attributes in each bounded context.</span></span> <span data-ttu-id="2772b-155">ユーザーが User エンティティとして "Conferences Management" マイクロサービス モデル内にどのように存在し、また "Pricing" マイクロサービスにも Buyer エンティティの形式でどのように存在しているのか (代替属性か、またはユーザーが実際に購入者である場合のユーザーに関する詳細を使用して) を確認できます。</span><span class="sxs-lookup"><span data-stu-id="2772b-155">You can see how the user is present in the Conferences Management microservice model as the User entity and is also present in the form of the Buyer entity in the Pricing microservice, with alternate attributes or details about the user when it's actually a buyer.</span></span> <span data-ttu-id="2772b-156">解決する問題またはコンテキストによっては、各マイクロサービスまたは BC は、User エンティティに関連するすべてのデータを必要とするのでなく、その一部のみを必要とする場合があります。</span><span class="sxs-lookup"><span data-stu-id="2772b-156">Each microservice or BC might not need all the data related to a User entity, just part of it, depending on the problem to solve or the context.</span></span> <span data-ttu-id="2772b-157">たとえば、"Pricing" マイクロサービス モデルでは、ユーザーのアドレスも名前も必要なく、ID (識別情報としての) と Status のみを必要とします。このデータは購入者ごとにシートの価格を設定する場合に値引きに影響を与えます。</span><span class="sxs-lookup"><span data-stu-id="2772b-157">For instance, in the Pricing microservice model, you do not need the address or the name of the user, just the ID (as identity) and Status, which will have an impact on discounts when pricing the seats per buyer.</span></span>

<span data-ttu-id="2772b-158">各ドメイン内で Seat エンティティの名前は同じですが、その属性は異なっています。</span><span class="sxs-lookup"><span data-stu-id="2772b-158">The Seat entity has the same name but different attributes in each domain model.</span></span> <span data-ttu-id="2772b-159">ただし、Seat は User および Buyer の場合と同様に、同じ ID に基づいて識別情報を共有します。</span><span class="sxs-lookup"><span data-stu-id="2772b-159">However, Seat shares identity based on the same ID, as happens with User and Buyer.</span></span>

<span data-ttu-id="2772b-160">基本的には、複数のサービス (ドメイン) に存在するユーザーの共有の概念があります。この概念では、すべてがそのユーザーの識別情報を共有します。</span><span class="sxs-lookup"><span data-stu-id="2772b-160">Basically, there's a shared concept of a user that exists in multiple services (domains), which all share the identity of that user.</span></span> <span data-ttu-id="2772b-161">ただし、各ドメイン モデルには、ユーザー エンティティに関する追加のまたは異なる詳細情報が存在する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="2772b-161">But in each domain model there might be additional or different details about the user entity.</span></span> <span data-ttu-id="2772b-162">そのため、あるドメイン (マイクロサービス) から別のドメインにユーザー エンティティをマップする方法が必要です。</span><span class="sxs-lookup"><span data-stu-id="2772b-162">Therefore, there needs to be a way to map a user entity from one domain (microservice) to another.</span></span>

<span data-ttu-id="2772b-163">ドメイン間で同じユーザー エンティティを同じ数の属性と共有しないことには、いくつかの利点があります。</span><span class="sxs-lookup"><span data-stu-id="2772b-163">There are several benefits to not sharing the same user entity with the same number of attributes across domains.</span></span> <span data-ttu-id="2772b-164">1 つの利点は重複が少なくなるということです。この結果、マイクロサービス モデルには、必要のないデータが含まれなくなります。</span><span class="sxs-lookup"><span data-stu-id="2772b-164">One benefit is to reduce duplication, so that microservice models do not have any data that they do not need.</span></span> <span data-ttu-id="2772b-165">もう 1 つ利点は、エンティティごとに特定の種類のデータを所有するマスター マイクロサービスを設定できるということです。これにより、該当する種類のデータに対する更新およびクエリはマスター マイクロサービスによってのみ制御されます。</span><span class="sxs-lookup"><span data-stu-id="2772b-165">Another benefit is having a master microservice that owns a certain type of data per entity so that updates and queries for that type of data are driven only by that microservice.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="2772b-166">[前へ](distributed-data-management.md)
>[次へ](direct-client-to-microservice-communication-versus-the-api-gateway-pattern.md)</span><span class="sxs-lookup"><span data-stu-id="2772b-166">[Previous](distributed-data-management.md)
[Next](direct-client-to-microservice-communication-versus-the-api-gateway-pattern.md)</span></span>
