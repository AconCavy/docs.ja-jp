---
title: 部分的なエラーの処理
description: 部分的なエラーを適切に処理する方法について説明します。 マイクロサービスは完全には機能していませんが、一部の役に立つ作業を実行できる場合があります。
ms.date: 10/16/2018
ms.openlocfilehash: 0300719360e1a2500db0af8454c91fdfe2e5b09b
ms.sourcegitcommit: e3cbf26d67f7e9286c7108a2752804050762d02d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/09/2020
ms.locfileid: "80988871"
---
# <a name="handle-partial-failure"></a><span data-ttu-id="b87f5-104">部分的なエラーを処理する</span><span class="sxs-lookup"><span data-stu-id="b87f5-104">Handle partial failure</span></span>

<span data-ttu-id="b87f5-105">マイクロサービスベースのアプリケーションのような分散システムでは、部分的なエラーが発生するリスクが常にあります。</span><span class="sxs-lookup"><span data-stu-id="b87f5-105">In distributed systems like microservices-based applications, there's an ever-present risk of partial failure.</span></span> <span data-ttu-id="b87f5-106">たとえば、単一のマイクロサービス/コンテナーでエラーが発生する場合、短時間応答できない場合、単一の VM またはサーバーがクラッシュする場合があります。</span><span class="sxs-lookup"><span data-stu-id="b87f5-106">For instance, a single microservice/container can fail or might not be available to respond for a short time, or a single VM or server can crash.</span></span> <span data-ttu-id="b87f5-107">クライアントとサービスは別のプロセスなので、サービスがクライアントの要求に迅速に応答できないことがあります。</span><span class="sxs-lookup"><span data-stu-id="b87f5-107">Since clients and services are separate processes, a service might not be able to respond in a timely way to a client's request.</span></span> <span data-ttu-id="b87f5-108">サービスが過負荷になり、要求への応答が非常に遅くなる場合や、ネットワークの問題のために短時間アクセスできなくなる場合があります。</span><span class="sxs-lookup"><span data-stu-id="b87f5-108">The service might be overloaded and responding very slowly to requests or might simply not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="b87f5-109">eShopOnContainers サンプル アプリケーションの [Order details]\(注文の詳細\) ページを例にして考えてみましょう。</span><span class="sxs-lookup"><span data-stu-id="b87f5-109">For example, consider the Order details page from the eShopOnContainers sample application.</span></span> <span data-ttu-id="b87f5-110">ユーザーが発注しようとしたときに発注マイクロサービスが応答しない場合、クライアント プロセスの不適切な実装 (MVC Web アプリケーション) では、たとえばクライアント コードがタイムアウトのない同期 RPC を使用する場合などに、応答を無期限に待機するスレッドがブロックされます。</span><span class="sxs-lookup"><span data-stu-id="b87f5-110">If the ordering microservice is unresponsive when the user tries to submit an order, a bad implementation of the client process (the MVC web application)—for example, if the client code were to use synchronous RPCs with no timeout—would block threads indefinitely waiting for a response.</span></span> <span data-ttu-id="b87f5-111">不適切なユーザー エクスペリエンスが作り出されるだけでなく、応答しない待機が発生するたびにスレッドが消費またはブロックされます。また、スケーラブルなアプリケーションでは、スレッドは非常に重要です。</span><span class="sxs-lookup"><span data-stu-id="b87f5-111">Besides creating a bad user experience, every unresponsive wait consumes or blocks a thread, and threads are extremely valuable in highly scalable applications.</span></span> <span data-ttu-id="b87f5-112">ブロックされたスレッドが多数発生すると、最終的にはアプリケーションの実行時にスレッドが不足する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="b87f5-112">If there are many blocked threads, eventually the application's runtime can run out of threads.</span></span> <span data-ttu-id="b87f5-113">その場合、図 8-1 に示すように、アプリケーションは部分的に応答しなくなるのではなく、全体的に応答しなくなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="b87f5-113">In that case, the application can become globally unresponsive instead of just partially unresponsive, as shown in Figure 8-1.</span></span>

![部分的なエラーを示す図。](./media/handle-partial-failure/partial-failures-diagram.png)

<span data-ttu-id="b87f5-115">**図 8-1**。</span><span class="sxs-lookup"><span data-stu-id="b87f5-115">**Figure 8-1**.</span></span> <span data-ttu-id="b87f5-116">サービス スレッドの可用性に影響する依存関係が原因の部分的なエラー</span><span class="sxs-lookup"><span data-stu-id="b87f5-116">Partial failures because of dependencies that impact service thread availability</span></span>

<span data-ttu-id="b87f5-117">大規模なマイクロサービスベースのアプリケーションでは、部分的なエラーが拡大する可能性があります。特に、内部マイクロサービスの相互作用のほとんどが同期 HTTP 呼び出し (アンチパターンと見なされます) に基づいている場合は拡大する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="b87f5-117">In a large microservices-based application, any partial failure can be amplified, especially if most of the internal microservices interaction is based on synchronous HTTP calls (which is considered an anti-pattern).</span></span> <span data-ttu-id="b87f5-118">1 日あたり何百万もの着信を受け取るシステムについて考えてみましょう。</span><span class="sxs-lookup"><span data-stu-id="b87f5-118">Think about a system that receives millions of incoming calls per day.</span></span> <span data-ttu-id="b87f5-119">同期 HTTP 呼び出しの長いチェーンに基づいているような不適切な設計のシステムの場合、このような着信の結果、同期の依存関係として数百万の発信が数十の内部マイクロサービスに対して行われる可能性があります (たとえば、1:4 の比率としましょう)。</span><span class="sxs-lookup"><span data-stu-id="b87f5-119">If your system has a bad design that's based on long chains of synchronous HTTP calls, these incoming calls might result in many more millions of outgoing calls (let's suppose a ratio of 1:4) to dozens of internal microservices as synchronous dependencies.</span></span> <span data-ttu-id="b87f5-120">この状況は、図 8-2 に示されています。特に依存関係 \#3 であり、チェーンが開始され、依存関係 #4 が呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="b87f5-120">This situation is shown in Figure 8-2, especially dependency \#3, that starts a chain, calling dependency #4.</span></span> <span data-ttu-id="b87f5-121">これにより #5 が呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="b87f5-121">which the calls #5.</span></span>

![複数の分散依存関係を示す図。](./media/handle-partial-failure/multiple-distributed-dependencies.png)

<span data-ttu-id="b87f5-123">**図 8-2**。</span><span class="sxs-lookup"><span data-stu-id="b87f5-123">**Figure 8-2**.</span></span> <span data-ttu-id="b87f5-124">HTTP 要求の長いチェーンが特徴の不適切な設計の影響</span><span class="sxs-lookup"><span data-stu-id="b87f5-124">The impact of having an incorrect design featuring long chains of HTTP requests</span></span>

<span data-ttu-id="b87f5-125">分散型のクラウド ベースのシステムでは、すべての依存関係自体に優れた可用性がある場合でも、断続的なエラーは必ず発生します。</span><span class="sxs-lookup"><span data-stu-id="b87f5-125">Intermittent failure is guaranteed in a distributed and cloud-based system, even if every dependency itself has excellent availability.</span></span> <span data-ttu-id="b87f5-126">この点を考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="b87f5-126">It's a fact you need to consider.</span></span>

<span data-ttu-id="b87f5-127">フォールト トレランスを確保するための手法を設計および実装していない場合は、たとえ短時間のダウンタイムであっても増幅する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="b87f5-127">If you do not design and implement techniques to ensure fault tolerance, even small downtimes can be amplified.</span></span> <span data-ttu-id="b87f5-128">たとえば、可用性がそれぞれ 99.99% の依存関係が 50 個ある場合、この波及効果のために毎月数時間のダウンタイムが発生します。</span><span class="sxs-lookup"><span data-stu-id="b87f5-128">As an example, 50 dependencies each with 99.99% of availability would result in several hours of downtime each month because of this ripple effect.</span></span> <span data-ttu-id="b87f5-129">マイクロサービスの依存関係が大量の要求を処理しているときにエラーが発生すると、そのエラーによって各サービスのすべての使用可能な要求スレッドが短時間で飽和状態になり、アプリケーション全体がクラッシュする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="b87f5-129">When a microservice dependency fails while handling a high volume of requests, that failure can quickly saturate all available request threads in each service and crash the whole application.</span></span>

![マイクロサービスで増幅された部分的なエラーを示す図。](./media/handle-partial-failure/partial-failure-amplified-microservices.png)

<span data-ttu-id="b87f5-131">**図 8-3**。</span><span class="sxs-lookup"><span data-stu-id="b87f5-131">**Figure 8-3**.</span></span> <span data-ttu-id="b87f5-132">同期 HTTP 呼び出しの長いチェーンがあるマイクロサービスによって増幅される部分的なエラー</span><span class="sxs-lookup"><span data-stu-id="b87f5-132">Partial failure amplified by microservices with long chains of synchronous HTTP calls</span></span>

<span data-ttu-id="b87f5-133">この問題を最小限に抑えるために、このガイドの「[マイクロ サービスの自律性を強制する非同期マイクロ サービスの統合](../architect-microservice-container-applications/communication-in-microservice-architecture.md#asynchronous-microservice-integration-enforces-microservices-autonomy)」セクションでは、内部のマイクロサービス全体で非同期通信を使用することをお勧めしています。</span><span class="sxs-lookup"><span data-stu-id="b87f5-133">To minimize this problem, in the section [Asynchronous microservice integration enforce microservice's autonomy](../architect-microservice-container-applications/communication-in-microservice-architecture.md#asynchronous-microservice-integration-enforces-microservices-autonomy), this guide encourages you to use asynchronous communication across the internal microservices.</span></span>

<span data-ttu-id="b87f5-134">さらに、部分的なエラーを処理する (つまり、回復力のあるマイクロサービスとクライアント アプリケーションを構築する) ようにマイクロサービスとクライアント アプリケーションを設計することが不可欠です。</span><span class="sxs-lookup"><span data-stu-id="b87f5-134">In addition, it's essential that you design your microservices and client applications to handle partial failures—that is, to build resilient microservices and client applications.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="b87f5-135">[前へ](index.md)
>[次へ](partial-failure-strategies.md)</span><span class="sxs-lookup"><span data-stu-id="b87f5-135">[Previous](index.md)
[Next](partial-failure-strategies.md)</span></span>
