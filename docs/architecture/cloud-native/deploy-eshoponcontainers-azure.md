---
title: eShopOnContainers を Azure にデプロイする
description: Azure Kubernetes Service、ヘルム、および DevSpaces を使用した eShopOnContainers アプリケーションのデプロイ。
ms.date: 06/30/2019
ms.openlocfilehash: 21033cc904dc595193c69f3452ce2522740f8ff6
ms.sourcegitcommit: 55f438d4d00a34b9aca9eedaac3f85590bb11565
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/23/2019
ms.locfileid: "73840491"
---
# <a name="deploying-eshoponcontainers-to-azure"></a><span data-ttu-id="67b61-103">eShopOnContainers を Azure にデプロイする</span><span class="sxs-lookup"><span data-stu-id="67b61-103">Deploying eShopOnContainers to Azure</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="67b61-104">EShopOnContainers アプリケーションをサポートするロジックは、さまざまなサービスを使用して Azure でサポートできます。</span><span class="sxs-lookup"><span data-stu-id="67b61-104">The logic supporting the eShopOnContainers application can be supported by Azure using a variety of services.</span></span> <span data-ttu-id="67b61-105">Azure Kubernetes Service (AKS) を使用して Kubernetes を利用する方法をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="67b61-105">The recommended approach is to leverage Kubernetes using Azure Kubernetes Service (AKS).</span></span> <span data-ttu-id="67b61-106">これは、簡単に繰り返されるインフラストラクチャ構成を実現するために、ヘルム配置と組み合わせることができます。</span><span class="sxs-lookup"><span data-stu-id="67b61-106">This can be combined with Helm deployment to ensure easily repeated infrastructure configuration.</span></span> <span data-ttu-id="67b61-107">開発プロセスの一部として、開発者は必要に応じて Kubernetes の Azure Dev Spaces を利用できます。</span><span class="sxs-lookup"><span data-stu-id="67b61-107">Optionally, developers can leverage Azure Dev Spaces for Kubernetes as part of their development process.</span></span> <span data-ttu-id="67b61-108">別の方法として、Azure Functions や Azure Logic Apps などの Azure サーバーレス機能を使用してアプリの機能をホストすることもできます。</span><span class="sxs-lookup"><span data-stu-id="67b61-108">Another option is to host the functionality of the app using Azure Serverless features like Azure Functions and Azure Logic Apps.</span></span>

## <a name="azure-kubernetes-service"></a><span data-ttu-id="67b61-109">Azure Kubernetes Service</span><span class="sxs-lookup"><span data-stu-id="67b61-109">Azure Kubernetes Service</span></span>

<span data-ttu-id="67b61-110">独自の AKS クラスターで eShopOnContainers アプリケーションをホストする場合は、最初の手順としてクラスターを作成します。</span><span class="sxs-lookup"><span data-stu-id="67b61-110">If you'd like to host the eShopOnContainers application in your own AKS cluster, the first step is to create your cluster.</span></span> <span data-ttu-id="67b61-111">これを行うには、Azure portal を使用します。ここでは、必要な手順を順番に説明します。または、Azure CLI を使用して、ロールベースの Access Control (RBAC) とアプリケーションのルーティングを有効にするために注意を払う必要があります。</span><span class="sxs-lookup"><span data-stu-id="67b61-111">You can do this using the Azure portal, which will walk you through the required steps, or you can use the Azure CLI, taking care to ensure you enable Role-Based Access Control (RBAC) and application routing when you do so.</span></span> <span data-ttu-id="67b61-112">EShopOnContainers のドキュメントでは、独自の AKS クラスターを作成する手順について説明しています。</span><span class="sxs-lookup"><span data-stu-id="67b61-112">The eShopOnContainers' documentation describes the steps involved in creating your own AKS cluster.</span></span> <span data-ttu-id="67b61-113">クラスターが作成されたら、Kubernetes ダッシュボードへのアクセスを有効にする必要があります。この時点で、Kubernetes ダッシュボードを参照してクラスターを管理することができます。</span><span class="sxs-lookup"><span data-stu-id="67b61-113">Once the cluster is created, you must enable access to the Kubernetes dashboard, at which point you should be able to browse to the Kubernetes dashboard to manage the cluster.</span></span>

<span data-ttu-id="67b61-114">クラスターを作成して構成したら、そのクラスターに対して、ヘルムと Tiller を使用してアプリケーションをデプロイできます。</span><span class="sxs-lookup"><span data-stu-id="67b61-114">Once the cluster has been created and configured, you can deploy the application to it using Helm and Tiller.</span></span>

## <a name="deploying-to-azure-kubernetes-service-using-helm"></a><span data-ttu-id="67b61-115">ヘルムを使用した Azure Kubernetes Service へのデプロイ</span><span class="sxs-lookup"><span data-stu-id="67b61-115">Deploying to Azure Kubernetes Service using Helm</span></span>

<span data-ttu-id="67b61-116">AKS への基本的な配置では、カスタム CLI スクリプトまたは単純な配置ファイルを使用できますが、より複雑なアプリケーションでは、ヘルムなどの依存関係管理ツールを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="67b61-116">Basic deployments to AKS may use custom CLI scripts or simple deployment files, but more complex applications should use a dependency management tool like Helm.</span></span> <span data-ttu-id="67b61-117">ヘルムは、クラウドネイティブコンピューティングファンデーションによって管理されており、Kubernetes アプリケーションを定義、インストール、およびアップグレードするのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="67b61-117">Helm is maintained by the Cloud-native Computing Foundation and helps you define, install, and upgrade Kubernetes applications.</span></span> <span data-ttu-id="67b61-118">ヘルムは、ヘルムグラフを使用するコマンドラインクライアント、およびクラスター内コンポーネントの Tiller で構成されています。</span><span class="sxs-lookup"><span data-stu-id="67b61-118">Helm is composed of a command-line client, helm, which uses helm charts, and an in-cluster component, Tiller.</span></span> <span data-ttu-id="67b61-119">ヘルムグラフでは、標準の YAML 形式のファイルを使用して、関連する Kubernetes リソースのセットを記述します。通常は、ここで説明するアプリケーションと共にバージョン管理されます。</span><span class="sxs-lookup"><span data-stu-id="67b61-119">Helm Charts use standard YAML-formatted files to describe a related set of Kubernetes resources and are typically versioned alongside the application they describe.</span></span> <span data-ttu-id="67b61-120">ヘルムグラフは、記述されているインストールの要件に応じて、単純なものから複雑なものまで多岐に範囲されています。</span><span class="sxs-lookup"><span data-stu-id="67b61-120">Helm Charts range from simple to complex depending on the requirements of the installation they describe.</span></span>

<span data-ttu-id="67b61-121">EShopOnContainers ヘルムグラフは、/k8s/ヘルムフォルダーにあります。</span><span class="sxs-lookup"><span data-stu-id="67b61-121">You'll find the eShopOnContainers helm charts in the /k8s/helm folder.</span></span> <span data-ttu-id="67b61-122">図2-6 は、アプリケーションのさまざまなコンポーネントを、ヘルムが配置を定義するために使用するフォルダー構造に編成する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="67b61-122">Figure 2-6 shows how the different components of the application are organized into a folder structure used by helm to define and managed deployments.</span></span>

<span data-ttu-id="67b61-123">![eShopOnContainers アーキテクチャ](./media/eshoponcontainers-helm-folder.png)
**図 2-6**。</span><span class="sxs-lookup"><span data-stu-id="67b61-123">![eShopOnContainers Architecture](./media/eshoponcontainers-helm-folder.png)
**Figure 2-6**.</span></span> <span data-ttu-id="67b61-124">EShopOnContainers ヘルムフォルダー。</span><span class="sxs-lookup"><span data-stu-id="67b61-124">The eShopOnContainers helm folder.</span></span>

<span data-ttu-id="67b61-125">個々のコンポーネントは、`helm install` コマンドを使用してインストールされます。</span><span class="sxs-lookup"><span data-stu-id="67b61-125">Each individual component is installed using a `helm install` command.</span></span> <span data-ttu-id="67b61-126">これらのコマンドは簡単にスクリプト化できます。 eShopOnContainers には、さまざまなコンポーネントをループ処理し、それぞれのヘルムグラフを使用してインストールする "deploy all" スクリプトが用意されています。</span><span class="sxs-lookup"><span data-stu-id="67b61-126">These commands are easily scripted, and eShopOnContainers provides a "deploy all" script that loops through the different components and installs them using their respective helm charts.</span></span> <span data-ttu-id="67b61-127">結果として、ソース管理のアプリケーションでバージョン管理された反復可能なプロセスが生成されます。これにより、チームのすべてのユーザーが1行のスクリプトコマンドで AKS クラスターにデプロイできるようになります。</span><span class="sxs-lookup"><span data-stu-id="67b61-127">The result is a repeatable process, versioned with the application in source control, that anyone on the team can deploy to an AKS cluster with a one-line script command.</span></span> <span data-ttu-id="67b61-128">特に Azure Dev Spaces と組み合わせると、開発者はマイクロサービスベースのクラウドネイティブアプリに対する個々の変更を簡単に診断してテストすることができます。</span><span class="sxs-lookup"><span data-stu-id="67b61-128">Especially when combined with Azure Dev Spaces, this makes it easy for developers to diagnose and test their individual changes to their microservice-based cloud-native apps.</span></span>

## <a name="azure-dev-spaces"></a><span data-ttu-id="67b61-129">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="67b61-129">Azure Dev Spaces</span></span>

<span data-ttu-id="67b61-130">Azure Dev Spaces は、開発中に個人の開発者が Azure で独自の AKS クラスターをホストするのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="67b61-130">Azure Dev Spaces helps individual developers host their own unique version of AKS clusters in Azure during development.</span></span> <span data-ttu-id="67b61-131">これにより、ローカルコンピューターの要件が最小限に抑えられ、チームメンバーは、実際の AKS 環境での変更の動作をすばやく確認できます。</span><span class="sxs-lookup"><span data-stu-id="67b61-131">This minimizes local machine requirements and allows team members to quickly see how their changes will behave in a real AKS environment.</span></span> <span data-ttu-id="67b61-132">Azure Dev Spaces には、開発者が開発スペースを管理し、必要に応じて特定の子開発領域に配置するために使用する CLI が用意されています。</span><span class="sxs-lookup"><span data-stu-id="67b61-132">Azure Dev Spaces offers a CLI for developers to use to manage their dev spaces and to deploy to a specific child dev space as needed.</span></span> <span data-ttu-id="67b61-133">各子 dev 空間は、一意の URL サブドメインを使用して参照されます。これにより、個々の開発者が、進行中の他の作業との競合を回避できるように、変更されたクラスターをサイドバイサイドで配置できます。</span><span class="sxs-lookup"><span data-stu-id="67b61-133">Each child dev space is referenced using a unique URL subdomain, allowing side-by-side deployments of modified clusters so that individual developers can avoid conflicting with each other's work in progress.</span></span> <span data-ttu-id="67b61-134">図2-7 では、developer Susie が独自のバージョンの Bikes マイクロサービスを開発領域にデプロイした方法を確認できます。</span><span class="sxs-lookup"><span data-stu-id="67b61-134">In Figure 2-7 you can see how developer Susie has deployed her own version of the Bikes microservice into her dev space.</span></span> <span data-ttu-id="67b61-135">次に、自分のスペースの名前 (susie.s.dev.myapp.eus.azds.io) で始まるカスタム URL を使用して、自分の変更をテストできます。</span><span class="sxs-lookup"><span data-stu-id="67b61-135">She's then able to test her changes using a custom URL starting with the name of her space (susie.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="67b61-136">![eShopOnContainers アーキテクチャ](./media/azure-devspaces-one.png)
**図 2-7**。</span><span class="sxs-lookup"><span data-stu-id="67b61-136">![eShopOnContainers Architecture](./media/azure-devspaces-one.png)
**Figure 2-7**.</span></span> <span data-ttu-id="67b61-137">Developer Susie は独自のバージョンの Bikes マイクロサービスをデプロイしてテストします。</span><span class="sxs-lookup"><span data-stu-id="67b61-137">Developer Susie deploys her own version of the Bikes microservice and tests it.</span></span>

<span data-ttu-id="67b61-138">同時に、開発者 John は予約マイクロサービスをカスタマイズし、変更をテストする必要があります。</span><span class="sxs-lookup"><span data-stu-id="67b61-138">At the same time, developer John is customizing the Reservations microservice and needs to test his changes.</span></span> <span data-ttu-id="67b61-139">図2-8 に示すように、Susie の変更と競合することなく、自分の開発スペースに変更をデプロイできます。</span><span class="sxs-lookup"><span data-stu-id="67b61-139">He's able to deploy his changes to his own dev space without conflicting with Susie's changes as shown in Figure 2-8.</span></span> <span data-ttu-id="67b61-140">彼は自分の URL を使用して自分の変更をテストすることができます。自分の URL の先頭には、スペース (john.s.dev.myapp.eus.azds.io) の名前が付いています。</span><span class="sxs-lookup"><span data-stu-id="67b61-140">He can test his changes using his own URL which is prefixed with the name of his space (john.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="67b61-141">![eShopOnContainers アーキテクチャ](./media/azure-devspaces-two.png)
**図 2-8**。</span><span class="sxs-lookup"><span data-stu-id="67b61-141">![eShopOnContainers Architecture](./media/azure-devspaces-two.png)
**Figure 2-8**.</span></span> <span data-ttu-id="67b61-142">開発者 John は独自のバージョンの予約マイクロサービスをデプロイし、他の開発者と競合することなくテストします。</span><span class="sxs-lookup"><span data-stu-id="67b61-142">Developer John deploys his own version of the Reservations microservice and tests it without conflicting with other developers.</span></span>

<span data-ttu-id="67b61-143">Azure Dev Spaces を使用すると、チームは AKS を直接操作しながら、変更の変更、配置、およびテストを行うことができます。</span><span class="sxs-lookup"><span data-stu-id="67b61-143">Using Azure Dev Spaces, teams can work directly with AKS while independently changing, deploying, and testing their changes.</span></span> <span data-ttu-id="67b61-144">この方法では、すべての開発者が独自の AKS 環境を使用するため、個別の専用ホスト環境が必要になります。</span><span class="sxs-lookup"><span data-stu-id="67b61-144">This approach reduces the need for separate dedicated hosted environments since every developer effectively has their own AKS environment.</span></span> <span data-ttu-id="67b61-145">開発者は CLI を使用して Azure Dev Spaces を操作したり、アプリケーションを起動して Visual Studio から直接 Azure Dev Spaces したりできます。</span><span class="sxs-lookup"><span data-stu-id="67b61-145">Developers can work with Azure Dev Spaces using its CLI or launch their application to Azure Dev Spaces directly from Visual Studio.</span></span> [<span data-ttu-id="67b61-146">Azure Dev Spaces のしくみと構成方法の詳細については、こちらを参照してください。</span><span class="sxs-lookup"><span data-stu-id="67b61-146">Learn more about how Azure Dev Spaces works and is configured.</span></span>](https://docs.microsoft.com/azure/dev-spaces/how-dev-spaces-works)

## <a name="azure-functions-and-logic-apps-serverless"></a><span data-ttu-id="67b61-147">Azure Functions と Logic Apps (サーバーレス)</span><span class="sxs-lookup"><span data-stu-id="67b61-147">Azure Functions and Logic Apps (Serverless)</span></span>

<span data-ttu-id="67b61-148">EShopOnContainers サンプルには、オンラインマーケティングキャンペーンの追跡のサポートが含まれています。</span><span class="sxs-lookup"><span data-stu-id="67b61-148">The eShopOnContainers sample includes support for tracking online marketing campaigns.</span></span> <span data-ttu-id="67b61-149">Azure 関数は、指定されたキャンペーン ID のマーケティングキャンペーンの詳細を取得するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="67b61-149">An Azure Function is used to pull marketing campaign details for a given campaign ID.</span></span> <span data-ttu-id="67b61-150">この目的のために完全な ASP.NET Core アプリケーションを作成するのではなく、1つの Azure 関数エンドポイントがシンプルで十分です。</span><span class="sxs-lookup"><span data-stu-id="67b61-150">Rather than creating a complete ASP.NET Core application for this purpose, a single Azure Function endpoint is simpler and sufficient.</span></span> <span data-ttu-id="67b61-151">Azure Functions は、特に Kubernetes で実行するように構成されている場合に、完全 ASP.NET Core アプリケーションよりもはるかに簡単なビルドおよび配置モデルを備えています。</span><span class="sxs-lookup"><span data-stu-id="67b61-151">Azure Functions have a much simpler build and deployment model than full ASP.NET Core applications, especially when configured to run in Kubernetes.</span></span> <span data-ttu-id="67b61-152">関数の配置は、Azure Resource Manager (ARM) テンプレートと Azure CLI を使用してスクリプト化されます。</span><span class="sxs-lookup"><span data-stu-id="67b61-152">Deploying the function is scripted using Azure Resource Manager (ARM) templates and the Azure CLI.</span></span> <span data-ttu-id="67b61-153">このキャンペーン詳細マイクロサービスは顧客向けではなく、オンラインストアと同じ要件がないため、Azure Functions の候補として適しています。</span><span class="sxs-lookup"><span data-stu-id="67b61-153">This campaign details microservice isn't customer-facing and doesn't have the same requirements as the online store, making it a good candidate for Azure Functions.</span></span> <span data-ttu-id="67b61-154">関数を使用するには、データベース接続文字列データやイメージベース URI 設定など、一部の構成が適切に機能する必要があります。</span><span class="sxs-lookup"><span data-stu-id="67b61-154">The function requires some configuration to work properly, such as database connection string data and image base URI settings.</span></span> <span data-ttu-id="67b61-155">Azure Functions は、Azure Portal で構成します。</span><span class="sxs-lookup"><span data-stu-id="67b61-155">You configure Azure Functions in the Azure Portal.</span></span>

## <a name="references"></a><span data-ttu-id="67b61-156">参照</span><span class="sxs-lookup"><span data-stu-id="67b61-156">References</span></span>

- <span data-ttu-id="67b61-157">[eShopOnContainers: AKS で Kubernetes クラスターを作成する](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span><span class="sxs-lookup"><span data-stu-id="67b61-157">[eShopOnContainers: Create Kubernetes cluster in AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span></span>
- [<span data-ttu-id="67b61-158">eShopOnContainers: Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="67b61-158">eShopOnContainers: Azure Dev Spaces</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Azure-Dev-Spaces)
- [<span data-ttu-id="67b61-159">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="67b61-159">Azure Dev Spaces</span></span>](https://docs.microsoft.com/azure/dev-spaces/about)

>[!div class="step-by-step"]
><span data-ttu-id="67b61-160">[前へ](map-eshoponcontainers-azure-services.md)
>[次へ](centralized-configuration.md)</span><span class="sxs-lookup"><span data-stu-id="67b61-160">[Previous](map-eshoponcontainers-azure-services.md)
[Next](centralized-configuration.md)</span></span>
