---
title: eShopOnContainers を Azure にデプロイする
description: Azure Kubernetes Service、ヘルム、および DevSpaces を使用した eShopOnContainers アプリケーションのデプロイ。
ms.date: 05/13/2020
ms.openlocfilehash: b3871dae2b414709bfe24b6f7bdbf06de1689d12
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/24/2020
ms.locfileid: "91160724"
---
# <a name="deploying-eshoponcontainers-to-azure"></a><span data-ttu-id="8cd27-103">eShopOnContainers を Azure にデプロイする</span><span class="sxs-lookup"><span data-stu-id="8cd27-103">Deploying eShopOnContainers to Azure</span></span>

<span data-ttu-id="8cd27-104">EShopOnContainers アプリケーションは、さまざまな Azure プラットフォームにデプロイできます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-104">The eShopOnContainers application can be deployed to a variety of Azure platforms.</span></span> <span data-ttu-id="8cd27-105">Azure Kubernetes Services (AKS) にアプリケーションをデプロイする方法をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8cd27-105">The recommended approach is to deploy the application to Azure Kubernetes Services (AKS).</span></span> <span data-ttu-id="8cd27-106">Kubernetes 配置ツールであるヘルムは、デプロイの複雑さを軽減するために使用できます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-106">Helm, a Kubernetes deployment tool, is available to reduce deployment complexity.</span></span> <span data-ttu-id="8cd27-107">開発プロセスを効率化するために、開発者は必要に応じて Kubernetes の Azure Dev Spaces を実装することもできます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-107">Optionally, developers may implement Azure Dev Spaces for Kubernetes to streamline their development process.</span></span>

## <a name="azure-kubernetes-service"></a><span data-ttu-id="8cd27-108">Azure Kubernetes Service</span><span class="sxs-lookup"><span data-stu-id="8cd27-108">Azure Kubernetes Service</span></span>

<span data-ttu-id="8cd27-109">AKS で eShop をホストするには、最初の手順として、AKS クラスターを作成します。</span><span class="sxs-lookup"><span data-stu-id="8cd27-109">To host eShop in AKS, the first step is to create an AKS cluster.</span></span> <span data-ttu-id="8cd27-110">これを行うには、Azure portal を使用します。これにより、必要な手順を実行できます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-110">To do so, you might use the Azure portal, which will walk you through the required steps.</span></span> <span data-ttu-id="8cd27-111">また、Azure CLI からクラスターを作成して、ロールベースの Access Control (RBAC) とアプリケーションルーティングを有効にすることもできます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-111">You could also create a cluster from the Azure CLI, taking care to enable Role-Based Access Control (RBAC) and application routing.</span></span> <span data-ttu-id="8cd27-112">EShopOnContainers のドキュメントでは、独自の AKS クラスターを作成する手順について詳しく説明しています。</span><span class="sxs-lookup"><span data-stu-id="8cd27-112">The eShopOnContainers' documentation details the steps for creating your own AKS cluster.</span></span> <span data-ttu-id="8cd27-113">作成したら、Kubernetes ダッシュボードからクラスターにアクセスして管理できます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-113">Once created, you can access and manage the cluster from the Kubernetes dashboard.</span></span>

<span data-ttu-id="8cd27-114">これで、ヘルムと Tiller を利用して、eShop アプリケーションをクラスターにデプロイできるようになりました。</span><span class="sxs-lookup"><span data-stu-id="8cd27-114">You can now deploy the eShop application to the cluster leveraging Helm and Tiller.</span></span>

## <a name="deploying-to-azure-kubernetes-service-using-helm"></a><span data-ttu-id="8cd27-115">ヘルムを使用した Azure Kubernetes Service へのデプロイ</span><span class="sxs-lookup"><span data-stu-id="8cd27-115">Deploying to Azure Kubernetes Service using Helm</span></span>

<span data-ttu-id="8cd27-116">ヘルムは、Kubernetes で直接動作するアプリケーションパッケージマネージャーツールです。</span><span class="sxs-lookup"><span data-stu-id="8cd27-116">Helm is an application package manager tool that works directly with Kubernetes.</span></span> <span data-ttu-id="8cd27-117">Kubernetes アプリケーションを定義、インストール、およびアップグレードするのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-117">It helps you define, install, and upgrade Kubernetes applications.</span></span> <span data-ttu-id="8cd27-118">単純なアプリは、カスタム CLI スクリプトまたは単純なデプロイファイルを使用して AKS にデプロイできますが、複雑なアプリには多数の Kubernetes オブジェクトを含めることができ、また、ヘルムの恩恵を受けることができます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-118">While simple apps can be deployed to AKS with custom CLI scripts or simple deployment files, complex apps can contain many Kubernetes objects and benefit from Helm.</span></span>

<span data-ttu-id="8cd27-119">アプリケーションには、ヘルムを使用して、ヘルムパッケージのアプリケーションと構成を宣言的に記述する、ヘルムグラフと呼ばれるテキストベースの構成ファイルが含まれています。</span><span class="sxs-lookup"><span data-stu-id="8cd27-119">Using Helm, applications include text-based configuration files, called Helm charts, which declaratively describe the application and configuration in Helm packages.</span></span> <span data-ttu-id="8cd27-120">グラフでは、標準の YAML 形式のファイルを使用して、関連する Kubernetes リソースのセットを記述します。</span><span class="sxs-lookup"><span data-stu-id="8cd27-120">Charts use standard YAML-formatted files to describe a related set of Kubernetes resources.</span></span> <span data-ttu-id="8cd27-121">これらは、記述されているアプリケーションコードと共にバージョン管理されます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-121">They're versioned alongside the application code they describe.</span></span> <span data-ttu-id="8cd27-122">ヘルムグラフは、記述されているインストールの要件に応じて、単純なものから複雑なものまで多岐に範囲されています。</span><span class="sxs-lookup"><span data-stu-id="8cd27-122">Helm Charts range from simple to complex depending on the requirements of the installation they describe.</span></span>

<span data-ttu-id="8cd27-123">ヘルムはコマンドラインクライアントツールで構成されています。このツールは、ヘルムグラフを使用して、という名前のサーバーコンポーネントに対してコマンドを起動します。</span><span class="sxs-lookup"><span data-stu-id="8cd27-123">Helm is composed of a command-line client tool, which consumes helm charts and launches commands to a server component named, Tiller.</span></span> <span data-ttu-id="8cd27-124">Tiller は、コンテナー化されたワークロードの適切なプロビジョニングを確実に行うために、Kubernetes API と通信します。</span><span class="sxs-lookup"><span data-stu-id="8cd27-124">Tiller communicates with the Kubernetes API to ensure the correct provisioning of your containerized workloads.</span></span> <span data-ttu-id="8cd27-125">ヘルムは、クラウドネイティブコンピューティングファンデーションによって管理されています。</span><span class="sxs-lookup"><span data-stu-id="8cd27-125">Helm is maintained by the Cloud-native Computing Foundation.</span></span>

<span data-ttu-id="8cd27-126">次の yaml ファイルは、ヘルムテンプレートを示しています。</span><span class="sxs-lookup"><span data-stu-id="8cd27-126">The following yaml file presents a Helm template:</span></span>

```yaml
apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.app.svc.marketing }}
  labels:
    app: {{ template "marketing-api.name" . }}
    chart: {{ template "marketing-api.chart" . }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
spec:
  type: {{ .Values.service.type }}
  ports:
    - port: {{ .Values.service.port }}
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app: {{ template "marketing-api.name" . }}
    release: {{ .Release.Name }}
```

<span data-ttu-id="8cd27-127">テンプレートで、キーと値のペアの動的セットがどのように記述されているかに注意してください。</span><span class="sxs-lookup"><span data-stu-id="8cd27-127">Note how the template describes a dynamic set of key/value pairs.</span></span> <span data-ttu-id="8cd27-128">テンプレートが呼び出されると、中かっこで囲まれた値が、他の yaml ベースの構成ファイルから取り込まれます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-128">When the template is invoked, values that enclosed in curly braces are pulled in from other yaml-based configuration files.</span></span>

<span data-ttu-id="8cd27-129">EShopOnContainers ヘルムグラフは、/k8s/ヘルムフォルダーにあります。</span><span class="sxs-lookup"><span data-stu-id="8cd27-129">You'll find the eShopOnContainers helm charts in the /k8s/helm folder.</span></span> <span data-ttu-id="8cd27-130">図2-6 は、アプリケーションのさまざまなコンポーネントを、ヘルムが配置を定義するために使用するフォルダー構造に編成する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="8cd27-130">Figure 2-6 shows how the different components of the application are organized into a folder structure used by helm to define and managed deployments.</span></span>

<span data-ttu-id="8cd27-131">![eShopOnContainers アーキテクチャ ](./media/eshoponcontainers-helm-folder.png)
 **図 2-6**。</span><span class="sxs-lookup"><span data-stu-id="8cd27-131">![eShopOnContainers Architecture](./media/eshoponcontainers-helm-folder.png)
**Figure 2-6**.</span></span> <span data-ttu-id="8cd27-132">EShopOnContainers ヘルムフォルダー。</span><span class="sxs-lookup"><span data-stu-id="8cd27-132">The eShopOnContainers helm folder.</span></span>

<span data-ttu-id="8cd27-133">個々のコンポーネントは、コマンドを使用してインストールされ `helm install` ます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-133">Each individual component is installed using a `helm install` command.</span></span> <span data-ttu-id="8cd27-134">eShop には、それぞれのヘルムグラフを使用してコンポーネントをループしてインストールする "deploy all" スクリプトが含まれています。</span><span class="sxs-lookup"><span data-stu-id="8cd27-134">eShop includes a "deploy all" script that loops through and installs the components using their respective helm charts.</span></span> <span data-ttu-id="8cd27-135">結果として、ソース管理のアプリケーションでバージョン管理された反復可能なプロセスが生成されます。これにより、チームのすべてのユーザーが1行のスクリプトコマンドで AKS クラスターにデプロイできるようになります。</span><span class="sxs-lookup"><span data-stu-id="8cd27-135">The result is a repeatable process, versioned with the application in source control, that anyone on the team can deploy to an AKS cluster with a one-line script command.</span></span>

> <span data-ttu-id="8cd27-136">バージョン3のヘルムは、Tiller サーバーコンポーネントの必要性を正式に排除することに注意してください。</span><span class="sxs-lookup"><span data-stu-id="8cd27-136">Note that version 3 of Helm officially removes the need for the Tiller server component.</span></span> <span data-ttu-id="8cd27-137">この拡張機能の詳細については、 [こちら](https://medium.com/better-programming/why-is-tiller-missing-in-helm-3-2347c446714)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8cd27-137">More information on this enhancement can be found [here](https://medium.com/better-programming/why-is-tiller-missing-in-helm-3-2347c446714).</span></span>

## <a name="azure-dev-spaces"></a><span data-ttu-id="8cd27-138">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="8cd27-138">Azure Dev Spaces</span></span>

<span data-ttu-id="8cd27-139">クラウドネイティブアプリケーションは、大規模で複雑な拡張が可能で、大量のコンピューティングリソースを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8cd27-139">Cloud-native applications can quickly grow large and complex, requiring significant compute resources to run.</span></span> <span data-ttu-id="8cd27-140">このようなシナリオでは、アプリケーション全体を開発用コンピューター (特にラップトップ) でホストすることはできません。</span><span class="sxs-lookup"><span data-stu-id="8cd27-140">In these scenarios, the entire application can't be hosted on a development machine (especially a laptop).</span></span> <span data-ttu-id="8cd27-141">Azure Dev Spaces は、AKS を使用してこの問題に対処するように設計されています。</span><span class="sxs-lookup"><span data-stu-id="8cd27-141">Azure Dev Spaces is designed to address this problem using AKS.</span></span> <span data-ttu-id="8cd27-142">開発者は、AKS 開発クラスターでアプリケーションの残りの部分をホストしながら、ローカルバージョンのサービスを操作できます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-142">It enables developers to work with a local version of their services while hosting the rest of the application in an AKS development cluster.</span></span>

<span data-ttu-id="8cd27-143">開発者は、コンテナー化されたアプリケーション全体を含む AKS クラスターで実行中の (開発) インスタンスを共有します。</span><span class="sxs-lookup"><span data-stu-id="8cd27-143">Developers share a running (development) instance in an AKS cluster that contains the entire containerized application.</span></span> <span data-ttu-id="8cd27-144">ただし、ユーザーは自分のコンピューターに設定されている個人用のスペースを使用して、サービスをローカルに開発します。</span><span class="sxs-lookup"><span data-stu-id="8cd27-144">But they use personal spaces set up on their machine to locally develop their services.</span></span> <span data-ttu-id="8cd27-145">準備ができたら、依存関係をレプリケートせずに、AKS クラスターでエンドツーエンドのテストを行います。</span><span class="sxs-lookup"><span data-stu-id="8cd27-145">When ready, they test from end-to-end in the AKS cluster - without replicating dependencies.</span></span> <span data-ttu-id="8cd27-146">Azure Dev Spaces は、ローカルコンピューターから AKS のサービスとコードをマージします。</span><span class="sxs-lookup"><span data-stu-id="8cd27-146">Azure Dev Spaces merges code from the local machine with services in AKS.</span></span> <span data-ttu-id="8cd27-147">チームメンバーは、実際の AKS 環境で変更がどのように動作するかを確認できます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-147">Team members can see how their changes will behave in a real AKS environment.</span></span> <span data-ttu-id="8cd27-148">開発者は、Visual Studio 2017 または Visual Studio Code を使用して、Kubernetes 内で直接コードをすばやく反復処理し、デバッグすることができます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-148">Developers can rapidly iterate and debug code directly in Kubernetes using Visual Studio 2017 or Visual Studio Code.</span></span>

<span data-ttu-id="8cd27-149">図2-7 では、Developer Susie が開発スペースに自転車マイクロサービスの更新バージョンをデプロイしたことがわかります。</span><span class="sxs-lookup"><span data-stu-id="8cd27-149">In Figure 2-7, you can see that Developer Susie has deployed an updated version of the Bikes microservice into her dev space.</span></span> <span data-ttu-id="8cd27-150">次に、自分のスペースの名前 (susie.s.dev.myapp.eus.azds.io) で始まるカスタム URL を使用して、自分の変更をテストできます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-150">She's then able to test her changes using a custom URL starting with the name of her space (susie.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="8cd27-151">![eShopOnContainers アーキテクチャ ](./media/azure-devspaces-one.png)
 **図 2-7**。</span><span class="sxs-lookup"><span data-stu-id="8cd27-151">![eShopOnContainers Architecture](./media/azure-devspaces-one.png)
**Figure 2-7**.</span></span> <span data-ttu-id="8cd27-152">Developer Susie は独自のバージョンの Bikes マイクロサービスをデプロイしてテストします。</span><span class="sxs-lookup"><span data-stu-id="8cd27-152">Developer Susie deploys her own version of the Bikes microservice and tests it.</span></span>

<span data-ttu-id="8cd27-153">同時に、開発者 John は予約マイクロサービスをカスタマイズし、変更をテストする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8cd27-153">At the same time, developer John is customizing the Reservations microservice and needs to test his changes.</span></span> <span data-ttu-id="8cd27-154">図2-8 に示すように、Susie の変更と競合することなく、自分の開発スペースに自分の変更をデプロイします。</span><span class="sxs-lookup"><span data-stu-id="8cd27-154">He deploys his changes to his own dev space without conflicting with Susie's changes as shown in Figure 2-8.</span></span> <span data-ttu-id="8cd27-155">John は、スペースの名前 (john.s.dev.myapp.eus.azds.io) をプレフィックスとした独自の URL を使用して、自分の変更をテストします。</span><span class="sxs-lookup"><span data-stu-id="8cd27-155">John then tests his changes using his own URL that is prefixed with the name of his space (john.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="8cd27-156">![eShopOnContainers アーキテクチャ ](./media/azure-devspaces-two.png)
 **図 2-8**。</span><span class="sxs-lookup"><span data-stu-id="8cd27-156">![eShopOnContainers Architecture](./media/azure-devspaces-two.png)
**Figure 2-8**.</span></span> <span data-ttu-id="8cd27-157">開発者 John は独自のバージョンの予約マイクロサービスをデプロイし、他の開発者と競合することなくテストします。</span><span class="sxs-lookup"><span data-stu-id="8cd27-157">Developer John deploys his own version of the Reservations microservice and tests it without conflicting with other developers.</span></span>

<span data-ttu-id="8cd27-158">Azure Dev Spaces を使用すると、チームは AKS を直接操作しながら、変更の変更、配置、およびテストを行うことができます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-158">Using Azure Dev Spaces, teams can work directly with AKS while independently changing, deploying, and testing their changes.</span></span> <span data-ttu-id="8cd27-159">この方法では、すべての開発者が独自の AKS 環境を使用するため、個別の専用ホスト環境が必要になります。</span><span class="sxs-lookup"><span data-stu-id="8cd27-159">This approach reduces the need for separate dedicated hosted environments since every developer effectively has their own AKS environment.</span></span> <span data-ttu-id="8cd27-160">開発者は CLI を使用して Azure Dev Spaces を操作したり、アプリケーションを起動して Visual Studio から直接 Azure Dev Spaces したりできます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-160">Developers can work with Azure Dev Spaces using its CLI or launch their application to Azure Dev Spaces directly from Visual Studio.</span></span> [<span data-ttu-id="8cd27-161">Azure Dev Spaces のしくみと構成方法の詳細については、こちらを参照してください。</span><span class="sxs-lookup"><span data-stu-id="8cd27-161">Learn more about how Azure Dev Spaces works and is configured.</span></span>](/azure/dev-spaces/how-dev-spaces-works)

## <a name="azure-functions-and-logic-apps-serverless"></a><span data-ttu-id="8cd27-162">Azure Functions と Logic Apps (サーバーレス)</span><span class="sxs-lookup"><span data-stu-id="8cd27-162">Azure Functions and Logic Apps (Serverless)</span></span>

<span data-ttu-id="8cd27-163">EShopOnContainers サンプルには、オンラインマーケティングキャンペーンの追跡のサポートが含まれています。</span><span class="sxs-lookup"><span data-stu-id="8cd27-163">The eShopOnContainers sample includes support for tracking online marketing campaigns.</span></span> <span data-ttu-id="8cd27-164">特定のキャンペーン ID のマーケティングキャンペーンの詳細を追跡するには、Azure 関数を使用します。</span><span class="sxs-lookup"><span data-stu-id="8cd27-164">An Azure Function is used to track marketing campaign details for a given campaign ID.</span></span> <span data-ttu-id="8cd27-165">完全なマイクロサービスを作成するのではなく、1つの Azure 関数がシンプルで十分です。</span><span class="sxs-lookup"><span data-stu-id="8cd27-165">Rather than creating a full microservice, a single Azure Function is simpler and sufficient.</span></span> <span data-ttu-id="8cd27-166">Kubernetes で実行するように構成されている場合は特に、単純なビルドおよびデプロイモデルが Azure Functions ます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-166">Azure Functions have a simple build and deployment model, especially when configured to run in Kubernetes.</span></span> <span data-ttu-id="8cd27-167">関数の配置は、Azure Resource Manager (ARM) テンプレートと Azure CLI を使用してスクリプト化されます。</span><span class="sxs-lookup"><span data-stu-id="8cd27-167">Deploying the function is scripted using Azure Resource Manager (ARM) templates and the Azure CLI.</span></span> <span data-ttu-id="8cd27-168">このキャンペーンサービスは顧客向けではなく、1つの操作を呼び出して、Azure Functions に最適な候補となります。</span><span class="sxs-lookup"><span data-stu-id="8cd27-168">This campaign service isn't customer-facing and invokes a single operation, making it a great candidate for Azure Functions.</span></span> <span data-ttu-id="8cd27-169">関数には、データベース接続文字列データやイメージベース URI 設定など、最小限の構成が必要です。</span><span class="sxs-lookup"><span data-stu-id="8cd27-169">The function requires minimal configuration, including a database connection string data and image base URI settings.</span></span> <span data-ttu-id="8cd27-170">Azure portal で Azure Functions を構成します。</span><span class="sxs-lookup"><span data-stu-id="8cd27-170">You configure Azure Functions in the Azure portal.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="8cd27-171">[前へ](map-eshoponcontainers-azure-services.md)
>[次へ](centralized-configuration.md)</span><span class="sxs-lookup"><span data-stu-id="8cd27-171">[Previous](map-eshoponcontainers-azure-services.md)
[Next](centralized-configuration.md)</span></span>
