---
title: Azure Monitor
description: Azure モニターを使用してシステムを可視化する方法が実行されています。
ms.date: 02/05/2020
ms.openlocfilehash: 4e5ddba6c1c13dc65662a7748d4ae3a58a6a6f68
ms.sourcegitcommit: f87ad41b8e62622da126aa928f7640108c4eff98
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/07/2020
ms.locfileid: "80805633"
---
# <a name="azure-monitor"></a>Azure Monitor

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

Azure に見られるクラウド アプリケーション監視ソリューションほど成熟したクラウド プロバイダーは他にありません。 Azure Monitor は、システムの状態の可視性、問題の把握、アプリケーションの最適化を提供するように設計されたツールのコレクションの名前です。

![Azure Monitor は、クラウド ネイティブ アプリケーションがどのように機能しているかを分析するためのツールのコレクションです。](./media/azure-monitor.png)
**図 7-12**. Azure Monitor は、クラウド ネイティブ アプリケーションがどのように機能しているかを分析するためのツールのコレクションです。

## <a name="gathering-logs-and-metrics"></a>ログとメトリックの収集

あらゆる監視ソリューションの最初のステップは、できるだけ多くのデータを収集することです。 収集できるデータが多ければ多いほど、得られる洞察はより深くなります。 従来、計測システムは困難でした。 簡易ネットワーク管理プロトコル (SNMP) は、マシン レベルの情報を収集するためのゴールドスタンダード プロトコルでしたが、多くの知識と構成が必要でした。 さいわい、この作業の多くは、最も一般的なメトリックが Azure Monitor によって自動的に収集されるため、排除されています。

アプリケーション レベルのメトリックとイベントは、配置されるアプリケーションに固有であるため、自動的にはインストルメント化できません。 これらのメトリックを収集するために、顧客がサインアップまたは注文を完了したときなど、このような情報を直接報告[するために利用可能な SDK と API](https://docs.microsoft.com/azure/azure-monitor/app/api-custom-events-metrics)があります。 例外は、アプリケーションインサイトを介して Azure Monitor にキャプチャおよびレポートを作成することもできます。 SDK は、クラウド ネイティブ アプリケーションで見つかったほとんどすべての言語をサポートします。

アプリケーションの状態に関する情報を収集する最終的な目標は、エンド ユーザーが適切なエクスペリエンスを提供できるようにすることです。 外部で[Web テスト](https://docs.microsoft.com/azure/azure-monitor/app/monitor-web-app-availability)を実行するよりも、ユーザーに問題があるかどうかを確認する優れた方法は何ですか。 これらのテストは、世界中の場所からウェブサイトに ping を実行するのと同じくらい簡単に行うことができますし、エージェントがサイトにログインしてユーザーの操作をシミュレートするのと同じくらい簡単です。

## <a name="reporting-data"></a>レポート データ

データが収集されると、データを操作、要約、およびグラフにプロットして、ユーザーが問題が発生したときにすぐに表示されるようにすることができます。 これらのグラフは、ダッシュボードやワークブック(システムのいくつかの側面についてのストーリーを伝えるように設計された複数ページのレポート)に集めることができます。

人工知能や機械学習がなければ、現代のアプリケーションは完全ではありません。 この場合、データを Azure のさまざまな機械学習ツールに渡して、他の方法で非表示にする傾向や情報を抽出[できます](https://www.youtube.com/watch?v=Cuza-I1g9tw)。

Application Insights は Kusto と呼ばれる強力なクエリ言語を提供し、レコードの検索、要約、さらにはグラフのプロットに使用できます。 たとえば、このクエリは、2007 年 11 月のすべてのレコードを検索し、それらを州別にグループ化し、トップ 10 を円グラフとしてプロットします。

```kusto
StormEvents
| where StartTime >= datetime(2007-11-01) and StartTime < datetime(2007-12-01)
| summarize count() by State
| top 10 by count_
| render piechart
```

![アプリケーション インサイト クエリ](./media/azure-monitor.png)
**図 7-13**の結果。 アプリケーションインサイトクエリの結果。

1時間か2時間を過ごすのに最適な場所である[Kustoクエリを試すための遊び場](https://dataexplorer.azure.com/clusters/help/databases/Samples)があります。 [サンプル クエリの](https://docs.microsoft.com/azure/kusto/query/samples)読み取りも有益です。

## <a name="dashboards"></a>ダッシュボード

Azure Monitor から情報を表示するために使用できるさまざまなダッシュボード テクノロジがいくつかあります。 おそらく最も簡単なのは、アプリケーションインサイトでクエリを実行し、[データをチャートにプロットすることです](https://docs.microsoft.com/azure/azure-monitor/learn/tutorial-app-dashboards)。

![メインの Azure ダッシュボード](./media/azure-monitor.png)
**の図 7-14**に埋め込まれたアプリケーション インサイト グラフの例。 メインの Azure ダッシュボードに埋め込まれたアプリケーション インサイト グラフの例。

ダッシュボード機能を使用して、これらのグラフを Azure ポータルに適切に埋め込むことができます。 複数のデータ層にドリルダウンするなど、より厳密な要件を持つユーザーは[、Azure](https://powerbi.microsoft.com/)Monitor データを Power BI で使用できます。 Power BI は、さまざまなデータ ソースからデータを集約できる、業界をリードするエンタープライズ クラスのビジネス インテリジェンス ツールです。

![Power BI ダッシュボード](./media/azure-monitor.png)
**の図 7-15 の**例を示します。 Power BI ダッシュボードの例。

## <a name="alerts"></a>警告

データ ダッシュボードを使用する場合は、不十分な場合があります。 誰もダッシュボードを見るために目を覚ましていない場合でも、問題が解決されるか、検出されるまでに何時間もかかる可能性があります。 このため、Azure Monitor は、一流の[アラート ソリューション](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-overview)も提供します。 アラートは、次の条件を含むさまざまな条件によってトリガーされます。

- メトリックの値
- ログの検索クエリ
- アクティビティ ログのイベント
- 基になっている Azure プラットフォームの正常性
- Web サイトの可用性のテスト

アラートがトリガーされると、さまざまなタスクを実行できます。 単純な面では、アラートはメーリングリストに電子メール通知を送信するか、またはテキストメッセージを個人に送信するだけです。 より複雑なアラートにより、特定のアプリケーションの呼び出し元を認識する PagerDuty などのツールでワークフローがトリガーされる可能性があります。 アラートは、ワークフローの可能性が無限に近い[Microsoft Flow](https://flow.microsoft.com/)でアクションをトリガーできます。

アラートの一般的な原因が特定されると、アラートの一般的な原因と、アラートを解決するための手順に関する詳細を使用して、アラートを強化できます。 高度に成熟したクラウドネイティブアプリケーションの展開では、スケールセットから失敗したノードを削除したり、自動スケールアクティビティをトリガーしたりするアクションを実行する自己修復タスクを開始する可能性があります。 最終的には、システムが翌朝誰かが仕事に到着するまで、システムが補償したり、少なくともぐったりするように調整することができるので、ライブサイトの問題を解決するために午前2時にオンコール担当者を起こす必要はなくなるかもしれません。

Azure Monitor は、機械学習を自動的に活用して、デプロイされたアプリケーションの通常の動作パラメーターを理解します。 これにより、通常のパラメータの外部で動作しているサービスを検出できます。 たとえば、サイトの平日のトラフィックは、1 分間に 10,000 件の要求になります。 そして、特定の週に、突然要求の数は、毎分20,000要求の非常に珍しいヒットします。 [スマート検出](https://docs.microsoft.com/azure/azure-monitor/app/proactive-diagnostics)は、標準からのこの偏差に気づき、アラートをトリガーします。 同時に、トラフィックの負荷が予想される場合に誤検知を発生させないほど、トレンド分析は十分にスマートです。

## <a name="references"></a>References

- [Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/overview)

>[!div class="step-by-step"]
>[前へ](monitoring-azure-kubernetes.md)
>[次へ](identity.md)
