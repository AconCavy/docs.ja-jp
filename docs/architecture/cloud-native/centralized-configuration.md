---
title: 集中管理構成
description: Azure Key Vault を使用した一元化された構成によって、クラウドネイティブアプリの管理が容易になります。
ms.date: 06/30/2019
ms.openlocfilehash: 4c516b6773d913acd71ff06742302e9766a141e2
ms.sourcegitcommit: 56f1d1203d0075a461a10a301459d3aa452f4f47
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/24/2019
ms.locfileid: "73841139"
---
# <a name="centralized-configuration"></a><span data-ttu-id="505ad-103">集中管理構成</span><span class="sxs-lookup"><span data-stu-id="505ad-103">Centralized configuration</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="505ad-104">クラウドネイティブアプリケーションには、従来の単一インスタンスモノリシックアプリよりも多くのサービスが実行されています。</span><span class="sxs-lookup"><span data-stu-id="505ad-104">Cloud-native applications involve many more running services than traditional single-instance monolithic apps.</span></span> <span data-ttu-id="505ad-105">多数の相互に依存するサービスの構成設定を管理することは困難な場合があります。これは、多くの場合、集中管理された構成ストアが分散アプリケーションに実装されるためです。</span><span class="sxs-lookup"><span data-stu-id="505ad-105">Managing configuration settings for dozens of interdependent services can be challenging, which is why centralized configuration stores are often implemented for distributed applications.</span></span>

<span data-ttu-id="505ad-106">[第1章](introduction.md)で説明したように、12要素アプリの推奨事項では、コードと構成を厳密に分離する必要があります。</span><span class="sxs-lookup"><span data-stu-id="505ad-106">As discussed in [Chapter 1](introduction.md), the Twelve-Factor App recommendations require strict separation between code and configuration.</span></span> <span data-ttu-id="505ad-107">これは、構成設定を定数またはリテラル値としてコードに格納することが違反になることを意味します。</span><span class="sxs-lookup"><span data-stu-id="505ad-107">This means storing configuration settings as constants or literal values in code is a violation.</span></span> <span data-ttu-id="505ad-108">この推奨事項が存在するのは、開発、テスト、ステージング、運用など、複数の環境で同じコードを使用する必要があるためです。</span><span class="sxs-lookup"><span data-stu-id="505ad-108">This recommendation exists because the same code should be used across multiple environments, including development, testing, staging, and production.</span></span> <span data-ttu-id="505ad-109">ただし、構成値は、これらの環境によって異なる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="505ad-109">However, configuration values are likely to vary between each of these environments.</span></span> <span data-ttu-id="505ad-110">そのため、構成値は環境自体に保存する必要があります。そうしないと、環境は一元的な構成ストアに資格情報を保存する必要があります。</span><span class="sxs-lookup"><span data-stu-id="505ad-110">So, configuration values should be stored in the environment itself, or the environment should store the credentials to a centralized configuration store.</span></span>

<span data-ttu-id="505ad-111">EShopOnContainers アプリケーションには、各マイクロサービスにローカルアプリケーション設定ファイルが含まれています。</span><span class="sxs-lookup"><span data-stu-id="505ad-111">The eShopOnContainers application includes local application settings files with each microservice.</span></span> <span data-ttu-id="505ad-112">これらのファイルはソース管理にチェックインされますが、接続文字列や API キーなどの運用シークレットは含まれません。</span><span class="sxs-lookup"><span data-stu-id="505ad-112">These files are checked into source control but don't include production secrets such as connection strings or API keys.</span></span> <span data-ttu-id="505ad-113">運用環境では、個々の設定がサービスごとの環境変数で上書きされる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="505ad-113">In production, individual settings may be overwritten with per-service environment variables.</span></span> <span data-ttu-id="505ad-114">これは、ホストされているアプリケーションの一般的な方法ですが、中央の構成ストアは提供しません。</span><span class="sxs-lookup"><span data-stu-id="505ad-114">This is a common practice for hosted applications, but doesn't provide a central configuration store.</span></span> <span data-ttu-id="505ad-115">構成設定の一元管理をサポートするために、各マイクロサービスには、ローカル設定または Azure Key Vault 設定の使用を切り替えるための設定が含まれています。</span><span class="sxs-lookup"><span data-stu-id="505ad-115">To support centralized management of configuration settings, each microservice includes a setting to toggle between its use of local settings or Azure Key Vault settings.</span></span>

## <a name="azure-key-vault"></a><span data-ttu-id="505ad-116">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="505ad-116">Azure Key Vault</span></span>

<span data-ttu-id="505ad-117">Azure Key Vault は、トークン、パスワード、証明書、API キー、およびその他の機密情報を安全に格納します。</span><span class="sxs-lookup"><span data-stu-id="505ad-117">Azure Key Vault provides secure storage of tokens, passwords, certificates, API keys, and other sensitive secrets.</span></span> <span data-ttu-id="505ad-118">Key Vault にアクセスするには、適切な呼び出し元の認証と承認が必要です。これは eShopOnContainers マイクロサービスの場合、ClientId/ClientSecret の組み合わせを使用することを意味します。</span><span class="sxs-lookup"><span data-stu-id="505ad-118">Access to Key Vault requires proper caller authentication and authorization, which in the case of the eShopOnContainers microservices means the use of a ClientId/ClientSecret combination.</span></span> <span data-ttu-id="505ad-119">これらの資格情報をソース管理にチェックインするのではなく、アプリケーションの環境で設定します。</span><span class="sxs-lookup"><span data-stu-id="505ad-119">Don't check in these credentials into source control, but instead set in the application's environment.</span></span> <span data-ttu-id="505ad-120">AKS から Key Vault への直接アクセスは、 [FlexVolume Key Vault](https://github.com/Azure/kubernetes-keyvault-flexvol)使用して実現できます。</span><span class="sxs-lookup"><span data-stu-id="505ad-120">Direct access to Key Vault from AKS can be achieved using [Key Vault FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol).</span></span>

<span data-ttu-id="505ad-121">集中管理された構成では、一元化されたログエンドポイントなど、アプリケーション全体に適用される設定を1回だけ設定し、分散アプリケーションのすべての部分で使用できます。</span><span class="sxs-lookup"><span data-stu-id="505ad-121">With centralized configuration, settings that apply to the entire application, such as the centralized logging endpoint, can be set once and used by every part of the distributed application.</span></span> <span data-ttu-id="505ad-122">マイクロサービスは互いに独立している必要がありますが、通常は、構成の詳細が集中管理された構成ストアの利点を持つ共有依存関係があります。</span><span class="sxs-lookup"><span data-stu-id="505ad-122">Although microservices should be independent of one another, there will typically still be some shared dependencies whose configuration details can benefit from a centralized configuration store.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="505ad-123">[前へ](deploy-eshoponcontainers-azure.md)
>[次へ](scale-applications.md)</span><span class="sxs-lookup"><span data-stu-id="505ad-123">[Previous](deploy-eshoponcontainers-azure.md)
[Next](scale-applications.md)</span></span>
