---
title: サーバーレス関数の活用
description: クラウドネイティブアプリケーションでのサーバーレスと Azure Functions の活用
ms.date: 04/13/2020
ms.openlocfilehash: 176499e3cd0349cd689b9d13d1c237a6343d13f3
ms.sourcegitcommit: 5988e9a29cedb8757320817deda3c08c6f44a6aa
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2020
ms.locfileid: "82199743"
---
# <a name="leveraging-serverless-functions"></a><span data-ttu-id="f20d2-103">サーバーレス関数の活用</span><span class="sxs-lookup"><span data-stu-id="f20d2-103">Leveraging serverless functions</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="f20d2-104">物理マシンの管理からクラウド機能の活用までの範囲では、サーバーレスは極端な端に存在します。</span><span class="sxs-lookup"><span data-stu-id="f20d2-104">In the spectrum from managing physical machines to leveraging cloud capabilities, serverless lives at the extreme end.</span></span> <span data-ttu-id="f20d2-105">唯一の責任はコードです。コードの実行時にのみ課金されます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-105">Your only responsibility is your code, and you only pay when your code runs.</span></span> <span data-ttu-id="f20d2-106">Azure Functions は、クラウドネイティブアプリケーションにサーバーレス機能を構築する方法を提供します。</span><span class="sxs-lookup"><span data-stu-id="f20d2-106">Azure Functions provides a way to build serverless capabilities into your cloud-native applications.</span></span>

## <a name="what-is-serverless"></a><span data-ttu-id="f20d2-107">サーバーレスとは</span><span class="sxs-lookup"><span data-stu-id="f20d2-107">What is serverless?</span></span>

<span data-ttu-id="f20d2-108">サーバーレスは、クラウドコンピューティングの比較的新しいサービスモデルです。</span><span class="sxs-lookup"><span data-stu-id="f20d2-108">Serverless is a relatively new service model of cloud computing.</span></span> <span data-ttu-id="f20d2-109">サーバーは省略可能であるという意味ではありません。コードは、サーバー上のどこかで実行されます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-109">It doesn't mean that servers are optional - your code still runs on a server somewhere.</span></span> <span data-ttu-id="f20d2-110">この違いは、アプリケーションチームがサーバーインフラストラクチャの管理について心配しなくなったことです。</span><span class="sxs-lookup"><span data-stu-id="f20d2-110">The distinction is that the application team no longer concerns itself with managing server infrastructure.</span></span> <span data-ttu-id="f20d2-111">代わりに、クラウドベンダーがこの責任を担います。</span><span class="sxs-lookup"><span data-stu-id="f20d2-111">Instead, the cloud vendor own this responsibility.</span></span> <span data-ttu-id="f20d2-112">開発チームは、組み込みではなく、ビジネスソリューションを顧客に提供することによって生産性を向上させます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-112">The development team increases its productivity by delivering business solutions to customers, not plumbing.</span></span>

<span data-ttu-id="f20d2-113">サーバーレスコンピューティングでは、イベントによってトリガーされるステートレスコンテナーを使用してサービスをホストします。</span><span class="sxs-lookup"><span data-stu-id="f20d2-113">Serverless computing uses event-triggered stateless containers to host your services.</span></span> <span data-ttu-id="f20d2-114">必要に応じてスケールアウトしたり、需要を満たすことができます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-114">They can scale out and in to meet demand as-needed.</span></span> <span data-ttu-id="f20d2-115">Azure Functions のようなサーバーレスプラットフォームは、キュー、イベント、ストレージなどの他の Azure サービスと緊密に統合されています。</span><span class="sxs-lookup"><span data-stu-id="f20d2-115">Serverless platforms like Azure Functions have tight integration with other Azure services like queues, events, and storage.</span></span>

## <a name="what-challenges-are-solved-by-serverless"></a><span data-ttu-id="f20d2-116">サーバーレスによって解決される課題</span><span class="sxs-lookup"><span data-stu-id="f20d2-116">What challenges are solved by serverless?</span></span>

<span data-ttu-id="f20d2-117">サーバーレスプラットフォームは、多くの時間とコストがかかる問題に対処します。</span><span class="sxs-lookup"><span data-stu-id="f20d2-117">Serverless platforms address many time-consuming and expensive concerns:</span></span>

- <span data-ttu-id="f20d2-118">購入コンピューターとソフトウェアライセンス</span><span class="sxs-lookup"><span data-stu-id="f20d2-118">Purchasing machines and software licenses</span></span>
- <span data-ttu-id="f20d2-119">コンピューターとそのネットワーク、電力、および A/C の要件のハウジング、セキュリティ保護、構成、および保守</span><span class="sxs-lookup"><span data-stu-id="f20d2-119">Housing, securing, configuring, and maintaining the machines and their networking, power, and A/C requirements</span></span>
- <span data-ttu-id="f20d2-120">オペレーティングシステムとソフトウェアの修正プログラムの適用とアップグレード</span><span class="sxs-lookup"><span data-stu-id="f20d2-120">Patching and upgrading operating systems and software</span></span>
- <span data-ttu-id="f20d2-121">アプリケーションソフトウェアをホストするための web サーバーまたはコンピューターサービスの構成</span><span class="sxs-lookup"><span data-stu-id="f20d2-121">Configuring web servers or machine services to host application software</span></span>
- <span data-ttu-id="f20d2-122">プラットフォーム内でのアプリケーションソフトウェアの構成</span><span class="sxs-lookup"><span data-stu-id="f20d2-122">Configuring application software within its platform</span></span>

<span data-ttu-id="f20d2-123">多くの企業は、ハードウェアインフラストラクチャの問題をサポートするために大規模な予算を割り当てています。</span><span class="sxs-lookup"><span data-stu-id="f20d2-123">Many companies allocate large budgets to support hardware infrastructure concerns.</span></span> <span data-ttu-id="f20d2-124">クラウドに移行すると、これらのコストを削減できます。アプリケーションをサーバーレスに移行すると、アプリケーションを排除するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-124">Moving to the cloud can help reduce these costs; shifting applications to serverless can help eliminate them.</span></span>

## <a name="what-is-the-difference-between-a-microservice-and-a-serverless-function"></a><span data-ttu-id="f20d2-125">マイクロサービスとサーバーレス関数の違いは何ですか。</span><span class="sxs-lookup"><span data-stu-id="f20d2-125">What is the difference between a microservice and a serverless function?</span></span>

<span data-ttu-id="f20d2-126">通常、マイクロサービスは、オンラインの e コマースサイトのショッピングカートなどのビジネス機能をカプセル化します。</span><span class="sxs-lookup"><span data-stu-id="f20d2-126">Typically, a microservice encapsulates a business capability, such as a shopping cart for an online eCommerce site.</span></span> <span data-ttu-id="f20d2-127">ユーザーがショッピング体験を管理できるようにする複数の操作を公開します。</span><span class="sxs-lookup"><span data-stu-id="f20d2-127">It exposes multiple operations that enable a user to manage their shopping experience.</span></span> <span data-ttu-id="f20d2-128">ただし、関数は、イベントへの応答として単一の用途の操作を実行する、小さな軽量のコードブロックです。</span><span class="sxs-lookup"><span data-stu-id="f20d2-128">A function, however, is a small, lightweight block of code that executes a single-purpose operation in response to an event.</span></span>
<span data-ttu-id="f20d2-129">通常、マイクロサービスは、要求に応答するように構成されます (多くの場合、インターフェイスから)。</span><span class="sxs-lookup"><span data-stu-id="f20d2-129">Microservices are typically constructed to respond to requests, often from an interface.</span></span> <span data-ttu-id="f20d2-130">要求は、HTTP Rest または gRPC ベースのいずれかになります。</span><span class="sxs-lookup"><span data-stu-id="f20d2-130">Requests can be HTTP Rest- or gRPC-based.</span></span> <span data-ttu-id="f20d2-131">サーバーレスサービスは、イベントに応答します。</span><span class="sxs-lookup"><span data-stu-id="f20d2-131">Serverless services respond to events.</span></span> <span data-ttu-id="f20d2-132">イベントドリブンアーキテクチャは、実行時間の短いバックグラウンドタスクの処理に最適です。</span><span class="sxs-lookup"><span data-stu-id="f20d2-132">Its event-driven architecture is ideal for processing short-running, background tasks.</span></span>

## <a name="what-scenarios-are-appropriate-for-serverless"></a><span data-ttu-id="f20d2-133">サーバーレスに適したシナリオ</span><span class="sxs-lookup"><span data-stu-id="f20d2-133">What scenarios are appropriate for serverless?</span></span>

<span data-ttu-id="f20d2-134">サーバーレスは、トリガーへの応答として呼び出される、個々の実行時間の短い関数を公開します。</span><span class="sxs-lookup"><span data-stu-id="f20d2-134">Serverless exposes individual short-running functions that are invoked in response to a trigger.</span></span> <span data-ttu-id="f20d2-135">これにより、バックグラウンドタスクの処理に最適です。</span><span class="sxs-lookup"><span data-stu-id="f20d2-135">This makes them ideal for processing background tasks.</span></span>

<span data-ttu-id="f20d2-136">アプリケーションでは、ワークフローのステップとして電子メールを送信することが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="f20d2-136">An application might need to send an email as a step in a workflow.</span></span> <span data-ttu-id="f20d2-137">マイクロサービス要求の一部として通知を送信する代わりに、メッセージの詳細をキューに配置します。</span><span class="sxs-lookup"><span data-stu-id="f20d2-137">Instead of sending the notification as part of a microservice request, place the message details onto a queue.</span></span> <span data-ttu-id="f20d2-138">Azure 関数は、メッセージをデキューし、電子メールを非同期に送信することができます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-138">An Azure Function can dequeue the message and asynchronously send the email.</span></span> <span data-ttu-id="f20d2-139">これにより、マイクロサービスのパフォーマンスとスケーラビリティが向上します。</span><span class="sxs-lookup"><span data-stu-id="f20d2-139">Doing so could improve the performance and scalability of the microservice.</span></span> <span data-ttu-id="f20d2-140">[キューベースの負荷平準化](https://docs.microsoft.com/azure/architecture/patterns/queue-based-load-leveling)を実装すると、電子メールの送信に関連するボトルネックを回避できます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-140">[Queue-based load leveling](https://docs.microsoft.com/azure/architecture/patterns/queue-based-load-leveling) can be implemented to avoid bottlenecks related to sending the emails.</span></span> <span data-ttu-id="f20d2-141">さらに、このスタンドアロンサービスは、さまざまなアプリケーションでユーティリティとして再利用される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f20d2-141">Additionally, this stand-alone service could be reused as a utility across many different applications.</span></span>

<span data-ttu-id="f20d2-142">キューとトピックからの非同期メッセージングは、サーバーレス機能をトリガーするための一般的なパターンです。</span><span class="sxs-lookup"><span data-stu-id="f20d2-142">Asynchronous messaging from queues and topics is a common pattern to trigger serverless functions.</span></span> <span data-ttu-id="f20d2-143">ただし、Azure Functions は、Azure Blob Storage への変更など、他のイベントによってトリガーされる場合があります。</span><span class="sxs-lookup"><span data-stu-id="f20d2-143">However, Azure Functions can be triggered by other events, such as changes to Azure Blob Storage.</span></span> <span data-ttu-id="f20d2-144">イメージのアップロードをサポートするサービスには、イメージサイズの最適化を担当する Azure 関数がある場合があります。</span><span class="sxs-lookup"><span data-stu-id="f20d2-144">A service that supports image uploads could have an Azure Function responsible for optimizing the image size.</span></span> <span data-ttu-id="f20d2-145">関数は Azure Blob Storage に挿入することによって直接トリガーされるため、マイクロサービスの操作が複雑になることはありません。</span><span class="sxs-lookup"><span data-stu-id="f20d2-145">The function could be triggered directly by inserts into Azure Blob Storage, keeping complexity out of the microservice operations.</span></span>

<span data-ttu-id="f20d2-146">多くのサービスには、ワークフローの一部として長時間実行されるプロセスがあります。</span><span class="sxs-lookup"><span data-stu-id="f20d2-146">Many services have long-running processes as part of their workflows.</span></span> <span data-ttu-id="f20d2-147">多くの場合、これらのタスクは、アプリケーションとのユーザー操作の一部として実行されます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-147">Often these tasks are done as part of the user's interaction with the application.</span></span> <span data-ttu-id="f20d2-148">これらのタスクを実行すると、ユーザーのエクスペリエンスに悪影響を与える可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f20d2-148">These tasks can force the user to wait, negatively impacting their experience.</span></span> <span data-ttu-id="f20d2-149">サーバーレスコンピューティングは、ユーザー操作ループの外側で低速タスクを移動する優れた方法を提供します。</span><span class="sxs-lookup"><span data-stu-id="f20d2-149">Serverless computing provides a great way to move slower tasks outside of the user interaction loop.</span></span> <span data-ttu-id="f20d2-150">これらのタスクは、アプリケーション全体の規模を調整することなく、必要に応じてスケールできます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-150">These tasks can scale with demand without requiring the entire application to scale.</span></span>

## <a name="when-should-you-avoid-serverless"></a><span data-ttu-id="f20d2-151">サーバーレスを避ける必要がある場合</span><span class="sxs-lookup"><span data-stu-id="f20d2-151">When should you avoid serverless?</span></span>

<span data-ttu-id="f20d2-152">サーバーレスソリューションは、オンデマンドでプロビジョニングし、スケーリングします。</span><span class="sxs-lookup"><span data-stu-id="f20d2-152">Serverless solutions provision and scale on demand.</span></span> <span data-ttu-id="f20d2-153">新しいインスタンスが呼び出されると、コールドスタートが一般的な問題になります。</span><span class="sxs-lookup"><span data-stu-id="f20d2-153">When a new instance is invoked, cold starts are a common issue.</span></span> <span data-ttu-id="f20d2-154">コールドスタートとは、このインスタンスのプロビジョニングにかかる時間のことです。</span><span class="sxs-lookup"><span data-stu-id="f20d2-154">A cold start is the period of time it takes to provision this instance.</span></span> <span data-ttu-id="f20d2-155">通常、この遅延は数秒である可能性がありますが、さまざまな要因によってはより長い時間がかかることがあります。</span><span class="sxs-lookup"><span data-stu-id="f20d2-155">Normally, this delay might be a few seconds, but can be longer depending on various factors.</span></span> <span data-ttu-id="f20d2-156">プロビジョニングが完了すると、定期的な要求を受信している限り、1つのインスタンスが保持されます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-156">Once provisioned, a single instance is kept alive as long as it receives periodic requests.</span></span> <span data-ttu-id="f20d2-157">ただし、サービスが呼び出される頻度が低い場合は、Azure によってメモリから削除され、再起動時にコールドスタートが必要になることがあります。</span><span class="sxs-lookup"><span data-stu-id="f20d2-157">But, if a service is called less frequently, Azure may remove it from memory and require a cold start when reinvoked.</span></span> <span data-ttu-id="f20d2-158">コールドスタートは、関数が新しいインスタンスにスケールアウトする場合にも必要です。</span><span class="sxs-lookup"><span data-stu-id="f20d2-158">Cold starts are also required when a function scales out to a new instance.</span></span>

<span data-ttu-id="f20d2-159">図3-10 は、コールドスタートパターンを示しています。</span><span class="sxs-lookup"><span data-stu-id="f20d2-159">Figure 3-10 shows a cold-start pattern.</span></span> <span data-ttu-id="f20d2-160">アプリがコールドである場合に必要な追加の手順に注意してください。</span><span class="sxs-lookup"><span data-stu-id="f20d2-160">Note the extra steps required when the app is cold.</span></span>

<span data-ttu-id="f20d2-161">![コールドスタートとウォーム](./media/cold-start-warm-start.png)
スタートの**図 3-10**。</span><span class="sxs-lookup"><span data-stu-id="f20d2-161">![Cold versus warm start](./media/cold-start-warm-start.png)
**Figure 3-10**.</span></span> <span data-ttu-id="f20d2-162">コールドスタートとウォームスタート。</span><span class="sxs-lookup"><span data-stu-id="f20d2-162">Cold start versus warm start.</span></span>

<span data-ttu-id="f20d2-163">コールドスタートを完全に回避するには、[従量課金プランから専用プランに](https://azure.microsoft.com/blog/understanding-serverless-cold-start/)切り替えることができます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-163">To avoid cold starts entirely, you might switch from a [consumption plan to a dedicated plan](https://azure.microsoft.com/blog/understanding-serverless-cold-start/).</span></span> <span data-ttu-id="f20d2-164">Premium プランのアップグレードを使用して、1つまたは複数の事前設定された[med-v インスタンス](https://docs.microsoft.com/azure/azure-functions/functions-premium-plan#pre-warmed-instances)を構成することもできます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-164">You can also configure one or more [pre-warmed instances](https://docs.microsoft.com/azure/azure-functions/functions-premium-plan#pre-warmed-instances) with the premium plan upgrade.</span></span> <span data-ttu-id="f20d2-165">このような場合は、別のインスタンスを追加する必要があるときに、既に稼働状態になっています。</span><span class="sxs-lookup"><span data-stu-id="f20d2-165">In these cases, when you need to add another instance, it's already up and ready to go.</span></span> <span data-ttu-id="f20d2-166">これらのオプションは、サーバーレスコンピューティングに関連するコールドスタートの問題を軽減するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-166">These options can help mitigate the cold start issue associated with serverless computing.</span></span>

<span data-ttu-id="f20d2-167">クラウドプロバイダーは、コンピューティングの実行時間とメモリの消費量に基づいて、サーバーレスに課金されます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-167">Cloud providers bill for serverless based on compute execution time and consumed memory.</span></span> <span data-ttu-id="f20d2-168">実行時間の長い操作や大量のメモリ消費量のワークロードは、常にサーバーレスに最適な候補ではありません。</span><span class="sxs-lookup"><span data-stu-id="f20d2-168">Long running operations or high memory consumption workloads aren't always the best candidates for serverless.</span></span> <span data-ttu-id="f20d2-169">サーバーレス関数を使用すると、短時間で完了することができます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-169">Serverless functions favor small chunks of work that can complete quickly.</span></span> <span data-ttu-id="f20d2-170">ほとんどのサーバーレスプラットフォームでは、数分以内に個々の機能が完了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f20d2-170">Most serverless platforms require individual functions to complete within a few minutes.</span></span> <span data-ttu-id="f20d2-171">Azure Functions 既定値は5分間のタイムアウト期間です。これは10分まで構成できます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-171">Azure Functions defaults to a 5-minute time-out duration, which can be configured up to 10 minutes.</span></span> <span data-ttu-id="f20d2-172">Azure Functions premium プランでもこの問題を軽減できます。既定のタイムアウトを30分に設定すると、無制限に構成できます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-172">The Azure Functions premium plan can mitigate this issue as well, defaulting time-outs to 30 minutes with an unbounded higher limit that can be configured.</span></span> <span data-ttu-id="f20d2-173">コンピューティング時間はカレンダー時間ではありません。</span><span class="sxs-lookup"><span data-stu-id="f20d2-173">Compute time isn't calendar time.</span></span> <span data-ttu-id="f20d2-174">[Azure Durable Functions framework](https://docs.microsoft.com/azure/azure-functions/durable/durable-functions-overview?tabs=csharp)を使用する高度な関数は、数日後に実行を一時停止することがあります。</span><span class="sxs-lookup"><span data-stu-id="f20d2-174">More advanced functions using the [Azure Durable Functions framework](https://docs.microsoft.com/azure/azure-functions/durable/durable-functions-overview?tabs=csharp) may pause execution over a course of several days.</span></span> <span data-ttu-id="f20d2-175">課金は実際の実行時間に基づいて行います。関数がウェイクアップし、処理が再開されます。</span><span class="sxs-lookup"><span data-stu-id="f20d2-175">The billing is based on actual execution time - when the function wakes up and resumes processing.</span></span>

<span data-ttu-id="f20d2-176">最後に、アプリケーションタスクに Azure Functions を利用することで、複雑さが増します。</span><span class="sxs-lookup"><span data-stu-id="f20d2-176">Finally, leveraging Azure Functions for application tasks adds complexity.</span></span> <span data-ttu-id="f20d2-177">最初に、モジュール化された疎結合設計を使用してアプリケーションを設計することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="f20d2-177">It's wise to first architect your application with a modular, loosely coupled design.</span></span> <span data-ttu-id="f20d2-178">次に、サーバーレスが追加の複雑さを正当化する利点があるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="f20d2-178">Then, identify if there are benefits serverless would offer that justify the additional complexity.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="f20d2-179">[前へ](leverage-containers-orchestrators.md)
>[次へ](combine-containers-serverless-approaches.md)</span><span class="sxs-lookup"><span data-stu-id="f20d2-179">[Previous](leverage-containers-orchestrators.md)
[Next](combine-containers-serverless-approaches.md)</span></span>
