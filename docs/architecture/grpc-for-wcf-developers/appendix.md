---
title: WCF 開発者向けの付録-gRPC
description: 最新のマイクロサービスアーキテクチャにおける分散トランザクションとその実装について説明します。
ms.date: 09/02/2019
ms.openlocfilehash: 061aef016fd0e4303e1bbcbf0e73cec2b0c54f74
ms.sourcegitcommit: f348c84443380a1959294cdf12babcb804cfa987
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/12/2019
ms.locfileid: "73968218"
---
# <a name="appendix-a---transactions"></a><span data-ttu-id="0f3f0-103">付録 A-トランザクション</span><span class="sxs-lookup"><span data-stu-id="0f3f0-103">Appendix A - Transactions</span></span>

<span data-ttu-id="0f3f0-104">Windows Communication Foundation (WCF) でサポートされている分散トランザクションを使用すると、複数のサービスにわたってアトミックな操作を実行できます。</span><span class="sxs-lookup"><span data-stu-id="0f3f0-104">Windows Communication Foundation (WCF) supported distributed transactions, allowing atomic operations to be performed across multiple services.</span></span> <span data-ttu-id="0f3f0-105">この機能は、 [Microsoft 分散トランザクションコーディネーター](https://docs.microsoft.com/previous-versions/windows/desktop/ms684146(v=vs.85))に基づいています。</span><span class="sxs-lookup"><span data-stu-id="0f3f0-105">This functionality was based on the [Microsoft Distributed Transaction Coordinator](https://docs.microsoft.com/previous-versions/windows/desktop/ms684146(v=vs.85)).</span></span>

<span data-ttu-id="0f3f0-106">最新のマイクロサービスのランドスケープでは、この種類の自動化された分散トランザクション処理はできません。</span><span class="sxs-lookup"><span data-stu-id="0f3f0-106">In the modern microservices landscape, this type of automated distributed transaction processing isn't possible.</span></span> <span data-ttu-id="0f3f0-107">1つの環境で使用できるオペレーティングシステム、プログラミング言語、およびフレームワークが混在しているとは言えませんが、多くの場合、リレーショナルデータベース、NoSQL データストア、メッセージングシステムなど、さまざまなテクノロジを利用することはできません。</span><span class="sxs-lookup"><span data-stu-id="0f3f0-107">There are too many different technologies at play, including relational databases, NoSQL data stores, and messaging systems, not to mention the mix of operating systems, programming languages and frameworks that may be used in a single environment.</span></span>

<span data-ttu-id="0f3f0-108">WCF 分散トランザクションは、 [2 フェーズコミット (2pc)](https://en.wikipedia.org/wiki/Two-phase_commit_protocol)と呼ばれるものを実装したものです。</span><span class="sxs-lookup"><span data-stu-id="0f3f0-108">The WCF distributed transaction is an implementation of what is known as a [two-phase commit (2PC)](https://en.wikipedia.org/wiki/Two-phase_commit_protocol).</span></span> <span data-ttu-id="0f3f0-109">サービス間でメッセージを調整し、各サービス内で開いているトランザクションを作成し、成功または失敗に応じて "コミット" または "ロールバック" メッセージを送信することによって、2PC トランザクションを手動で実装することができます。</span><span class="sxs-lookup"><span data-stu-id="0f3f0-109">It's possible to implement 2PC transactions manually by coordinating messages across services, creating open transactions within each service and sending "commit" or "rollback" messages depending upon success or failure.</span></span> <span data-ttu-id="0f3f0-110">ただし、2PC の管理に関係する複雑さは、システムの進化に伴って指数関数的に増加することがあります。また、開いているトランザクションは、パフォーマンスに悪影響を及ぼす可能性があるデータベースロックを保持し、さらにはサービス間のデッドロックを引き起こす可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0f3f0-110">However, the complexity that is involved in managing 2PC can increase exponentially as systems evolve, and open transactions hold database locks that can negatively impact performance or, worse, cause cross-service deadlocks.</span></span>

<span data-ttu-id="0f3f0-111">可能な場合は、分散トランザクションを完全に回避することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="0f3f0-111">If possible, it's best to avoid distributed transactions altogether.</span></span> <span data-ttu-id="0f3f0-112">アトミックの更新を必要とするようにデータの2つの項目がリンクされている場合は、それらを同じサービスに対して処理し、単一の要求またはメッセージを使用してそのサービスに対してアトミックな変更を適用することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="0f3f0-112">If two items of data are so linked as to require atomic updates, consider handling them both with the same service, and applying those atomic changes using a single request or message to that service.</span></span>

<span data-ttu-id="0f3f0-113">これが不可能な場合は、別の方法として、 [Saga パターン](https://microservices.io/patterns/data/saga.html)を使用する方法があります。</span><span class="sxs-lookup"><span data-stu-id="0f3f0-113">If that isn't possible, then one alternative is to use the [Saga pattern](https://microservices.io/patterns/data/saga.html).</span></span> <span data-ttu-id="0f3f0-114">Saga では、更新は順番に処理されます。各更新が成功すると、次の更新がトリガーされます。</span><span class="sxs-lookup"><span data-stu-id="0f3f0-114">In a saga, updates are processing sequentially; as each update succeeds the next one is triggered.</span></span> <span data-ttu-id="0f3f0-115">これらのトリガーは、サービスからサービスに伝達することも、saga コーディネーターまたは "orchestrator" によって管理することもできます。</span><span class="sxs-lookup"><span data-stu-id="0f3f0-115">These triggers can be propagated from service to service, or managed by a saga coordinator or "orchestrator".</span></span> <span data-ttu-id="0f3f0-116">プロセスのどの時点でも更新が失敗した場合、更新を既に完了しているサービスでは、元に戻すための特定のロジックが適用されます。</span><span class="sxs-lookup"><span data-stu-id="0f3f0-116">If an update fails at any point during the process, the services that have already completed their updates apply specific logic to reverse them.</span></span>

<span data-ttu-id="0f3f0-117">また、「 [.Net マイクロサービスの電子書籍](https://docs.microsoft.com/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/)」で説明されているように、ドメイン駆動設計 (DDD) とコマンド/クエリ責務分離 (CQRS) を使用する方法もあります。</span><span class="sxs-lookup"><span data-stu-id="0f3f0-117">Another option is to use Domain Driven Design (DDD) and Command/Query Responsibility Segregation (CQRS), as described in the [.NET Microservices e-book](https://docs.microsoft.com/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/).</span></span> <span data-ttu-id="0f3f0-118">特に、ドメインイベントまたは[イベントソーシング](https://martinfowler.com/eaaDev/EventSourcing.html)を使用すると、すぐ&mdash;には適用されない場合に更新が確実に&mdash;されるようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="0f3f0-118">In particular, using domain events or [event sourcing](https://martinfowler.com/eaaDev/EventSourcing.html) can help to ensure that updates are consistently&mdash;if not immediately&mdash;applied.</span></span>

>[!div class="step-by-step"]
>[<span data-ttu-id="0f3f0-119">前へ</span><span class="sxs-lookup"><span data-stu-id="0f3f0-119">Previous</span></span>](application-performance-management.md)
