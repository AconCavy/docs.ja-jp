---
title: WCF 開発者向けの付録-gRPC
description: 最新のマイクロサービスアーキテクチャにおける分散トランザクションとその実装について説明します。
ms.date: 09/02/2019
ms.openlocfilehash: 9931681727f921e007c2f80852ad0e69cd7288de
ms.sourcegitcommit: 5fb5b6520b06d7f5e6131ec2ad854da302a28f2e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/03/2019
ms.locfileid: "74711468"
---
# <a name="appendix-a---transactions"></a><span data-ttu-id="58055-103">付録 A-トランザクション</span><span class="sxs-lookup"><span data-stu-id="58055-103">Appendix A - Transactions</span></span>

<span data-ttu-id="58055-104">Windows Communication Foundation (WCF) では分散トランザクションがサポートされているため、複数のサービスにまたがるアトミック操作を実行できます。</span><span class="sxs-lookup"><span data-stu-id="58055-104">Windows Communication Foundation (WCF) supports distributed transactions, allowing you to perform atomic operations across multiple services.</span></span> <span data-ttu-id="58055-105">この機能は、 [Microsoft 分散トランザクションコーディネーター](https://docs.microsoft.com/previous-versions/windows/desktop/ms684146(v=vs.85))に基づいています。</span><span class="sxs-lookup"><span data-stu-id="58055-105">This functionality is based on the [Microsoft Distributed Transaction Coordinator](https://docs.microsoft.com/previous-versions/windows/desktop/ms684146(v=vs.85)).</span></span>

<span data-ttu-id="58055-106">新しいマイクロサービスのランドスケープでは、この種類の自動化された分散トランザクション処理はできません。</span><span class="sxs-lookup"><span data-stu-id="58055-106">In the newer microservices landscape, this type of automated distributed transaction processing isn't possible.</span></span> <span data-ttu-id="58055-107">リレーショナルデータベース、NoSQL データストア、メッセージングシステムなど、さまざまなテクノロジが関係しています。</span><span class="sxs-lookup"><span data-stu-id="58055-107">There are too many different technologies involved, including relational databases, NoSQL data stores, and messaging systems.</span></span> <span data-ttu-id="58055-108">また、1つの環境で使用されているオペレーティングシステム、プログラミング言語、フレームワークが混在している場合もあります。</span><span class="sxs-lookup"><span data-stu-id="58055-108">There might also be a mix of operating systems, programming languages, and frameworks in use in a single environment.</span></span>

<span data-ttu-id="58055-109">WCF 分散トランザクションは、 [2 フェーズコミット (2pc)](https://en.wikipedia.org/wiki/Two-phase_commit_protocol)と呼ばれるものを実装したものです。</span><span class="sxs-lookup"><span data-stu-id="58055-109">WCF distributed transaction is an implementation of what is known as a [two-phase commit (2PC)](https://en.wikipedia.org/wiki/Two-phase_commit_protocol).</span></span> <span data-ttu-id="58055-110">サービス間でメッセージを調整し、各サービス内で開いているトランザクションを作成し、成功または失敗に応じてコミットまたはロールバックメッセージを送信することにより、2PC トランザクションを手動で実装できます。</span><span class="sxs-lookup"><span data-stu-id="58055-110">You can implement 2PC transactions manually by coordinating messages across services, creating open transactions within each service, and sending commit or rollback messages, depending upon success or failure.</span></span> <span data-ttu-id="58055-111">ただし、2PC の管理に伴う複雑さは、システムの進化に伴って急激に増加する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="58055-111">However, the complexity involved in managing 2PC can increase exponentially as systems evolve.</span></span> <span data-ttu-id="58055-112">開いているトランザクションは、パフォーマンスに悪影響を及ぼす可能性のあるデータベースロックを保持するか、またはサービス間のデッドロックの原因となります。</span><span class="sxs-lookup"><span data-stu-id="58055-112">Open transactions hold database locks that can negatively affect performance, or, worse, cause cross-service deadlocks.</span></span>

<span data-ttu-id="58055-113">可能な場合は、分散トランザクションを完全に回避することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="58055-113">If possible, it's best to avoid distributed transactions altogether.</span></span> <span data-ttu-id="58055-114">データの2つの項目が、アトミック更新を必要とするようにリンクされている場合は、それらを同じサービスで処理することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="58055-114">If two items of data are so linked as to require atomic updates, consider handling them both with the same service.</span></span> <span data-ttu-id="58055-115">単一の要求またはメッセージをそのサービスに対して使用して、これらのアトミックな変更を適用します。</span><span class="sxs-lookup"><span data-stu-id="58055-115">Apply those atomic changes by using a single request or message to that service.</span></span>

<span data-ttu-id="58055-116">これが不可能な場合は、別の方法として、 [Saga パターン](https://microservices.io/patterns/data/saga.html)を使用する方法があります。</span><span class="sxs-lookup"><span data-stu-id="58055-116">If that isn't possible, then one alternative is to use the [Saga pattern](https://microservices.io/patterns/data/saga.html).</span></span> <span data-ttu-id="58055-117">Saga では、更新は順番に処理されます。各更新が成功すると、次の更新がトリガーされます。</span><span class="sxs-lookup"><span data-stu-id="58055-117">In a saga, updates are processed sequentially; as each update succeeds, the next one is triggered.</span></span> <span data-ttu-id="58055-118">これらのトリガーは、サービスからサービスに伝達することも、saga コーディネーターまたは orchestrator で管理することもできます。</span><span class="sxs-lookup"><span data-stu-id="58055-118">These triggers can be propagated from service to service, or managed by a saga coordinator or orchestrator.</span></span> <span data-ttu-id="58055-119">プロセスのどの時点でも更新が失敗した場合、更新を既に完了しているサービスでは、元に戻すための特定のロジックが適用されます。</span><span class="sxs-lookup"><span data-stu-id="58055-119">If an update fails at any point during the process, the services that have already completed their updates apply specific logic to reverse them.</span></span>

<span data-ttu-id="58055-120">また、「 [.Net マイクロサービスの電子書籍](https://docs.microsoft.com/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/)」で説明されているように、ドメイン駆動設計 (DDD) とコマンド/クエリ責務分離 (CQRS) を使用する方法もあります。</span><span class="sxs-lookup"><span data-stu-id="58055-120">Another option is to use Domain Driven Design (DDD) and Command/Query Responsibility Segregation (CQRS), as described in the [.NET Microservices e-book](https://docs.microsoft.com/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/).</span></span> <span data-ttu-id="58055-121">特に、ドメインイベントまたは[イベントソーシング](https://martinfowler.com/eaaDev/EventSourcing.html)を使用すると、直ちに更新が適用されることを保証するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="58055-121">In particular, using domain events or [event sourcing](https://martinfowler.com/eaaDev/EventSourcing.html) can help to ensure that updates are consistently, if not immediately, applied.</span></span>

>[!div class="step-by-step"]
>[<span data-ttu-id="58055-122">前へ</span><span class="sxs-lookup"><span data-stu-id="58055-122">Previous</span></span>](application-performance-management.md)
