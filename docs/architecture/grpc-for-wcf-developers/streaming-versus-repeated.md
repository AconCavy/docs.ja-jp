---
title: ストリーミングサービスと繰り返しフィールド-WCF 開発者向け gRPC
description: GRPC を使用してデータのコレクションを渡す方法として、繰り返しフィールドをストリーミングサービスに比較します。
ms.date: 09/02/2019
ms.openlocfilehash: 0e717df57ba2bb52d63a063072d8a45bf0f7e395
ms.sourcegitcommit: f38e527623883b92010cf4760246203073e12898
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/20/2020
ms.locfileid: "77503369"
---
# <a name="grpc-streaming-services-vs-repeated-fields"></a>gRPC streaming services と繰り返されるフィールド

gRPC サービスには、データセットを返すための2つの方法、またはオブジェクトの一覧が用意されています。 プロトコルバッファーメッセージの指定では、別のメッセージ内のメッセージのリストまたは配列を宣言するために `repeated` キーワードを使用します。 GRPC サービス仕様では、`stream` キーワードを使用して、長時間実行される永続的な接続を宣言します。 この接続では、複数のメッセージが送信され、個別に処理できます。 

`stream` 機能を使用して、通知やログメッセージなどの長時間実行されるテンポラルデータを使用することもできます。 ただし、この章では、1つのデータセットを返すための使用方法を検討します。

使用する必要がある要素は、次のような要因によって異なります。

- データセットの全体的なサイズ。
- クライアント側またはサーバー側でデータセットを作成するために要した時間。
- 最初のアイテムが使用可能になるとすぐにデータセットのコンシューマーがアクションを開始できるかどうか、またはすべてのデータセットを使用して有用な処理を行う必要があるかどうか。

## <a name="when-to-use-repeated-fields"></a>`repeated` フィールドを使用する場合

サイズが制限され、短時間で完全に生成できるデータセットの場合 (1 秒未満の場合など) は、通常の Protobuf メッセージで `repeated` フィールドを使用する必要があります。 たとえば、e コマースシステムでは、注文内の項目のリストを作成するのは簡単であり、リストが非常に大きくなるとは限りません。 `repeated` フィールドを持つ1つのメッセージを返すのは、`stream` を使用する場合よりもはるかに高速であり、ネットワークオーバーヘッドが少なくなります。

クライアントが処理を開始する前にすべてのデータを必要とし、データセットがメモリ内に構築するのに十分な大きさである場合は、`repeated` フィールドの使用を検討してください。 サーバー上のメモリ内のデータセットの作成速度が遅い場合でも、この点を考慮してください。

## <a name="when-to-use-stream-methods"></a>`stream` メソッドを使用する場合

データセット内のメッセージオブジェクトが非常に大きい可能性がある場合は、ストリーミング要求または応答を使用して転送することをお勧めします。 メモリ内に大きなオブジェクトを構築し、それをネットワークに書き込んでから、リソースを解放する方が効率的です。 このアプローチにより、サービスのスケーラビリティが向上します。

同様に、メモリが不足するのを防ぐために、無制限のサイズのデータセットをストリームに送信することをお勧めします。

コンシューマーが各項目を個別に処理できるデータセットの場合、進行状況をユーザーに示すことができる場合は、ストリームの使用を検討する必要があります。 ストリームを使用すると、アプリケーションの応答性を向上させることができますが、アプリケーションの全体的なパフォーマンスとのバランスを取る必要があります。

また、ストリームが役に立つ可能性があるもう1つのシナリオは、メッセージが複数のサービスにわたって処理される場所です。 チェーン内の各サービスが1つのストリームを返す場合は、ターミナルサービス (つまり、チェーン内の最後のサービス) がメッセージの返却を開始できます。 これらのメッセージは処理され、元の要求元にチェーンに従って戻すことができます。 要求元は、ストリームを返すか、結果を1つの応答メッセージに集約することができます。 このアプローチは、MapReduce のようなパターンに適しています。

>[!div class="step-by-step"]
>[前へ](migrate-duplex-services.md)
>[次へ](client-libraries.md)
