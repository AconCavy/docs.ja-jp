---
title: For Each...Next ステートメント
ms.date: 07/20/2015
f1_keywords:
- vb.ForEach
- vb.ForEachNext
- vb.Each
- ForEachNext
helpviewer_keywords:
- infinite loops
- Next statement [Visual Basic], For Each...Next
- endless loops
- loop structures [Visual Basic], For Each...Next
- loops, endless
- Each keyword [Visual Basic]
- instructions, repeating
- For Each statement [Visual Basic]
- collections, instruction repetition
- loops, infinite
- For Each...Next statements
- For keyword [Visual Basic], For Each...Next statements
- Exit statement [Visual Basic], For Each...Next statements
- iteration
ms.assetid: ebce3120-95c3-42b1-b70b-fa7da40c75e2
ms.openlocfilehash: 572f1efc0148bd8df4f13fa5651e74249caa45a7
ms.sourcegitcommit: 17ee6605e01ef32506f8fdc686954244ba6911de
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/22/2019
ms.locfileid: "74351205"
---
# <a name="for-eachnext-statement-visual-basic"></a><span data-ttu-id="0c5b7-102">For Each...Next ステートメント (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="0c5b7-102">For Each...Next Statement (Visual Basic)</span></span>

<span data-ttu-id="0c5b7-103">コレクション内の各要素に対してステートメントのグループを繰り返します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-103">Repeats a group of statements for each element in a collection.</span></span>

## <a name="syntax"></a><span data-ttu-id="0c5b7-104">構文</span><span class="sxs-lookup"><span data-stu-id="0c5b7-104">Syntax</span></span>

```vb
For Each element [ As datatype ] In group
    [ statements ]
    [ Continue For ]
    [ statements ]
    [ Exit For ]
    [ statements ]
Next [ element ]
```

## <a name="parts"></a><span data-ttu-id="0c5b7-105">指定項目</span><span class="sxs-lookup"><span data-stu-id="0c5b7-105">Parts</span></span>

|<span data-ttu-id="0c5b7-106">用語</span><span class="sxs-lookup"><span data-stu-id="0c5b7-106">Term</span></span>|<span data-ttu-id="0c5b7-107">Definition</span><span class="sxs-lookup"><span data-stu-id="0c5b7-107">Definition</span></span>|
|---|---|
|`element`|<span data-ttu-id="0c5b7-108">`For Each` ステートメントで必要です。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-108">Required in the `For Each` statement.</span></span> <span data-ttu-id="0c5b7-109">`Next` ステートメントでは省略可能です。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-109">Optional in the `Next` statement.</span></span> <span data-ttu-id="0c5b7-110">変動.</span><span class="sxs-lookup"><span data-stu-id="0c5b7-110">Variable.</span></span> <span data-ttu-id="0c5b7-111">コレクションの要素を反復処理するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-111">Used to iterate through the elements of the collection.</span></span>|
|`datatype`|<span data-ttu-id="0c5b7-112">[`Option Infer`](option-infer-statement.md)が on (既定値) または `element` が既に宣言されている場合は省略可能です。`Option Infer` がオフで `element` がまだ宣言されていない場合は必須です。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-112">Optional if [`Option Infer`](option-infer-statement.md) is on (the default) or `element` is already declared; required if `Option Infer` is off and `element` isn't already declared.</span></span> <span data-ttu-id="0c5b7-113">`element`のデータ型。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-113">The data type of `element`.</span></span>|
|`group`|<span data-ttu-id="0c5b7-114">必須。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-114">Required.</span></span> <span data-ttu-id="0c5b7-115">コレクション型またはオブジェクトである型を持つ変数。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-115">A variable with a type that's a collection type or Object.</span></span> <span data-ttu-id="0c5b7-116">`statements` を繰り返すコレクションを参照します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-116">Refers to the collection over which the `statements` are to be repeated.</span></span>|
|`statements`|<span data-ttu-id="0c5b7-117">省略可。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-117">Optional.</span></span> <span data-ttu-id="0c5b7-118">`group`内の各項目に対して実行される `For Each` と `Next` 間の1つ以上のステートメント。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-118">One or more statements between `For Each` and `Next` that run on each item in `group`.</span></span>|
|`Continue For`|<span data-ttu-id="0c5b7-119">省略可。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-119">Optional.</span></span> <span data-ttu-id="0c5b7-120">`For Each` ループの開始位置に制御を転送します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-120">Transfers control to the start of the `For Each` loop.</span></span>|
|`Exit For`|<span data-ttu-id="0c5b7-121">省略可。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-121">Optional.</span></span> <span data-ttu-id="0c5b7-122">`For Each` ループから制御を転送します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-122">Transfers control out of the `For Each` loop.</span></span>|
|`Next`|<span data-ttu-id="0c5b7-123">必須。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-123">Required.</span></span> <span data-ttu-id="0c5b7-124">`For Each` ループの定義を終了します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-124">Terminates the definition of the `For Each` loop.</span></span>|

## <a name="simple-example"></a><span data-ttu-id="0c5b7-125">簡単な例</span><span class="sxs-lookup"><span data-stu-id="0c5b7-125">Simple Example</span></span>

<span data-ttu-id="0c5b7-126">コレクションまたは配列の各要素に対して一連のステートメントを繰り返す場合は、`For Each`...`Next` ループを使用します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-126">Use a `For Each`...`Next` loop when you want to repeat a set of statements for each element of a collection or array.</span></span>

> [!TIP]
> <span data-ttu-id="0c5b7-127">[For...Next ステートメント](../../../visual-basic/language-reference/statements/for-next-statement.md)は、ループの各反復処理を制御変数に関連付けて、その変数の初期値と最終値を決定できる場合に適しています。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-127">A [For...Next Statement](../../../visual-basic/language-reference/statements/for-next-statement.md) works well when you can associate each iteration of a loop with a control variable and determine that variable's initial and final values.</span></span> <span data-ttu-id="0c5b7-128">ただし、コレクションを処理する場合、初期値と最終値の概念は意味がなく、コレクションに含まれる要素の数がわかるとは限りません。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-128">However, when you are dealing with a collection, the concept of initial and final values isn't meaningful, and you don't necessarily know how many elements the collection has.</span></span> <span data-ttu-id="0c5b7-129">このような場合は、`For Each`...`Next` ループの方が適していることがよくあります。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-129">In this kind of case, a `For Each`...`Next` loop is often a better choice.</span></span>

<span data-ttu-id="0c5b7-130">次の例では、`For Each`...`Next`</span><span class="sxs-lookup"><span data-stu-id="0c5b7-130">In the following example, the `For Each`…`Next`</span></span> <span data-ttu-id="0c5b7-131">ステートメントは、リストコレクションのすべての要素を反復処理します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-131">statement iterates through all the elements of a List collection.</span></span>

[!code-vb[VbVbalrStatements#121](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/class9.vb#121)]

<span data-ttu-id="0c5b7-132">その他の例については、「[コレクション](../../../standard/collections/index.md)と[配列](../../../visual-basic/programming-guide/language-features/arrays/index.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-132">For more examples, see [Collections](../../../standard/collections/index.md) and [Arrays](../../../visual-basic/programming-guide/language-features/arrays/index.md).</span></span>

## <a name="nested-loops"></a><span data-ttu-id="0c5b7-133">Nested Loops</span><span class="sxs-lookup"><span data-stu-id="0c5b7-133">Nested Loops</span></span>

<span data-ttu-id="0c5b7-134">ループを入れ子にするには、別のループ内にループを挿入し `For Each` ます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-134">You can nest `For Each` loops by putting one loop within another.</span></span>

<span data-ttu-id="0c5b7-135">次の例では、入れ子になった `For Each`...`Next` を示します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-135">The following example demonstrates nested `For Each`…`Next`</span></span> <span data-ttu-id="0c5b7-136">構成.</span><span class="sxs-lookup"><span data-stu-id="0c5b7-136">structures.</span></span>

[!code-vb[VbVbalrStatements#122](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/class9.vb#122)]

<span data-ttu-id="0c5b7-137">ループを入れ子にする場合、各ループには一意の `element` 変数が必要です。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-137">When you nest loops, each loop must have a unique `element` variable.</span></span>

<span data-ttu-id="0c5b7-138">また、さまざまな種類の制御構造を相互に入れ子にすることもできます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-138">You can also nest different kinds of control structures within each other.</span></span> <span data-ttu-id="0c5b7-139">詳細については、「[入れ子になった制御構造](../../../visual-basic/programming-guide/language-features/control-flow/nested-control-structures.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-139">For more information, see [Nested Control Structures](../../../visual-basic/programming-guide/language-features/control-flow/nested-control-structures.md).</span></span>

## <a name="exit-for-and-continue-for"></a><span data-ttu-id="0c5b7-140">Exit For と Continue For</span><span class="sxs-lookup"><span data-stu-id="0c5b7-140">Exit For and Continue For</span></span>

<span data-ttu-id="0c5b7-141">[Exit For](../../../visual-basic/language-reference/statements/exit-statement.md)ステートメントを実行すると、`For`...`Next` が終了します</span><span class="sxs-lookup"><span data-stu-id="0c5b7-141">The [Exit For](../../../visual-basic/language-reference/statements/exit-statement.md) statement causes execution to exit the `For`…`Next`</span></span> <span data-ttu-id="0c5b7-142">ループし、`Next` ステートメントの後のステートメントに制御を転送します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-142">loop and transfers control to the statement that follows the `Next` statement.</span></span>

<span data-ttu-id="0c5b7-143">`Continue For` ステートメントは、ループの次の反復処理に制御を直ちに転送します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-143">The `Continue For` statement transfers control immediately to the next iteration of the loop.</span></span> <span data-ttu-id="0c5b7-144">詳細については、「[Continue ステートメント](../../../visual-basic/language-reference/statements/continue-statement.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-144">For more information, see [Continue Statement](../../../visual-basic/language-reference/statements/continue-statement.md).</span></span>

<span data-ttu-id="0c5b7-145">次の例では、`Continue For` ステートメントと `Exit For` ステートメントを使用する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-145">The following example shows how to use the `Continue For` and `Exit For` statements.</span></span>

[!code-vb[VbVbalrStatements#123](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/class9.vb#123)]

<span data-ttu-id="0c5b7-146">`For Each` ループには、任意の数の `Exit For` ステートメントを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-146">You can put any number of `Exit For` statements in a `For Each` loop.</span></span> <span data-ttu-id="0c5b7-147">入れ子になった `For Each` ループ内で使用すると、`Exit For` によって最も内側のループが終了し、次の上位レベルの入れ子に制御が移ります。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-147">When used within nested `For Each` loops, `Exit For` causes execution to exit the innermost loop and transfers control to the next higher level of nesting.</span></span>

<span data-ttu-id="0c5b7-148">`Exit For` は、たとえば、`If`...`Then`...`Else` 構造など、何らかの条件を評価した後に使用されることがよくあります。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-148">`Exit For` is often used after an evaluation of some condition, for example, in an `If`...`Then`...`Else` structure.</span></span> <span data-ttu-id="0c5b7-149">次の条件に `Exit For` を使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-149">You might want to use `Exit For` for the following conditions:</span></span>

- <span data-ttu-id="0c5b7-150">反復処理を続行することは不要または不可能です。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-150">Continuing to iterate is unnecessary or impossible.</span></span> <span data-ttu-id="0c5b7-151">これは、エラー値または終了要求が原因である可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-151">This might be caused by an erroneous value or a termination request.</span></span>

- <span data-ttu-id="0c5b7-152">例外は、`Try`...`Catch`...`Finally`でキャッチされます。`Finally` ブロックの末尾に `Exit For` を使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-152">An exception is caught in a `Try`...`Catch`...`Finally`. You might use `Exit For` at the end of the `Finally` block.</span></span>

- <span data-ttu-id="0c5b7-153">無限ループがあります。これは、大規模または無限の回数実行されるループです。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-153">There an endless loop, which is a loop that could run a large or even infinite number of times.</span></span> <span data-ttu-id="0c5b7-154">このような条件を検出した場合は、`Exit For` を使用してループをエスケープできます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-154">If you detect such a condition, you can use `Exit For` to escape the loop.</span></span> <span data-ttu-id="0c5b7-155">詳細については、「[Do...Loop ステートメント](../../../visual-basic/language-reference/statements/do-loop-statement.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-155">For more information, see [Do...Loop Statement](../../../visual-basic/language-reference/statements/do-loop-statement.md).</span></span>

## <a name="iterators"></a><span data-ttu-id="0c5b7-156">反復子</span><span class="sxs-lookup"><span data-stu-id="0c5b7-156">Iterators</span></span>

<span data-ttu-id="0c5b7-157">*反復子*を使用して、コレクションに対してカスタムの反復処理を実行します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-157">You use an *iterator* to perform a custom iteration over a collection.</span></span> <span data-ttu-id="0c5b7-158">反復子は、関数または `Get` アクセサーにすることができます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-158">An iterator can be a function or a `Get` accessor.</span></span> <span data-ttu-id="0c5b7-159">`Yield` ステートメントを使用して、コレクションの各要素を一度に1つ返します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-159">It uses a `Yield` statement to return each element of the collection one at a time.</span></span>

<span data-ttu-id="0c5b7-160">`For Each...Next` ステートメントを使用して、反復子を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-160">You call an iterator by using a `For Each...Next` statement.</span></span> <span data-ttu-id="0c5b7-161">`For Each` ループの各イテレーションは、反復子を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-161">Each iteration of the `For Each` loop calls the iterator.</span></span> <span data-ttu-id="0c5b7-162">反復子で `Yield` ステートメントに到達すると、`Yield` ステートメント内の式が返され、コード内の現在の位置が保持されます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-162">When a `Yield` statement is reached in the iterator, the expression in the `Yield` statement is returned, and the current location in code is retained.</span></span> <span data-ttu-id="0c5b7-163">次回、反復子が呼び出されると、この位置から実行が再開されます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-163">Execution is restarted from that location the next time that the iterator is called.</span></span>

<span data-ttu-id="0c5b7-164">次の例では、iterator 関数を使用します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-164">The following example uses an iterator function.</span></span> <span data-ttu-id="0c5b7-165">Iterator 関数には、For... の内部にある `Yield` ステートメントがあります。 [次](../../../visual-basic/language-reference/statements/for-next-statement.md)のループ。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-165">The iterator function has a `Yield` statement that's inside a [For…Next](../../../visual-basic/language-reference/statements/for-next-statement.md) loop.</span></span> <span data-ttu-id="0c5b7-166">`ListEvenNumbers` メソッドでは、`For Each` ステートメント本体の各反復処理によって、次の `Yield` ステートメントに進む反復子関数の呼び出しが作成されます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-166">In the `ListEvenNumbers` method, each iteration of the `For Each` statement body creates a call to the iterator function, which proceeds to the next `Yield` statement.</span></span>

[!code-vb[VbVbalrStatements#127](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/class9.vb#127)]

<span data-ttu-id="0c5b7-167">詳細については、「[反復子](../../programming-guide/concepts/iterators.md)、 [Yield ステートメント](../../../visual-basic/language-reference/statements/yield-statement.md)、および[反復子](../../../visual-basic/language-reference/modifiers/iterator.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-167">For more information, see [Iterators](../../programming-guide/concepts/iterators.md), [Yield Statement](../../../visual-basic/language-reference/statements/yield-statement.md), and [Iterator](../../../visual-basic/language-reference/modifiers/iterator.md).</span></span>

## <a name="technical-implementation"></a><span data-ttu-id="0c5b7-168">技術的な実装</span><span class="sxs-lookup"><span data-stu-id="0c5b7-168">Technical Implementation</span></span>

<span data-ttu-id="0c5b7-169">`For Each`...`Next`</span><span class="sxs-lookup"><span data-stu-id="0c5b7-169">When a `For Each`…`Next`</span></span> <span data-ttu-id="0c5b7-170">ステートメントを実行すると、ループが開始される前に、Visual Basic によってコレクションが1回だけ評価されます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-170">statement runs, Visual Basic evaluates the collection only one time, before the loop starts.</span></span> <span data-ttu-id="0c5b7-171">ステートメントブロックで `element` または `group`が変更された場合、これらの変更はループの繰り返しに影響しません。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-171">If your statement block changes `element` or `group`, these changes don't affect the iteration of the loop.</span></span>

<span data-ttu-id="0c5b7-172">コレクション内のすべての要素が `element`に連続して割り当てられると、`For Each` ループが停止し、`Next` ステートメントに続くステートメントに制御が移ります。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-172">When all the elements in the collection have been successively assigned to `element`, the `For Each` loop stops and control passes to the statement following the `Next` statement.</span></span>

<span data-ttu-id="0c5b7-173">[Option Infer ステートメント](option-infer-statement.md)が on (既定の設定) の場合、Visual Basic コンパイラは `element`のデータ型を推測できます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-173">If [Option Infer](option-infer-statement.md) is on (its default setting), the Visual Basic compiler can infer the data type of `element`.</span></span> <span data-ttu-id="0c5b7-174">Off で、`element` がループの外側で宣言されていない場合は、`For Each` ステートメントで宣言する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-174">If it is off and `element` hasn't been declared outside the loop, you must declare it in the `For Each` statement.</span></span> <span data-ttu-id="0c5b7-175">`element` のデータ型を明示的に宣言するには、`As` 句を使用します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-175">To declare the data type of `element` explicitly, use an `As` clause.</span></span> <span data-ttu-id="0c5b7-176">要素のデータ型が `For Each`...`Next` コンストラクトの外側で定義されている場合を除き、そのスコープはループの本体です。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-176">Unless the data type of element is defined outside the `For Each`...`Next` construct, its scope is the body of the loop.</span></span> <span data-ttu-id="0c5b7-177">ループ内で `element` 宣言することはできません。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-177">Note that you cannot declare `element` both outside and inside the loop.</span></span>

<span data-ttu-id="0c5b7-178">必要に応じて、`Next` ステートメントで `element` を指定することもできます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-178">You can optionally specify `element` in the `Next` statement.</span></span> <span data-ttu-id="0c5b7-179">これにより、特に `For Each` ループが入れ子になっている場合に、プログラムの読みやすさが向上します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-179">This improves the readability of your program, especially if you have nested `For Each` loops.</span></span> <span data-ttu-id="0c5b7-180">対応する `For Each` ステートメントに表示されるものと同じ変数を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-180">You must specify the same variable as the one that appears in the corresponding `For Each` statement.</span></span>

<span data-ttu-id="0c5b7-181">ループ内の `element` の値を変更しないようにすることもできます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-181">You might want to avoid changing the value of `element` inside a loop.</span></span> <span data-ttu-id="0c5b7-182">これにより、コードの読み取りとデバッグが困難になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-182">Doing this can make it more difficult to read and debug your code.</span></span> <span data-ttu-id="0c5b7-183">`group` の値を変更しても、ループが最初に入力されたときに決定されたコレクションまたはその要素には影響しません。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-183">Changing the value of `group` doesn't affect the collection or its elements, which were determined when the loop was first entered.</span></span>

<span data-ttu-id="0c5b7-184">ループを入れ子にしているときに、外側の入れ子レベルの `Next` ステートメントが内部レベルの `Next` より前に検出された場合、コンパイラはエラーを通知します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-184">When you're nesting loops, if a `Next` statement of an outer nesting level is encountered before the `Next` of an inner level, the compiler signals an error.</span></span> <span data-ttu-id="0c5b7-185">ただし、コンパイラは、すべての `Next` ステートメントで `element` を指定した場合にのみ、この重複エラーを検出できます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-185">However, the compiler can detect this overlapping error only if you specify `element` in every `Next` statement.</span></span>

<span data-ttu-id="0c5b7-186">コードが特定の順序でコレクションを走査することに依存している場合、コレクションが公開する列挙子オブジェクトの特性がわかっていない限り、`For Each`...`Next` ループは最適な選択ではありません。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-186">If your code depends on traversing a collection in a particular order, a `For Each`...`Next` loop isn't the best choice, unless you know the characteristics of the enumerator object the collection exposes.</span></span> <span data-ttu-id="0c5b7-187">走査の順序は Visual Basic によって決定されるのではなく、列挙子オブジェクトの <xref:System.Collections.IEnumerator.MoveNext%2A> メソッドによって決定されます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-187">The order of traversal isn't determined by Visual Basic, but by the <xref:System.Collections.IEnumerator.MoveNext%2A> method of the enumerator object.</span></span> <span data-ttu-id="0c5b7-188">したがって、コレクションのどの要素が `element`に最初に返されるか、または指定された要素の後に返される次の要素であるかを予測できない場合があります。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-188">Therefore, you might not be able to predict which element of the collection is the first to be returned in `element`, or which is the next to be returned after a given element.</span></span> <span data-ttu-id="0c5b7-189">`For`...`Next` や `Do`...`Loop`などの別のループ構造を使用して、より信頼性の高い結果を得ることができます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-189">You might achieve more reliable results using a different loop structure, such as `For`...`Next` or `Do`...`Loop`.</span></span>

<span data-ttu-id="0c5b7-190">ランタイムは、`group` 内の要素を `element`に変換できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-190">The runtime must be able to convert the elements in `group` to `element`.</span></span> <span data-ttu-id="0c5b7-191">[`Option Strict`] ステートメントでは、拡大変換と縮小変換の両方を許可するかどうかを制御します (`Option Strict` はオフ、既定値)。または、拡大変換のみが許可されるかどうかを制御します (`Option Strict` がオンの場合)。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-191">The [`Option Strict`] statement controls whether both widening and narrowing conversions are allowed (`Option Strict` is off, its default value), or whether only widening conversions are allowed (`Option Strict` is on).</span></span> <span data-ttu-id="0c5b7-192">詳細については、「[縮小変換](#narrowing-conversions)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-192">For more information, see [Narrowing conversions](#narrowing-conversions).</span></span>

<span data-ttu-id="0c5b7-193">`group` のデータ型は、コレクションまたは列挙可能な配列を参照する参照型である必要があります。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-193">The data type of `group` must be a reference type that refers to a collection or an array that's enumerable.</span></span> <span data-ttu-id="0c5b7-194">ほとんどの場合、`group` は、`System.Collections` 名前空間の <xref:System.Collections.IEnumerable> インターフェイスまたは `System.Collections.Generic` 名前空間の <xref:System.Collections.Generic.IEnumerable%601> インターフェイスを実装するオブジェクトを参照します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-194">Most commonly this means that `group` refers to an object that implements the <xref:System.Collections.IEnumerable> interface of the `System.Collections` namespace or the <xref:System.Collections.Generic.IEnumerable%601> interface of the `System.Collections.Generic` namespace.</span></span> <span data-ttu-id="0c5b7-195">`System.Collections.IEnumerable` は、コレクションの列挙子オブジェクトを返す <xref:System.Collections.IEnumerable.GetEnumerator%2A> メソッドを定義します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-195">`System.Collections.IEnumerable` defines the <xref:System.Collections.IEnumerable.GetEnumerator%2A> method, which returns an enumerator object for the collection.</span></span> <span data-ttu-id="0c5b7-196">列挙子オブジェクトは、`System.Collections` 名前空間の `System.Collections.IEnumerator` インターフェイスを実装し、<xref:System.Collections.IEnumerator.Current%2A> プロパティと <xref:System.Collections.IEnumerator.Reset%2A> および <xref:System.Collections.IEnumerator.MoveNext%2A> メソッドを公開します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-196">The enumerator object implements the `System.Collections.IEnumerator` interface of the `System.Collections` namespace and exposes the <xref:System.Collections.IEnumerator.Current%2A> property and the <xref:System.Collections.IEnumerator.Reset%2A> and <xref:System.Collections.IEnumerator.MoveNext%2A> methods.</span></span> <span data-ttu-id="0c5b7-197">Visual Basic は、これらを使用してコレクションを走査します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-197">Visual Basic uses these to traverse the collection.</span></span>

### <a name="narrowing-conversions"></a><span data-ttu-id="0c5b7-198">縮小変換</span><span class="sxs-lookup"><span data-stu-id="0c5b7-198">Narrowing Conversions</span></span>

<span data-ttu-id="0c5b7-199">`Option Strict` が `On`に設定されている場合、通常、縮小変換ではコンパイラエラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-199">When `Option Strict` is set to `On`, narrowing conversions ordinarily cause compiler errors.</span></span> <span data-ttu-id="0c5b7-200">ただし、`For Each` ステートメントでは、`group` 内の要素から `element` への変換は実行時に評価されて実行され、縮小変換によって発生するコンパイラエラーは抑制されます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-200">In a `For Each` statement, however, conversions from the elements in `group` to `element` are evaluated and performed at run time, and compiler errors caused by narrowing conversions are suppressed.</span></span>

<span data-ttu-id="0c5b7-201">次の例では、`n` の初期値としての `m` の割り当ては `Option Strict` がオンのときにはコンパイルされません。これは、`Long` から `Integer` への変換は縮小変換であるためです。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-201">In the following example, the assignment of `m` as the initial value for `n` doesn't compile when `Option Strict` is on because the conversion of a `Long` to an `Integer` is a narrowing conversion.</span></span> <span data-ttu-id="0c5b7-202">ただし、`For Each` ステートメントでは、`number` への代入によって `Long` から `Integer`への変換が必要な場合でも、コンパイラエラーは報告されません。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-202">In the `For Each` statement, however, no compiler error is reported, even though the assignment to `number` requires the same conversion from `Long` to `Integer`.</span></span> <span data-ttu-id="0c5b7-203">多数の数値が含まれている `For Each` ステートメントでは、<xref:Microsoft.VisualBasic.CompilerServices.Conversions.ToInteger%2A> が大きい数値に適用されると、実行時エラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-203">In the `For Each` statement that contains a large number, a run-time error occurs when <xref:Microsoft.VisualBasic.CompilerServices.Conversions.ToInteger%2A> is applied to the large number.</span></span>

[!code-vb[VbVbalrStatements#89](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/Class3.vb#89)]

### <a name="ienumerator-calls"></a><span data-ttu-id="0c5b7-204">IEnumerator 呼び出し</span><span class="sxs-lookup"><span data-stu-id="0c5b7-204">IEnumerator Calls</span></span>

<span data-ttu-id="0c5b7-205">`For Each`...`Next` ループの実行が開始されると、`group` が有効なコレクションオブジェクトを参照していることが Visual Basic 検証されます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-205">When execution of a `For Each`...`Next` loop starts, Visual Basic verifies that `group` refers to a valid collection object.</span></span> <span data-ttu-id="0c5b7-206">そうでない場合は、例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-206">If not, it throws an exception.</span></span> <span data-ttu-id="0c5b7-207">それ以外の場合は、<xref:System.Collections.IEnumerator.MoveNext%2A> メソッドと列挙子オブジェクトの <xref:System.Collections.IEnumerator.Current%2A> プロパティを呼び出して、最初の要素を返します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-207">Otherwise, it calls the <xref:System.Collections.IEnumerator.MoveNext%2A> method and the <xref:System.Collections.IEnumerator.Current%2A> property of the enumerator object to return the first element.</span></span> <span data-ttu-id="0c5b7-208">`MoveNext` が次の要素がないことを示している場合 (つまり、コレクションが空の場合)、`For Each` ループは停止し、`Next` ステートメントに続くステートメントに制御が移ります。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-208">If `MoveNext` indicates that there is no next element, that is, if the collection is empty, the `For Each` loop stops and control passes to the statement following the `Next` statement.</span></span> <span data-ttu-id="0c5b7-209">それ以外の場合、Visual Basic は最初の要素に `element` を設定し、ステートメントブロックを実行します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-209">Otherwise, Visual Basic sets `element` to the first element and runs the statement block.</span></span>

<span data-ttu-id="0c5b7-210">Visual Basic が `Next` ステートメントを検出するたびに、`For Each` ステートメントに戻ります。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-210">Each time Visual Basic encounters the `Next` statement, it returns to the `For Each` statement.</span></span> <span data-ttu-id="0c5b7-211">この場合も、`MoveNext` と `Current` を呼び出して次の要素を返します。もう一度、ブロックを実行するか、結果に応じてループを停止します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-211">Again it calls `MoveNext` and `Current` to return the next element, and again it either runs the block or stops the loop depending on the result.</span></span> <span data-ttu-id="0c5b7-212">このプロセスは、次の要素が存在しないこと、または `Exit For` ステートメントが発生したことが `MoveNext` によって示されるまで続行されます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-212">This process continues until `MoveNext` indicates that there is no next element or an `Exit For` statement is encountered.</span></span>

<span data-ttu-id="0c5b7-213">**コレクションの変更。**</span><span class="sxs-lookup"><span data-stu-id="0c5b7-213">**Modifying the Collection.**</span></span> <span data-ttu-id="0c5b7-214"><xref:System.Collections.IEnumerable.GetEnumerator%2A> によって返される列挙子オブジェクトは、要素の追加、削除、置換、または並べ替えを行うことによって、コレクションを変更することはできません。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-214">The enumerator object returned by <xref:System.Collections.IEnumerable.GetEnumerator%2A> normally doesn't let you change the collection by adding, deleting, replacing, or reordering any elements.</span></span> <span data-ttu-id="0c5b7-215">`For Each`...`Next` ループを開始した後にコレクションを変更した場合、列挙子オブジェクトは無効になり、次に要素にアクセスしようとすると <xref:System.InvalidOperationException> 例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-215">If you change the collection after you have initiated a `For Each`...`Next` loop, the enumerator object becomes invalid, and the next attempt to access an element causes an <xref:System.InvalidOperationException> exception.</span></span>

<span data-ttu-id="0c5b7-216">ただし、この変更のブロックは Visual Basic によって決定されるのではなく、<xref:System.Collections.IEnumerable> インターフェイスの実装によって決まります。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-216">However, this blocking of modification isn't determined by Visual Basic, but rather by the implementation of the <xref:System.Collections.IEnumerable> interface.</span></span> <span data-ttu-id="0c5b7-217">反復処理中に変更を許可する方法で `IEnumerable` を実装することができます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-217">It is possible to implement `IEnumerable` in a way that allows for modification during iteration.</span></span> <span data-ttu-id="0c5b7-218">このような動的な変更を検討している場合は、使用しているコレクションの `IEnumerable` 実装の特性を理解していることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-218">If you are considering doing such dynamic modification, make sure that you understand the characteristics of the `IEnumerable` implementation on the collection you are using.</span></span>

<span data-ttu-id="0c5b7-219">**コレクション要素の変更。**</span><span class="sxs-lookup"><span data-stu-id="0c5b7-219">**Modifying Collection Elements.**</span></span> <span data-ttu-id="0c5b7-220">列挙子オブジェクトの <xref:System.Collections.IEnumerator.Current%2A> プロパティは[ReadOnly](../../../visual-basic/language-reference/modifiers/readonly.md)であり、各コレクション要素のローカルコピーを返します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-220">The <xref:System.Collections.IEnumerator.Current%2A> property of the enumerator object is [ReadOnly](../../../visual-basic/language-reference/modifiers/readonly.md), and it returns a local copy of each collection element.</span></span> <span data-ttu-id="0c5b7-221">つまり、`For Each`...`Next` ループで要素自体を変更することはできません。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-221">This means that you cannot modify the elements themselves in a `For Each`...`Next` loop.</span></span> <span data-ttu-id="0c5b7-222">行った変更は、`Current` からのローカルコピーにのみ適用され、基になるコレクションには反映されません。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-222">Any modification you make affects only the local copy from `Current` and isn't reflected back into the underlying collection.</span></span> <span data-ttu-id="0c5b7-223">ただし、要素が参照型の場合は、その要素が指すインスタンスのメンバーを変更できます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-223">However, if an element is a reference type, you can modify the members of the instance to which it points.</span></span> <span data-ttu-id="0c5b7-224">次の例では、各 `thisControl` 要素の `BackColor` メンバーを変更します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-224">The following example modifies the `BackColor` member of each `thisControl` element.</span></span> <span data-ttu-id="0c5b7-225">ただし、`thisControl` 自体を変更することはできません。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-225">You cannot, however, modify `thisControl` itself.</span></span>

```vb
Sub LightBlueBackground(thisForm As System.Windows.Forms.Form)
    For Each thisControl In thisForm.Controls
        thisControl.BackColor = System.Drawing.Color.LightBlue
    Next thisControl
End Sub
```

<span data-ttu-id="0c5b7-226">前の例では、各 `thisControl` 要素の `BackColor` メンバーを変更できますが、`thisControl` 自体を変更することはできません。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-226">The previous example can modify the `BackColor` member of each `thisControl` element, although it cannot modify `thisControl` itself.</span></span>

<span data-ttu-id="0c5b7-227">**配列の反復処理。**</span><span class="sxs-lookup"><span data-stu-id="0c5b7-227">**Traversing Arrays.**</span></span> <span data-ttu-id="0c5b7-228"><xref:System.Array> クラスは <xref:System.Collections.IEnumerable> インターフェイスを実装するため、すべての配列は <xref:System.Array.GetEnumerator%2A> メソッドを公開します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-228">Because the <xref:System.Array> class implements the <xref:System.Collections.IEnumerable> interface, all arrays expose the <xref:System.Array.GetEnumerator%2A> method.</span></span> <span data-ttu-id="0c5b7-229">これは、`For Each`...`Next` ループで配列を反復処理できることを意味します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-229">This means that you can iterate through an array with a `For Each`...`Next` loop.</span></span> <span data-ttu-id="0c5b7-230">ただし、読み取ることができるのは配列要素だけです。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-230">However, you can only read the array elements.</span></span> <span data-ttu-id="0c5b7-231">変更することはできません。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-231">You cannot change them.</span></span>

## <a name="example"></a><span data-ttu-id="0c5b7-232">例</span><span class="sxs-lookup"><span data-stu-id="0c5b7-232">Example</span></span>

<span data-ttu-id="0c5b7-233">次の例では、C:\ 内のすべてのフォルダーを一覧表示します。<xref:System.IO.DirectoryInfo> クラスを使用したディレクトリ。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-233">The following example lists all the folders in the C:\ directory by using the <xref:System.IO.DirectoryInfo> class.</span></span>

[!code-vb[VbVbalrStatements#124](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/class9.vb#124)]

## <a name="example"></a><span data-ttu-id="0c5b7-234">例</span><span class="sxs-lookup"><span data-stu-id="0c5b7-234">Example</span></span>

<span data-ttu-id="0c5b7-235">次の例では、コレクションを並べ替えるための手順を示しています。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-235">The following example illustrates a procedure for sorting a collection.</span></span> <span data-ttu-id="0c5b7-236">この例では、<xref:System.Collections.Generic.List%601>に格納されている `Car` クラスのインスタンスを並べ替えます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-236">The example sorts instances of a `Car` class that are stored in a <xref:System.Collections.Generic.List%601>.</span></span> <span data-ttu-id="0c5b7-237">`Car` クラスは、<xref:System.IComparable%601> のメソッドの実装を必要とする <xref:System.IComparable%601.CompareTo%2A> インターフェイスを実装します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-237">The `Car` class implements the <xref:System.IComparable%601> interface, which requires that the <xref:System.IComparable%601.CompareTo%2A> method be implemented.</span></span>

<span data-ttu-id="0c5b7-238"><xref:System.IComparable%601.CompareTo%2A> メソッドを呼び出すたびに、並べ替えに使用される1つの比較が行われます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-238">Each call to the <xref:System.IComparable%601.CompareTo%2A> method makes a single comparison that's used for sorting.</span></span> <span data-ttu-id="0c5b7-239">`CompareTo` メソッドのユーザーが作成したコードは、現在のオブジェクトと別のオブジェクトとの各比較の値を戻します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-239">User-written code in the `CompareTo` method returns a value for each comparison of the current object with another object.</span></span> <span data-ttu-id="0c5b7-240">現在のオブジェクトが別のオブジェクトよりも小さい場合はゼロ未満の値を、大きい場合はゼロ以上の値を、等しい場合はゼロを戻します。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-240">The value returned is less than zero if the current object is less than the other object, greater than zero if the current object is greater than the other object, and zero if they are equal.</span></span> <span data-ttu-id="0c5b7-241">これによって、より大きい、より小さい、等しい、の条件をコードに定義することができます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-241">This enables you to define in code the criteria for greater than, less than, and equal.</span></span>

<span data-ttu-id="0c5b7-242">`ListCars` のメソッドでは、`cars.Sort()` ステートメントがリストを並べ替えます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-242">In the `ListCars` method, the `cars.Sort()` statement sorts the list.</span></span> <span data-ttu-id="0c5b7-243"><xref:System.Collections.Generic.List%601.Sort%2A> の <xref:System.Collections.Generic.List%601> メソッドへの呼び出しによって、`CompareTo` メソッドは `Car` 内の `List` オブジェクトに自動的に呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="0c5b7-243">This call to the <xref:System.Collections.Generic.List%601.Sort%2A> method of the <xref:System.Collections.Generic.List%601> causes the `CompareTo` method to be called automatically for the `Car` objects in the `List`.</span></span>

[!code-vb[VbVbalrStatements#125](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrStatements/VB/class9.vb#125)]

## <a name="see-also"></a><span data-ttu-id="0c5b7-244">参照</span><span class="sxs-lookup"><span data-stu-id="0c5b7-244">See also</span></span>

- [<span data-ttu-id="0c5b7-245">コレクション</span><span class="sxs-lookup"><span data-stu-id="0c5b7-245">Collections</span></span>](../../../standard/collections/index.md)
- [<span data-ttu-id="0c5b7-246">For...Next ステートメント</span><span class="sxs-lookup"><span data-stu-id="0c5b7-246">For...Next Statement</span></span>](../../../visual-basic/language-reference/statements/for-next-statement.md)
- [<span data-ttu-id="0c5b7-247">ループ構造</span><span class="sxs-lookup"><span data-stu-id="0c5b7-247">Loop Structures</span></span>](../../../visual-basic/programming-guide/language-features/control-flow/loop-structures.md)
- [<span data-ttu-id="0c5b7-248">While...End While ステートメント</span><span class="sxs-lookup"><span data-stu-id="0c5b7-248">While...End While Statement</span></span>](../../../visual-basic/language-reference/statements/while-end-while-statement.md)
- [<span data-ttu-id="0c5b7-249">Do...Loop ステートメント</span><span class="sxs-lookup"><span data-stu-id="0c5b7-249">Do...Loop Statement</span></span>](../../../visual-basic/language-reference/statements/do-loop-statement.md)
- [<span data-ttu-id="0c5b7-250">拡大変換と縮小変換</span><span class="sxs-lookup"><span data-stu-id="0c5b7-250">Widening and Narrowing Conversions</span></span>](../../../visual-basic/programming-guide/language-features/data-types/widening-and-narrowing-conversions.md)
- [<span data-ttu-id="0c5b7-251">オブジェクト初期化子 : 名前付きの型と匿名型</span><span class="sxs-lookup"><span data-stu-id="0c5b7-251">Object Initializers: Named and Anonymous Types</span></span>](../../../visual-basic/programming-guide/language-features/objects-and-classes/object-initializers-named-and-anonymous-types.md)
- [<span data-ttu-id="0c5b7-252">コレクション初期化子</span><span class="sxs-lookup"><span data-stu-id="0c5b7-252">Collection Initializers</span></span>](../../../visual-basic/programming-guide/language-features/collection-initializers/index.md)
- [<span data-ttu-id="0c5b7-253">配列</span><span class="sxs-lookup"><span data-stu-id="0c5b7-253">Arrays</span></span>](../../../visual-basic/programming-guide/language-features/arrays/index.md)
