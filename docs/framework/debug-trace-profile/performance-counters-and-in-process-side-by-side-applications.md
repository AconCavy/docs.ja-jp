---
title: パフォーマンス カウンターとインプロセス side-by-side アプリケーション
description: .NET でパフォーマンスカウンターとインプロセス side-by-side アプリケーションを確認します。 ランタイムごとにパフォーマンスカウンターを区別するには、Perfmon.exe を使用します。
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- performance counters
- performance counters,and in-process side-by-side applications
- performance,.NET Framework applications
- performance monitoring,counters
ms.assetid: 6888f9be-c65b-4b03-a07b-df7ebdee2436
ms.openlocfilehash: eb05d9f5f930420827c6b3d94ea0ed34f64464fd
ms.sourcegitcommit: c23d9666ec75b91741da43ee3d91c317d68c7327
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/01/2020
ms.locfileid: "85803860"
---
# <a name="performance-counters-and-in-process-side-by-side-applications"></a><span data-ttu-id="805a1-104">パフォーマンス カウンターとインプロセス side-by-side アプリケーション</span><span class="sxs-lookup"><span data-stu-id="805a1-104">Performance Counters and In-Process Side-By-Side Applications</span></span>
<span data-ttu-id="805a1-105">パフォーマンス モニター (Perfmon.exe) を使用すると、ランタイムごとにパフォーマンス カウンターを区別できるようになります。</span><span class="sxs-lookup"><span data-stu-id="805a1-105">Using the Performance Monitor (Perfmon.exe), it is possible to differentiate the performance counters on a per-runtime basis.</span></span> <span data-ttu-id="805a1-106">このトピックでは、この機能を有効にするために必要なレジストリの変更について説明します。</span><span class="sxs-lookup"><span data-stu-id="805a1-106">This topic describes the registry change needed to enable this functionality.</span></span>  
  
## <a name="the-default-behavior"></a><span data-ttu-id="805a1-107">既定の動作</span><span class="sxs-lookup"><span data-stu-id="805a1-107">The Default Behavior</span></span>  
 <span data-ttu-id="805a1-108">パフォーマンス モニターの既定では、アプリケーションごとにパフォーマンス カウンターが表示されますが、</span><span class="sxs-lookup"><span data-stu-id="805a1-108">By default, the Performance Monitor displays performance counters on a per-application basis.</span></span> <span data-ttu-id="805a1-109">これが問題になるシナリオが 2 つあります。</span><span class="sxs-lookup"><span data-stu-id="805a1-109">However, there are two scenarios in which this is problematic:</span></span>  
  
- <span data-ttu-id="805a1-110">同じ名前の 2 つのアプリケーションを監視する場合。</span><span class="sxs-lookup"><span data-stu-id="805a1-110">When you monitor two applications that have the same name.</span></span> <span data-ttu-id="805a1-111">たとえば、両方の名前が myapp.exe の場合、**[インスタンス]** 列に一方のアプリケーションは **myapp**、もう一方は **myapp#1** と表示されます。</span><span class="sxs-lookup"><span data-stu-id="805a1-111">For example, if both applications are named myapp.exe, one will be displayed as **myapp** and the other as **myapp#1** in the **Instance** column.</span></span> <span data-ttu-id="805a1-112">このような場合、特定のアプリケーションにパフォーマンス カウンターを対応付けることは困難です。</span><span class="sxs-lookup"><span data-stu-id="805a1-112">In this case, it is difficult to match a performance counter to a particular application.</span></span> <span data-ttu-id="805a1-113">**myapp#1** 用に収集されたデータが 1 つ目の myapp.exe と 2 つ目の myapp.exe のどちらを示しているかが明確ではありません。</span><span class="sxs-lookup"><span data-stu-id="805a1-113">It is not clear whether the data collected for **myapp#1** refers to the first myapp.exe or the second myapp.exe.</span></span>  
  
- <span data-ttu-id="805a1-114">1 つのアプリケーションが複数インスタンスの共通言語ランタイムを使用している場合。</span><span class="sxs-lookup"><span data-stu-id="805a1-114">When an application uses multiple instances of the common language runtime.</span></span> <span data-ttu-id="805a1-115">.NET Framework 4 では、インプロセスの side-by-side ホスティングシナリオがサポートされています。つまり、1つのプロセスまたはアプリケーションが共通言語ランタイムの複数のインスタンスを読み込むことができます。</span><span class="sxs-lookup"><span data-stu-id="805a1-115">The .NET Framework 4 supports in-process side-by-side hosting scenarios; that is, a single process or application can load multiple instances of the common language runtime.</span></span> <span data-ttu-id="805a1-116">myapp.exe という単一のアプリケーションが 2 つのランタイム インスタンスを読み込むと、既定で、**[インスタンス]** 列に **myapp** および **myapp#1** と表示されます。</span><span class="sxs-lookup"><span data-stu-id="805a1-116">If a single application named myapp.exe loads two runtime instances, by default, they will be designated in the **Instance** column as **myapp** and **myapp#1**.</span></span> <span data-ttu-id="805a1-117">この場合、**myapp** と **myapp#1** が同じ名前の 2 つのアプリケーションを示しているか、2 つのランタイムを持つ単一のアプリケーションを示しているかが明確ではありません。</span><span class="sxs-lookup"><span data-stu-id="805a1-117">In this case, it is not clear whether **myapp** and **myapp#1** refer to two applications with the same name, or to the same application with two runtimes.</span></span> <span data-ttu-id="805a1-118">同じ名前の複数のアプリケーションが複数のランタイムを読み込む場合、あいまいさはさらに大きくなります。</span><span class="sxs-lookup"><span data-stu-id="805a1-118">If multiple applications with the same name load multiple runtimes, the ambiguity is even greater.</span></span>  
  
 <span data-ttu-id="805a1-119">このあいまいさを排除するために、レジストリ キーを設定できます。</span><span class="sxs-lookup"><span data-stu-id="805a1-119">You can set a registry key to eliminate this ambiguity.</span></span> <span data-ttu-id="805a1-120">.NET Framework 4 を使用して開発されたアプリケーションの場合、このレジストリの変更によって、**インスタンス**列のアプリケーション名にプロセス識別子の後にランタイムインスタンス識別子が追加されます。</span><span class="sxs-lookup"><span data-stu-id="805a1-120">For applications developed using the .NET Framework 4, this registry change adds a process identifier followed by a runtime instance identifier to the application name in the **Instance** column.</span></span> <span data-ttu-id="805a1-121">*アプリケーションまたは\*\*アプリケーション*#1 ではなく、アプリケーションが*application* `p` *processID* \_ `r` **インスタンス**列でアプリケーション _ processID*runtimeid*として識別されるようになりました。</span><span class="sxs-lookup"><span data-stu-id="805a1-121">Instead of *application* or *application*#1, the application is now identified as *application*_`p`*processID*\_`r`*runtimeID* in the **Instance** column.</span></span> <span data-ttu-id="805a1-122">以前のバージョンの共通言語ランタイムを使用してアプリケーションを開発した場合、.NET Framework 4 がインストールされていれば、そのインスタンスは\*アプリケーション \_ \*の processID として表され `p` *processID*ます。</span><span class="sxs-lookup"><span data-stu-id="805a1-122">If an application was developed using a previous version of the common language runtime, that instance is represented as *application\_*`p`*processID* provided that the .NET Framework 4 is installed.</span></span>  
  
## <a name="performance-counters-for-in-process-side-by-side-applications"></a><span data-ttu-id="805a1-123">インプロセス side-by-side アプリケーションのパフォーマンス カウンター</span><span class="sxs-lookup"><span data-stu-id="805a1-123">Performance Counters for In-Process Side-by-Side Applications</span></span>  
 <span data-ttu-id="805a1-124">単一のアプリケーションでホストされている複数の共通言語ランタイム バージョンのパフォーマンス カウンターを処理するには、次の表のように 1 つのレジストリ キー設定を変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="805a1-124">To handle performance counters for multiple common language runtime versions that are hosted in a single application, you must change a single registry key setting, as shown in the following table.</span></span>  
  
|||  
|-|-|  
|<span data-ttu-id="805a1-125">キー名</span><span class="sxs-lookup"><span data-stu-id="805a1-125">Key name</span></span>|<span data-ttu-id="805a1-126">HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\\.NETFramework\Performance</span><span class="sxs-lookup"><span data-stu-id="805a1-126">HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\\.NETFramework\Performance</span></span>|  
|<span data-ttu-id="805a1-127">値の名前</span><span class="sxs-lookup"><span data-stu-id="805a1-127">Value name</span></span>|<span data-ttu-id="805a1-128">ProcessNameFormat</span><span class="sxs-lookup"><span data-stu-id="805a1-128">ProcessNameFormat</span></span>|  
|<span data-ttu-id="805a1-129">値の種類</span><span class="sxs-lookup"><span data-stu-id="805a1-129">Value type</span></span>|<span data-ttu-id="805a1-130">REG_DWORD</span><span class="sxs-lookup"><span data-stu-id="805a1-130">REG_DWORD</span></span>|  
|<span data-ttu-id="805a1-131">値</span><span class="sxs-lookup"><span data-stu-id="805a1-131">Value</span></span>|<span data-ttu-id="805a1-132">1 (0x00000001)</span><span class="sxs-lookup"><span data-stu-id="805a1-132">1 (0x00000001)</span></span>|  
  
 <span data-ttu-id="805a1-133">`ProcessNameFormat` の値 0 は、既定の動作が有効であることを示します。つまり、Perfmon.exe には、アプリケーションごとのパフォーマンス カウンターが表示されます。</span><span class="sxs-lookup"><span data-stu-id="805a1-133">A value of 0 for `ProcessNameFormat` indicates that the default behavior is enabled; that is, Perfmon.exe displays performance counters on a per-application basis.</span></span> <span data-ttu-id="805a1-134">この値を 1 に設定すると、Perfmon.exe で複数バージョンのアプリケーションのあいまいさが解消され、ランタイムごとにパフォーマンス カウンターが表示されます。</span><span class="sxs-lookup"><span data-stu-id="805a1-134">When you set this value to 1, Perfmon.exe disambiguates multiple versions of an application and provides performance counters on a per-runtime basis.</span></span> <span data-ttu-id="805a1-135">`ProcessNameFormat` レジストリ キー設定の他の値はサポートされておらず、将来使用するために予約されています。</span><span class="sxs-lookup"><span data-stu-id="805a1-135">Any other value for the `ProcessNameFormat` registry key setting is unsupported and reserved for future use.</span></span>  
  
 <span data-ttu-id="805a1-136">`ProcessNameFormat` レジストリ キー設定を更新した後は、新しいインスタンスの名前付け機能が正しく動作するように、Perfmon.exe、またはパフォーマンス カウンターを使用している他のプログラムを再起動する必要があります。</span><span class="sxs-lookup"><span data-stu-id="805a1-136">After you update the `ProcessNameFormat` registry key setting, you must restart Perfmon.exe or any other consumers of performance counters so that the new instance naming feature works correctly.</span></span>  
  
 <span data-ttu-id="805a1-137">`ProcessNameFormat` 値をプログラムで変更する例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="805a1-137">The following example shows how to change the `ProcessNameFormat` value programmatically.</span></span>  
  
 [!code-csharp[Conceptual.PerfCounters.InProSxS#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.perfcounters.inprosxs/cs/regsetting1.cs#1)]
 [!code-vb[Conceptual.PerfCounters.InProSxS#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.perfcounters.inprosxs/vb/regsetting1.vb#1)]  
  
 <span data-ttu-id="805a1-138">このレジストリを変更すると、Perfmon.exe には、.NET Framework 4 を対象とするアプリケーションの名前が*アプリケーション*_ processID runtimeid として表示されます。ここで、 `p` *processID* \_ `r` *runtimeID* *application*はアプリケーションの名前、 *processID*はアプリケーションのプロセス識別子、 *runtimeid*は共通言語ランタイム識別子です。</span><span class="sxs-lookup"><span data-stu-id="805a1-138">When you make this registry change, Perfmon.exe displays the names of applications that target the .NET Framework 4 as *application*_`p`*processID*\_`r`*runtimeID*, where *application* is the name of the application, *processID* is the application's process identifier, and *runtimeID* is a common language runtime identifier.</span></span> <span data-ttu-id="805a1-139">たとえば、myapp.exe というアプリケーションが 2 インスタンスの共通言語ランタイムを読み込んだ場合、Perfmon.exe では、1 つ目のインスタンスは myapp_p1416_r10、2 つ目のインスタンスは myapp_p3160_r10 と識別できます。</span><span class="sxs-lookup"><span data-stu-id="805a1-139">For example, if an application named myapp.exe loads two instances of the common language runtime, Perfmon.exe may identify one instance as myapp_p1416_r10 and the second as myapp_p3160_r10.</span></span> <span data-ttu-id="805a1-140">ランタイム識別子は、プロセス内のランタイムのあいまいさを排除するだけです。ランタイムに関するその他の情報は提供されません</span><span class="sxs-lookup"><span data-stu-id="805a1-140">The runtime identifier only disambiguates the runtimes within a process; it does not provide any other information about the runtime.</span></span> <span data-ttu-id="805a1-141">(たとえば、ランタイム ID はランタイムのバージョンや SKU と関係がありません)。</span><span class="sxs-lookup"><span data-stu-id="805a1-141">(For example, the runtime ID has no relation to the version or the SKU of the runtime.)</span></span>  
  
 <span data-ttu-id="805a1-142">.NET Framework 4 がインストールされている場合、レジストリの変更は、以前のバージョンの .NET Framework を使用して開発されたアプリケーションにも影響します。</span><span class="sxs-lookup"><span data-stu-id="805a1-142">If the .NET Framework 4 is installed, the registry change also affects applications that were developed using earlier versions of the .NET Framework.</span></span> <span data-ttu-id="805a1-143">これらは*application_* processID として Perfmon.exe に表示され `p` *processID*ます。ここで、 *application*はアプリケーション名、 *processid*はプロセス識別子です。</span><span class="sxs-lookup"><span data-stu-id="805a1-143">These appear in Perfmon.exe as *application_*`p`*processID*, where *application* is the application name and *processID* is the process identifier.</span></span> <span data-ttu-id="805a1-144">たとえば、myapp.exe という 2 つのアプリケーションのパフォーマンス カウンターを監視する場合、一方は myapp_p23900、もう一方は myapp_p24908 と表示される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="805a1-144">For example, if the performance counters of two applications named myapp.exe are monitored, one might appear as myapp_p23900 and the other as myapp_p24908.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="805a1-145">プロセス識別子によって、旧バージョンのランタイムを使用する同じ名前の 2 つのアプリケーションが解決する際のあいまいさが排除されます。</span><span class="sxs-lookup"><span data-stu-id="805a1-145">The process identifier eliminates the ambiguity of resolving two applications with the same name that use earlier versions of the runtime.</span></span> <span data-ttu-id="805a1-146">旧バージョンの共通言語ランタイムは side-by-side シナリオをサポートしていないため、旧バージョンでランタイム識別子は必須ではありません。</span><span class="sxs-lookup"><span data-stu-id="805a1-146">A runtime identifier is not required for previous versions, because previous versions of the common language runtime do not support side-by-side scenarios.</span></span>  
  
 <span data-ttu-id="805a1-147">.NET Framework 4 が存在しないか、またはアンインストールされた場合、レジストリキーを設定しても効果はありません。</span><span class="sxs-lookup"><span data-stu-id="805a1-147">If the .NET Framework 4 is not present or was uninstalled, setting the registry key has no effect.</span></span> <span data-ttu-id="805a1-148">つまり、同じ名前のアプリケーションが 2 つあっても、Perfmon.exe で *application*、*application#1* と表示されます (たとえば、**myapp** と **myapp#1**)。</span><span class="sxs-lookup"><span data-stu-id="805a1-148">This means that two applications with the same name will continue to appear in Perfmon.exe as *application* and *application#1* (for example, as **myapp** and **myapp#1**).</span></span>
