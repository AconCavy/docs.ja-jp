---
title: インスタンス ストア
ms.date: 03/30/2017
ms.assetid: f2629668-0923-4987-b943-67477131c1e0
ms.openlocfilehash: 26e0c28fe3061306a00e75b0498ef0781b7013c6
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/15/2020
ms.locfileid: "90555797"
---
# <a name="instance-stores"></a><span data-ttu-id="62673-102">インスタンス ストア</span><span class="sxs-lookup"><span data-stu-id="62673-102">Instance Stores</span></span>
<span data-ttu-id="62673-103">インスタンス ストアは、インスタンスの論理コンテナーです。</span><span class="sxs-lookup"><span data-stu-id="62673-103">An instance store is a logical container of instances.</span></span> <span data-ttu-id="62673-104">この場所には、インスタンス データとメタデータが格納されます。</span><span class="sxs-lookup"><span data-stu-id="62673-104">It is the place where the instance data and metadata is stored.</span></span> <span data-ttu-id="62673-105">インスタンス ストアは、専用の物理的なストレージを意味しているわけではありません。</span><span class="sxs-lookup"><span data-stu-id="62673-105">An instance store does not imply dedicated physical storage.</span></span> <span data-ttu-id="62673-106">インスタンス ストアには SQL Server データベースの永続的な情報と、メモリ内の非永続的な状態の情報が含まれます。</span><span class="sxs-lookup"><span data-stu-id="62673-106">An instance store could contain durable information in a SQL Server database or non-durable state information in a memory.</span></span> <span data-ttu-id="62673-107">[!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] には SQL Workflow Instance Store が付属しています。これはインスタンス ストアの具象実装で、ワークフローが SQL Server 2005 または SQL Server 2008 データベースにインスタンス データとメタデータを永続化できるようにします。</span><span class="sxs-lookup"><span data-stu-id="62673-107">The [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] ships with the SQL Workflow Instance Store, which is a concrete implementation of an instance store that allows workflows to persist instance data and metadata into a SQL Server 2005 or SQL Server 2008 database.</span></span> <span data-ttu-id="62673-108">また、Windows Server App Fabric には、インスタンス ストアの具象実装も用意されています。</span><span class="sxs-lookup"><span data-stu-id="62673-108">In addition Windows Server App Fabric also provides a concrete implementation of an instance store.</span></span> <span data-ttu-id="62673-109">詳細については、「 [Windows Server App Fabric インスタンスストア、クエリ、およびコントロールプロバイダー](/previous-versions/appfabric/ff383417(v=azure.10))」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="62673-109">For more information, see [Windows Server App Fabric Instance Store, Query, and Control Providers](/previous-versions/appfabric/ff383417(v=azure.10)).</span></span>  
  
 <span data-ttu-id="62673-110">永続化 API は、ホストがコマンド要求 (<xref:System.Activities.DurableInstancing.LoadWorkflowCommand> や <xref:System.Activities.DurableInstancing.SaveWorkflowCommand> など) をインスタンス ストアに送信できるようにするための、ホストとインスタンス ストア間のインターフェイスです。</span><span class="sxs-lookup"><span data-stu-id="62673-110">The persistence API is the interface between a host and an instance store that allows the host to send command requests (for example, <xref:System.Activities.DurableInstancing.LoadWorkflowCommand> and <xref:System.Activities.DurableInstancing.SaveWorkflowCommand>) to the instance store.</span></span> <span data-ttu-id="62673-111">この API の具象実装は、永続化プロバイダーと呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="62673-111">The concrete implementation of this API is called a persistence provider.</span></span> <span data-ttu-id="62673-112">永続化プロバイダーはホストからの要求を受け取り、インスタンス ストアを変更します。</span><span class="sxs-lookup"><span data-stu-id="62673-112">The persistence provider receives requests from a host and modifies the instance store.</span></span>  
  
 <span data-ttu-id="62673-113">ホストで多くのインスタンス ストアを使用し、インスタンス ストアを多くのホストで使用できるように、ホストとインスタンス ストアはプラグ可能です。</span><span class="sxs-lookup"><span data-stu-id="62673-113">Hosts and instance stores are pluggable so that a host can be used with many instance stores, and an instance store can be used with many hosts.</span></span> <span data-ttu-id="62673-114">通常、インスタンス ストアは特定のホストの使用パターンに合わせて最適化されますが、インスタンス ストアとホストはそれぞれのライフ サイクルで進化する場合があります。</span><span class="sxs-lookup"><span data-stu-id="62673-114">An instance store is typically optimized for the usage patterns of a particular host, although the instance store and host may evolve on independent life cycles.</span></span> <span data-ttu-id="62673-115">たとえば、 **WorkflowServiceHost** と **SqlWorkflowInstanceStore** は、うまく連携するように設計されています。</span><span class="sxs-lookup"><span data-stu-id="62673-115">For example, the **WorkflowServiceHost** and the **SqlWorkflowInstanceStore** are designed to work well together.</span></span> <span data-ttu-id="62673-116">独自のインスタンスストアを作成して、ワークフローサービスインスタンスのデータとメタデータを永続化し、そのインスタンスストアを **WorkflowServiceHost**で使用することができます。</span><span class="sxs-lookup"><span data-stu-id="62673-116">You can create your own instance store to persist data and metadata of workflow service instances and use that instance store with the **WorkflowServiceHost**.</span></span> <span data-ttu-id="62673-117">たとえば、SQL Server データベースに保存するのではなく、OracleWorkflowInstanceStore を作成して、ワークフローに Oracle データベースに情報を永続化させることができます。</span><span class="sxs-lookup"><span data-stu-id="62673-117">For example, you can create an OracleWorkflowInstanceStore that lets workflows persist information into an Oracle database instead of saving them into a SQL Server database.</span></span>  
  
 <span data-ttu-id="62673-118">通常、ホストは保存されたオブジェクトを変更する機能を追加して拡張されます。</span><span class="sxs-lookup"><span data-stu-id="62673-118">It is common for hosts to be extended with additional functionality that modifies the persisted objects.</span></span> <span data-ttu-id="62673-119">たとえば、インスタンス永続化システムは、ワークフローホスト、"中断" 操作をサポートする拡張機能、および SQL インスタンスストアを持つことができます。</span><span class="sxs-lookup"><span data-stu-id="62673-119">For example, an instance persistence system may have a workflow host, an extension that supports the "Suspend" operation, and an SQL instance store.</span></span>  <span data-ttu-id="62673-120">ワークフロー ホストは保存または読み込みなどの標準的なコマンドを送信して、インスタンス ストアに対してワークフローの保存または読み込みを行ったり、インスタンス ストアにワークフローを保存したりします。</span><span class="sxs-lookup"><span data-stu-id="62673-120">The workflow host might send a standard command such as Save or Load to save or load a workflow from an instance store or to save a workflow into an instance store.</span></span> <span data-ttu-id="62673-121">中断されたワークフロー インスタンスが読み込まれないように、中断の拡張機能によって、ワークフロー インスタンスの保存および読み込みを行うコマンドに追加のセマンティクスが追加されます。</span><span class="sxs-lookup"><span data-stu-id="62673-121">The suspend extension might add additional semantics to the commands for saving and loading workflow instances so that a suspended workflow instance cannot be loaded.</span></span> <span data-ttu-id="62673-122">SQL インスタンス ストアの永続化プロバイダーは、ワークフロー インスタンスの保存と読み込み用のコマンドを理解し、SQL Server データベースの永続オブジェクトのテーブルを変更する適切なストアド プロシージャを呼び出して、コマンドを実装します。</span><span class="sxs-lookup"><span data-stu-id="62673-122">The persistence provider for the SQL instance store understands the commands for saving and loading workflow instances, and implements the commands by calling appropriate stored procedures that change the tables of persistent objects in an SQL Server database.</span></span>  
  
 <span data-ttu-id="62673-123">インスタンス ストア内では、ホストはインスタンスの所有者として動作します。</span><span class="sxs-lookup"><span data-stu-id="62673-123">A host acts as an instance owner within an instance store.</span></span> <span data-ttu-id="62673-124">ホストは、同時に複数のインスタンス ストアを持つ複数のインスタンスの所有者として動作します。</span><span class="sxs-lookup"><span data-stu-id="62673-124">A host may act as more than one instance owner with more than one instance store at the same time.</span></span> <span data-ttu-id="62673-125">ホストはインスタンスに関連付けられているインスタンス キーの GUID を提供します。</span><span class="sxs-lookup"><span data-stu-id="62673-125">The host provides GUIDs for instance keys associated with the instances.</span></span> <span data-ttu-id="62673-126">インスタンス キーは、インスタンスを識別する一意の別名です。</span><span class="sxs-lookup"><span data-stu-id="62673-126">An instance key is a unique alias that identifies an instance.</span></span> <span data-ttu-id="62673-127">永続化システムは、ホストが要求したコマンドを実行するときに、インスタンスの所有者情報を作成、更新、および削除します。</span><span class="sxs-lookup"><span data-stu-id="62673-127">The persistence system creates, updates, and deletes instance owner information as it executes commands requested by hosts.</span></span>  
  
 <span data-ttu-id="62673-128">ホストとインスタンス ストアとの対話に関連する重要な手順を次に示します。</span><span class="sxs-lookup"><span data-stu-id="62673-128">The following list contains the important steps involved in the host’s interaction with the instance store:</span></span>  
  
1. <span data-ttu-id="62673-129">永続化プロバイダーから **InstanceStore** を取得します。</span><span class="sxs-lookup"><span data-stu-id="62673-129">Obtain an **InstanceStore** from a persistence provider.</span></span>  

2. <span data-ttu-id="62673-130">InstanceStore のメソッドを呼び出して、インスタンスへのハンドルを取得し <xref:System.Runtime.DurableInstancing.InstanceStore.CreateInstanceHandle%2A> ます。 **InstanceStore**</span><span class="sxs-lookup"><span data-stu-id="62673-130">Obtain the handle to an instance by calling the <xref:System.Runtime.DurableInstancing.InstanceStore.CreateInstanceHandle%2A> method on the **InstanceStore**.</span></span>  
  
3. <span data-ttu-id="62673-131">InstanceStore のメソッドを呼び出すことによって、インスタンスハンドルに対してコマンドを呼び出し <xref:System.Runtime.DurableInstancing.InstanceStore.Execute%2A> ます。 **InstanceStore**</span><span class="sxs-lookup"><span data-stu-id="62673-131">Invoke commands against the instance handle by calling the <xref:System.Runtime.DurableInstancing.InstanceStore.Execute%2A> method on the **InstanceStore**.</span></span>  
  
4. <span data-ttu-id="62673-132"><xref:System.Runtime.DurableInstancing.InstanceView> **InstanceStore.Exeかわいらしい**によって返されたを調べて、コマンドの結果を確認します。</span><span class="sxs-lookup"><span data-stu-id="62673-132">Examine the <xref:System.Runtime.DurableInstancing.InstanceView> returned by **InstanceStore.Execute** to determine the results of the commands.</span></span>
