---
title: カスタムのフロー制御アクティビティの作成
ms.date: 03/30/2017
ms.assetid: 27f409f6-2d1d-4cfb-9765-93eb2ad667d5
ms.openlocfilehash: 92d98d33b10e431248c4c482fcd26f3036c4c330
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/26/2020
ms.locfileid: "96242072"
---
# <a name="creating-custom-flow-control-activities"></a><span data-ttu-id="40d06-102">カスタムのフロー制御アクティビティの作成</span><span class="sxs-lookup"><span data-stu-id="40d06-102">Creating custom flow control activities</span></span>

<span data-ttu-id="40d06-103">.NET Framework には、抽象プログラミング構造 (など <xref:System.Activities.Statements.Flowchart> ) または標準のプログラミングステートメント (など) と同様に機能するさまざまなフロー制御アクティビティが含まれてい <xref:System.Activities.Statements.If> ます。</span><span class="sxs-lookup"><span data-stu-id="40d06-103">The .NET Framework contains a variety of flow-control activities that function similarly to abstract programming structures (such as <xref:System.Activities.Statements.Flowchart>)   or to standard programming statements (such as <xref:System.Activities.Statements.If>).</span></span> <span data-ttu-id="40d06-104">このトピックでは、一般的では [ない ForEach](./samples/non-generic-foreach.md)のサンプルプロジェクトのアーキテクチャについて説明します。</span><span class="sxs-lookup"><span data-stu-id="40d06-104">This topic discusses the architecture of one of the sample projects, [Non-Generic ForEach](./samples/non-generic-foreach.md).</span></span>  
  
## <a name="creating-the-custom-class"></a><span data-ttu-id="40d06-105">カスタム クラスの作成</span><span class="sxs-lookup"><span data-stu-id="40d06-105">Creating the custom class</span></span>  

 <span data-ttu-id="40d06-106">非ジェネリックの ForEach クラスは子アクティビティをスケジュールする必要があるため、<xref:System.Activities.NativeActivity> から派生する必要があります。<xref:System.Workflow.Activities.CodeActivity> から派生したアクティビティにはこの機能がありません。</span><span class="sxs-lookup"><span data-stu-id="40d06-106">Since the Non-Generic ForEach class will need to schedule child activities, it will need to derive from <xref:System.Activities.NativeActivity>, since activities that derive from <xref:System.Workflow.Activities.CodeActivity> do not have this functionality.</span></span>  
  
```csharp  
public sealed class ForEach : NativeActivity  
{
}
```  
  
 <span data-ttu-id="40d06-107">カスタム クラスには、アクティビティによって使用されているデータを格納し、アクティビティの子アクティビティを実行する機能を提供するためのいくつかのメンバーが必要です。</span><span class="sxs-lookup"><span data-stu-id="40d06-107">The custom class requires several members to store data being used by the activity, and to provide functionality to execute the activity’s child activities.</span></span> <span data-ttu-id="40d06-108">そのメンバーには以下が含まれます。</span><span class="sxs-lookup"><span data-stu-id="40d06-108">These members include:</span></span>  
  
- <span data-ttu-id="40d06-109">`valueEnumerator`: 項目のコレクションを反復処理する非パブリックの <xref:System.Collections.IEnumerator> 型の <xref:System.Activities.Variable%601>。</span><span class="sxs-lookup"><span data-stu-id="40d06-109">`valueEnumerator`: The non-public <xref:System.Activities.Variable%601> of type <xref:System.Collections.IEnumerator> used to iterate over the collection of items.</span></span> <span data-ttu-id="40d06-110">このメンバーは引数またはパブリック プロパティではなく、アクティビティで内部的に使用されるため、<xref:System.Activities.Variable%601> 型となり、このオブジェクトの発生元がアクティビティの外部にある場合に使用されます。</span><span class="sxs-lookup"><span data-stu-id="40d06-110">This member is of type <xref:System.Activities.Variable%601> because it is used internally in the activity, rather than an argument or public property, which would be used if this object were to have an origin outside the activity.</span></span>  
  
- <span data-ttu-id="40d06-111">`OnChildComplete`: 各子の実行の完了時に実行されるパブリック <xref:System.Activities.CompletionCallback> プロパティ。</span><span class="sxs-lookup"><span data-stu-id="40d06-111">`OnChildComplete`: The public <xref:System.Activities.CompletionCallback> property that executes when each child completes execution.</span></span> <span data-ttu-id="40d06-112">このメンバーは、アクティビティの異なるインスタンスごとに値が変わらないため、CLR プロパティとして定義されています。</span><span class="sxs-lookup"><span data-stu-id="40d06-112">This member is defined as a CLR property, since its value will not change for different instances of the activity.</span></span>  
  
- <span data-ttu-id="40d06-113">`Values`: 子アクティビティの反復処理に使用される入力のコレクション。</span><span class="sxs-lookup"><span data-stu-id="40d06-113">`Values`: The collection of inputs used for the iterations of the child activity.</span></span> <span data-ttu-id="40d06-114">このメンバーは、データの発生元がアクティビティの外部にあり、アクティビティの実行中にコレクションの内容の変更が想定されないため、<xref:System.Activities.InArgument%601> 型です。</span><span class="sxs-lookup"><span data-stu-id="40d06-114">This member is of type <xref:System.Activities.InArgument%601>, since the origin of the data is outside the activity, but the contents of the collection is not expected to change during the execution of the activity.</span></span> <span data-ttu-id="40d06-115">アクティビティの実行中に、アクティビティ (たとえば、追加または削除) のためにこのコレクションの内容を変更する機能が必要な場合、このメンバーは <xref:System.Activities.ActivityAction> として定義されます。この場合、メンバーはアクセスするたびに評価され、変更をアクティビティに反映できます。</span><span class="sxs-lookup"><span data-stu-id="40d06-115">If the activity needed the functionality to change the contents of this collection while the activity was executing (to add or remove activities, for instance), this member would have been defined as an <xref:System.Activities.ActivityAction>, which then would have been evaluated every time it was accessed, so that changes would be available to the activity.</span></span>  
  
- <span data-ttu-id="40d06-116">`Body`: このメンバーはアクティビティを `Values` コレクションの項目ごとに実行されるように定義します。</span><span class="sxs-lookup"><span data-stu-id="40d06-116">`Body`: This member defines the activity to be executed for each item in the `Values` collection.</span></span> <span data-ttu-id="40d06-117">このメンバーは、アクセスするたびに評価されるように <xref:System.Activities.ActivityAction> として定義されます。</span><span class="sxs-lookup"><span data-stu-id="40d06-117">This member is defined as an <xref:System.Activities.ActivityAction> so that it is evaluated every time it is accessed.</span></span>  
  
- <span data-ttu-id="40d06-118">`Execute`: このメソッドは `InternalExecute`、`OnForEachComplete`、および `GetStateAndExecute` の非パブリック メンバーを使用して実行をスケジュールし、Body メンバーに定義された子アクティビティの完了ハンドラーを割り当てます。</span><span class="sxs-lookup"><span data-stu-id="40d06-118">`Execute`: This method uses the `InternalExecute`, `OnForEachComplete`, and `GetStateAndExecute` non-public members to schedule the execution and assign the completion handler of the child activity defined in the Body member.</span></span>  
  
- <span data-ttu-id="40d06-119">`CacheMetadata`: このメンバーはアクティビティの実行に必要な情報をランタイムに提供します。</span><span class="sxs-lookup"><span data-stu-id="40d06-119">`CacheMetadata`: This member provides the runtime with the information it needs to execute the activity.</span></span> <span data-ttu-id="40d06-120">既定では、アクティビティの `CacheMetadata` メソッドはランタイムにアクティビティのすべてのパブリック メンバーを通知しますが、このアクティビティは一部の機能にプライベート メンバーを使用するため、ランタイムにプライベート メンバーの存在を通知して認識されるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="40d06-120">By default, an activity’s `CacheMetadata` method will inform the runtime of all public members of the activity, but since this activity uses private members for some functionality, it needs to inform the runtime of their existence so that the runtime can be aware of them.</span></span> <span data-ttu-id="40d06-121">この場合、`CacheMetadata` 関数はオーバーライドされ、プライベートの `valueEnumerator` メンバーにアクセスできるようにします。</span><span class="sxs-lookup"><span data-stu-id="40d06-121">In this case, the `CacheMetadata` function is overridden so that the private `valueEnumerator` member can be accessed.</span></span> <span data-ttu-id="40d06-122">このメンバーはアクティビティの値の引数も作成し、実行時にアクティビティに渡すことができるようにします。</span><span class="sxs-lookup"><span data-stu-id="40d06-122">This member also creates an argument for the values for the activity so that they can be passed in to the activity during execution.</span></span>
