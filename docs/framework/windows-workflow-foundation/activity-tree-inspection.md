---
title: アクティビティ ツリー検査
ms.date: 03/30/2017
ms.assetid: 100d00e4-8c1d-4233-8fbb-dd443a01155d
ms.openlocfilehash: 044dcbbe7f22b1026dbc4dc14ab87da4f5a9d0ee
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/26/2020
ms.locfileid: "96289153"
---
# <a name="activity-tree-inspection"></a><span data-ttu-id="a00a8-102">アクティビティ ツリー検査</span><span class="sxs-lookup"><span data-stu-id="a00a8-102">Activity Tree Inspection</span></span>

<span data-ttu-id="a00a8-103">アクティビティ ツリー検査は、アプリケーションによってホストされるワークフローを検査するためにワークフロー アプリケーションの作成者によって使用されます。</span><span class="sxs-lookup"><span data-stu-id="a00a8-103">Activity tree inspection is used by workflow application authors to inspect the workflows hosted by the application.</span></span> <span data-ttu-id="a00a8-104"><xref:System.Activities.WorkflowInspectionServices> を使用することによって、特定の子アクティビティを対象としてワークフローを検索したり、個々のアクティビティとそのプロパティを列挙したりできるほか、アクティビティのランタイム メタデータを特定の時点でキャッシュできます。</span><span class="sxs-lookup"><span data-stu-id="a00a8-104">By using <xref:System.Activities.WorkflowInspectionServices>, workflows can be searched for specific child activities, individual activities and their properties can be enumerated, and runtime metadata of the activities can be cached at a specific time.</span></span> <span data-ttu-id="a00a8-105">ここでは、<xref:System.Activities.WorkflowInspectionServices> の概要を説明します。また、これを使用してアクティビティ ツリーを検査する方法も説明します。</span><span class="sxs-lookup"><span data-stu-id="a00a8-105">This topic provides an overview of <xref:System.Activities.WorkflowInspectionServices> and how to use it to inspect an activity tree.</span></span>  
  
## <a name="using-workflowinspectionservices"></a><span data-ttu-id="a00a8-106">WorkflowInspectionServices の使用</span><span class="sxs-lookup"><span data-stu-id="a00a8-106">Using WorkflowInspectionServices</span></span>  

 <span data-ttu-id="a00a8-107"><xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> メソッドは、指定したアクティビティ ツリーのアクティビティをすべて列挙するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="a00a8-107">The <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> method is used to enumerate all of the activities in the specified activity tree.</span></span> <span data-ttu-id="a00a8-108"><xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> は、子、デリゲート ハンドラー、変数の既定値、引数の式を含む、ツリー内のすべてのアクティビティに接触する列挙可能なアクティビティを返します。</span><span class="sxs-lookup"><span data-stu-id="a00a8-108"><xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> returns an enumerable that touches all activities within the tree including children, delegate handlers, variable defaults, and argument expressions.</span></span> <span data-ttu-id="a00a8-109">次の例では、ワークフロー定義は <xref:System.Activities.Statements.Sequence>、<xref:System.Activities.Statements.While>、<xref:System.Activities.Statements.ForEach%601>、<xref:System.Activities.Statements.WriteLine>、および式を使用して作成されます。</span><span class="sxs-lookup"><span data-stu-id="a00a8-109">In the following example, a workflow definition is created by using a <xref:System.Activities.Statements.Sequence>, <xref:System.Activities.Statements.While>, <xref:System.Activities.Statements.ForEach%601>, <xref:System.Activities.Statements.WriteLine>, and expressions.</span></span> <span data-ttu-id="a00a8-110">ワークフロー定義が作成されると、このワークフロー定義が呼び出されて、`InspectActivity` メソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="a00a8-110">After the workflow definition is created, it is invoked and then the `InspectActivity` method is called.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#45](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#45)]  
  
 <span data-ttu-id="a00a8-111">アクティビティを列挙するために、<xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> がルート アクティビティで呼び出され、返される各アクティビティでもう一度再帰的に呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="a00a8-111">To enumerate the activities, the <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> is called on the root activity, and again recursively on each returned activity.</span></span> <span data-ttu-id="a00a8-112">次の例では、アクティビティ ツリーのそれぞれのアクティビティと式の <xref:System.Activities.Activity.DisplayName%2A> がコンソールに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="a00a8-112">In the following example, the <xref:System.Activities.Activity.DisplayName%2A> of each activity and expression in the activity tree is written to the console.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#46](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#46)]  
  
 <span data-ttu-id="a00a8-113">このサンプル コードから次の出力が得られます。</span><span class="sxs-lookup"><span data-stu-id="a00a8-113">This sample code provides the following output.</span></span>  
  
 <span data-ttu-id="a00a8-114">**リスト項目 1**</span><span class="sxs-lookup"><span data-stu-id="a00a8-114">**List Item 1**</span></span>  
<span data-ttu-id="a00a8-115">**リスト項目 2** 
**リスト項目 3** 
**リスト項目 4** 
**リスト項目 5** 
**コレクションに追加された項目。** 
**シーケンス\*\*\*\*リテラル<リスト \<String> >**</span><span class="sxs-lookup"><span data-stu-id="a00a8-115">**List Item 2**
**List Item 3**
**List Item 4**
**List Item 5**
**Items added to collection.**
**Sequence** **Literal<List\<String>>**</span></span>  
 <span data-ttu-id="a00a8-116">**While**</span><span class="sxs-lookup"><span data-stu-id="a00a8-116">**While**</span></span>  
 <span data-ttu-id="a00a8-117">**AddToCollection\<String>**</span><span class="sxs-lookup"><span data-stu-id="a00a8-117">**AddToCollection\<String>**</span></span>  
 <span data-ttu-id="a00a8-118">**ICollection 値<ICollection\<String>>**</span><span class="sxs-lookup"><span data-stu-id="a00a8-118">**VariableValue<ICollection\<String>>**</span></span>  
 <span data-ttu-id="a00a8-119">**LambdaValue\<String>**</span><span class="sxs-lookup"><span data-stu-id="a00a8-119">**LambdaValue\<String>**</span></span>  
 <span data-ttu-id="a00a8-120">**LocationReferenceValue<リスト\<String>>**</span><span class="sxs-lookup"><span data-stu-id="a00a8-120">**LocationReferenceValue<List\<String>>**</span></span>  
 <span data-ttu-id="a00a8-121">**LambdaValue\<Boolean>**</span><span class="sxs-lookup"><span data-stu-id="a00a8-121">**LambdaValue\<Boolean>**</span></span>  
 <span data-ttu-id="a00a8-122">**LocationReferenceValue<リスト\<String>>**</span><span class="sxs-lookup"><span data-stu-id="a00a8-122">**LocationReferenceValue<List\<String>>**</span></span>  
 <span data-ttu-id="a00a8-123">**Each\<String>**</span><span class="sxs-lookup"><span data-stu-id="a00a8-123">**ForEach\<String>**</span></span>  
 <span data-ttu-id="a00a8-124">**変数の値<IEnumerable\<String>>**</span><span class="sxs-lookup"><span data-stu-id="a00a8-124">**VariableValue<IEnumerable\<String>>**</span></span>  
 <span data-ttu-id="a00a8-125">**WriteLine**</span><span class="sxs-lookup"><span data-stu-id="a00a8-125">**WriteLine**</span></span>  
 <span data-ttu-id="a00a8-126">**DelegateArgumentValue\<String>**</span><span class="sxs-lookup"><span data-stu-id="a00a8-126">**DelegateArgumentValue\<String>**</span></span>  
 <span data-ttu-id="a00a8-127">**Sequence**</span><span class="sxs-lookup"><span data-stu-id="a00a8-127">**Sequence**</span></span>  
 <span data-ttu-id="a00a8-128">**WriteLine**</span><span class="sxs-lookup"><span data-stu-id="a00a8-128">**WriteLine**</span></span>  
 <span data-ttu-id="a00a8-129">**リテラル \<String>** すべてのアクティビティを列挙するのではなく、特定のアクティビティを取得するには、を <xref:System.Activities.WorkflowInspectionServices.Resolve%2A> 使用します。</span><span class="sxs-lookup"><span data-stu-id="a00a8-129">**Literal\<String>**  To retrieve a specific activity instead of enumerating all of the activities, <xref:System.Activities.WorkflowInspectionServices.Resolve%2A> is used.</span></span> <span data-ttu-id="a00a8-130"><xref:System.Activities.WorkflowInspectionServices.Resolve%2A> と <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> はいずれも、`WorkflowInspectionServices.CacheMetadata` が前に呼び出されていない場合にメタデータのキャッシュ処理を実行します。</span><span class="sxs-lookup"><span data-stu-id="a00a8-130">Both <xref:System.Activities.WorkflowInspectionServices.Resolve%2A> and <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> perform metadata caching if `WorkflowInspectionServices.CacheMetadata` has not been previously called.</span></span> <span data-ttu-id="a00a8-131"><xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A> が呼び出されている場合、<xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> は既存のメタデータに基づいています。</span><span class="sxs-lookup"><span data-stu-id="a00a8-131">If <xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A> has been called then <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> is based on the existing metadata.</span></span> <span data-ttu-id="a00a8-132">このため、<xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A> を最後に呼び出した後でツリーが変更されていると、予期しない結果が <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> で生じることがあります。</span><span class="sxs-lookup"><span data-stu-id="a00a8-132">Therefore, if tree changes have been made since the last call to <xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A>, <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> might give unexpected results.</span></span> <span data-ttu-id="a00a8-133">を呼び出した後にワークフローに変更が加えられた場合 <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> 、メソッドを呼び出すことによってメタデータを再度キャッシュできます <xref:System.Activities.Validation.ActivityValidationServices> <xref:System.Activities.Validation.ActivityValidationServices.Validate%2A> 。</span><span class="sxs-lookup"><span data-stu-id="a00a8-133">If changes have been made to the workflow after calling <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A>, metadata can be re-cached by calling the <xref:System.Activities.Validation.ActivityValidationServices> <xref:System.Activities.Validation.ActivityValidationServices.Validate%2A> method.</span></span> <span data-ttu-id="a00a8-134">メタデータのキャッシュ処理については、次のセクションで説明します。</span><span class="sxs-lookup"><span data-stu-id="a00a8-134">Caching metadata is discussed in the next section.</span></span>  
  
### <a name="caching-metadata"></a><span data-ttu-id="a00a8-135">メタデータのキャッシュ処理</span><span class="sxs-lookup"><span data-stu-id="a00a8-135">Caching Metadata</span></span>  

 <span data-ttu-id="a00a8-136">アクティビティのメタデータをキャッシュすると、アクティビティの引数、変数、子アクティビティ、アクティビティ デリゲートの記述が構築および検証されます。</span><span class="sxs-lookup"><span data-stu-id="a00a8-136">Caching the metadata for an activity builds and validates a description of the activity’s arguments, variables, child activities, and activity delegates.</span></span> <span data-ttu-id="a00a8-137">既定では、メタデータはアクティビティが実行用に準備されるときにランタイムによってキャッシュされます。</span><span class="sxs-lookup"><span data-stu-id="a00a8-137">Metadata, by default, is cached by the runtime when an activity is prepared for execution.</span></span> <span data-ttu-id="a00a8-138">ワークフロー ホストの作成者が、それよりも前 (すべてのコストを先に取得する場合など) にアクティビティまたはアクティビティ ツリーのメタデータをキャッシュする場合は、<xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A> を使用して目的の時点でメタデータをキャッシュできます。</span><span class="sxs-lookup"><span data-stu-id="a00a8-138">If a workflow host author wants to cache the metadata for an activity or activity tree before this, for example to take all of the cost upfront, then <xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A> can be used to cache the metadata at the desired time.</span></span>
