---
title: XAML での WPF と WF の統合
ms.date: 03/30/2017
ms.assetid: a4f53b48-fc90-4315-bca0-ba009562f488
ms.openlocfilehash: b8015e5c526f58875beb58ab48a21c050bdc8a06
ms.sourcegitcommit: 42ed59871db1f29a32b3d8e7abeb20e6eceeda7c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/10/2019
ms.locfileid: "74960091"
---
# <a name="wpf-and-windows-workflow-foundation-integration-in-xaml"></a><span data-ttu-id="cefb3-102">XAML での WPF と Windows Workflow Foundation の統合</span><span class="sxs-lookup"><span data-stu-id="cefb3-102">WPF and Windows Workflow Foundation integration in XAML</span></span>

<span data-ttu-id="cefb3-103">このサンプルでは、1つの XAML ドキュメントで Windows Presentation Foundation (WPF) および Windows Workflow Foundation (WF) 機能を使用するアプリケーションを作成する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="cefb3-103">This sample demonstrates how to create an application that uses Windows Presentation Foundation (WPF) and Windows Workflow Foundation (WF) features in a single XAML document.</span></span> <span data-ttu-id="cefb3-104">これを実現するために、このサンプルでは Windows Workflow Foundation と XAML 拡張機能を使用します。</span><span class="sxs-lookup"><span data-stu-id="cefb3-104">To accomplish this, the sample uses Windows Workflow Foundation and XAML extensibility.</span></span>

## <a name="sample-details"></a><span data-ttu-id="cefb3-105">サンプルの詳細</span><span class="sxs-lookup"><span data-stu-id="cefb3-105">Sample details</span></span>

 <span data-ttu-id="cefb3-106">ShowWindow.xaml ファイルは、シーケンスのアクティビティによって操作される 2 つの文字列変数 <xref:System.Activities.Statements.Sequence> および `ShowWindow` を持つ `WriteLine` アクティビティに逆シリアル化します。</span><span class="sxs-lookup"><span data-stu-id="cefb3-106">The ShowWindow.xaml file deserializes into a <xref:System.Activities.Statements.Sequence> activity with two string variables that are manipulated by the sequence’s activities: `ShowWindow` and `WriteLine`.</span></span> <span data-ttu-id="cefb3-107"><xref:System.Activities.Statements.WriteLine> アクティビティは、<xref:System.Activities.Statements.WriteLine.Text%2A> プロパティに割り当てる式をコンソール ウィンドウに出力します。</span><span class="sxs-lookup"><span data-stu-id="cefb3-107">The <xref:System.Activities.Statements.WriteLine> activity outputs to the console window the expression that it assigns to the <xref:System.Activities.Statements.WriteLine.Text%2A> property.</span></span> <span data-ttu-id="cefb3-108">`ShowWindow` アクティビティは、実行ロジックの一部として WPF ウィンドウを表示します。</span><span class="sxs-lookup"><span data-stu-id="cefb3-108">The `ShowWindow` activity displays a WPF window as part of its execution logic.</span></span> <span data-ttu-id="cefb3-109">このウィンドウの <xref:System.Activities.ActivityContext.DataContext%2A> には、シーケンスで宣言された変数が含まれます。</span><span class="sxs-lookup"><span data-stu-id="cefb3-109">The <xref:System.Activities.ActivityContext.DataContext%2A> of the window includes the variables declared in the sequence.</span></span> <span data-ttu-id="cefb3-110">`ShowWindow` アクティビティで宣言されたウィンドウのコントロールは、データ バインドを使用してこれらの変数を操作します。</span><span class="sxs-lookup"><span data-stu-id="cefb3-110">The controls of the window declared in the `ShowWindow` activity use data binding to manipulate those variables.</span></span> <span data-ttu-id="cefb3-111">最後に、このウィンドウにはボタン コントロールが含まれます。</span><span class="sxs-lookup"><span data-stu-id="cefb3-111">Finally, the window contains a button control.</span></span> <span data-ttu-id="cefb3-112">このボタンの `Click` イベントは、<xref:System.Activities.ActivityDelegate> アクティビティを含む `MarkupExtension` という名前の `CloseWindow` によって処理されます。</span><span class="sxs-lookup"><span data-stu-id="cefb3-112">The `Click` event for the button is handled by a <xref:System.Activities.ActivityDelegate> named `MarkupExtension` that contains a `CloseWindow` activity.</span></span> <span data-ttu-id="cefb3-113">`MarkUpExtension` は、`x:Name` によって識別されるオブジェクトおよび格納先ウィンドウの <xref:System.Activities.ActivityContext.DataContext%2A> を、コンテキストとして提供する、含まれているアクティビティを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="cefb3-113">`MarkUpExtension` invokes the contained activity that provides, as context, any objects identified by an `x:Name`, as well as the <xref:System.Activities.ActivityContext.DataContext%2A> of the containing window.</span></span> <span data-ttu-id="cefb3-114">したがって、`CloseWindow.InArgument<Window>` は、ウィンドウの名前を参照する式を使用してバインドできます。</span><span class="sxs-lookup"><span data-stu-id="cefb3-114">Thus, the `CloseWindow.InArgument<Window>` can be bound using an expression that references the window’s name.</span></span>

 <span data-ttu-id="cefb3-115">`ShowWindow` アクティビティは、WPF ウィンドウを表示するために <xref:System.Activities.AsyncCodeActivity%601> クラスから派生し、ウィンドウが閉じたときに完了します。</span><span class="sxs-lookup"><span data-stu-id="cefb3-115">The `ShowWindow` activity derives from the <xref:System.Activities.AsyncCodeActivity%601> class to display a WPF window and completes when the window is closed.</span></span> <span data-ttu-id="cefb3-116">`Window` プロパティは、アクティビティの実行ごとにウィンドウを必要に応じて作成できるようにする `Func<Window>` 型です。</span><span class="sxs-lookup"><span data-stu-id="cefb3-116">The `Window` property is of type `Func<Window>` that allows the window to be created on demand for each execution of the activity.</span></span> <span data-ttu-id="cefb3-117">`Window` プロパティは、<xref:System.Xaml.XamlDeferringLoader> を使用してこの遅延評価モデルを有効にします。</span><span class="sxs-lookup"><span data-stu-id="cefb3-117">The `Window` property uses a <xref:System.Xaml.XamlDeferringLoader> to enable this deferred evaluation model.</span></span> <span data-ttu-id="cefb3-118">`FuncFactoryDeferringLoader` を使用すると、`XamlReader` をシリアル化中にキャプチャしてアクティビティの実行中に読み取ることができます。</span><span class="sxs-lookup"><span data-stu-id="cefb3-118">The `FuncFactoryDeferringLoader` allows a `XamlReader` to be captured during serialization and then read during activity execution.</span></span>

 <span data-ttu-id="cefb3-119">アクティビティが適切に記述されていれば、スケジューラ スレッドはブロックされません。</span><span class="sxs-lookup"><span data-stu-id="cefb3-119">A well-written activity never blocks the scheduler thread.</span></span> <span data-ttu-id="cefb3-120">ただし、`ShowWindow` アクティビティは、表示しているウィンドウが閉じられるまで完了できません。</span><span class="sxs-lookup"><span data-stu-id="cefb3-120">However, the `ShowWindow` activity cannot complete until the window it is displaying is closed.</span></span> <span data-ttu-id="cefb3-121">`ShowWindow` アクティビティは、<xref:System.Activities.AsyncCodeActivity> から派生して <xref:System.Activities.WorkflowInvoker.BeginInvoke%2A> メソッドを <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> メソッドで呼び出し、ウィンドウをモーダルで表示することによってこの動作を実現します。</span><span class="sxs-lookup"><span data-stu-id="cefb3-121">The `ShowWindow` activity achieves this behavior by deriving from <xref:System.Activities.AsyncCodeActivity>, calling the <xref:System.Activities.WorkflowInvoker.BeginInvoke%2A> method in the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> method, and showing the window modally.</span></span> <span data-ttu-id="cefb3-122">デリゲートは、WPF <xref:System.ServiceModel.InstanceContext.SynchronizationContext%2A> を介して呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="cefb3-122">The delegate is invoked through the WPF <xref:System.ServiceModel.InstanceContext.SynchronizationContext%2A>.</span></span> <span data-ttu-id="cefb3-123">`ShowWindow` アクティビティは、<xref:System.Activities.ActivityContext.DataContext%2A> プロパティを `Window.DataContext` プロパティに割り当てて、データ バインド コントロールがスコープ内の変数にアクセスできるようにします。</span><span class="sxs-lookup"><span data-stu-id="cefb3-123">The `ShowWindow` activity assigns the <xref:System.Activities.ActivityContext.DataContext%2A> property to the `Window.DataContext` property to provide any data bound controls access to the in-scope variables.</span></span>

 <span data-ttu-id="cefb3-124">このサンプルにおける最後の重要な点は、<xref:System.Workflow.ComponentModel.Serialization.MarkupExtension> という `DelegateActivityExtension` です。</span><span class="sxs-lookup"><span data-stu-id="cefb3-124">The last point of interest in this sample is a <xref:System.Workflow.ComponentModel.Serialization.MarkupExtension> called `DelegateActivityExtension`.</span></span> <span data-ttu-id="cefb3-125">このマークアップ拡張機能の `ProvideValue` メソッドは、埋め込みアクティビティを呼び出すデリゲートを返します。</span><span class="sxs-lookup"><span data-stu-id="cefb3-125">The `ProvideValue` method of this markup extension returns a delegate that invokes an embedded activity.</span></span> <span data-ttu-id="cefb3-126">このアクティビティは、WPF データコンテキストとスコープ内の任意の `x:Name` 値を含む環境で実行されます。</span><span class="sxs-lookup"><span data-stu-id="cefb3-126">This activity runs in an environment that includes the WPF data context and any `x:Name` values in scope.</span></span> <span data-ttu-id="cefb3-127">`GenericInvoke` メソッドで、この環境は <xref:System.Activities.Hosting.SymbolResolver> 拡張機能を介してアクティビティに提供されます。</span><span class="sxs-lookup"><span data-stu-id="cefb3-127">In the `GenericInvoke` method, this environment is provided to the activity through a <xref:System.Activities.Hosting.SymbolResolver> extension.</span></span> <span data-ttu-id="cefb3-128">この拡張機能は、マークアップ拡張機能のデリゲートが呼び出されるたびに埋め込みアクティビティを呼び出すために使用される <xref:System.Activities.WorkflowInvoker> に追加されます。</span><span class="sxs-lookup"><span data-stu-id="cefb3-128">This extension is added to a <xref:System.Activities.WorkflowInvoker> that is then used to invoke the embedded activity whenever the markup extension’s delegate is invoked.</span></span>

> [!NOTE]
> <span data-ttu-id="cefb3-129">既定のデザイナーでは ShowWindow アクティビティはサポートされません。したがって、ShowWindow.Xaml ファイルはデザイナーでは正しく表示されません。</span><span class="sxs-lookup"><span data-stu-id="cefb3-129">The default designer does not support the ShowWindow activity; as such, the ShowWindow.Xaml file does not display correctly in the designer.</span></span>

## <a name="run-the-sample"></a><span data-ttu-id="cefb3-130">サンプルの実行</span><span class="sxs-lookup"><span data-stu-id="cefb3-130">Run the sample</span></span>

1. <span data-ttu-id="cefb3-131">Visual Studio を使用して、WPFWFIntegration ソリューションファイルを開きます。</span><span class="sxs-lookup"><span data-stu-id="cefb3-131">Using Visual Studio, open the WPFWFIntegration.sln solution file.</span></span>

2. <span data-ttu-id="cefb3-132">ソリューションをビルドするには、 **ctrl**+**Shift**+**B**キーを押します。</span><span class="sxs-lookup"><span data-stu-id="cefb3-132">To build the solution, press **Ctrl**+**Shift**+**B**.</span></span>

3. <span data-ttu-id="cefb3-133">ソリューションを実行するには、 **F5**キーを押します。</span><span class="sxs-lookup"><span data-stu-id="cefb3-133">To run the solution, press **F5**.</span></span>

4. <span data-ttu-id="cefb3-134">姓と名をダイアログ ボックスに入力します。</span><span class="sxs-lookup"><span data-stu-id="cefb3-134">Type your first and last name into the dialog.</span></span>

5. <span data-ttu-id="cefb3-135">ダイアログ ボックスを閉じると、コンソールに名前がエコーされます。</span><span class="sxs-lookup"><span data-stu-id="cefb3-135">Close the dialog and the console echoes your name.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="cefb3-136">サンプルは、既にコンピューターにインストールされている場合があります。</span><span class="sxs-lookup"><span data-stu-id="cefb3-136">The samples may already be installed on your machine.</span></span> <span data-ttu-id="cefb3-137">続行する前に、次の (既定の) ディレクトリを確認してください。</span><span class="sxs-lookup"><span data-stu-id="cefb3-137">Check for the following (default) directory before continuing.</span></span>
>
> `<InstallDrive>:\WF_WCF_Samples`
>
> <span data-ttu-id="cefb3-138">このディレクトリが存在しない場合は、 [Windows Communication Foundation (wcf) および Windows Workflow Foundation (WF) のサンプルの .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459)にアクセスして、すべての WINDOWS COMMUNICATION FOUNDATION (wcf) と [!INCLUDE[wf1](../../../../includes/wf1-md.md)] サンプルをダウンロードしてください。</span><span class="sxs-lookup"><span data-stu-id="cefb3-138">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="cefb3-139">このサンプルは、次のディレクトリに格納されます。</span><span class="sxs-lookup"><span data-stu-id="cefb3-139">This sample is located in the following directory.</span></span>
>
> `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\WPFWFIntegration`
