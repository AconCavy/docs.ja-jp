---
title: インスタンスのアクティブ化処理
ms.date: 03/30/2017
ms.assetid: 134c3f70-5d4e-46d0-9d49-469a6643edd8
ms.openlocfilehash: 1fd30d9d440c06c03e726ed1f1ddbebb0d5f7e8c
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/26/2020
ms.locfileid: "96279936"
---
# <a name="instance-activation"></a><span data-ttu-id="b2a1d-102">インスタンスのアクティブ化処理</span><span class="sxs-lookup"><span data-stu-id="b2a1d-102">Instance Activation</span></span>

<span data-ttu-id="b2a1d-103">SQL Workflow Instance Store が実行する内部タスクは、定期的にアクティブになり、実行可能またはアクティブ化可能なワークフロー インスタンスを永続性データベースで検出します。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-103">The SQL Workflow Instance Store runs an internal task that periodically wakes up and detects runnable or activatable workflow instances in the persistence database.</span></span> <span data-ttu-id="b2a1d-104">このタスクは、実行可能なワークフロー インスタンスを検出すると、このインスタンスをアクティブ化することができるワークフロー ホストに通知します。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-104">If it finds a runnable workflow instance, it notifies the workflow host that is capable of activating the instance.</span></span> <span data-ttu-id="b2a1d-105">Instance Store がアクティブ化可能なワークフロー インスタンスを検出した場合、ワークフロー ホストをアクティブ化する汎用ホストに Instance Store が通知を行い、ワークフロー ホストがワークフロー インスタンスを実行します。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-105">If the instance store finds an activatable workflow instance, it notifies a generic host that activates a workflow host, which in turn runs the workflow instance.</span></span> <span data-ttu-id="b2a1d-106">このトピックの以降のセクションでは、インスタンスのアクティブ化処理を詳細に説明します。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-106">The following sections in this topic explain the instance activation process in detail.</span></span>  
  
## <a name="detecting-and-activating-runnable-workflow-instances"></a><a name="RunnableSection"></a> <span data-ttu-id="b2a1d-107">実行可能なワークフローインスタンスの検出とアクティブ化</span><span class="sxs-lookup"><span data-stu-id="b2a1d-107">Detecting and Activating Runnable Workflow Instances</span></span>  

 <span data-ttu-id="b2a1d-108">SQL Workflow Instance Store では、インスタンスが中断状態または完了状態ではなく、次の条件を満たす場合に、ワークフローインスタンスが実行可能 *であると* 見なされます。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-108">The SQL Workflow Instance Store considers a workflow instance *runnable* if the instance is not in the suspended state or the completed state and satisfies the following conditions:</span></span>  
  
- <span data-ttu-id="b2a1d-109">インスタンスがロック解除されていて、保留タイマーの期限が切れている。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-109">The instance is unlocked and has a pending timer that has expired.</span></span>  
  
- <span data-ttu-id="b2a1d-110">インスタンスに期限切れのロックがある。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-110">The instance has an expired lock on it.</span></span>  
  
- <span data-ttu-id="b2a1d-111">インスタンスのロックが解除され、状態が [ **実行中**] になります。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-111">The instance is unlocked and its status is **Executing**.</span></span>  
  
 <span data-ttu-id="b2a1d-112">SQL Workflow Instance Store は、実行可能なインスタンスを見つけると <xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent> を生成します。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-112">The SQL Workflow Instance Store raises the <xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent> when it finds a runnable instance.</span></span> <span data-ttu-id="b2a1d-113">その後、SqlWorkflowInstanceStore は <xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand> がストアで一度呼び出されるまで監視を停止します。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-113">After this, the SqlWorkflowInstanceStore stops monitoring until the <xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand> is called once on the store.</span></span>  
  
 <span data-ttu-id="b2a1d-114"><xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent> に定期受信し、インスタンスの読み込みが可能なワークフロー ホストは、インスタンス ストアに対して <xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand> を実行してインスタンスをメモリに読み込みます。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-114">A workflow host that has subscribed for the <xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent> and capable of loading the instance executes the <xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand> against the instance store to load the instance into memory.</span></span> <span data-ttu-id="b2a1d-115">ホストとインスタンスのメタデータプロパティ **Workflowservicetype** が同じ値に設定されている場合、ワークフローホストはワークフローインスタンスを読み込むことができると見なされます。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-115">A workflow host is considered capable of loading a workflow instance if the host and the instance have metadata property **WorkflowServiceType** set to the same value.</span></span>  
  
## <a name="detecting-and-activating-activatable-workflow-instances"></a><span data-ttu-id="b2a1d-116">アクティブ化可能なワークフロー インスタンスの検出とアクティブ化</span><span class="sxs-lookup"><span data-stu-id="b2a1d-116">Detecting and Activating Activatable Workflow Instances</span></span>  

 <span data-ttu-id="b2a1d-117">インスタンスが実行可能で、インスタンスを読み込むことができるワークフローホストがコンピューター上で実行されていない場合、ワークフローインスタンスは *アクティブ* 化可能と見なされます。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-117">A workflow instance is considered *activatable* if the instance is runnable and there is no workflow host that is capable of loading the instance is running on the computer.</span></span> <span data-ttu-id="b2a1d-118">実行可能なワークフロー インスタンスの定義については、前の「実行可能なワークフロー インスタンスの検出とアクティブ化」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-118">See Detecting and Activating Runnable Workflow Instances above for the definition of a runnable workflow instance.</span></span>  
  
 <span data-ttu-id="b2a1d-119">SQL Workflow Instance Store は、データベースでアクティブ化可能なワークフロー インスタンスを見つけると <xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent> を生成します。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-119">The SQL Workflow Instance Store raises the <xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent> when it finds an activatable workflow instance in the database.</span></span> <span data-ttu-id="b2a1d-120">その後、SqlWorkflowInstanceStore は <xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand> がストアで一度呼び出されるまで監視を停止します。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-120">After this, the SqlWorkflowInstanceStore stops monitoring until the <xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand> is called once on the store.</span></span>  
  
 <span data-ttu-id="b2a1d-121"><xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent> に定期受信している汎用ホストは、イベントを受け取ると、インスタンス ストアに対して <xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand> を実行して、ワークフロー ホストの作成に必要なアクティブ化のパラメーターを取得します。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-121">When a generic host that has subscribed for the <xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent> receives the event, it executes the <xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand> against the instance store to obtain activation parameters required to create a workflow host.</span></span> <span data-ttu-id="b2a1d-122">汎用ホストは、このアクティブ化パラメーターを使用してワークフロー ホストを作成します。作成されたワークフロー ホストは、実行可能なサービス インスタンスを読み込んで実行します。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-122">The generic host uses these activation parameters to create a workflow host, which in turn loads and runs the runnable service instance.</span></span>  
  
## <a name="generic-hosts"></a><span data-ttu-id="b2a1d-123">汎用ホスト</span><span class="sxs-lookup"><span data-stu-id="b2a1d-123">Generic Hosts</span></span>  

 <span data-ttu-id="b2a1d-124">汎用ホストは、"メタデータ" プロパティの値を持つホストで、汎用ホストの **workflowservicetype** が workflowservicetype に設定されてい **ます。任意** のワークフロー型を処理できることを示します。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-124">A generic host is a host with the value of the metadata property **WorkflowServiceType** for generic hosts is set to **WorkflowServiceType.Any** to indicate that it can handle any workflow type.</span></span> <span data-ttu-id="b2a1d-125">汎用ホストには、 **ActivationType** という名前の XName パラメーターがあります。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-125">A generic host has an XName parameter named **ActivationType**.</span></span>  
  
 <span data-ttu-id="b2a1d-126">現在、SQL Workflow Instance Store は、ActivationType パラメーターの値が WAS に設定 **さ** れた汎用ホストをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-126">Currently, the SQL Workflow Instance Store supports generic hosts with value of the ActivationType parameter set to **WAS**.</span></span> <span data-ttu-id="b2a1d-127">ActivationType が WAS に設定されていない場合、SQL Workflow Instance Store は <xref:System.Runtime.DurableInstancing.InstancePersistenceException> をスローします。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-127">If the ActivationType is not set to WAS, the SQL Workflow Instance Store throws an <xref:System.Runtime.DurableInstancing.InstancePersistenceException>.</span></span> <span data-ttu-id="b2a1d-128">Windows Server AppFabric のホスト機能に付属するワークフロー管理サービスは、アクティブ化の種類が **WAS** に設定された汎用ホストです。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-128">The Workflow Management Service that ships with the hosting features of Windows Server AppFabric is a generic host that has the activation type set to **WAS**.</span></span>  
  
 <span data-ttu-id="b2a1d-129">WAS アクティブ化の場合、汎用ホストは、新しいホストをアクティブ化できるエンドポイント アドレスを派生する一連のアクティブ化パラメーターを要求します。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-129">For WAS activation, a generic host requires a set of activation parameters to derive the endpoint address at which new hosts can be activated.</span></span> <span data-ttu-id="b2a1d-130">WAS アクティブ化のアクティブ化パラメーターは、サイトの名前、サイトを基準としたアプリケーションの相対パス、アプリケーションを基準としたサービスの相対パスです。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-130">The activation parameters for WAS activation are name of the site, path to the application relative to the site, and path to the service relative to the application.</span></span> <span data-ttu-id="b2a1d-131">SQL Workflow Instance Store は、<xref:System.Activities.DurableInstancing.SaveWorkflowCommand> の実行中にこれらのアクティブ化パラメーターを格納します。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-131">The SQL Workflow Instance Store stores these activation parameters during the execution of the <xref:System.Activities.DurableInstancing.SaveWorkflowCommand>.</span></span>  
  
## <a name="runnable-instances-detection-period"></a><span data-ttu-id="b2a1d-132">実行可能インスタンス検出期間</span><span class="sxs-lookup"><span data-stu-id="b2a1d-132">Runnable Instances Detection Period</span></span>  

 <span data-ttu-id="b2a1d-133">SQL Workflow Instance Store の "実行可能 **インスタンス検出期間** " プロパティは、前の検出サイクルの後に、Sql Workflow instance store が永続性データベースで実行可能またはアクティブ化可能なワークフローインスタンスを検出する検出タスクを実行するまでの期間を指定します。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-133">The **Runnable Instances Detection Period** property of the SQL Workflow Instance Store specifies the time period after which the SQL Workflow Instance Store runs a detection task to detect any runnable or activatable workflow instances in the persistence database after the previous detection cycle.</span></span> <span data-ttu-id="b2a1d-134">このプロパティの詳細については、「実行可能 [インスタンスの検出期間](runnable-instances-detection-period.md) 」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="b2a1d-134">See [Runnable Instances Detection Period](runnable-instances-detection-period.md) for more details on this property.</span></span>
