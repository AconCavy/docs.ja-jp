---
title: 接続情報の保護
description: 接続文字列のセキュリティの脆弱性について説明します。これは、接続文字列の構築方法と保持方法、および認証の種類が原因で生じる場合があります。
ms.date: 03/30/2017
ms.assetid: 1471f580-bcd4-4046-bdaf-d2541ecda2f4
ms.openlocfilehash: 76b182a3d14be08d956f8ffb95dd2ae05245c003
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/15/2020
ms.locfileid: "90557893"
---
# <a name="protecting-connection-information"></a><span data-ttu-id="3932e-103">接続情報の保護</span><span class="sxs-lookup"><span data-stu-id="3932e-103">Protecting Connection Information</span></span>
<span data-ttu-id="3932e-104">アプリケーションのセキュリティを実現するうえで、データ ソースへのアクセスを保護することは、最も重要な目標の 1 つです。</span><span class="sxs-lookup"><span data-stu-id="3932e-104">Protecting access to your data source is one of the most important goals when securing an application.</span></span> <span data-ttu-id="3932e-105">保護されていない接続文字列は脆弱性を招く原因になります。</span><span class="sxs-lookup"><span data-stu-id="3932e-105">A connection string presents a potential vulnerability if it is not secured.</span></span> <span data-ttu-id="3932e-106">接続情報をテキスト形式で保存したり、メモリ内に保持したりすると、システム全体のセキュリティが損なわれる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3932e-106">Storing connection information in plain text or persisting it in memory risks compromising your entire system.</span></span> <span data-ttu-id="3932e-107">ソース コードに組み込まれた接続文字列は、[Ildasm.exe (IL Disassembler)](../../tools/ildasm-exe-il-disassembler.md) を使って、コンパイル済みアセンブリの Microsoft Intermediate Language (MSIL) を表示することで読み取ることができます。</span><span class="sxs-lookup"><span data-stu-id="3932e-107">Connection strings embedded in your source code can be read using the [Ildasm.exe (IL Disassembler)](../../tools/ildasm-exe-il-disassembler.md) to view Microsoft intermediate language (MSIL) in a compiled assembly.</span></span>  
  
 <span data-ttu-id="3932e-108">接続文字列に関係したセキュリティ上の脆弱性は、使用されている認証の種類、メモリやディスクへの接続文字列の保存方法、実行時に接続文字列を作成する際の手法などから発生します。</span><span class="sxs-lookup"><span data-stu-id="3932e-108">Security vulnerabilities involving connection strings can arise based on the type of authentication used, how connection strings are persisted in memory and on disk, and the techniques used to construct them at run time.</span></span>  
  
## <a name="use-windows-authentication"></a><span data-ttu-id="3932e-109">Windows 認証の使用</span><span class="sxs-lookup"><span data-stu-id="3932e-109">Use Windows Authentication</span></span>  
 <span data-ttu-id="3932e-110">データ ソースへのアクセスを制限するには、ユーザー ID、パスワード、データ ソース名などの接続情報をセキュリティで保護する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3932e-110">To help limit access to your data source, you must secure connection information such as user ID, password, and data source name.</span></span> <span data-ttu-id="3932e-111">ユーザー情報の漏洩を防ぐためにも、できるだけ Windows 認証 ("*統合セキュリティ*" とも呼ばれます) を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="3932e-111">In order to avoid exposing user information, we recommend using Windows authentication (sometimes referred to as *integrated security*) wherever possible.</span></span> <span data-ttu-id="3932e-112">Windows 認証は、接続文字列に `Integrated Security` キーワードまたは `Trusted_Connection` キーワードを使用することによって指定できます。こうすることで、ユーザー ID とパスワードを使う必要がなくなります。</span><span class="sxs-lookup"><span data-stu-id="3932e-112">Windows authentication is specified in a connection string by using the `Integrated Security` or `Trusted_Connection` keywords, eliminating the need to use a user ID and password.</span></span> <span data-ttu-id="3932e-113">Windows 認証を使用した場合、ユーザーは Windows によって認証され、サーバー リソースやデータベース リソースへのアクセスは Windows のユーザーおよびグループに付与された権限によって制御されます。</span><span class="sxs-lookup"><span data-stu-id="3932e-113">When using Windows authentication, users are authenticated by Windows, and access to server and database resources is determined by granting permissions to Windows users and groups.</span></span>  
  
 <span data-ttu-id="3932e-114">Windows 認証が使用できない場合、ユーザーの資格情報を接続文字列に含めることになるため、十分な注意が必要です。</span><span class="sxs-lookup"><span data-stu-id="3932e-114">For situations where it is not possible to use Windows authentication, you must use extra care because user credentials are exposed in the connection string.</span></span> <span data-ttu-id="3932e-115">ASP.NET アプリケーションでは、Windows アカウントを、データベースやその他のネットワーク リソースに接続する際の固定 ID として構成できます。</span><span class="sxs-lookup"><span data-stu-id="3932e-115">In an ASP.NET application, you can configure a Windows account as a fixed identity that is used to connect to databases and other network resources.</span></span> <span data-ttu-id="3932e-116">**web.config** ファイルの identity 要素で権限の借用を有効にし、ユーザー名とパスワードを指定します。</span><span class="sxs-lookup"><span data-stu-id="3932e-116">You enable impersonation in the identity element in the **web.config** file and specify a user name and password.</span></span>  
  
```xml  
<identity impersonate="true"
        userName="MyDomain\UserAccount"
        password="*****" />  
```  
  
 <span data-ttu-id="3932e-117">固定 ID アカウントには、権限の低いアカウント、つまり、データベースに対する必要な権限だけが付与されたアカウントを使用してください。</span><span class="sxs-lookup"><span data-stu-id="3932e-117">The fixed identity account should be a low-privilege account that has been granted only necessary permissions in the database.</span></span> <span data-ttu-id="3932e-118">さらに、ユーザー名とパスワードがクリア テキストで表示されないよう、構成ファイルを暗号化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3932e-118">In addition, you should encrypt the configuration file so that the user name and password are not exposed in clear text.</span></span>  
  
## <a name="do-not-use-universal-data-link-udl-files"></a><span data-ttu-id="3932e-119">UDL (Universal Data Link) ファイルの使用回避</span><span class="sxs-lookup"><span data-stu-id="3932e-119">Do Not Use Universal Data Link (UDL) files</span></span>  
 <span data-ttu-id="3932e-120"><xref:System.Data.OleDb.OleDbConnection> の接続文字列を UDL (Universal Data Link) ファイルに保存することは避けてください。</span><span class="sxs-lookup"><span data-stu-id="3932e-120">Avoid storing connection strings for an <xref:System.Data.OleDb.OleDbConnection> in a Universal Data Link (UDL) file.</span></span> <span data-ttu-id="3932e-121">UDL はクリア テキストで保存され暗号化できません。</span><span class="sxs-lookup"><span data-stu-id="3932e-121">UDLs are stored in clear text and cannot be encrypted.</span></span> <span data-ttu-id="3932e-122">UDL ファイルは、アプリケーションにとって外部ファイルをベースにしたリソースであるため、.NET Framework ではセキュリティ保護も暗号化もされません。</span><span class="sxs-lookup"><span data-stu-id="3932e-122">A UDL file is an external file-based resource to your application, and it cannot be secured or encrypted using the .NET Framework.</span></span>  
  
## <a name="avoid-injection-attacks-with-connection-string-builders"></a><span data-ttu-id="3932e-123">接続文字列ビルダーを使用したインジェクション攻撃の防止</span><span class="sxs-lookup"><span data-stu-id="3932e-123">Avoid Injection Attacks with Connection String Builders</span></span>  
 <span data-ttu-id="3932e-124">ユーザー入力から文字列を動的に連結することによって接続文字列を構築している場合、接続文字列のインジェクション攻撃を受ける可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3932e-124">A connection string injection attack can occur when dynamic string concatenation is used to build connection strings based on user input.</span></span> <span data-ttu-id="3932e-125">ユーザー入力の検証や悪意のある文字のエスケープを怠ると、機密データなど、サーバー上のリソースへのアクセスを攻撃者に許してしまうことも考えられます。</span><span class="sxs-lookup"><span data-stu-id="3932e-125">If the user input is not validated and malicious text or characters not escaped, an attacker can potentially access sensitive data or other resources on the server.</span></span> <span data-ttu-id="3932e-126">こうした問題を解消するために、ADO.NET 2.0 では、接続文字列の構文を検証し、余分なパラメーターの追加を防ぐ新しい接続文字列ビルダー クラスが導入されました。</span><span class="sxs-lookup"><span data-stu-id="3932e-126">To address this problem, ADO.NET 2.0 introduced new connection string builder classes to validate connection string syntax and ensure that additional parameters are not introduced.</span></span> <span data-ttu-id="3932e-127">詳細については、「[接続文字列ビルダー](connection-string-builders.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="3932e-127">For more information, see [Connection String Builders](connection-string-builders.md).</span></span>  
  
## <a name="use-persist-security-infofalse"></a><span data-ttu-id="3932e-128">Persist Security Info=False の使用</span><span class="sxs-lookup"><span data-stu-id="3932e-128">Use Persist Security Info=False</span></span>  
 <span data-ttu-id="3932e-129">`Persist Security Info` の既定値は false です。すべての接続文字列には、この既定値を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="3932e-129">The default value for `Persist Security Info` is false; we recommend using this default in all connection strings.</span></span> <span data-ttu-id="3932e-130">`Persist Security Info` を `true` または `yes` に設定すると、ユーザー ID やパスワードなどのセキュリティ関連情報を、接続を開いた後にその接続から取得できます。</span><span class="sxs-lookup"><span data-stu-id="3932e-130">Setting `Persist Security Info` to `true` or `yes` allows security-sensitive information, including the user ID and password, to be obtained from a connection after it has been opened.</span></span> <span data-ttu-id="3932e-131">`Persist Security Info` を `false` または `no` に設定した場合、その情報を使って接続を開いた後で、セキュリティ情報が破棄されるため、信頼できないソースによってセキュリティ関連情報がアクセスされることを確実に防ぐことができます。</span><span class="sxs-lookup"><span data-stu-id="3932e-131">When `Persist Security Info` is set to `false` or `no`, security information is discarded after it is used to open the connection, ensuring that an untrusted source does not have access to security-sensitive information.</span></span>  
  
## <a name="encrypt-configuration-files"></a><span data-ttu-id="3932e-132">構成ファイルの暗号化</span><span class="sxs-lookup"><span data-stu-id="3932e-132">Encrypt Configuration Files</span></span>  
 <span data-ttu-id="3932e-133">接続文字列は構成ファイルに保存することもでき、そうすることで、アプリケーションのコードに接続文字列を組み込むことを避けられます。</span><span class="sxs-lookup"><span data-stu-id="3932e-133">You can also store connection strings in configuration files, which eliminates the need to embed them in your application's code.</span></span> <span data-ttu-id="3932e-134">構成ファイルは、.NET Framework が基本的な要素を定義するために使用する標準的な XML ファイルです。</span><span class="sxs-lookup"><span data-stu-id="3932e-134">Configuration files are standard XML files for which the .NET Framework has defined a common set of elements.</span></span> <span data-ttu-id="3932e-135">通常、構成ファイル内の接続文字列は、**app.config** ファイル (Windows アプリケーションの場合) または **web.config** ファイル (ASP.NET アプリケーションの場合) の **\<connectionStrings>** 要素に格納されます。</span><span class="sxs-lookup"><span data-stu-id="3932e-135">Connection strings in configuration files are typically stored inside the **\<connectionStrings>** element in the **app.config** for a Windows application, or the **web.config** file for an ASP.NET application.</span></span> <span data-ttu-id="3932e-136">構成ファイルへの接続文字列の格納、構成ファイルからの接続文字列の取得、および暗号化については、「[接続文字列と構成ファイル](connection-strings-and-configuration-files.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3932e-136">For more information on the basics of storing, retrieving and encrypting connection strings from configuration files, see [Connection Strings and Configuration Files](connection-strings-and-configuration-files.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3932e-137">関連項目</span><span class="sxs-lookup"><span data-stu-id="3932e-137">See also</span></span>

- [<span data-ttu-id="3932e-138">ADO.NET アプリケーションのセキュリティ保護</span><span class="sxs-lookup"><span data-stu-id="3932e-138">Securing ADO.NET Applications</span></span>](securing-ado-net-applications.md)
- <span data-ttu-id="3932e-139">[保護された構成を使用した構成情報の暗号化](/previous-versions/aspnet/53tyfkaw(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="3932e-139">[Encrypting Configuration Information Using Protected Configuration](/previous-versions/aspnet/53tyfkaw(v=vs.100))</span></span>
- [<span data-ttu-id="3932e-140">.NET でのセキュリティ</span><span class="sxs-lookup"><span data-stu-id="3932e-140">Security in .NET</span></span>](../../../standard/security/index.md)
- [<span data-ttu-id="3932e-141">ADO.NET の概要</span><span class="sxs-lookup"><span data-stu-id="3932e-141">ADO.NET Overview</span></span>](ado-net-overview.md)
