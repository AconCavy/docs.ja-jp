---
title: ストリーミング プロバイダー (WCF Data Services)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF Data Services, providers
- WCF Data Services, binary data
- streaming data provider [WCF Data Services]
- WCF Data Services, streams
ms.assetid: f0978fe4-5f9f-42aa-a5c2-df395d7c9495
ms.openlocfilehash: da575c65902ec8751c12482d0c8d0abd523623e4
ms.sourcegitcommit: f348c84443380a1959294cdf12babcb804cfa987
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/12/2019
ms.locfileid: "73975120"
---
# <a name="streaming-provider-wcf-data-services"></a><span data-ttu-id="0bcec-102">ストリーミング プロバイダー (WCF Data Services)</span><span class="sxs-lookup"><span data-stu-id="0bcec-102">Streaming Provider (WCF Data Services)</span></span>

<span data-ttu-id="0bcec-103">データ サービスは、ラージ オブジェクトのバイナリ データを公開できます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-103">A data service can expose large object binary data.</span></span> <span data-ttu-id="0bcec-104">このバイナリ データは、ビデオ ストリームとオーディオ ストリーム、画像、ドキュメント ファイル、またはその他の種類のバイナリのメディアを表すことができます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-104">This binary data might represent video and audio streams, images, document files, or other types of binary media.</span></span> <span data-ttu-id="0bcec-105">データ モデルのエンティティに 1 つ以上のバイナリ プロパティが含まれている場合、データ サービスは、このバイナリ データを応答フィードのエントリ内に Base-64 としてエンコードして返します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-105">When an entity in the data model includes one or more binary properties, the data service returns this binary data encoded as base-64 inside the entry in the response feed.</span></span> <span data-ttu-id="0bcec-106">この方法で大きなバイナリデータを読み込んでシリアル化するとパフォーマンスに影響する可能性があるため、Open Data Protocol (OData) は、そのデータが属するエンティティとは独立してバイナリデータを取得するためのメカニズムを定義します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-106">Because loading and serializing large binary data in this manner can affect performance, the Open Data Protocol (OData) defines a mechanism for retrieving binary data independent of the entity to which it belongs.</span></span> <span data-ttu-id="0bcec-107">これは、バイナリ データとエンティティを分離して 1 つ以上のデータ ストリームを生成することで実現されます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-107">This is accomplished by separating the binary data from the entity into one or more data streams.</span></span>

- <span data-ttu-id="0bcec-108">メディア リソース - エンティティに属するバイナリ データ (ビデオ、オーディオ、画像、その他の種類のメディア リソース ストリームなど)。</span><span class="sxs-lookup"><span data-stu-id="0bcec-108">Media resource - binary data that belongs to an entity, such as a video, audio, image or other type of media resource stream.</span></span>

- <span data-ttu-id="0bcec-109">メディア リンク エントリ - 関連するメディア リソース ストリームへの参照を含むエンティティ。</span><span class="sxs-lookup"><span data-stu-id="0bcec-109">Media link entry - an entity that has a reference to a related media resource stream.</span></span>

<span data-ttu-id="0bcec-110">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] では、ストリーミング データ プロバイダーを実装してバイナリ リソース ストリームを定義します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-110">With [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], you define a binary resource stream by implementing a streaming data provider.</span></span> <span data-ttu-id="0bcec-111">ストリーミングプロバイダーの実装では、特定のエンティティに関連付けられたメディアリソースストリームが <xref:System.IO.Stream> オブジェクトとしてデータサービスに提供されます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-111">The streaming provider implementation supplies the data service with the media resource stream associated with a specific entity as an <xref:System.IO.Stream> object.</span></span> <span data-ttu-id="0bcec-112">この実装によって、データ サービスでは、指定された MIME の種類のバイナリ データ ストリームとしてメディア リソースを HTTP 経由で受け入れて、返すことができます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-112">This implementation enables the data service to accept and return media resources over HTTP as binary data streams of a specified MIME type.</span></span>

<span data-ttu-id="0bcec-113">バイナリ データのストリーミングをサポートするデータ サービスを構成するには、次の手順に従う必要があります。</span><span class="sxs-lookup"><span data-stu-id="0bcec-113">Configuring a data service to support the streaming of binary data requires the following steps:</span></span>

1. <span data-ttu-id="0bcec-114">データ モデル内の 1 つ以上のエンティティをメディア リンク エントリとして属性化します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-114">Attribute one or more entities in the data model as a media link entry.</span></span> <span data-ttu-id="0bcec-115">これらのエンティティには、ストリーミング対象のバイナリ データを含めないでください。</span><span class="sxs-lookup"><span data-stu-id="0bcec-115">These entities should not include the binary data to be streamed.</span></span> <span data-ttu-id="0bcec-116">エンティティのバイナリ プロパティは、常に Base-64 でエンコードされたバイナリとしてエントリで返されます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-116">Any binary properties of an entity are always returned in the entry as base-64 encoded binary.</span></span>

2. <span data-ttu-id="0bcec-117">T:System.Data.Services.Providers.IDataServiceStreamProvider インターフェイスを実装します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-117">Implement the T:System.Data.Services.Providers.IDataServiceStreamProvider interface.</span></span>

3. <span data-ttu-id="0bcec-118"><xref:System.IServiceProvider> インターフェイスを実装するデータ サービスを定義します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-118">Define a data service that implements the <xref:System.IServiceProvider> interface.</span></span> <span data-ttu-id="0bcec-119">データ サービスは、<xref:System.IServiceProvider.GetService%2A> の実装を使用してストリーミング データ プロバイダーの実装にアクセスします。</span><span class="sxs-lookup"><span data-stu-id="0bcec-119">The data service uses the <xref:System.IServiceProvider.GetService%2A> implementation to access the streaming data provider implementation.</span></span> <span data-ttu-id="0bcec-120">このメソッドは、適切なストリーミング プロバイダーの実装を返します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-120">This method returns the appropriate streaming provider implementation.</span></span>

4. <span data-ttu-id="0bcec-121">Web アプリケーション構成で大きいメッセージ ストリームを有効にします。</span><span class="sxs-lookup"><span data-stu-id="0bcec-121">Enable large message streams in the Web application configuration.</span></span>

5. <span data-ttu-id="0bcec-122">サーバー上またはデータ ソース内のバイナリ リソースへのアクセスを有効にします。</span><span class="sxs-lookup"><span data-stu-id="0bcec-122">Enable access to binary resources on the server or in a data source.</span></span>

<span data-ttu-id="0bcec-123">このトピックの例は、「ストリーミング[プロバイダーシリーズ: ストリーミングプロバイダーの実装 (パート 1)」 Data Services](https://go.microsoft.com/fwlink/?LinkID=198989)で詳しく説明されているストリーミングフォトサービスのサンプルに基づいています。</span><span class="sxs-lookup"><span data-stu-id="0bcec-123">The examples in this topic are based on a sample streaming photo service, which is discussed in depth in the post [Data Services Streaming Provider Series: Implementing a Streaming Provider (Part 1)](https://go.microsoft.com/fwlink/?LinkID=198989).</span></span> <span data-ttu-id="0bcec-124">このサンプルサービスのソースコードは、MSDN コードギャラリーの[ストリーミングフォトデータサービスのサンプルページ](https://go.microsoft.com/fwlink/?LinkID=198988)にあります。</span><span class="sxs-lookup"><span data-stu-id="0bcec-124">The source code for this sample service is available on the [Streaming Photo Data Service Sample page](https://go.microsoft.com/fwlink/?LinkID=198988) on MSDN Code Gallery.</span></span>

## <a name="defining-a-media-link-entry-in-the-data-model"></a><span data-ttu-id="0bcec-125">データ モデル内のメディア リンク エントリの定義</span><span class="sxs-lookup"><span data-stu-id="0bcec-125">Defining a Media Link Entry in the Data Model</span></span>

<span data-ttu-id="0bcec-126">エンティティがデータ モデル内のメディア リンク エントリとして定義される方法は、データ ソース プロバイダーによって決定されます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-126">The data source provider determines the way that an entity is defined as a media link entry in the data model.</span></span>

<span data-ttu-id="0bcec-127">**Entity Framework プロバイダー**</span><span class="sxs-lookup"><span data-stu-id="0bcec-127">**Entity Framework Provider**</span></span>

<span data-ttu-id="0bcec-128">エンティティがメディア リンク エントリであることを示すには、概念モデルのエンティティ型定義に `HasStream` 属性を追加します。次にその例を示します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-128">To indicate that an entity is a media link entry, add the `HasStream` attribute to the entity type definition in the conceptual model, as in the following example:</span></span>

[!code-xml[Astoria Photo Streaming Service#HasStream](../../../../samples/snippets/xml/VS_Snippets_Misc/astoria_photo_streaming_service/xml/photodata.edmx#hasstream)]

<span data-ttu-id="0bcec-129">また、エンティティまたはデータ モデルを定義する .edmx ファイルまたは .csdl ファイルのルートに名前空間 `xmlns:m=http://schemas.microsoft.com/ado/2007/08/dataservices/metadata` を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0bcec-129">You must also add the namespace `xmlns:m=http://schemas.microsoft.com/ado/2007/08/dataservices/metadata` either to the entity or to the root of the .edmx or .csdl file that defines the data model.</span></span>

<span data-ttu-id="0bcec-130">Entity Framework プロバイダーを使用し、メディアリソースを公開するデータサービスの例については、「 [Data Services ストリーミングプロバイダーシリーズ: ストリーミングプロバイダーの実装 (パート 1)](https://go.microsoft.com/fwlink/?LinkID=198989)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0bcec-130">For an example of a data service that uses the Entity Framework provider and exposes a media resource, see the post [Data Services Streaming Provider Series: Implementing a Streaming Provider (Part 1)](https://go.microsoft.com/fwlink/?LinkID=198989).</span></span>

<span data-ttu-id="0bcec-131">**リフレクション プロバイダー**</span><span class="sxs-lookup"><span data-stu-id="0bcec-131">**Reflection Provider**</span></span>

<span data-ttu-id="0bcec-132">エンティティがメディア リンク エントリであることを示すには、リフレクション プロバイダーのエンティティ型を定義するクラスに <xref:System.Data.Services.Common.HasStreamAttribute> を追加します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-132">To indicate that an entity is a media link entry, add the <xref:System.Data.Services.Common.HasStreamAttribute> to the class that defines the entity type in the reflection provider.</span></span>

<span data-ttu-id="0bcec-133">**カスタムデータサービスプロバイダー**</span><span class="sxs-lookup"><span data-stu-id="0bcec-133">**Custom Data Service Provider**</span></span>

<span data-ttu-id="0bcec-134">カスタム サービス プロバイダーを使用する場合は、<xref:System.Data.Services.Providers.IDataServiceMetadataProvider> インターフェイスを実装してデータ サービスのメタデータを定義します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-134">When using custom service providers, you implement the <xref:System.Data.Services.Providers.IDataServiceMetadataProvider> interface to define the metadata for your data service.</span></span> <span data-ttu-id="0bcec-135">詳細については、「[カスタムデータサービスプロバイダー](custom-data-service-providers-wcf-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0bcec-135">For more information, see [Custom Data Service Providers](custom-data-service-providers-wcf-data-services.md).</span></span> <span data-ttu-id="0bcec-136">エンティティ型 (メディア リンク エントリ) を表す <xref:System.Data.Services.Providers.ResourceType> で <xref:System.Data.Services.Providers.ResourceType.IsMediaLinkEntry%2A> プロパティを `true` に設定して、バイナリ リソース ストリームが <xref:System.Data.Services.Providers.ResourceType> に属することを示します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-136">You indicate that a binary resource stream belongs to a <xref:System.Data.Services.Providers.ResourceType> by setting the <xref:System.Data.Services.Providers.ResourceType.IsMediaLinkEntry%2A> property to `true` on the <xref:System.Data.Services.Providers.ResourceType> that represents the entity type, which is a media link entry.</span></span>

## <a name="implementing-the-idataservicestreamprovider-interface"></a><span data-ttu-id="0bcec-137">IDataServiceStreamProvider インターフェイスの実装</span><span class="sxs-lookup"><span data-stu-id="0bcec-137">Implementing the IDataServiceStreamProvider Interface</span></span>

<span data-ttu-id="0bcec-138">バイナリ データ ストリームをサポートするデータ サービスを作成するには、<xref:System.Data.Services.Providers.IDataServiceStreamProvider> インターフェイスを実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0bcec-138">To create a data service that supports binary data streams, you must implement the <xref:System.Data.Services.Providers.IDataServiceStreamProvider> interface.</span></span> <span data-ttu-id="0bcec-139">これを実装すると、データ サービスはバイナリ データをストリームとしてクライアントに返し、クライアントから送信されたストリームとしてバイナリ データを使用できます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-139">This implementation enables the data service to return binary data as a stream to the client and consume binary data as a stream sent from the client.</span></span> <span data-ttu-id="0bcec-140">データ サービスでは、バイナリ データへのストリームとしてのアクセスが必要になるたびに、このインターフェイスのインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-140">The data service creates an instance of this interface whenever it needs to access binary data as a stream.</span></span> <span data-ttu-id="0bcec-141"><xref:System.Data.Services.Providers.IDataServiceStreamProvider> インターフェイスでは次のメンバーを指定します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-141">The <xref:System.Data.Services.Providers.IDataServiceStreamProvider> interface specifies the following members:</span></span>

|<span data-ttu-id="0bcec-142">メンバー名</span><span class="sxs-lookup"><span data-stu-id="0bcec-142">Member name</span></span>|<span data-ttu-id="0bcec-143">説明</span><span class="sxs-lookup"><span data-stu-id="0bcec-143">Description</span></span>|
|-----------------|-----------------|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.DeleteStream%2A>|<span data-ttu-id="0bcec-144">このメソッドはデータ サービスにより呼び出され、メディア リンク エントリが削除されたときに対応するメディア リソースを削除します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-144">This method is invoked by the data service to delete the corresponding media resource when its media link entry is deleted.</span></span> <span data-ttu-id="0bcec-145"><xref:System.Data.Services.Providers.IDataServiceStreamProvider> を実装する場合、このメソッドには、指定されたメディア リンク エントリに関連付けられたメディア リソースを削除するコードが含まれます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-145">When you implement <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, this method contains the code that deletes the media resource associated with the supplied media link entry.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStream%2A>|<span data-ttu-id="0bcec-146">このメソッドはデータ サービスにより呼び出され、メディア リソースをストリームとして返します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-146">This method is invoked by the data service to return a media resource as a stream.</span></span> <span data-ttu-id="0bcec-147"><xref:System.Data.Services.Providers.IDataServiceStreamProvider> を実装する場合、このメソッドには、指定されたメディア リンク エントリに関連付けられたメディア リソースを返すためにデータ サービスが使用するストリームを提供するコードが含まれます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-147">When you implement <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, this method contains the code that provides a stream that is used by the data service to the return media resource that is associated with the provided media link entry.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStreamUri%2A>|<span data-ttu-id="0bcec-148">このメソッドはデータ サービスにより呼び出され、メディア リンク エントリのメディア リソースを要求するために使用される URI を返します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-148">This method is invoked by the data service to return the URI that is used to request the media resource for the media link entry.</span></span> <span data-ttu-id="0bcec-149">この値を使用して、メディア リンク エントリのコンテンツ要素の `src` 属性が作成され、データ ストリームが要求されます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-149">This value is used to create the `src` attribute in the content element of the media link entry and that is used to request the data stream.</span></span> <span data-ttu-id="0bcec-150">このメソッドから `null` が返されると、データ サービスによって URI が自動的に決定されます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-150">When this method returns `null`, the data service automatically determines the URI.</span></span> <span data-ttu-id="0bcec-151">このメソッドは、ストリーミング プロバイダーを使用しないバイナリ データへの直接アクセスをクライアントに提供する必要がある場合に使用します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-151">Use this method when you need to provide clients with direct access to binary data without using the steam provider.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetStreamContentType%2A>|<span data-ttu-id="0bcec-152">このメソッドはデータ サービスにより呼び出され、指定されたメディア リンク エントリに関連付けられたメディア リソースの Content-Type 値を返します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-152">This method is invoked by the data service to return the Content-Type value of the media resource that is associated with the specified media link entry.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetStreamETag%2A>|<span data-ttu-id="0bcec-153">このメソッドはデータ サービスにより呼び出され、指定されたエンティティに関連付けられたデータ ストリームの eTag を返します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-153">This method is invoked by the data service to return the eTag of the data stream that is associated with the specified entity.</span></span> <span data-ttu-id="0bcec-154">このメソッドは、バイナリ データのコンカレンシーを管理する場合に使用されます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-154">This method is used when you manage concurrency for the binary data.</span></span> <span data-ttu-id="0bcec-155">このメソッドが null を返す場合、データ サービスではコンカレンシーが追跡されません。</span><span class="sxs-lookup"><span data-stu-id="0bcec-155">When this method returns null, the data service does not track concurrency.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A>|<span data-ttu-id="0bcec-156">このメソッドはデータ サービスにより呼び出され、クライアントから送信されたストリームの受信時に使用されるストリームを取得します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-156">This method is invoked by the data service to obtain the stream that is used when receiving the stream sent from the client.</span></span> <span data-ttu-id="0bcec-157"><xref:System.Data.Services.Providers.IDataServiceStreamProvider> を実装する場合、データ サービスが受信したストリーム データを書き込む先である書き込み可能なストリームを返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="0bcec-157">When you implement <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, you must return a writable stream to which the data service writes received stream data.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.ResolveType%2A>|<span data-ttu-id="0bcec-158">名前空間で修飾された型名を返します。この型は、挿入されるメディア リソースのデータ ストリームに関連付けられたメディア リンク エントリに対してデータ サービス ランタイムが作成する必要がある型を表します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-158">Returns a namespace-qualified type name that represents the type that the data service runtime must create for the media link entry that is associated with the data stream for the media resource that is being inserted.</span></span>|

## <a name="creating-the-streaming-data-service"></a><span data-ttu-id="0bcec-159">ストリーミング データ サービスの作成</span><span class="sxs-lookup"><span data-stu-id="0bcec-159">Creating the Streaming Data Service</span></span>

<span data-ttu-id="0bcec-160">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] ランタイムに <xref:System.Data.Services.Providers.IDataServiceStreamProvider> の実装へのアクセスを提供するには、作成するデータ サービスで <xref:System.IServiceProvider> インターフェイスも実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0bcec-160">To provide the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] runtime with access to the <xref:System.Data.Services.Providers.IDataServiceStreamProvider> implementation, the data service that you create must also implement the <xref:System.IServiceProvider> interface.</span></span> <span data-ttu-id="0bcec-161">次の例は、<xref:System.IServiceProvider.GetService%2A> メソッドを実装して、`PhotoServiceStreamProvider` を実装する <xref:System.Data.Services.Providers.IDataServiceStreamProvider> クラスのインスタンスを返す方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="0bcec-161">The following example shows how to implement the <xref:System.IServiceProvider.GetService%2A> method to return an instance of the `PhotoServiceStreamProvider` class that implements <xref:System.Data.Services.Providers.IDataServiceStreamProvider>.</span></span>

[!code-csharp[Astoria Photo Streaming Service#PhotoServiceStreamingProvider](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_photo_streaming_service/cs/photodata.svc.cs#photoservicestreamingprovider)]
[!code-vb[Astoria Photo Streaming Service#PhotoServiceStreamingProvider](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_photo_streaming_service/vb/photodata.svc.vb#photoservicestreamingprovider)]

<span data-ttu-id="0bcec-162">データサービスの作成方法に関する一般的な情報については、「[データサービスの構成](configuring-the-data-service-wcf-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0bcec-162">For general information about how to create a data service, see [Configuring the Data Service](configuring-the-data-service-wcf-data-services.md).</span></span>

## <a name="enabling-large-binary-streams-in-the-hosting-environment"></a><span data-ttu-id="0bcec-163">ホスト環境での大きなバイナリ ストリームの有効化</span><span class="sxs-lookup"><span data-stu-id="0bcec-163">Enabling Large Binary Streams in the Hosting Environment</span></span>

<span data-ttu-id="0bcec-164">ASP.NET Web アプリケーションでデータサービスを作成する場合は、Windows Communication Foundation (WCF) を使用して HTTP プロトコルの実装を提供します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-164">When you create a data service in an ASP.NET Web application, Windows Communication Foundation (WCF) is used to provide the HTTP protocol implementation.</span></span> <span data-ttu-id="0bcec-165">既定では、WCF では HTTP メッセージのサイズは 65K バイトのみに制限されます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-165">By default, WCF limits the size of HTTP messages to only 65K bytes.</span></span> <span data-ttu-id="0bcec-166">また、データ サービスに対する大きなバイナリ データのストリーミングを可能にするには、大きなバイナリ ファイルを有効にして、転送にストリームを使用するように Web アプリケーションを構成する必要もあります。</span><span class="sxs-lookup"><span data-stu-id="0bcec-166">To be able to stream large binary data to and from the data service, you must also configure the Web application to enable large binary files and to use streams for transfer.</span></span> <span data-ttu-id="0bcec-167">そのためには、アプリケーションの Web.config ファイルの `<configuration />` 要素に次の内容を追加します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-167">To do this, add the following in the `<configuration />` element of the application's Web.config file:</span></span>

> [!NOTE]
> <span data-ttu-id="0bcec-168">要求メッセージと応答メッセージの両方でバイナリデータがストリーミングされ、WCF によってバッファリングされないようにするには、<xref:System.ServiceModel.TransferMode.Streamed?displayProperty=nameWithType> 転送モードを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0bcec-168">You must use a <xref:System.ServiceModel.TransferMode.Streamed?displayProperty=nameWithType> transfer mode to ensure that the binary data in both the request and response messages are streamed and not buffered by WCF.</span></span>

<span data-ttu-id="0bcec-169">詳細については、「[ストリーミングメッセージ転送](../../wcf/feature-details/streaming-message-transfer.md)と[トランスポートクォータ](../../wcf/feature-details/transport-quotas.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0bcec-169">For more information, see [Streaming Message Transfer](../../wcf/feature-details/streaming-message-transfer.md) and [Transport Quotas](../../wcf/feature-details/transport-quotas.md).</span></span>

<span data-ttu-id="0bcec-170">また、既定では、インターネット インフォメーション サービス (IIS) でも要求のサイズが 4 MB に制限されます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-170">By default, Internet Information Services (IIS) also limits the size of requests to 4MB.</span></span> <span data-ttu-id="0bcec-171">IIS での実行時にデータサービスが 4 MB を超えるストリームを受信できるようにするには、次の例に示すように、`<system.web />` 構成セクションで[HttpRuntime 要素 (ASP.NET Settings スキーマ)](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/e1f13641(v=vs.100))の `maxRequestLength` 属性も設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0bcec-171">To enable your data service to receive streams larger than 4MB when running on IIS, you must also set the `maxRequestLength` attribute of the [httpRuntime Element (ASP.NET Settings Schema)](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/e1f13641(v=vs.100)) in the `<system.web />` configuration section, as shown in the following example:</span></span>

## <a name="using-data-streams-in-a-client-application"></a><span data-ttu-id="0bcec-172">クライアント アプリケーションでのデータ ストリームの使用</span><span class="sxs-lookup"><span data-stu-id="0bcec-172">Using Data Streams in a Client Application</span></span>

<span data-ttu-id="0bcec-173">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] クライアント ライブラリを使用すると、クライアントのバイナリ ストリームとして公開されたリソースを取得および更新できます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-173">The [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client library enables you to both retrieve and update these exposed resources as binary streams on the client.</span></span> <span data-ttu-id="0bcec-174">詳細については、「[バイナリデータの操作](working-with-binary-data-wcf-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0bcec-174">For more information, see [Working with Binary Data](working-with-binary-data-wcf-data-services.md).</span></span>

## <a name="considerations-for-working-with-a-streaming-provider"></a><span data-ttu-id="0bcec-175">ストリーミング プロバイダーの使用に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="0bcec-175">Considerations for Working with a Streaming Provider</span></span>

<span data-ttu-id="0bcec-176">ストリーミング プロバイダーを実装する場合およびデータ サービスからメディア リソースにアクセスする場合には、次の点を考慮してください。</span><span class="sxs-lookup"><span data-stu-id="0bcec-176">The following are things to consider when you implement a streaming provider and when you access media resources from a data service.</span></span>

- <span data-ttu-id="0bcec-177">MERGE 要求は、メディア リソースではサポートされません。</span><span class="sxs-lookup"><span data-stu-id="0bcec-177">MERGE requests are not supported for media resources.</span></span> <span data-ttu-id="0bcec-178">既存のエンティティのメディア リソースを変更するには、PUT 要求を使用します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-178">Use a PUT request to change the media resource of an existing entity.</span></span>

- <span data-ttu-id="0bcec-179">POST 要求を使用して新しいメディア リンク エントリを作成することはできません。</span><span class="sxs-lookup"><span data-stu-id="0bcec-179">A POST request cannot be used to create a new media link entry.</span></span> <span data-ttu-id="0bcec-180">代わりに、POST 要求を発行して新しいメディア リソースを作成する必要があります。データ サービスによって、既定値で新しいメディア リンク エントリが作成されます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-180">Instead, you must issue a POST request to create a new media resource, and the data service creates a new media link entry with default values.</span></span> <span data-ttu-id="0bcec-181">その後に MERGE 要求または PUT 要求を使用してこの新しいエンティティを更新できます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-181">This new entity can be updated by a subsequent MERGE or PUT request.</span></span> <span data-ttu-id="0bcec-182">プロパティ値を POST 要求の Slug ヘッダーの値に設定するなど、エンティティをキャッシュしてディスポーザーで更新を行うこともできます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-182">You may also consider caching the entity and make updates in the disposer, such as setting the property value to the value of the Slug header in the POST request.</span></span>

- <span data-ttu-id="0bcec-183">POST 要求を受信すると、データ サービスは <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> を呼び出してメディア リソースを作成してから、<xref:System.Data.Services.IUpdatable.SaveChanges%2A> を呼び出してメディア リンク エントリを作成します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-183">When a POST request is received, the data service calls <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> to create the media resource before it calls <xref:System.Data.Services.IUpdatable.SaveChanges%2A> to create the media link entry.</span></span>

- <span data-ttu-id="0bcec-184"><xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> を実装すると、<xref:System.IO.MemoryStream> オブジェクトは返されません。</span><span class="sxs-lookup"><span data-stu-id="0bcec-184">An implementation of <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> should not return a <xref:System.IO.MemoryStream> object.</span></span> <span data-ttu-id="0bcec-185">この種類のストリームを使用すると、サービスが非常に大きなデータ ストリームを受信した場合に、メモリ リソースの問題が発生します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-185">When you use this kind of stream, memory resource issues will occur when the service receives very large data streams.</span></span>

- <span data-ttu-id="0bcec-186">データベースにメディア リソースを格納する場合は、次の点を考慮してください。</span><span class="sxs-lookup"><span data-stu-id="0bcec-186">The following are things to consider when storing media resources in a database:</span></span>

  - <span data-ttu-id="0bcec-187">メディア リソースであるバイナリ プロパティをデータ モデルに含めないようにしてください。</span><span class="sxs-lookup"><span data-stu-id="0bcec-187">A binary property that is a media resource should not be included in the data model.</span></span> <span data-ttu-id="0bcec-188">データ モデルで公開されるプロパティはすべて、応答フィードのエントリで返されます。</span><span class="sxs-lookup"><span data-stu-id="0bcec-188">All properties exposed in a data model are returned in the entry in a response feed.</span></span>

  - <span data-ttu-id="0bcec-189">大きなバイナリ ストリームのパフォーマンスを向上させるには、カスタム ストリーム クラスを作成してバイナリ データをデータベースに格納することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="0bcec-189">To improve performance with a large binary stream, we recommend that you create a custom stream class to store binary data in the database.</span></span> <span data-ttu-id="0bcec-190">このクラスは、<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> の実装によって返され、バイナリ データをチャンク単位でデータベースに送信します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-190">This class is returned by your <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> implementation and sends the binary data to the database in chunks.</span></span> <span data-ttu-id="0bcec-191">SQL Server データベースでは、バイナリデータが 1 MB を超える場合、FILESTREAM を使用してデータをデータベースにストリーミングすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="0bcec-191">For a SQL Server database, we recommend that you use a FILESTREAM to stream data into the database when the binary data is larger than 1MB.</span></span>

  - <span data-ttu-id="0bcec-192">データ サービスによって受信される大きなバイナリ ストリームを格納できるようにデータベースが設計されていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="0bcec-192">Ensure that your database is designed to store the binary large streams that are to be received by your data service.</span></span>

  - <span data-ttu-id="0bcec-193">クライアントが POST 要求を送信して、1 回の要求でメディア リソースと共にメディア リンク エントリを挿入する場合は、データ サービスによって新しいエンティティがデータベースに挿入される前に、<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> を呼び出してストリームを取得します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-193">When a client sends a POST request to insert a media link entry with a media resource in a single request, <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> is called to obtain the stream before the data service inserts the new entity into the database.</span></span> <span data-ttu-id="0bcec-194">ストリーミング プロバイダーは、このデータ サービスの動作を処理できるように実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0bcec-194">A streaming provider implementation must be able to handle this data service behavior.</span></span> <span data-ttu-id="0bcec-195">エンティティがデータベースに挿入されるまで、個別のデータ テーブルを使用してバイナリ データを格納するか、データ ストリームをファイルに格納することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="0bcec-195">Consider using a separate data table to store the binary data or store the data stream in a file until after the entity has been inserted into the database.</span></span>

- <span data-ttu-id="0bcec-196"><xref:System.Data.Services.Providers.IDataServiceStreamProvider.DeleteStream%2A> メソッド、<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStream%2A> メソッド、または <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> メソッドを実装する場合は、メソッドのパラメーターとして指定される eTag 値および Content-Type 値を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0bcec-196">When you implement the <xref:System.Data.Services.Providers.IDataServiceStreamProvider.DeleteStream%2A>, <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStream%2A>, or <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> methods, you must use the eTag and Content-Type values that are supplied as method parameters.</span></span> <span data-ttu-id="0bcec-197"><xref:System.Data.Services.Providers.IDataServiceStreamProvider> プロバイダーの実装には、eTag ヘッダーまたは Content-Type ヘッダーを設定しないでください。</span><span class="sxs-lookup"><span data-stu-id="0bcec-197">Do not set eTag or Content-Type headers in your <xref:System.Data.Services.Providers.IDataServiceStreamProvider> provider implementation.</span></span>

- <span data-ttu-id="0bcec-198">既定では、クライアントはチャンクされた HTTP Transfer-Encoding を使用して、大きなバイナリ ストリームを送信します。</span><span class="sxs-lookup"><span data-stu-id="0bcec-198">By default, the client sends large binary streams by using a chunked HTTP Transfer-Encoding.</span></span> <span data-ttu-id="0bcec-199">ASP.NET 開発サーバーではこの種のエンコードがサポートされていないため、この Web サーバーを使用して、大きなバイナリストリームを受け入れる必要があるストリーミングデータサービスをホストすることはできません。</span><span class="sxs-lookup"><span data-stu-id="0bcec-199">Because the ASP.NET Development Server does not support this kind of encoding, you cannot use this Web server to host a streaming data service that must accept large binary streams.</span></span> <span data-ttu-id="0bcec-200">ASP.NET 開発サーバーの詳細については、「 [Visual Studio の Web サーバー for ASP.NET Web Projects](https://docs.microsoft.com/previous-versions/aspnet/58wxa9w5(v=vs.120))」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0bcec-200">For more information on ASP.NET Development Server, see [Web Servers in Visual Studio for ASP.NET Web Projects](https://docs.microsoft.com/previous-versions/aspnet/58wxa9w5(v=vs.120)).</span></span>

<a name="versioning"></a>

## <a name="versioning-requirements"></a><span data-ttu-id="0bcec-201">バージョン管理の要件</span><span class="sxs-lookup"><span data-stu-id="0bcec-201">Versioning Requirements</span></span>

<span data-ttu-id="0bcec-202">ストリーミングプロバイダーには、次の OData プロトコルのバージョン管理要件があります。</span><span class="sxs-lookup"><span data-stu-id="0bcec-202">The streaming provider has the following OData protocol versioning requirements:</span></span>

- <span data-ttu-id="0bcec-203">ストリーミングプロバイダーでは、データサービスが OData プロトコル以降のバージョンのバージョン2.0 をサポートしている必要があります。</span><span class="sxs-lookup"><span data-stu-id="0bcec-203">The streaming provider requires that the data service support version 2.0 of the OData protocol and later versions.</span></span>

<span data-ttu-id="0bcec-204">詳細については、「[データサービスのバージョン管理](data-service-versioning-wcf-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0bcec-204">For more information, see [Data Service Versioning](data-service-versioning-wcf-data-services.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="0bcec-205">関連項目</span><span class="sxs-lookup"><span data-stu-id="0bcec-205">See also</span></span>

- [<span data-ttu-id="0bcec-206">Data Services プロバイダー</span><span class="sxs-lookup"><span data-stu-id="0bcec-206">Data Services Providers</span></span>](data-services-providers-wcf-data-services.md)
- [<span data-ttu-id="0bcec-207">カスタム データ サービス プロバイダー</span><span class="sxs-lookup"><span data-stu-id="0bcec-207">Custom Data Service Providers</span></span>](custom-data-service-providers-wcf-data-services.md)
- [<span data-ttu-id="0bcec-208">バイナリ データの操作</span><span class="sxs-lookup"><span data-stu-id="0bcec-208">Working with Binary Data</span></span>](working-with-binary-data-wcf-data-services.md)
