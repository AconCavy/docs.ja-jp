---
title: データ サービスのバージョン管理 (WCF Data Services)
ms.date: 03/30/2017
helpviewer_keywords:
- versioning, WCF Data Services
- versioning [WCF Data Services]
- WCF Data Services, versioning
ms.assetid: e3e899cc-7f25-4f67-958f-063f01f79766
ms.openlocfilehash: f82ab4c98e724bbed658a6c77de9c5a5d5c3390f
ms.sourcegitcommit: 43cbde34970f5f38f30c43cd63b9c7e2e83717ae
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/11/2020
ms.locfileid: "81121535"
---
# <a name="data-service-versioning-wcf-data-services"></a>データ サービスのバージョン管理 (WCF Data Services)
オープン データ プロトコル (OData) を使用すると、データ サービスを作成して、データ モデルに基づく URI を使用してクライアントがリソースとしてデータにアクセスできるようにします。 OData はサービス操作の定義もサポートしています。 ビジネス ニーズの変化、情報テクノロジの要件、その他の問題への対処などのさまざまな理由により、サービスの初期導入後と、場合によっては有効期間中に数回、これらのデータ サービスを変更することが必要になる場合があります。 既存のデータ サービスに変更を加える場合は、新しいバージョンのデータ サービスを定義する必要性や、既存のクライアント アプリケーションへの影響を最小限に抑える最善の方法を検討する必要があります。 ここでは、新しいバージョンのデータ サービスをいつどのように作成するかに関するガイダンスを示します。 また、クライアントと OData プロトコルの異なるバージョンをサポートするデータ サービス間の交換を、WCF データ サービスが処理する方法についても説明します。

## <a name="versioning-a-wcf-data-service"></a>WCF Data Service のバージョン管理
 データ サービスが配置され、データが使用されている状況では、データ サービスに変更を加えることで、既存のクライアント アプリケーションとの間に互換性の問題が発生する可能性があります。 ただし、サービスの全体的なビジネス ニーズを受けて変更が求められることも多いため、クライアント アプリケーションへの影響を最小限に抑えながらデータ サービスの新しいバージョンをいつどのように作成するかを検討する必要があります。

### <a name="data-model-changes-that-recommend-a-new-data-service-version"></a>新しいバージョンのデータ サービスが推奨されるデータ モデルの変更
 データ サービスの新しいバージョンを発行するかどうかを検討する際は、さまざまな種類の変更がクライアント アプリケーションに与える影響を理解することが重要です。 データ サービスの新しいバージョンを作成する必要があるデータ サービスへの変更は、次の 2 つのカテゴリに分類できます。

- サービス コントラクトに対する変更。これには、サービス操作の更新、エンティティ セット (フィード) のアクセシビリティへの変更、バージョンの変更、およびサービスの動作に対するその他の変更が含まれます。

- データ コントラクトに対する変更。これには、データ モデル、フィード形式、またはフィードのカスタマイズが含まれます。

 次の表に、データ サービスの新しいバージョンの発行を考慮する必要がある変更の種類を示します。

|変更の種類|新しいバージョンが必要|新しいバージョンは不要|
|--------------------|----------------------------|----------------------------|
|サービス操作|- 新しいパラメータを追加<br />- 戻り値の型を変更する<br />- サービス操作の削除|- 既存のパラメータを削除<br />- 新しいサービス操作の追加|
|サービスの動作|- カウント要求を無効にする<br />- プロジェクションサポートを無効にする<br />- 必要なデータサービスのバージョンを増やす|- カウント要求を有効にする<br />- プロジェクションサポートを有効にする<br />- 必要なデータ サービスのバージョンを減らす|
|エンティティ セットのアクセス許可|- エンティティ セットのアクセス許可を制限する<br />- 応答コードの変更(新しい最初の数字の値) <sup>1</sup>|- エンティティ セットのアクセス許可を緩和<br />- 応答コードの変更 (同じ最初の桁の値)|
|エンティティのプロパティ|- 既存のプロパティまたはリレーションシップを削除する<br />- null 非許容プロパティを追加します<br />- 既存のプロパティを変更|- null 許容プロパティ<sup>2</sup>を追加します|
|エンティティ セット|- エンティティ セットの削除|- 派生型の追加<br />- 基本タイプの変更<br />- エンティティ セットの追加|
|フィードのカスタマイズ|- エンティティ-プロパティマッピングの変更||

 <sup>1</sup>これは、クライアント アプリケーションが特定のエラー コードを受け取る方法に依存する方法によって異なる場合があります。

 <sup>2</sup>クライアントで<xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A>定義されていないデータ`true`サービスによって送信された新しいプロパティをクライアントが無視するように、このプロパティを設定できます。 ただし、挿入の場合、クライアントによって POST 要求に含められていないプロパティは既定値に設定されます。 更新の場合、クライアントが識別できないプロパティ内の既存のデータは、既定値で上書きされます。 この場合は、更新を MERGE 要求として送信する必要があります (これは既定の動作です)。 詳細については、「[データ サービス コンテキストの管理](managing-the-data-service-context-wcf-data-services.md)」を参照してください。

### <a name="how-to-version-a-data-service"></a>データ サービスのバージョンの管理
 必要に応じて、サービス コントラクトまたはデータ モデルが更新されたサービスの新しいインスタンスを作成して、データ サービスの新しいバージョンを定義します。 次に、この新しいサービスを、以前のバージョンと区別する新しい URI エンドポイントを使用して公開します。 次に例を示します。

- 古いバージョン: `http://services.odata.org/Northwind/v1/Northwind.svc/`

- 新しいバージョン: `http://services.odata.org/Northwind/v2/Northwind.svc/`

 データ サービスをアップグレードした場合、新しいルート URI を使用するには、新しいデータ サービス メタデータに基づいてクライアントも更新する必要があります。 可能な場合は、新しいバージョンを使用するためのアップグレードが行われていないクライアントをサポートするために、データ サービスの以前のバージョンを保持してください。 データ サービスの古いバージョンは、必要でなくなった時点で削除できます。 データ サービスのエンドポイント URI を外部の構成ファイルに保持することを検討する必要があります。

## <a name="odata-protocol-versions"></a>OData プロトコルのバージョン
 OData の新しいバージョンがリリースされると、クライアント アプリケーションは、データ サービスでサポートされている OData プロトコルの同じバージョンを使用していない可能性があります。 古いクライアント アプリケーションは、OData の新しいバージョンをサポートするデータ サービスにアクセス可能性があります。 クライアント アプリケーションは、アクセスされるデータ サービスよりも新しいバージョンの OData をサポートする、新しいバージョンの WCF データ サービス クライアント ライブラリを使用している可能性もあります。

 WCF データ サービスは、このようなバージョン管理シナリオを処理する OData によって提供されるサポートを活用します。 また、クライアントがデータ サービスで使用するバージョンとは異なるバージョンの OData を使用する場合に、データ モデル メタデータを生成して使用してクライアント データ サービス クラスを作成する機能もサポートされています。 詳細については[、「OData: 概要](https://www.odata.org/documentation/odata-version-2-0/overview/)」の「プロトコルのバージョン管理」セクションを参照してください。

### <a name="version-negotiation"></a>バージョンのネゴシエーション
 データ サービスは、クライアントが要求したバージョンに関係なく、サービスで使用される OData プロトコルの最高バージョンを定義するように構成できます。 これを行うには、データ サービスで<xref:System.Data.Services.Common.DataServiceProtocolVersion><xref:System.Data.Services.DataServiceBehavior>使用される<xref:System.Data.Services.DataServiceBehavior.MaxProtocolVersion%2A>プロパティの値を指定します。 詳細については、「データ[サービスの設定](configuring-the-data-service-wcf-data-services.md)」を参照してください。

 アプリケーションが WCF Data Services クライアント ライブラリを使用してデータ サービスにアクセスする場合、OData のバージョンとアプリケーションで使用される機能に応じて、ライブラリは自動的にこれらのヘッダーを正しい値に設定します。 既定では、WCF データ サービスは、要求された操作をサポートする最も低いプロトコル バージョンを使用します。

 次の表は、特定のバージョンの OData プロトコルに対する WCF データ サービス のサポートを含む .NET Framework および Silverlight のバージョンの詳細を示しています。

|OData プロトコルのバージョン|サポートが用意されているバージョン|
|-----------------------------------------------------------------------------------|----------------------------|
|Version 1|- .NET Framework 3.5 サービス パック 1 (SP1)<br />- シルバーライトバージョン3|
|Version 2|- .NET フレームワーク 4<br />- シルバーライトバージョン4|

### <a name="metadata-versions"></a>メタデータのバージョン
 既定では、WCF データ サービスは、データ モデルを表すために CSDL のバージョン 1.1 を使用します。 リフレクション プロバイダーまたはカスタム データ サービス プロバイダーに基づくデータ モデルの場合は、常にこの CSDL バージョンが使用されます。 ただし、Entity Framework を使用してデータ モデルを定義している場合は、返される CSDL のバージョンは Entity Framework で使用されるバージョンと同じになります。 CSDL のバージョンは、[スキーマ要素 (CSDL)](/ef/ef6/modeling/designer/advanced/edmx/csdl-spec#schema-element-csdl)の名前空間によって決定されます。

 返されたメタデータの `DataServices` 要素には `DataServiceVersion` 属性も含まれます。この属性は、応答メッセージの `DataServiceVersion` ヘッダーの値と同じです。 Visual Studio の [**サービス参照の追加**] ダイアログ ボックスなどのクライアント アプリケーションは、この情報を使用して、データ サービスをホストする WCF データ サービスのバージョンで正しく動作するクライアント データ サービス クラスを生成します。 詳細については[、「OData: 概要](https://www.odata.org/documentation/odata-version-2-0/overview/)」の「プロトコルのバージョン管理」セクションを参照してください。

## <a name="see-also"></a>関連項目

- [Data Services プロバイダー](data-services-providers-wcf-data-services.md)
- [WCF Data Services の定義](defining-wcf-data-services.md)
