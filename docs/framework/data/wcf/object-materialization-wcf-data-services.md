---
title: オブジェクトの具体化 (WCF Data Services)
ms.date: 03/30/2017
helpviewer_keywords:
- WCF Data Services, client library
- WCF Data Services, querying
ms.assetid: f0dbf7b0-0292-4e31-9ae4-b98288336dc1
ms.openlocfilehash: 7a2b201e5690c4304e663e9429c54f377e05f556
ms.sourcegitcommit: 79a2d6a07ba4ed08979819666a0ee6927bbf1b01
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74568904"
---
# <a name="object-materialization-wcf-data-services"></a><span data-ttu-id="89aa2-102">オブジェクトの具体化 (WCF Data Services)</span><span class="sxs-lookup"><span data-stu-id="89aa2-102">Object Materialization (WCF Data Services)</span></span>

<span data-ttu-id="89aa2-103">.NET Framework ベースのクライアントアプリケーションで **[サービス参照の追加]** ダイアログボックスを使用して Open Data Protocol (OData) フィードを使用すると、フィードによって公開されるデータモデル内の各エンティティ型に対して同等のデータクラスが生成されます。</span><span class="sxs-lookup"><span data-stu-id="89aa2-103">When you use the **Add Service Reference** dialog to consume an Open Data Protocol (OData) feed in a .NET Framework-based client application, equivalent data classes are generated for each entity type in the data model exposed by the feed.</span></span> <span data-ttu-id="89aa2-104">詳細については、「[データサービスクライアントライブラリの生成](generating-the-data-service-client-library-wcf-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="89aa2-104">For more information, see [Generating the Data Service Client Library](generating-the-data-service-client-library-wcf-data-services.md).</span></span> <span data-ttu-id="89aa2-105">クエリによって返されるエンティティ データは、これらの生成されたクライアント データ サービス クラスのいずれかのインスタンスに具体化されます。</span><span class="sxs-lookup"><span data-stu-id="89aa2-105">Entity data that is returned by a query is materialized into an instance of one of these generated client data service classes.</span></span> <span data-ttu-id="89aa2-106">追跡オブジェクトのマージオプションと id 解決の詳細については、「[データサービスコンテキストの管理](managing-the-data-service-context-wcf-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="89aa2-106">For information about merge options and identity resolution for tracked objects, see [Managing the Data Service Context](managing-the-data-service-context-wcf-data-services.md).</span></span>

<span data-ttu-id="89aa2-107">WCF Data Services では、ツールで生成されたデータクラスを使用するのではなく、独自のクライアントデータサービスクラスを定義することもできます。</span><span class="sxs-lookup"><span data-stu-id="89aa2-107">WCF Data Services also enables you to define your own client data service classes rather than using the tool-generated data classes.</span></span> <span data-ttu-id="89aa2-108">これにより、"plain-old CLR object" (POCO) データ クラスとして知られる独自のデータ クラスを使用できます。</span><span class="sxs-lookup"><span data-stu-id="89aa2-108">This enables you to use your own data classes, also known as "plain-old CLR object" (POCO) data classes.</span></span> <span data-ttu-id="89aa2-109">これらの種類のカスタムデータクラスを使用する場合は、<xref:System.Data.Services.Common.DataServiceKeyAttribute> または <xref:System.Data.Services.Common.DataServiceEntityAttribute> のいずれかを使用してデータクラスの属性を設定し、クライアントの型名がデータサービスのデータモデルの型名と一致することを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="89aa2-109">When using these types of custom data classes, you should attribute the data class with either <xref:System.Data.Services.Common.DataServiceKeyAttribute> or <xref:System.Data.Services.Common.DataServiceEntityAttribute> and ensure that type names on the client match type names in the data model of the data service.</span></span>

<span data-ttu-id="89aa2-110">ライブラリは、クエリ応答メッセージを受信すると、OData フィードから返されたデータを、クエリの種類のクライアントデータサービスクラスのインスタンスに具体化します。</span><span class="sxs-lookup"><span data-stu-id="89aa2-110">After the library receives the query response message, it materializes the returned data from the OData feed into instances of client data service classes that are of the type of the query.</span></span> <span data-ttu-id="89aa2-111">これらのオブジェクトを具体化する一般的なプロセスは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="89aa2-111">The general process for materializing these objects is as follows:</span></span>

1. <span data-ttu-id="89aa2-112">クライアント ライブラリは、応答メッセージ フィード内の `entry` 要素からシリアル化された型を読み取り、次のいずれかの方法で正しい型の新しいインスタンスの作成を試みます。</span><span class="sxs-lookup"><span data-stu-id="89aa2-112">The client library reads the serialized type from the `entry` element in the response message feed and attempts to create a new instance of the correct type, in one of the following ways:</span></span>

    - <span data-ttu-id="89aa2-113">フィードで宣言された型の名前が <xref:System.Data.Services.Client.DataServiceQuery%601> の型と同じ場合は、空のコンストラクターを使用してこの型の新しいインスタンスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="89aa2-113">When the type declared in the feed has the same name as the type of the <xref:System.Data.Services.Client.DataServiceQuery%601>, a new instance of this type is created by using the empty constructor.</span></span>

    - <span data-ttu-id="89aa2-114">フィードで宣言された型の名前が <xref:System.Data.Services.Client.DataServiceQuery%601> の型から派生した型と同じ場合は、空のコンストラクターを使用して派生したこの型の新しいインスタンスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="89aa2-114">When the type declared in the feed has the same name as a type that is derived from the type of the <xref:System.Data.Services.Client.DataServiceQuery%601>, a new instance of this derived type is created by using the empty constructor.</span></span>

    - <span data-ttu-id="89aa2-115">フィードで宣言された型が <xref:System.Data.Services.Client.DataServiceQuery%601> の型、または派生した型と一致しない場合は、空のコンストラクターを使用してクエリされた型の新しいインスタンスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="89aa2-115">When the type declared in the feed cannot be matched to the type of the <xref:System.Data.Services.Client.DataServiceQuery%601> or any derived types, a new instance of the queried type is created by using the empty constructor.</span></span>

    - <span data-ttu-id="89aa2-116"><xref:System.Data.Services.Client.DataServiceContext.ResolveType%2A> プロパティが設定されている場合、指定されたデリゲートが呼び出され、既定の名前ベースの型のマッピングをオーバーライドし、<xref:System.Func%602> によって返された型の新しいインスタンスが代わりに作成されます。</span><span class="sxs-lookup"><span data-stu-id="89aa2-116">When the <xref:System.Data.Services.Client.DataServiceContext.ResolveType%2A> property is set, the supplied delegate is called to override the default name-based type mapping and a new instance of the type returned by the <xref:System.Func%602> is created instead.</span></span> <span data-ttu-id="89aa2-117">このデリゲートが NULL 値を返した場合、クエリされた型の新しいインスタンスが代わりに作成されます。</span><span class="sxs-lookup"><span data-stu-id="89aa2-117">If this delegate returns a null value, a new instance of the queried type is created instead.</span></span> <span data-ttu-id="89aa2-118">継承のシナリオをサポートするために、既定の名前ベースの型名のマッピングをオーバーライドすることが必要な場合があります。</span><span class="sxs-lookup"><span data-stu-id="89aa2-118">It may be required to override the default name-based type name mapping to support inheritance scenarios.</span></span>

2. <span data-ttu-id="89aa2-119">クライアント ライブラリは `id` の `entry` 要素から URI 値を読み取ります。これがエンティティの ID 値です。</span><span class="sxs-lookup"><span data-stu-id="89aa2-119">The client library reads the URI value from the `id` element of the `entry`, which is the identity value of the entity.</span></span> <span data-ttu-id="89aa2-120"><xref:System.Data.Services.Client.DataServiceContext.MergeOption%2A> の  <xref:System.Data.Services.Client.MergeOption.NoTracking> 値が使用されない限り、<xref:System.Data.Services.Client.DataServiceContext> のオブジェクトの追跡には、ID 値が使用されます。</span><span class="sxs-lookup"><span data-stu-id="89aa2-120">Unless a <xref:System.Data.Services.Client.DataServiceContext.MergeOption%2A> value of <xref:System.Data.Services.Client.MergeOption.NoTracking> is used, the identity value is used to track the object in the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="89aa2-121">さらに、クエリ応答でエンティティが複数回返されたときでも、単一のエンティティ インスタンスのみが作成されることを保証するためにも ID 値を使用します。</span><span class="sxs-lookup"><span data-stu-id="89aa2-121">The identity value is also used to guarantee that only a single entity instance is created, even when an entity is returned multiple times in the query response.</span></span>

3. <span data-ttu-id="89aa2-122">クライアント ライブラリは、フィード エントリからプロパティを読み取り、新しく作成されたオブジェクトに対応するプロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="89aa2-122">The client library reads properties from the feed entry and set the corresponding properties on the newly created object.</span></span> <span data-ttu-id="89aa2-123"><xref:System.Data.Services.Client.DataServiceContext> に同じ ID 値のオブジェクトが既に存在する場合、プロパティは、<xref:System.Data.Services.Client.MergeOption> の <xref:System.Data.Services.Client.DataServiceContext> 設定に基づき設定されます。</span><span class="sxs-lookup"><span data-stu-id="89aa2-123">When an object that has the same identity value already occurs in the <xref:System.Data.Services.Client.DataServiceContext>, the properties are set based on the <xref:System.Data.Services.Client.MergeOption> setting of the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="89aa2-124">応答には、クライアント型で対応するプロパティがないプロパティ値が含まれる場合があります。</span><span class="sxs-lookup"><span data-stu-id="89aa2-124">The response might contain property values for which a corresponding property does not occur in the client type.</span></span> <span data-ttu-id="89aa2-125">そのような場合、アクションは、<xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> の <xref:System.Data.Services.Client.DataServiceContext> プロパティの値によって異なります。</span><span class="sxs-lookup"><span data-stu-id="89aa2-125">When this occurs, the action depends on the value of the <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> property of the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="89aa2-126">このプロパティが `true` に設定されている場合は、欠落しているプロパティは無視されます。</span><span class="sxs-lookup"><span data-stu-id="89aa2-126">When this property is set to `true`, the missing property is ignored.</span></span> <span data-ttu-id="89aa2-127">それ以外の場合は、エラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="89aa2-127">Otherwise, an error is raised.</span></span> <span data-ttu-id="89aa2-128">プロパティは次のように設定されます。</span><span class="sxs-lookup"><span data-stu-id="89aa2-128">Properties are set as follows:</span></span>

    - <span data-ttu-id="89aa2-129">スカラー プロパティは、応答メッセージのエントリ内の対応する値に設定されます。</span><span class="sxs-lookup"><span data-stu-id="89aa2-129">Scalar properties are set to the corresponding value in the entry in the response message.</span></span>

    - <span data-ttu-id="89aa2-130">複合プロパティは、新しい複合型インスタンスに設定されます。このインスタンスは、応答からの複合型のプロパティとともに設定されます。</span><span class="sxs-lookup"><span data-stu-id="89aa2-130">Complex properties are set to a new complex type instance, which are set with the properties of the complex type from the response.</span></span>

    - <span data-ttu-id="89aa2-131">関連するエンティティのコレクションを返すナビゲーション プロパティは、<xref:System.Collections.Generic.ICollection%601> の新しいまたは既存のインスタンスに設定されます。ここで、`T` は関連エンティティの型です。</span><span class="sxs-lookup"><span data-stu-id="89aa2-131">Navigation properties that return a collection of related entities are set to a new or existing instance of <xref:System.Collections.Generic.ICollection%601>, where `T` is the type of the related entity.</span></span> <span data-ttu-id="89aa2-132">このコレクションは、関連オブジェクトが <xref:System.Data.Services.Client.DataServiceContext> に読み込まれていない限り空になります。</span><span class="sxs-lookup"><span data-stu-id="89aa2-132">This collection is empty unless the related objects have been loaded into the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="89aa2-133">詳細については、「[遅延コンテンツの読み込み](loading-deferred-content-wcf-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="89aa2-133">For more information, see [Loading Deferred Content](loading-deferred-content-wcf-data-services.md).</span></span>

      > [!NOTE]
      > <span data-ttu-id="89aa2-134">生成されたクライアント データ クラスでデータ バインディングがサポートされる場合、ナビゲーション プロパティは代わりに <xref:System.Data.Services.Client.DataServiceCollection%601> クラスのインスタンスを返します。</span><span class="sxs-lookup"><span data-stu-id="89aa2-134">When the generated client data classes support data binding, navigation properties return instances of the <xref:System.Data.Services.Client.DataServiceCollection%601> class instead.</span></span> <span data-ttu-id="89aa2-135">詳細については、「[コントロールへのデータのバインド](binding-data-to-controls-wcf-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="89aa2-135">For more information, see [Binding Data to Controls](binding-data-to-controls-wcf-data-services.md).</span></span>

4. <span data-ttu-id="89aa2-136"><xref:System.Data.Services.Client.DataServiceContext.ReadingEntity> イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="89aa2-136">The <xref:System.Data.Services.Client.DataServiceContext.ReadingEntity> event is raised.</span></span>

5. <span data-ttu-id="89aa2-137">クライアント ライブラリは <xref:System.Data.Services.Client.DataServiceContext> にオブジェクトをアタッチします。</span><span class="sxs-lookup"><span data-stu-id="89aa2-137">The client library attaches the object to the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="89aa2-138"><xref:System.Data.Services.Client.MergeOption> が <xref:System.Data.Services.Client.MergeOption.NoTracking> の場合は、オブジェクトはアタッチされません。</span><span class="sxs-lookup"><span data-stu-id="89aa2-138">The object is not attached when the <xref:System.Data.Services.Client.MergeOption> is <xref:System.Data.Services.Client.MergeOption.NoTracking>.</span></span>

## <a name="see-also"></a><span data-ttu-id="89aa2-139">参照</span><span class="sxs-lookup"><span data-stu-id="89aa2-139">See also</span></span>

- [<span data-ttu-id="89aa2-140">データ サービスに対するクエリ</span><span class="sxs-lookup"><span data-stu-id="89aa2-140">Querying the Data Service</span></span>](querying-the-data-service-wcf-data-services.md)
- [<span data-ttu-id="89aa2-141">クエリ射影</span><span class="sxs-lookup"><span data-stu-id="89aa2-141">Query Projections</span></span>](query-projections-wcf-data-services.md)
