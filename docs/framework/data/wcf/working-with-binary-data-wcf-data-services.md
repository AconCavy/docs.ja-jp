---
title: バイナリ データの操作 (WCF Data Services)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF Data Services, binary data
- WCF Data Services, streams
ms.assetid: aeccc45c-d5c5-4671-ad63-a492ac8043ac
ms.openlocfilehash: aa3e58d559121aaca401e7b851a4b4fd8e7753cd
ms.sourcegitcommit: 7088f87e9a7da144266135f4b2397e611cf0a228
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/11/2020
ms.locfileid: "75900845"
---
# <a name="working-with-binary-data-wcf-data-services"></a><span data-ttu-id="2f2a4-102">バイナリ データの操作 (WCF Data Services)</span><span class="sxs-lookup"><span data-stu-id="2f2a4-102">Working with Binary Data (WCF Data Services)</span></span>

<span data-ttu-id="2f2a4-103">WCF Data Services クライアント ライブラリを使用すると、次のいずれかの方法で、Open Data Protocol (OData) フィードからバイナリ データを取得して更新できます。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-103">The WCF Data Services client library enables you to retrieve and update binary data from an Open Data Protocol (OData) feed in one of the following ways:</span></span>

- <span data-ttu-id="2f2a4-104">エンティティのプリミティブ型のプロパティとして。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-104">As a primitive type property of an entity.</span></span> <span data-ttu-id="2f2a4-105">メモリに容易に読み込むことができる小さいバイナリ データ オブジェクトを操作する場合は、この方法が適しています。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-105">This is the recommended method for working with small binary data objects that can be easily loaded into memory.</span></span> <span data-ttu-id="2f2a4-106">この場合、バイナリ プロパティは、データ モデルによって公開されるエンティティ プロパティです。データ サービスは、応答メッセージの Base-64 バイナリ エンコード XML としてバイナリ データをシリアル化します。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-106">In this case, the binary property is an entity property exposed by the data model, and the data service serializes the binary data as base-64 binary encoded XML in the response message.</span></span>

- <span data-ttu-id="2f2a4-107">個別のバイナリ リソース ストリームとして。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-107">As a separate binary resource stream.</span></span> <span data-ttu-id="2f2a4-108">写真、ビデオ、またはその他の種類のバイナリ エンコード データを表すバイナリ ラージ オブジェクト (BLOB) データにアクセスしたり、変更したりする場合は、この方法が適しています。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-108">This is the recommended method for accessing and changing binary large object (BLOB) data that may represent a photo, video, or any other type of binary encoded data.</span></span>

<span data-ttu-id="2f2a4-109">OData で定義されているように、WCF Data Services では HTTP を使用してバイナリ データのストリーミングが実装されます。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-109">WCF Data Services implements the streaming of binary data by using HTTP as defined in the OData.</span></span> <span data-ttu-id="2f2a4-110">この場合、バイナリ データは、エンティティに関連しているものの、エンティティとは切り離されたメディア リソースとして処理されます。これをメディア リンク エントリといいます。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-110">In this mechanism, binary data is treated as a media resource that is separate from but related to an entity, which is called a media link entry.</span></span> <span data-ttu-id="2f2a4-111">詳細については、「[ストリーミング プロバイダー](streaming-provider-wcf-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-111">For more information, see [Streaming Provider](streaming-provider-wcf-data-services.md).</span></span>

> [!TIP]
> <span data-ttu-id="2f2a4-112">写真を格納している OData サービスからバイナリ画像ファイルをダウンロードする Windows Presentation Foundation (WPF) クライアント アプリケーションの作成方法の例については、ブログの記事「[Data Services ストリーミング プロバイダー シリーズ - パート 2: クライアントからメディア リソース ストリームへのアクセス](https://docs.microsoft.com/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-112">For a step-by-step example of how to create a Windows Presentation Foundation (WPF) client application that downloads binary image files from an OData service that stores photos, see the post [Data Services Streaming Provider Series-Part 2: Accessing a Media Resource Stream from the Client](https://docs.microsoft.com/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span></span> <span data-ttu-id="2f2a4-113">このブログ記事で取り上げられているストリーミング フォト データ サービスのサンプル コードをダウンロードするには、GitHub の「[ストリーミング フォト データ サービスのサンプル](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-113">To download the sample code for the stream photo data service featured in the blog post, see the [Streaming Photo Data Service Sample](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample) in GitHub.</span></span>

## <a name="entity-metadata"></a><span data-ttu-id="2f2a4-114">エンティティ メタデータ</span><span class="sxs-lookup"><span data-stu-id="2f2a4-114">Entity Metadata</span></span>

<span data-ttu-id="2f2a4-115">メディア リソース ストリームが関連付けられているエンティティは、データ サービス メタデータで `HasStream` 属性によって示されます。この属性は、メディア リンク エントリであるエンティティ型に適用されます。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-115">An entity that has a related media resource stream is indicated in the data service metadata by the `HasStream` attribute applied to an entity type that is the media link entry.</span></span> <span data-ttu-id="2f2a4-116">次の例の `PhotoInfo` エンティティは、メディア リソースが関連付けられているメディア リンク エントリであり、`HasStream` 属性によってそのことが示されています。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-116">In the following example, the `PhotoInfo` entity is a media link entry that has a related media resource, indicated by the `HasStream` attribute.</span></span>

[!code-xml[Astoria Photo Streaming Service#HasStream](../../../../samples/snippets/xml/VS_Snippets_Misc/astoria_photo_streaming_service/xml/photodata.edmx#hasstream)]

<span data-ttu-id="2f2a4-117">このトピックのその他の例では、メディア リソース ストリームにアクセスし変更する方法を紹介します。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-117">The remaining examples in this topic show how to access and change the media resource stream.</span></span> <span data-ttu-id="2f2a4-118">.NET Framework クライアント アプリケーションで WCF Data Services クライアント ライブラリを使用してメディア リソース ストリームを使用する方法の完全な例については、ブログの記事「[クライアントからメディア リソース ストリームへのアクセス](https://docs.microsoft.com/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-118">For a complete example of how to consume a media resource stream in a .NET Framework client application by using the WCF Data Services client library, see the post [Accessing a Media Resource Stream from the Client](https://docs.microsoft.com/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span></span>

## <a name="accessing-the-binary-resource-stream"></a><span data-ttu-id="2f2a4-119">バイナリ リソース ストリームへのアクセス</span><span class="sxs-lookup"><span data-stu-id="2f2a4-119">Accessing the Binary Resource Stream</span></span>

<span data-ttu-id="2f2a4-120">WCF Data Services クライアント ライブラリには、OData ベースのデータ サービスからのバイナリ リソース ストリームにアクセスするためのメソッドが用意されています。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-120">The WCF Data Services client library provides methods for accessing binary resource streams from an OData-based data service.</span></span> <span data-ttu-id="2f2a4-121">メディア リソースをダウンロードするときには、メディア リソースの URI を使用することも、メディア リソース データ自体を含むバイナリ ストリームを取得することもできます。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-121">When downloading a media resource, you can either use the URI of the media resource or you can get a binary stream that contains the media resource data itself.</span></span> <span data-ttu-id="2f2a4-122">メディア リソース データをバイナリ ストリームとしてアップロードすることもできます。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-122">You can also upload media resource data as a binary stream.</span></span>

> [!TIP]
> <span data-ttu-id="2f2a4-123">写真を格納している OData サービスからバイナリ画像ファイルをダウンロードする Windows Presentation Foundation (WPF) クライアント アプリケーションの作成方法の例については、ブログの記事「[Data Services ストリーミング プロバイダー シリーズ - パート 2: クライアントからメディア リソース ストリームへのアクセス](https://docs.microsoft.com/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-123">For a step-by-step example of how to create a Windows Presentation Foundation (WPF) client application that downloads binary image files from an OData service that stores photos, see the post [Data Services Streaming Provider Series-Part 2: Accessing a Media Resource Stream from the Client](https://docs.microsoft.com/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span></span> <span data-ttu-id="2f2a4-124">このブログ記事で取り上げられているストリーミング フォト データ サービスのサンプル コードをダウンロードするには、GitHub の「[ストリーミング フォト データ サービスのサンプル](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-124">To download the sample code for the stream photo data service featured in the blog post, see the [Streaming Photo Data Service Sample](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample) in GitHub.</span></span>

### <a name="getting-the-uri-of-the-binary-stream"></a><span data-ttu-id="2f2a4-125">バイナリ ストリームの URI の取得</span><span class="sxs-lookup"><span data-stu-id="2f2a4-125">Getting the URI of the Binary Stream</span></span>

<span data-ttu-id="2f2a4-126">画像やその他のメディア ファイルなど、取得するメディア リソースの種類によっては、アプリケーションでメディア リソースの URI を使用する方がバイナリ データ ストリーム自体を処理するよりも簡単です。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-126">When retrieving certain types of media resources, such as images and other media files, it is often easier to use the URI of the media resource in your application than handling the binary data stream itself.</span></span> <span data-ttu-id="2f2a4-127">特定のメディア リンク エントリに関連付けられているリソース ストリームの URI を取得するには、そのエンティティを追跡している <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> インスタンスの <xref:System.Data.Services.Client.DataServiceContext> メソッドを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-127">To get the URI of a resource stream associated with a give media link entry, you must call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the entity.</span></span> <span data-ttu-id="2f2a4-128">次の例は、クライアントで新しい画像を作成するために使用するメディア リソース ストリームの URI を取得するために <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> メソッドを呼び出す方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-128">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> method to get the URI of a media resource stream that is used to create a new image on the client:</span></span>

[!code-csharp[Astoria Photo Streaming Client#GetReadStreamUri](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_photo_streaming_client/cs/photowindow.xaml.cs#getreadstreamuri)]
[!code-vb[Astoria Photo Streaming Client#GetReadStreamUri](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_photo_streaming_client/vb/photowindow.xaml.vb#getreadstreamuri)]

### <a name="downloading-the-binary-resource-stream"></a><span data-ttu-id="2f2a4-129">バイナリ リソース ストリームのダウンロード</span><span class="sxs-lookup"><span data-stu-id="2f2a4-129">Downloading the Binary Resource Stream</span></span>

<span data-ttu-id="2f2a4-130">バイナリ リソース ストリームを取得する場合、メディア リンク エントリを追跡している <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> インスタンスの <xref:System.Data.Services.Client.DataServiceContext> メソッドを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-130">When retrieving a binary resource stream, you must call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the media link entry.</span></span> <span data-ttu-id="2f2a4-131">このメソッドは、<xref:System.Data.Services.Client.DataServiceStreamResponse> オブジェクトを返すデータ サービスに要求を送信します。このオブジェクトは、リソースが含まれるストリームを参照します。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-131">This method sends a request to the data service that returns a <xref:System.Data.Services.Client.DataServiceStreamResponse> object, which has a reference to the stream that contains the resource.</span></span> <span data-ttu-id="2f2a4-132">アプリケーションでバイナリ リソースを <xref:System.IO.Stream> として取得する必要がある場合にこのメソッドを使用します。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-132">Use this method when your application requires the binary resource as a <xref:System.IO.Stream>.</span></span> <span data-ttu-id="2f2a4-133">次の例は、クライアントで新しい画像を作成するために使用するストリームを取得するために <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> メソッドを呼び出す方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-133">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> method to retrieve a stream that is used to create a new image on the client:</span></span>

[!code-csharp[Astoria Streaming Client#GetReadStreamClient](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_streaming_client/cs/customerphotowindow.xaml.cs#getreadstreamclient)]
[!code-vb[Astoria Streaming Client#GetReadStreamClient](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_streaming_client/vb/customerphotowindow.xaml.vb#getreadstreamclient)]

> [!NOTE]
> <span data-ttu-id="2f2a4-134">バイナリ ストリームを含む応答メッセージの Content-Length ヘッダーは、このデータ サービスによって設定されません。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-134">The Content-Length header in the response message that contains the binary steam is not set by the data service.</span></span> <span data-ttu-id="2f2a4-135">この値は、バイナリ データ ストリームの実際の長さを反映していない場合があります。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-135">This value may not reflect the actual length of the binary data stream.</span></span>

### <a name="uploading-a-media-resource-as-a-stream"></a><span data-ttu-id="2f2a4-136">ストリームとしてのメディア リソースのアップロード</span><span class="sxs-lookup"><span data-stu-id="2f2a4-136">Uploading a Media Resource as a Stream</span></span>

<span data-ttu-id="2f2a4-137">メディア リソースを挿入または更新するには、エンティティを追跡している <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> インスタンスの <xref:System.Data.Services.Client.DataServiceContext> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-137">To insert or update a media resource, call the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the entity.</span></span> <span data-ttu-id="2f2a4-138">このメソッドは、指定ストリームから読み込まれたメディア リソースを含むデータ サービスに要求を送信します。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-138">This method sends a request to the data service that contains the media resource read from the supplied stream.</span></span> <span data-ttu-id="2f2a4-139">次の例は、<xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> メソッドを呼び出してデータ サービスに画像を送信する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-139">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method to send an image to the data service:</span></span>

[!code-csharp[Astoria Photo Streaming Client#SetSaveStream](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_photo_streaming_client/cs/photodetailswindow.xaml.cs#setsavestream)]
[!code-vb[Astoria Photo Streaming Client#SetSaveStream](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_photo_streaming_client/vb/photodetailswindow.xaml.vb#setsavestream)]

<span data-ttu-id="2f2a4-140">この例では、<xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> パラメーターに値 `true` を指定して `closeStream` メソッドを呼び出しています。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-140">In this example, the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method is called by supplying a value of `true` for the `closeStream` parameter.</span></span> <span data-ttu-id="2f2a4-141">したがって、必ず、バイナリ データがデータ サービスにアップロードされた後で <xref:System.Data.Services.Client.DataServiceContext> がストリームを閉じます。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-141">This guarantees that the <xref:System.Data.Services.Client.DataServiceContext> closes the stream after the binary data is uploaded to the data service.</span></span>

> [!NOTE]
> <span data-ttu-id="2f2a4-142"><xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> を呼び出すときには、<xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> が呼び出されるまでストリームはデータ サービスに送信されないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="2f2a4-142">When you call <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A>, the stream is not sent to the data service until <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> is called.</span></span>

## <a name="see-also"></a><span data-ttu-id="2f2a4-143">関連項目</span><span class="sxs-lookup"><span data-stu-id="2f2a4-143">See also</span></span>

- [<span data-ttu-id="2f2a4-144">WCF Data Services クライアント ライブラリ</span><span class="sxs-lookup"><span data-stu-id="2f2a4-144">WCF Data Services Client Library</span></span>](wcf-data-services-client-library.md)
- [<span data-ttu-id="2f2a4-145">コントロールへのデータのバインド</span><span class="sxs-lookup"><span data-stu-id="2f2a4-145">Binding Data to Controls</span></span>](binding-data-to-controls-wcf-data-services.md)
