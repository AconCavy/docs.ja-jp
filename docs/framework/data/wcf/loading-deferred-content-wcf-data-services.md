---
title: 遅延コンテンツの読み込み (WCF Data Services)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF Data Services, client library
- WCF Data Services, deferred content
- WCF Data Services, loading data
ms.assetid: 32f9b588-c832-44c4-a7e0-fcce635df59a
ms.openlocfilehash: 811118755c4688bd0ea8cb9ba37b2101ab6c52cf
ms.sourcegitcommit: 79a2d6a07ba4ed08979819666a0ee6927bbf1b01
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74568953"
---
# <a name="loading-deferred-content-wcf-data-services"></a><span data-ttu-id="fc9c2-102">遅延コンテンツの読み込み (WCF Data Services)</span><span class="sxs-lookup"><span data-stu-id="fc9c2-102">Loading Deferred Content (WCF Data Services)</span></span>
<span data-ttu-id="fc9c2-103">既定では、WCF Data Services によって、クエリが返すデータの量が制限されます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-103">By default, WCF Data Services limits the amount of data that a query returns.</span></span> <span data-ttu-id="fc9c2-104">その一方で、関連エンティティ、ページングされた応答データ、およびバイナリ データ ストリームを含む追加データをデータ サービスから必要に応じて明示的に読み込むことができます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-104">However, you can explicitly load additional data, including related entities, paged response data, and binary data streams, from the data service when it is needed.</span></span> <span data-ttu-id="fc9c2-105">このトピックでは、このような遅延コンテンツをアプリケーションに読み込む方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-105">This topic describes how to load such deferred content into your application.</span></span>  
  
## <a name="related-entities"></a><span data-ttu-id="fc9c2-106">関連エンティティ</span><span class="sxs-lookup"><span data-stu-id="fc9c2-106">Related Entities</span></span>  
 <span data-ttu-id="fc9c2-107">クエリを実行すると、アドレス指定したエンティティ セット内のエンティティだけが返されます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-107">When you execute a query, only entities in the addressed entity set are returned.</span></span> <span data-ttu-id="fc9c2-108">たとえば、Northwind データ サービスに対するクエリが `Customers` エンティティを返す場合、`Orders` と `Customers` の間にリレーションシップがあっても、既定では関連 `Orders` エンティティは返されません。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-108">For example, when a query against the Northwind data service returns `Customers` entities, by default the related `Orders` entities are not returned, even though there is a relationship between `Customers` and `Orders`.</span></span> <span data-ttu-id="fc9c2-109">また、データ サービスでページングが有効になった場合は、以降のデータ ページをサービスから明示的に読み込む必要があります。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-109">Also, when paging is enabled in the data service, you must explicitly load subsequent data pages from the service.</span></span> <span data-ttu-id="fc9c2-110">関連エンティティを読み込むには、2 つの方法があります。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-110">There are two ways to load related entities:</span></span>  
  
- <span data-ttu-id="fc9c2-111">**一括読み込み**: `$expand` クエリオプションを使用すると、クエリが要求したエンティティセットへのアソシエーションによって関連付けられたエンティティを返すように要求できます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-111">**Eager loading**: You can use the `$expand` query option to request that the query return entities that are related by an association to the entity set that the query requested.</span></span> <span data-ttu-id="fc9c2-112"><xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A> に対して <xref:System.Data.Services.Client.DataServiceQuery%601> メソッドを使用して、データ サービスに送信されるクエリに `$expand` オプションを追加します。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-112">Use the <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A> method on the <xref:System.Data.Services.Client.DataServiceQuery%601> to add the `$expand` option to the query that is sent to the data service.</span></span> <span data-ttu-id="fc9c2-113">次の例に示すように、エンティティ セットをコンマで区切ることによって関連する複数のエンティティ セットを要求できます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-113">You can request multiple related entity sets by separating them by a comma, as in the following example.</span></span> <span data-ttu-id="fc9c2-114">クエリによって要求されたすべてのエンティティは、1 つの応答で返されます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-114">All entities requested by the query are returned in a single response.</span></span> <span data-ttu-id="fc9c2-115">次の例では、`Order_Details` および `Customers` が `Orders` エンティティ セットと一緒に返されます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-115">The following example returns `Order_Details` and `Customers` together with the `Orders` entity set:</span></span>  
  
     [!code-csharp[Astoria Northwind Client#ExpandOrderDetailsSpecific](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#expandorderdetailsspecific)]
     [!code-vb[Astoria Northwind Client#ExpandOrderDetailsSpecific](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#expandorderdetailsspecific)]  
  
     <span data-ttu-id="fc9c2-116">WCF Data Services、`$expand` クエリオプションを使用して1つのクエリに含めることができるエンティティセットの数を12に制限します。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-116">WCF Data Services limits to 12 the number of entity sets that can be included in a single query by using the `$expand` query option.</span></span>  
  
- <span data-ttu-id="fc9c2-117">**明示的な読み込み**: <xref:System.Data.Services.Client.DataServiceContext> インスタンスで <xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A> メソッドを呼び出して、関連エンティティを明示的に読み込むことができます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-117">**Explicit loading**: You can call the <xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance to explicitly load related entities.</span></span> <span data-ttu-id="fc9c2-118"><xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A> メソッドへの各呼び出しによって、データ サービスへの個別の要求が作成されます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-118">Each call to the <xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A> method creates a separate request to the data service.</span></span> <span data-ttu-id="fc9c2-119">次の例では、`Order_Details` エンティティの `Orders` を明示的に読み込みます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-119">The following example explicitly loads `Order_Details` for an `Orders` entity:</span></span>  
  
     [!code-csharp[Astoria Northwind Client#LoadRelatedOrderDetailsSpecific](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#loadrelatedorderdetailsspecific)]
     [!code-vb[Astoria Northwind Client#LoadRelatedOrderDetailsSpecific](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#loadrelatedorderdetailsspecific)]  
  
 <span data-ttu-id="fc9c2-120">どちらのオプションを使用するかを検討する場合、データ サービスへの要求の数と 1 つの応答で返されるデータの量のバランスを考慮してください。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-120">When you consider which option to use, realize that there is a tradeoff between the number of requests to the data service and the amount of data that is returned in a single response.</span></span> <span data-ttu-id="fc9c2-121">アプリケーションが関連オブジェクトを必要とし、それらのオブジェクトを明示的に取得するための追加要求による待機時間を回避する場合は、一括読み込みを使用します。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-121">Use eager loading when your application requires associated objects and you want to avoid the added latency of additional requests to explicitly retrieve them.</span></span> <span data-ttu-id="fc9c2-122">しかし、アプリケーションが特定の関連エンティティ インスタンスのデータしか必要としない場合は、<xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A> メソッドを呼び出して、これらのエンティティを明示的に読み込むことを検討することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-122">However, if there are cases when the application only needs the data for specific related entity instances, you should consider explicitly loading those entities by calling the <xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A> method.</span></span> <span data-ttu-id="fc9c2-123">詳細については、「[方法: 関連エンティティを読み込む](how-to-load-related-entities-wcf-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-123">For more information, see [How to: Load Related Entities](how-to-load-related-entities-wcf-data-services.md).</span></span>  
  
## <a name="paged-content"></a><span data-ttu-id="fc9c2-124">ページングされたコンテンツ</span><span class="sxs-lookup"><span data-stu-id="fc9c2-124">Paged Content</span></span>  
 <span data-ttu-id="fc9c2-125">データ サービスでページングが有効化されている場合、データ サービスが返すフィード内のエントリの数はデータ サービスの構成によって制限されます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-125">When paging is enabled in the data service, the number of entries in the feed that the data service returns is limited by the configuration of the data service.</span></span> <span data-ttu-id="fc9c2-126">ページ制限は、各エンティティ セットに対して個別に設定できます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-126">Page limits can be set separately for each entity set.</span></span> <span data-ttu-id="fc9c2-127">詳細については、「[データサービスの構成](configuring-the-data-service-wcf-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-127">For more information, see [Configuring the Data Service](configuring-the-data-service-wcf-data-services.md).</span></span> <span data-ttu-id="fc9c2-128">ページングが有効である場合、フィードの最終的なエントリには、データの次のページへのリンクが含まれます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-128">When paging is enabled, the final entry in the feed contains a link to the next page of data.</span></span> <span data-ttu-id="fc9c2-129">このリンクは、<xref:System.Data.Services.Client.DataServiceQueryContinuation%601> オブジェクトに含まれます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-129">This link is contained in a <xref:System.Data.Services.Client.DataServiceQueryContinuation%601> object.</span></span> <span data-ttu-id="fc9c2-130">データの次のページへの URI は、<xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> が実行されたときに返される <xref:System.Data.Services.Client.QueryOperationResponse%601> で <xref:System.Data.Services.Client.DataServiceQuery%601> メソッドを呼び出すことによって取得します。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-130">You obtain the URI to the next page of data by calling the <xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> method on the <xref:System.Data.Services.Client.QueryOperationResponse%601> returned when the <xref:System.Data.Services.Client.DataServiceQuery%601> is executed.</span></span> <span data-ttu-id="fc9c2-131">返された <xref:System.Data.Services.Client.DataServiceQueryContinuation%601> オブジェクトが使用されて、結果の次のページが読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-131">The returned <xref:System.Data.Services.Client.DataServiceQueryContinuation%601> object is then used to load the next page of results.</span></span> <span data-ttu-id="fc9c2-132">クエリ結果は、<xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> メソッドを呼び出す前に列挙する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-132">You must enumerate the query result before you call the <xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> method.</span></span> <span data-ttu-id="fc9c2-133">最初に `do…while` ループを使用してクエリ結果を列挙した後に、次の `non-null` リンク値をチェックすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-133">Consider using a `do…while` loop to first enumerate the query result and then check for a `non-null` next link value.</span></span> <span data-ttu-id="fc9c2-134"><xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> メソッドが `null` (Visual Basic の場合は `Nothing`) を返す場合、元のクエリに追加の結果ページはありません。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-134">When the <xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> method returns `null` (`Nothing` in Visual Basic), there are no additional result pages for the original query.</span></span> <span data-ttu-id="fc9c2-135">次の例は、Northwind サンプル データ サービスからページングされた顧客データを読み込む `do…while` ループを示します。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-135">The following example shows a `do…while` loop that loads paged customer data from the Northwind sample data service.</span></span>  
  
 [!code-csharp[Astoria Northwind Client#LoadNextLink](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#loadnextlink)]
 [!code-vb[Astoria Northwind Client#LoadNextLink](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#loadnextlink)]  
  
 <span data-ttu-id="fc9c2-136">要求されたエンティティ セットと一緒に関連エンティティを 1 つの応答で返すようクエリが要求すると、ページング制限は、応答と共にインラインで含まれるネストされたフィードに影響することがあります。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-136">When a query requests that related entities are returned in a single response together with the requested entity set, paging limits may affect nested feeds that are included inline with the response.</span></span> <span data-ttu-id="fc9c2-137">たとえば、Northwind サンプル データ サービスで `Customers` エンティティ セットに対してページング制限が設定されている場合、次の Northwind サンプル データ サービスを定義する Northwind.svc.cs ファイルの例に示すように、独立したページング制限を関連 `Orders` エンティティ セットに設定することもできます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-137">For example, when a paging limit is set in the Northwind sample data service for the `Customers` entity set, an independent paging limit can also be set for the related `Orders` entity set, as in the following example from the Northwind.svc.cs file that defines the Northwind sample data service.</span></span>  
  
 [!code-csharp[Astoria Northwind Service#DataServiceConfigPaging](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_service/cs/northwind.svc.cs#dataserviceconfigpaging)]
 [!code-vb[Astoria Northwind Service#DataServiceConfigPaging](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_service/vb/northwind.svc.vb#dataserviceconfigpaging)]  
  
 <span data-ttu-id="fc9c2-138">この場合、最上位レベルの `Customers` エンティティ フィードとネストされた `Orders` エンティティ フィードの両方にページングを実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-138">In this case, you must implement paging for both the top-level `Customers` and the nested `Orders` entity feeds.</span></span> <span data-ttu-id="fc9c2-139">次の例は、選択した `while` エンティティに関連する `Orders` エンティティのページを読み込むために使用する `Customers` ループを示します。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-139">The following example shows the `while` loop used to load pages of `Orders` entities related to a selected `Customers` entity.</span></span>  
  
 [!code-csharp[Astoria Northwind Client#LoadNextOrdersLink](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#loadnextorderslink)]
 [!code-vb[Astoria Northwind Client#LoadNextOrdersLink](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#loadnextorderslink)]  
  
 <span data-ttu-id="fc9c2-140">詳細については、「[方法: ページング](how-to-load-paged-results-wcf-data-services.md)された結果を読み込む」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-140">For more information, see [How to: Load Paged Results](how-to-load-paged-results-wcf-data-services.md).</span></span>  
  
## <a name="binary-data-streams"></a><span data-ttu-id="fc9c2-141">バイナリ データ ストリーム</span><span class="sxs-lookup"><span data-stu-id="fc9c2-141">Binary Data Streams</span></span>  
 <span data-ttu-id="fc9c2-142">WCF Data Services を使用すると、バイナリラージオブジェクト (BLOB) データにデータストリームとしてアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-142">WCF Data Services enables you to access binary large object (BLOB) data as a data stream.</span></span> <span data-ttu-id="fc9c2-143">ストリーミングは必要になるまでバイナリ データの読み込みを待機し、クライアントは、このデータを効率的に処理できます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-143">Streaming defers the loading of binary data until it is needed, and the client can more efficiently process this data.</span></span> <span data-ttu-id="fc9c2-144">この機能を活用するには、データ サービスは <xref:System.Data.Services.Providers.IDataServiceStreamProvider> プロバイダーを実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-144">In order to take advantage of this functionality, the data service must implement the <xref:System.Data.Services.Providers.IDataServiceStreamProvider> provider.</span></span> <span data-ttu-id="fc9c2-145">詳細については、「 [Streaming Provider](streaming-provider-wcf-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-145">For more information, see [Streaming Provider](streaming-provider-wcf-data-services.md).</span></span> <span data-ttu-id="fc9c2-146">ストリーミングが有効である場合、エンティティ型は関連バイナリ データなしで返されます。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-146">When streaming is enabled, entity types are returned without the related binary data.</span></span> <span data-ttu-id="fc9c2-147">この場合、サービスからのバイナリデータのデータストリームにアクセスするには、<xref:System.Data.Services.Client.DataServiceContext> クラスの <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> メソッドを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-147">In this case, you must use the <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> method of the <xref:System.Data.Services.Client.DataServiceContext> class to access the data stream for the binary data from the service.</span></span> <span data-ttu-id="fc9c2-148">同様に、<xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> メソッドを使用して、エンティティのバイナリ データをストリームとして追加または変更します。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-148">Similarly, use the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method to add or change binary data for an entity as a stream.</span></span> <span data-ttu-id="fc9c2-149">詳細については、「[バイナリデータの操作](working-with-binary-data-wcf-data-services.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fc9c2-149">For more information, see [Working with Binary Data](working-with-binary-data-wcf-data-services.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="fc9c2-150">参照</span><span class="sxs-lookup"><span data-stu-id="fc9c2-150">See also</span></span>

- [<span data-ttu-id="fc9c2-151">WCF Data Services クライアント ライブラリ</span><span class="sxs-lookup"><span data-stu-id="fc9c2-151">WCF Data Services Client Library</span></span>](wcf-data-services-client-library.md)
- [<span data-ttu-id="fc9c2-152">データ サービスに対するクエリ</span><span class="sxs-lookup"><span data-stu-id="fc9c2-152">Querying the Data Service</span></span>](querying-the-data-service-wcf-data-services.md)
