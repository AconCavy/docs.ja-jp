---
title: プラットフォームのセキュリティ戦略
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- platform security model [WPF]
- Common Language Runtime (CLR) security features
- operating system security model [WPF]
- Internet Explorer security features [WPF]
- Security-Critical method
- CLR security features [WPF]
- security model [WPF]
- security model [WPF], platform
- WPF [WPF], about security model
- Windows Presentation Foundation [WPF], about security model
- security model [WPF], operating system
ms.assetid: 2a39a054-3e2a-4659-bcb7-8bcea490ba31
ms.openlocfilehash: 258fcd7c51ea59de03fe60a4eeb9a82dd1c7efca
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/12/2020
ms.locfileid: "79174603"
---
# <a name="wpf-security-strategy---platform-security"></a>WPF のセキュリティ方針 - プラットフォーム セキュリティ
Windows プレゼンテーションファンデーション (WPF) は、さまざまなセキュリティ サービスを提供していますが、オペレーティング システム、CLR、および Internet Explorer を含む、基盤となるプラットフォームのセキュリティ機能も利用します。 これらの層は、WPF に強力な多層防御セキュリティ モデルを提供するために組み合わされ、次の図に示すように、単一障害点を回避しようとします。  
  
 ![WPF セキュリティ モデルを示す図。](./media/wpf-security-strategy-platform-security/windows-presentation-foundation-security.png)  
  
 このトピックの残りの部分では、WPF に特に関連する各層の機能について説明します。  

## <a name="operating-system-security"></a>オペレーティング システムのセキュリティ  
Windows のコアには、WPF で構築されたアプリケーションを含め、すべての Windows アプリケーションのセキュリティ基盤となるセキュリティ機能がいくつか用意されています。 このトピックでは、WPF にとって重要なこれらのセキュリティ機能の幅と、WPF が多層防御を提供するために WPF を統合する方法について説明します。  
  
### <a name="microsoft-windows-xp-service-pack-2-sp2"></a>Microsoft Windows XP Service Pack 2 (SP2)  
 Windows の一般的なレビューと強化に加えて、このトピックで説明する Windows XP SP2 の 3 つの主要な機能があります。  
  
- /GS のコンパイル  
  
- マイクロソフトの更新プログラム。  
  
#### <a name="gs-compilation"></a>/GS のコンパイル  
 Windows XP SP2 では、CLR などの WPF の依存関係をすべて含む多くのコア システム ライブラリを再コンパイルして、バッファ オーバーランを軽減することで保護を提供します。 これは、C や C++ のコマンド ライン コンパイラの /GS パラメーターを使用して実現されます。 バッファー オーバーランを明示的に避ける必要はありますが、/GS コンパイルは、故意であるかないかにかかわらずバッファー オーバーランによって生み出される潜在的な脆弱性に対する多重防御の一例となります。  
  
 従来、バッファー オーバーランは、影響が大きいセキュリティ攻撃の多くの原因となっていました。 バッファー オーバーランは、バッファーの境界を超えて書き込む、悪意のあるコードの挿入を許すコードの脆弱性を攻撃者が利用するときに発生します。 これにより、攻撃者はプロセスを乗っ取ることができます。この場合、コードは、攻撃者のコードを実行するように関数のリターン アドレスを上書きすることで実行されます。 結果として、乗っ取ったプロセスと同じ特権を持つ任意のコードを実行する悪意のあるコードが生成されます。  
  
 高いレベルでは、-GS コンパイラ フラグは、ローカル文字列バッファーを持つ関数のリターン アドレスを保護するために特別なセキュリティ Cookie を挿入することによって、いくつかの潜在的なバッファ オーバーランから保護します。 関数が返されると、セキュリティ クッキーはその前の値と比較されます。 値が変更されている場合、バッファー オーバーランが発生した可能性があるとして、プロセスはエラー状態によって停止されます。 プロセスの停止により、悪意のある可能性があるコードの実行を防止できます。 詳細については[、-GS (バッファセキュリティチェック)](/cpp/build/reference/gs-buffer-security-check)を参照してください。  
  
 WPF は /GS フラグを使用してコンパイルされ、さらに別の防御層を WPF アプリケーションに追加します。  
  
### <a name="windows-vista"></a>Windows Vista  
Windows Vista の WPF ユーザーは、オペレーティング システムのセキュリティ強化の利点を活用できます。  
  
#### <a name="user-account-control-uac"></a>ユーザー アカウント制御 [UAC]  
 現在、Windows ユーザーは、多くのアプリケーションがインストールまたは実行、またはその両方に対して管理者特権で実行する傾向があります。 既定のアプリケーションの設定をレジストリに書き込めることが、その一例です。  
  
 管理者特権で実行することの本当の意味は、管理者特権を付与されているプロセスからアプリケーションを実行することです。 これによるセキュリティへの影響は、管理者特権で実行するプロセスを乗っ取る悪意のあるコードが、重要なシステム リソースへのアクセスなど、これらの権限を自動的に継承することです。  
  
 このセキュリティの脅威から保護するための 1 つの方法は、必要最小限の特権でアプリケーションを実行することです。 これは最小特権の原則と呼ばれ、Windows オペレーティング システムのコア機能です。 この機能はユーザー アカウント制御 (UAC) と呼ばれ、次の 2 つの主要な方法で Windows UAC で使用されます。  
  
- ユーザーが管理者であっても、既定で UAC 特権を持つほとんどのアプリケーションを実行するために、管理者特権を必要とするアプリケーションのみが管理者特権で実行されます。 管理者特権で実行するためには、アプリケーションは、アプリケーション マニフェストで、またはセキュリティ ポリシーのエントリとして明示的にマークされる必要があります。  
  
- 仮想化のような互換性に関する解決策を提供します。 たとえば、多くのアプリケーションが C:\Program Files のような制限された場所への書き込みを試みるなどです。 UAC の下で実行するアプリケーションでは、書き込みに管理者特権が必要でない、ユーザーごとの代替の場所が存在します。 UAC の下で実行するアプリケーションでは、UAC は C:\Program Files を仮想化して、書き込もうとしているアプリケーションが、実際はユーザーごとの代替の場所に書き込むようにします。 このような互換性の作業により、オペレーティング システムは、以前は UAC で実行できなかった多くのアプリケーションを実行できるようになります。  
  
#### <a name="code-integrity-checks"></a>コードの整合性チェック  
 Windows Vista では、より深いコード整合性チェックが組み込まれており、悪意のあるコードが読み込み/実行時にシステム ファイルやカーネルに挿入されるのを防ぎます。 これは、システム ファイルの保護を超えて動作します。  

### <a name="limited-rights-process-for-browser-hosted-applications"></a>ブラウザーでホストされるアプリケーションの制限付き権限のプロセス  
 ブラウザーホスト WPF アプリケーションは、インターネット ゾーンサンドボックス内で実行されます。 WPF とインターネット エクスプローラとの統合により、この保護が強化され、サポートが強化されます。  
  
 XAML ブラウザー アプリケーション (XBaps) は、一般にインターネット ゾーンのアクセス許可セットによってサンドボックス化されるため、これらの特権を削除しても、互換性の観点から XAML ブラウザー アプリケーション (XBaps) に悪影響を及ぼすわけではありません。 代わりに、追加の多重防御層が作成されます。セキュリティで保護されたアプリケーションが他のレイヤーを利用してプロセスを乗っ取ることができる場合、プロセスの特権は制限されたままとなります。  
  
 [最小限の特権を持つユーザー アカウントの使用](https://docs.microsoft.com/previous-versions/tn-archive/cc700846%28v=technet.10%29)を参照してください。  
  
## <a name="common-language-runtime-security"></a>共通言語ランタイムのセキュリティ  
 共通言語ランタイム (CLR) には、検証と検証、コード アクセス セキュリティ (CAS)、およびセキュリティ クリティカルな方法論など、多くの主要なセキュリティ上の利点があります。  

### <a name="validation-and-verification"></a>確認と検証  
 CLR は、アセンブリの分離と整合性を提供するために、検証プロセスを使用します。 CLR 検証では、アセンブリの外部を指すアドレスのポータブル実行可能 (PE) ファイル形式を検証することによって、アセンブリが分離されます。 CLR 検証では、アセンブリ内に埋め込まれているメタデータの整合性も検証されます。  
  
 タイプ セーフを確保し、一般的なセキュリティ問題 (バッファー オーバーランなど) を防ぐ、サブプロセス分離によるサンドボックス化を実現するために、CLR セキュリティは検証の概念を使用します。  
  
 マネージド アプリケーションは、Microsoft Intermediate Language (MSIL) にコンパイルされます。 マネージド アプリケーション内のメソッドを実行する際、その MSIL は Just-In-Time (JIT) コンパイルを通じてネイティブ コードにコンパイルされます。 JIT コンパイルには、コードが以下を行わないようにする多数の安全性と堅牢性ルールを適用する検証プロセスがあります。  
  
- 型のコントラクトの違反  
  
- バッファー オーバーランの導入  
  
- 乱暴なメモリへのアクセス  
  
 マネージド コードが信頼されたコードと見なされない限り、検証ルールに適合しないマネージド コードの実行は許可されません。  
  
 検証可能なコードの利点は、WPF が .NET Framework 上に構築される主な理由です。 検証可能なコードを使用する範囲で、起こりうる脆弱性の悪用の可能性が大幅に減少します。  
  
### <a name="code-access-security"></a>コード アクセス セキュリティ  
 クライアント コンピューターは、ファイル システム、レジストリ、印刷サービス、ユーザー インターフェイス、リフレクション、および環境変数など、マネージド アプリケーションがアクセスできる多種多様なリソースを公開します。 マネージ アプリケーションがクライアント コンピューター上のリソースにアクセスするには、その前に .NET Framework アクセス許可が必要です。 CAS のアクセス許可は、 のサブ<xref:System.Security.CodeAccessPermission>クラスです。CAS は、マネージ アプリケーションがアクセスできるリソースごとに 1 つのサブクラスを実装します。  
  
 CAS が実行を開始するときに、CAS によって付与されるアクセス許可のセットは、アクセス許可セットと呼ばれ、アプリケーションによって提供される証拠によって決定されます。 WPF アプリケーションの場合、提供される証拠は、アプリケーションが起動される場所またはゾーンです。 CAS は、次のゾーンを識別します。  
  
- **マイコンピュータ**. クライアント コンピューターから起動するアプリケーション (完全信頼)。  
  
- **ローカル イントラネット**。 イントラネットから起動するアプリケーション。 (部分信頼)。  
  
- **インターネット**. インターネットから起動するアプリケーション。 (最小信頼)。  
  
- **信頼済みサイト**: ユーザーから信頼すると特定されたアプリケーション。 (最小信頼)。  
  
- **信頼されないサイト**。 ユーザーから信頼しないと特定されたアプリケーション。 (非信頼)。  
  
 これらの各ゾーンに対して、CAS は、それぞれに関連付けられている信頼レベルに一致するアクセス許可を含む定義済みのアクセス許可セットを提供します。 チェックの内容は次のとおりです  
  
- **FullTrust**。 **マイ コンピュータ**ゾーンから起動されたアプリケーションの場合。 可能性のあるすべてのアクセス許可が付与されます。  
  
- **LocalIntranet**。 **ローカル イントラネット**ゾーンから起動されたアプリケーションの場合。 分離ストレージ、UI の無制限のアクセス、制約のないファイル ダイアログ、制限付きのリフレクション、環境変数へのアクセス制限など、クライアント コンピューターのリソースへの中程度のアクセスを提供するアクセス許可のサブセットが付与されます。 レジストリのような重要なリソースに対するアクセス許可は提供されません。  
  
- **インターネット**. **インターネット**または**信頼済みサイト**ゾーンから起動されたアプリケーションの場合。 分離ストレージ、ファイルを開くのみ、および制限付きの UI など、クライアント コンピューターに制限付きのアクセス権を付与するため、アクセス許可のサブセットを付与します。 基本的に、このアクセス許可セットは、クライアント コンピューターからアプリケーションを分離します。  
  
 **信頼されていないサイト**ゾーンから識別されたアプリケーションには、CAS によってアクセス許可がまったく付与されません。 その結果、定義済みのアクセス許可セットは存在しません。  
  
 次の図は、ゾーン、アクセス権セット、アクセス許可、およびリソースの関係を示しています。  
  
 ![CAS アクセス許可セットを示す図。](./media/wpf-security-strategy-platform-security/code-access-security-permissions-relationship.png)  
  
 インターネット ゾーン セキュリティ サンドボックスの制限は、XBAP がシステム ライブラリからインポートするコード (WPF を含む) にも同様に適用されます。 これにより、WPF でもコードのすべてのビットがロックダウンされます。 残念ながら、XBAP を実行するには、インターネット ゾーンセキュリティサンドボックスで有効になっている権限よりも多くのアクセス許可を必要とする機能を実行する必要があります。  
  
 次のページを含む XBAP アプリケーションを考えてみます。  
  
 [!code-csharp[WPFPlatformSecuritySnippets#Permission](~/samples/snippets/csharp/VS_Snippets_Wpf/WPFPlatformSecuritySnippets/CSharp/Page1.xaml.cs#permission)]
 [!code-vb[WPFPlatformSecuritySnippets#Permission](~/samples/snippets/visualbasic/VS_Snippets_Wpf/WPFPlatformSecuritySnippets/VisualBasic/Page1.xaml.vb#permission)]  
  
 この XBAP を実行するには、基になる WPF コードが呼び出し元の XBAP で使用できる機能よりも多くの機能を実行する必要があります。  
  
- レンダリング用のウィンドウ ハンドル (HWND) の作成  
  
- メッセージのディスパッチ  
  
- Tahoma フォントの読み込み  
  
 セキュリティの観点から、セキュリティで保護されたアプリケーションからこれらの操作のいずれかに直接アクセスを許可すると、致命的な状態になります。  
  
 さいわい、WPF は、サンドボックス化されたアプリケーションに代わって、これらの操作を昇格された特権で実行できるようにすることで、このような状況に対応します。 すべての WPF 操作は、XBAP のアプリケーション ドメインの制限されたインターネット ゾーン セキュリティ アクセス許可に対してチェックされますが、WPF には、可能なすべてのアクセス許可を含むアクセス許可セットが付与されます ( 他のシステム ライブラリと同様 ) 。
  
 このためには、WPF が昇格された特権を受け取る一方で、ホスト アプリケーション ドメインのインターネット ゾーンアクセス許可セットによって管理されないようにする必要があります。  
  
 WPF では、アクセス許可の**Assert**メソッドを使用してこれを行います。 次のコードは、その方法を示しています。  
  
 [!code-csharp[WPFPlatformSecuritySnippets#Permission](~/samples/snippets/csharp/VS_Snippets_Wpf/WPFPlatformSecuritySnippets/CSharp/Page1.xaml.cs#permission)]
 [!code-vb[WPFPlatformSecuritySnippets#Permission](~/samples/snippets/visualbasic/VS_Snippets_Wpf/WPFPlatformSecuritySnippets/VisualBasic/Page1.xaml.vb#permission)]  
  
 **アサート**は、基本的に WPF で必要とされる無制限のアクセス許可が XBAP のインターネット ゾーンアクセス許可によって制限されることを防ぎます。  
  
 プラットフォームの観点から見ると、WPF は**アサート**を正しく使用する役割を担います。**Assert**を誤って使用すると、悪意のあるコードが特権を昇格する可能性があります。 したがって、必要な場合にのみ**Assert**を呼び出し、サンドボックスの制限がそのまま残るようにすることが重要です。 たとえば、セキュリティで保護されたコードでは、ランダムなファイルを開くことはできませんが、フォントは使用できます。 WPF では、サンドボックス アプリケーションは**Assert**を呼び出してフォント機能を使用し、WPF では、サンドボックス アプリケーションの代わりにそれらのフォントが含まれていることがわかっているファイルを読み取ることができます。  
  
### <a name="clickonce-deployment"></a>ClickOnce の配置  
 ClickOnce は、.NET Framework に含まれる包括的な展開テクノロジであり、Visual Studio と統合されています (詳細については[、「ClickOnce のセキュリティと展開](/visualstudio/deployment/clickonce-security-and-deployment)」を参照してください)。 スタンドアロン WPF アプリケーションは ClickOnce を使用して展開できますが、ブラウザーホストアプリケーションは ClickOnce を使用して配置する必要があります。  
  
 ClickOnce を使用して配置されたアプリケーションには、コード アクセス セキュリティ (CAS) に対する追加のセキュリティ層が与えられます。基本的に、ClickOnce 配置されたアプリケーションは、必要なアクセス許可を要求します。 これらのアプリケーションが、アプリケーションの配置元ゾーンのアクセス許可セット数を超えていない場合、これらのアプリケーションには必要なアクセス許可のみが付与されます。 アクセス許可セットを必要なアクセス許可のみに減らすことで、起動ゾーンのアクセス許可セットで提供されるアクセス許可よりも少ない場合でも、アプリケーションがアクセスできるリソースの数は最小限に抑えられます。 その結果、アプリケーションが乗っ取られた場合、クライアント コンピューターの損傷の可能性が低減します。  
  
### <a name="security-critical-methodology"></a>セキュリティ クリティカルな方法  
 XBAP アプリケーションのインターネット ゾーンサンドボックスを有効にするアクセス許可を使用する WPF コードは、セキュリティ監査と制御の可能な限り最高のレベルに保持する必要があります。 この要件を容易にするために、.NET Framework では、特権を昇格させるコードの管理に関する新しいサポートが提供されています。 具体的には、 CLR を使用すると、特権を昇格するコードを識別し<xref:System.Security.SecurityCriticalAttribute>、 でマークを付けます。マークが付いていない<xref:System.Security.SecurityCriticalAttribute>コードは、この方法を使用して*透過的*になります。 逆に、<xref:System.Security.SecurityCriticalAttribute> でマークされていないマネージド コードは特権の昇格ができなくなります。  
  
 セキュリティ クリティカルな方法論では、特権を*セキュリティ クリティカルなカーネル*に昇格させる WPF コードを組織でき、残りは透過的です。 セキュリティ クリティカルなコードを分離することで、WPF エンジニアリング チームは、標準のセキュリティプラクティスを超えてセキュリティ クリティカルなカーネルに追加のセキュリティ分析とソースコントロールを集中させることができます[(WPF セキュリティ戦略 - セキュリティ エンジニアリング](wpf-security-strategy-security-engineering.md)を参照)。  
  
 .NET Framework では、開発者が (APTCA) で<xref:System.Security.AllowPartiallyTrustedCallersAttribute>マークされ、ユーザーのグローバル アセンブリ キャッシュ (GAC) に配置されたマネージ アセンブリを開発者が記述できるようにして、信頼されたコードで XBAP インターネット ゾーンサンドボックスを拡張できます。 アセンブリを APTCA でマークすることは、機密性の高いセキュリティ操作です。インターネットからの悪意のあるコードなど、いずれのコードもそのアセンブリを呼び出すことができるためです。 これを実施する際は十分注意し、ベスト プラクティスを使用する必要があります。ソフトウェアをインストールするためには、ユーザーがそのソフトウェアを信頼することを選択する必要があります。  
  
## <a name="microsoft-internet-explorer-security"></a>Microsoft Internet Explorer のセキュリティ  
 Microsoft Internet Explorer 6 (SP2) には、セキュリティの問題を軽減し、セキュリティ構成を簡略化するだけでなく、XAML ブラウザ アプリケーション (XAAP) のユーザーのセキュリティを強化するセキュリティ強化機能がいくつか含まれています。 これらの機能の推進により、ユーザーが閲覧の制御を拡大できるようにしています。  
  
 IE6 SP2 より前のバージョンでは、ユーザーは次のいずれかの対象となる可能性があります。  
  
- ランダムなポップアップ ウィンドウ。  
  
- スクリプトのリダイレクトの混乱。  
  
- 一部の Web サイトでの多数のセキュリティ ダイアログ。  
  
 場合によっては、信頼できない Web サイトは、ユーザーがインストールをキャンセルした可能性[!INCLUDE[TLA#tla_ui](../../../includes/tlasharptla-ui-md.md)]があるにもかかわらず、インストールを偽装したり、Microsoft ActiveX インストール ダイアログ ボックスを繰り返し表示したりして、ユーザーをだまそうとします。 これらの方法によって、大多数のユーザーが騙されて不適切な判断を行い、スパイウェア アプリケーションのインストールにつながる可能性があります。  
  
 IE6 SP2 には、ユーザーの開始という概念を中心に展開される、このような問題を軽減するためのいくつかの機能が含まれています。 IE6 SP2 は、アクションの前にユーザーがリンクまたはページ要素をクリックしたことを検出します。 *user initiation* たとえば、IE6 SP2 には、ポップアップを作成する前にユーザーがボタンをクリックしたときに検出するポップアップ**ブロック機能**が組み込まれています。 これにより、IE6 SP2 は、ユーザーが求めたり望まなかったポップアップを防ぎながら、ほとんどの無害なポップアップを許可できます。 ブロックされたポップアップは新しい**情報バー**の下にトラップされ、ユーザーは手動でブロックを上書きしてポップアップを表示できます。  
  
 同じユーザー開始ロジックは、**オープン**/**保存**セキュリティプロンプトにも適用されます。 ActiveX のインストール ダイアログ ボックスは、以前にインストールされたコントロールからのアップグレードを表す場合を除き、常に情報バーの下に閉じ込められます。 これらの対策を組み合わせると、より安全かつ制御されたユーザー エクスペリエンスがユーザーに提供されます。ユーザーを攻撃して不要または悪意のあるソフトウェアをインストールさせるサイトからユーザーが保護されるためです。  
  
 これらの機能は、IE6 SP2 を使用して、WPF アプリケーションのダウンロードとインストールを可能にする Web サイトを参照するお客様を保護します。 特に、IE6 SP2 は、ユーザーが、WPF を含め、そのアプリケーションを構築するために使用されたテクノロジに関係なく、悪意のあるアプリケーションや悪質なアプリケーションをインストールする機会を減らす、より優れたユーザー エクスペリエンスを提供するためです。 WPF では、ClickOnce を使用してこれらの保護機能を強化し、インターネット経由でのアプリケーションのダウンロードを容易にします。 XAML ブラウザー アプリケーション (XBaap) はインターネット ゾーンのセキュリティ サンドボックス内で実行されるため、シームレスに起動できます。 一方、スタンドアロン WPF アプリケーションを実行するには完全な信頼が必要です。 これらのアプリケーションの場合、ClickOnce は起動プロセス中に、アプリケーションの追加のセキュリティ要件の使用を通知するセキュリティ ダイアログ ボックスを表示します。 ただし、これはユーザーが開始する必要があり、ユーザーが開始したロジックによって制御されるとともに、キャンセルが可能です。  
  
 Internet Explorer 7 では、セキュリティに対する継続的な取り組みの一環として、IE6 SP2 のセキュリティ機能を組み込み、拡張しています。  
  
## <a name="see-also"></a>関連項目

- [コード アクセス セキュリティ](../misc/code-access-security.md)
- [セキュリティ](security-wpf.md)
- [WPF 部分信頼セキュリティ](wpf-partial-trust-security.md)
- [WPF のセキュリティ方針 - セキュリティ エンジニアリング](wpf-security-strategy-security-engineering.md)
