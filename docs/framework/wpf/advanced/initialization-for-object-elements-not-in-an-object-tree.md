---
title: オブジェクト ツリーに存在しないオブジェクト要素の初期化
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- logical tree [WPF]
- visual tree [WPF]
- elements [WPF], initializing
- initializing elements [WPF]
ms.assetid: 7b8dfc9b-46ac-4ce8-b7bb-035734d688b7
ms.openlocfilehash: 1a1d956ee7f41ac1ac0fc9bd051a18b9ff438930
ms.sourcegitcommit: 944ddc52b7f2632f30c668815f92b378efd38eea
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/03/2019
ms.locfileid: "73459836"
---
# <a name="initialization-for-object-elements-not-in-an-object-tree"></a><span data-ttu-id="b32b6-102">オブジェクト ツリーに存在しないオブジェクト要素の初期化</span><span class="sxs-lookup"><span data-stu-id="b32b6-102">Initialization for Object Elements Not in an Object Tree</span></span>
<span data-ttu-id="b32b6-103">[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] の初期化処理では、プロセスに処理を委任することがあり、そのプロセスは、一般的にその要素が論理ツリーまたはビジュアル ツリーのいずれかに接続されていることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="b32b6-103">Some aspects of [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] initialization are deferred to processes that typically rely on that element being connected to either the logical tree or visual tree.</span></span> <span data-ttu-id="b32b6-104">このトピックでは、どちらのツリーにも接続されていない要素を初期化するために必要となる場合がある手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="b32b6-104">This topic describes the steps that may be necessary in order to initialize an element that is not connected to either tree.</span></span>  

## <a name="elements-and-the-logical-tree"></a><span data-ttu-id="b32b6-105">要素と論理ツリー</span><span class="sxs-lookup"><span data-stu-id="b32b6-105">Elements and the Logical Tree</span></span>  
 <span data-ttu-id="b32b6-106">コード内で [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] クラスのインスタンスを作成するときは、[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] クラスのオブジェクト初期化処理の一部が、クラス コンストラクターの呼び出し時に実行されるコードから意図的に除外されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="b32b6-106">When you create an instance of a [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] class in code, you should be aware that several aspects of object initialization for a [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] class are deliberately not a part of the code that is executed when calling the class constructor.</span></span> <span data-ttu-id="b32b6-107">特に、コントロール クラスの場合は、コントロールの視覚的表現のほとんどが、コンストラクターでは定義されません。</span><span class="sxs-lookup"><span data-stu-id="b32b6-107">Particularly for a control class, most of the visual representation of that control is not defined by the constructor.</span></span> <span data-ttu-id="b32b6-108">代わりに、視覚的表現は、コントロールのテンプレートによって定義されます。</span><span class="sxs-lookup"><span data-stu-id="b32b6-108">Instead, the visual representation is defined by the control's template.</span></span> <span data-ttu-id="b32b6-109">このテンプレートのソースには、さまざまなものがありますが、ほとんどの場合は、テーマ スタイルから取得されます。</span><span class="sxs-lookup"><span data-stu-id="b32b6-109">The template potentially comes from a variety of sources, but most often the template is obtained from theme styles.</span></span> <span data-ttu-id="b32b6-110">テンプレートは、実質的には遅延バインディングです。そのコントロールがレイアウト可能になるまで、必要なテンプレートはコントロールに適用されません。</span><span class="sxs-lookup"><span data-stu-id="b32b6-110">Templates are effectively late-binding; the necessary template is not attached to the control in question until the control is ready for layout.</span></span> <span data-ttu-id="b32b6-111">コントロールは、ルートでレンダリングするための表面に接続される論理ツリーに適用されるまで、レイアウトが可能になりません。</span><span class="sxs-lookup"><span data-stu-id="b32b6-111">And the control is not ready for layout until it is attached to a logical tree that connects to a rendering surface at the root.</span></span> <span data-ttu-id="b32b6-112">このルート レベル要素によって、論理ツリーで定義されているすべての子要素のレンダリングが開始されます。</span><span class="sxs-lookup"><span data-stu-id="b32b6-112">It is that root-level element that initiates the rendering of all of its child elements as defined in the logical tree.</span></span>  
  
 <span data-ttu-id="b32b6-113">このプロセスには、ビジュアル ツリーも関与します。</span><span class="sxs-lookup"><span data-stu-id="b32b6-113">The visual tree also participates in this process.</span></span> <span data-ttu-id="b32b6-114">テンプレートによってビジュアル ツリーに組み込まれる要素も、接続されるまでは完全にインスタンス化されません。</span><span class="sxs-lookup"><span data-stu-id="b32b6-114">Elements that are part of the visual tree through the templates are also not fully instantiated until connected.</span></span>  
  
 <span data-ttu-id="b32b6-115">この動作の影響で、要素の視覚的特性がすべて揃っていることを前提とする特定の操作には、追加の手順が必要になります。</span><span class="sxs-lookup"><span data-stu-id="b32b6-115">The consequences of this behavior are that certain operations that rely on the completed visual characteristics of an element require additional steps.</span></span> <span data-ttu-id="b32b6-116">構築されているが、まだツリーに適用されていないクラスの視覚的特性を取得しようとする場合などが、その例です。</span><span class="sxs-lookup"><span data-stu-id="b32b6-116">An example is if you are attempting to get the visual characteristics of a class that was constructed but not yet attached to a tree.</span></span> <span data-ttu-id="b32b6-117">たとえば、<xref:System.Windows.Media.Imaging.RenderTargetBitmap> で <xref:System.Windows.Media.Imaging.RenderTargetBitmap.Render%2A> を呼び出す必要があり、渡そうとしているビジュアルがツリーに接続されていない要素である場合は、追加の初期化手順が完了するまで、その要素は視覚的に完成されません。</span><span class="sxs-lookup"><span data-stu-id="b32b6-117">For instance, if you want to call <xref:System.Windows.Media.Imaging.RenderTargetBitmap.Render%2A> on a <xref:System.Windows.Media.Imaging.RenderTargetBitmap> and the visual you are passing is an element not connected to a tree, that element is not visually complete until additional initialization steps are completed.</span></span>  
  
### <a name="using-begininit-and-endinit-to-initialize-the-element"></a><span data-ttu-id="b32b6-118">BeginInit と EndInit を使用して要素を初期化する</span><span class="sxs-lookup"><span data-stu-id="b32b6-118">Using BeginInit and EndInit to Initialize the Element</span></span>  
 <span data-ttu-id="b32b6-119">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] のさまざまなクラスでは、<xref:System.ComponentModel.ISupportInitialize> インターフェイスが実装されます。</span><span class="sxs-lookup"><span data-stu-id="b32b6-119">Various classes in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] implement the <xref:System.ComponentModel.ISupportInitialize> interface.</span></span> <span data-ttu-id="b32b6-120">このインターフェイスの <xref:System.ComponentModel.ISupportInitialize.BeginInit%2A> メソッドと <xref:System.ComponentModel.ISupportInitialize.EndInit%2A> メソッドを使用して、初期化手順を含むコード内の領域を表します (たとえば、レンダリングに影響を与えるプロパティ値の設定)。</span><span class="sxs-lookup"><span data-stu-id="b32b6-120">You use the <xref:System.ComponentModel.ISupportInitialize.BeginInit%2A> and <xref:System.ComponentModel.ISupportInitialize.EndInit%2A> methods of the interface to denote a region in your code that contains initialization steps (such as setting property values that affect rendering).</span></span> <span data-ttu-id="b32b6-121">シーケンス内で <xref:System.ComponentModel.ISupportInitialize.EndInit%2A> が呼び出された後に、レイアウト システムは要素を処理し、暗黙的スタイルの検索を開始します。</span><span class="sxs-lookup"><span data-stu-id="b32b6-121">After <xref:System.ComponentModel.ISupportInitialize.EndInit%2A> is called in the sequence, the layout system can process the element and start looking for an implicit style.</span></span>  
  
 <span data-ttu-id="b32b6-122">プロパティの設定しようとしている要素が <xref:System.Windows.FrameworkElement> または <xref:System.Windows.FrameworkContentElement> 派生クラスである場合は、<xref:System.ComponentModel.ISupportInitialize> にキャストするのではなく、<xref:System.Windows.FrameworkElement.BeginInit%2A> と <xref:System.Windows.FrameworkElement.EndInit%2A> のクラス バージョンを呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="b32b6-122">If the element you are setting properties on is a <xref:System.Windows.FrameworkElement> or <xref:System.Windows.FrameworkContentElement> derived class, then you can call the class versions of <xref:System.Windows.FrameworkElement.BeginInit%2A> and <xref:System.Windows.FrameworkElement.EndInit%2A> rather than casting to <xref:System.ComponentModel.ISupportInitialize>.</span></span>  
  
### <a name="sample-code"></a><span data-ttu-id="b32b6-123">サンプル コード</span><span class="sxs-lookup"><span data-stu-id="b32b6-123">Sample Code</span></span>  
 <span data-ttu-id="b32b6-124">次の例は、ルーズ [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] ファイルのレンダリング API と <xref:System.Windows.Markup.XamlReader.Load%28System.IO.Stream%29?displayProperty=nameWithType> を使用して、レンダリングに影響を与えるプロパティを調整する他の API 呼び出しの周辺への <xref:System.Windows.FrameworkElement.BeginInit%2A> と <xref:System.Windows.FrameworkElement.EndInit%2A> の適切な配置を示すコンソール アプリケーションのサンプル コードです。</span><span class="sxs-lookup"><span data-stu-id="b32b6-124">The following example is sample code for a console application that uses rendering APIs and <xref:System.Windows.Markup.XamlReader.Load%28System.IO.Stream%29?displayProperty=nameWithType> of a loose [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file to illustrate the proper placement of <xref:System.Windows.FrameworkElement.BeginInit%2A> and <xref:System.Windows.FrameworkElement.EndInit%2A> around other API calls that adjust properties that affect rendering.</span></span>  
  
 <span data-ttu-id="b32b6-125">この例では、main 関数のみを示します。</span><span class="sxs-lookup"><span data-stu-id="b32b6-125">The example illustrates the main function only.</span></span> <span data-ttu-id="b32b6-126">関数 `Rasterize` および `Save` (この例には示していません) は、イメージ処理および入出力を扱うユーティリティ関数です。</span><span class="sxs-lookup"><span data-stu-id="b32b6-126">The functions `Rasterize` and `Save` (not shown) are utility functions that take care of image processing and IO.</span></span>  
  
 [!code-csharp[InitializeElements#Main](~/samples/snippets/csharp/VS_Snippets_Wpf/InitializeElements/CSharp/initializeelements.cs#main)]
 [!code-vb[InitializeElements#Main](~/samples/snippets/visualbasic/VS_Snippets_Wpf/InitializeElements/VisualBasic/initializeelements.vb#main)]  
  
## <a name="see-also"></a><span data-ttu-id="b32b6-127">関連項目</span><span class="sxs-lookup"><span data-stu-id="b32b6-127">See also</span></span>

- [<span data-ttu-id="b32b6-128">WPF のツリー</span><span class="sxs-lookup"><span data-stu-id="b32b6-128">Trees in WPF</span></span>](trees-in-wpf.md)
- [<span data-ttu-id="b32b6-129">WPF グラフィックス レンダリングの概要</span><span class="sxs-lookup"><span data-stu-id="b32b6-129">WPF Graphics Rendering Overview</span></span>](../graphics-multimedia/wpf-graphics-rendering-overview.md)
- [<span data-ttu-id="b32b6-130">XAML の概要 (WPF)</span><span class="sxs-lookup"><span data-stu-id="b32b6-130">XAML Overview (WPF)</span></span>](../../../desktop-wpf/fundamentals/xaml.md)
