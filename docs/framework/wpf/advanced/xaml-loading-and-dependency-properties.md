---
title: XAML 読み込みと依存関係プロパティ
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- custom dependency properties [WPF]
- dependency properties [WPF], XAML loading and
- loading XML data [WPF]
ms.assetid: 6eea9f4e-45ce-413b-a266-f08238737bf2
ms.openlocfilehash: de8050e582f5b1a5a288c350c179cfa24fb5471c
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/12/2020
ms.locfileid: "79186248"
---
# <a name="xaml-loading-and-dependency-properties"></a><span data-ttu-id="0e8ba-102">XAML 読み込みと依存関係プロパティ</span><span class="sxs-lookup"><span data-stu-id="0e8ba-102">XAML Loading and Dependency Properties</span></span>
<span data-ttu-id="0e8ba-103">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] での [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] プロセッサの現在の実装では、本質的に依存関係プロパティが認識されます。</span><span class="sxs-lookup"><span data-stu-id="0e8ba-103">The current [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] implementation of its [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] processor is inherently dependency property aware.</span></span> <span data-ttu-id="0e8ba-104">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] の [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] プロセッサでは、バイナリ [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] を読み込み、依存関係プロパティである属性を処理するときに、依存関係プロパティに対するプロパティ システム メソッドが使用されます。</span><span class="sxs-lookup"><span data-stu-id="0e8ba-104">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] processor uses property system methods for dependency properties when loading binary [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] and processing attributes that are dependency properties.</span></span> <span data-ttu-id="0e8ba-105">これにより、プロパティ ラッパーは実質的にバイパスされます。</span><span class="sxs-lookup"><span data-stu-id="0e8ba-105">This effectively bypasses the property wrappers.</span></span> <span data-ttu-id="0e8ba-106">カスタム依存関係プロパティを実装するときは、この動作について考慮する必要があります。また、プロパティ ラッパーには、プロパティ システム メソッド <xref:System.Windows.DependencyObject.GetValue%2A> および <xref:System.Windows.DependencyObject.SetValue%2A> 以外の他のコードを配置しないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="0e8ba-106">When you implement custom dependency properties, you must account for this behavior and should avoid placing any other code in your property wrapper other than the property system methods <xref:System.Windows.DependencyObject.GetValue%2A> and <xref:System.Windows.DependencyObject.SetValue%2A>.</span></span>  

<a name="prerequisites"></a>
## <a name="prerequisites"></a><span data-ttu-id="0e8ba-107">必須コンポーネント</span><span class="sxs-lookup"><span data-stu-id="0e8ba-107">Prerequisites</span></span>  
 <span data-ttu-id="0e8ba-108">このトピックは、利用者と作成者の両方として依存関係プロパティを理解しており、「[依存関係プロパティの概要](dependency-properties-overview.md)」と「[カスタム依存関係プロパティ](custom-dependency-properties.md)」を読んでいることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="0e8ba-108">This topic assumes that you understand dependency properties both as consumer and author and have read [Dependency Properties Overview](dependency-properties-overview.md) and [Custom Dependency Properties](custom-dependency-properties.md).</span></span> <span data-ttu-id="0e8ba-109">また、「[XAML の概要 (WPF)](../../../desktop-wpf/fundamentals/xaml.md)」と「[XAML 構文の詳細](xaml-syntax-in-detail.md)」も読んでおく必要があります。</span><span class="sxs-lookup"><span data-stu-id="0e8ba-109">You should also have read [XAML Overview (WPF)](../../../desktop-wpf/fundamentals/xaml.md) and [XAML Syntax In Detail](xaml-syntax-in-detail.md).</span></span>  
  
<a name="implementation"></a>
## <a name="the-wpf-xaml-loader-implementation-and-performance"></a><span data-ttu-id="0e8ba-110">WPF XAML ローダーの実装とパフォーマンス</span><span class="sxs-lookup"><span data-stu-id="0e8ba-110">The WPF XAML Loader Implementation, and Performance</span></span>  
 <span data-ttu-id="0e8ba-111">実装上の理由から、プロパティ ラッパーとそのセッターを使用するのではなく、プロパティを依存関係プロパティとして識別し、プロパティ システムの <xref:System.Windows.DependencyObject.SetValue%2A> メソッドを使用してプロパティを設定する方が、計算がより低コストになります。</span><span class="sxs-lookup"><span data-stu-id="0e8ba-111">For implementation reasons, it is computationally less expensive to identify a property as a dependency property and access the property system <xref:System.Windows.DependencyObject.SetValue%2A> method to set it, rather than using the property wrapper and its setter.</span></span> <span data-ttu-id="0e8ba-112">これは、[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] のプロセッサでは、マークアップとさまざまな文字列の構造によって示される型とメンバーの関係に関する知識だけに基づいて、バッキング コードのオブジェクト モデル全体を推測する必要があるためです。</span><span class="sxs-lookup"><span data-stu-id="0e8ba-112">This is because a [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] processor must infer the entire object model of the backing code based only on knowing the type and member relationships that are indicated by the structure of the markup and various strings.</span></span>  
  
 <span data-ttu-id="0e8ba-113">型は xmlns 属性と assembly 属性の組み合わせによって参照されますが、メンバーを識別し、属性として設定できるサポートを判断し、プロパティ値でサポートされる型を解決するには、<xref:System.Reflection.PropertyInfo> を使用する広範なリフレクションが必要です。</span><span class="sxs-lookup"><span data-stu-id="0e8ba-113">The type is looked up through a combination of xmlns and assembly attributes, but identifying the members, determining which could support being set as an attribute, and resolving what types the property values support would otherwise require extensive reflection using <xref:System.Reflection.PropertyInfo>.</span></span> <span data-ttu-id="0e8ba-114">特定の型に対する依存関係プロパティには、プロパティ システムを通じてストレージ テーブルとしてアクセスできるため、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] による [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] プロセッサの実装では、このテーブルが使用され、依存関係プロパティ識別子 *ABCProperty* を使用して、包含する <xref:System.Windows.DependencyObject> 派生型で <xref:System.Windows.DependencyObject.SetValue%2A> を呼び出すことにより、特定のプロパティ *ABC* をより効率的に設定できることが推測されます。</span><span class="sxs-lookup"><span data-stu-id="0e8ba-114">Because dependency properties on a given type are accessible as a storage table through the property system, the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] implementation of its [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] processor uses this table and infers that any given property *ABC* can be more efficiently set by calling <xref:System.Windows.DependencyObject.SetValue%2A> on the containing <xref:System.Windows.DependencyObject> derived type, using the dependency property identifier *ABCProperty*.</span></span>  
  
<a name="implications"></a>
## <a name="implications-for-custom-dependency-properties"></a><span data-ttu-id="0e8ba-115">カスタム依存関係プロパティに対する影響</span><span class="sxs-lookup"><span data-stu-id="0e8ba-115">Implications for Custom Dependency Properties</span></span>  
 <span data-ttu-id="0e8ba-116">現在の [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] によるプロパティ設定に対する [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] プロセッサ動作の実装では、ラッパーが完全にバイパスされるため、カスタム依存関係プロパティのラッパーの set 定義に追加のロジックを含めないでください。</span><span class="sxs-lookup"><span data-stu-id="0e8ba-116">Because the current [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] implementation of the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] processor behavior for property setting bypasses the wrappers entirely, you should not put any additional logic into the set definitions of the wrapper for your custom dependency property.</span></span> <span data-ttu-id="0e8ba-117">そのようなロジックを set 定義に含めた場合、プロパティがコードではなく [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] で設定されていると、ロジックは実行されません。</span><span class="sxs-lookup"><span data-stu-id="0e8ba-117">If you put such logic in the set definition, then the logic will not be executed when the property is set in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] rather than in code.</span></span>  
  
 <span data-ttu-id="0e8ba-118">同様に、[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 処理からプロパティ値を取得する [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] プロセッサのその他の側面でも、ラッパーを使用するのではなく、<xref:System.Windows.DependencyObject.GetValue%2A> が使用されます。</span><span class="sxs-lookup"><span data-stu-id="0e8ba-118">Similarly, other aspects of the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] processor that obtain property values from [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] processing also use <xref:System.Windows.DependencyObject.GetValue%2A> rather than using the wrapper.</span></span> <span data-ttu-id="0e8ba-119">したがって、`get` 定義でも、<xref:System.Windows.DependencyObject.GetValue%2A> の呼び出し以外のものを追加して実装しないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="0e8ba-119">Therefore, you should also avoid any additional implementation in the `get` definition beyond the <xref:System.Windows.DependencyObject.GetValue%2A> call.</span></span>  
  
 <span data-ttu-id="0e8ba-120">次の例は、ラッパーでの依存関係プロパティの推奨される定義です。ここでは、プロパティ識別子は `public` `static` `readonly` フィールドとして格納されており、`get` と `set` の定義には、依存関係プロパティのバッキングを定義する必要なプロパティ システム メソッド以外のコードは含まれていません。</span><span class="sxs-lookup"><span data-stu-id="0e8ba-120">The following example is a recommended dependency property definition with wrappers, where the property identifier is stored as a `public` `static` `readonly` field, and the `get` and `set` definitions contain no code beyond the necessary property system methods that define the dependency property backing.</span></span>  
  
 [!code-csharp[WPFAquariumSln#AGWithWrapper](~/samples/snippets/csharp/VS_Snippets_Wpf/WPFAquariumSln/CSharp/WPFAquariumObjects/Class1.cs#agwithwrapper)]
 [!code-vb[WPFAquariumSln#AGWithWrapper](~/samples/snippets/visualbasic/VS_Snippets_Wpf/WPFAquariumSln/visualbasic/wpfaquariumobjects/class1.vb#agwithwrapper)]  
  
## <a name="see-also"></a><span data-ttu-id="0e8ba-121">関連項目</span><span class="sxs-lookup"><span data-stu-id="0e8ba-121">See also</span></span>

- [<span data-ttu-id="0e8ba-122">依存関係プロパティの概要</span><span class="sxs-lookup"><span data-stu-id="0e8ba-122">Dependency Properties Overview</span></span>](dependency-properties-overview.md)
- [<span data-ttu-id="0e8ba-123">XAML の概要 (WPF)</span><span class="sxs-lookup"><span data-stu-id="0e8ba-123">XAML Overview (WPF)</span></span>](../../../desktop-wpf/fundamentals/xaml.md)
- [<span data-ttu-id="0e8ba-124">依存関係プロパティのメタデータ</span><span class="sxs-lookup"><span data-stu-id="0e8ba-124">Dependency Property Metadata</span></span>](dependency-property-metadata.md)
- [<span data-ttu-id="0e8ba-125">コレクション型依存関係プロパティ</span><span class="sxs-lookup"><span data-stu-id="0e8ba-125">Collection-Type Dependency Properties</span></span>](collection-type-dependency-properties.md)
- [<span data-ttu-id="0e8ba-126">依存関係プロパティのセキュリティ</span><span class="sxs-lookup"><span data-stu-id="0e8ba-126">Dependency Property Security</span></span>](dependency-property-security.md)
- [<span data-ttu-id="0e8ba-127">DependencyObject の安全なコンストラクター パターン</span><span class="sxs-lookup"><span data-stu-id="0e8ba-127">Safe Constructor Patterns for DependencyObjects</span></span>](safe-constructor-patterns-for-dependencyobjects.md)
