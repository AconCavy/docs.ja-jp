---
title: 相互運用マーシャリング
ms.date: 03/30/2017
helpviewer_keywords:
- marshaling, COM interop
- interop marshaling
- interop marshaling, about interop marshaling
ms.assetid: 115f7a2f-d422-4605-ab36-13a8dd28142a
ms.openlocfilehash: 70514811a9d236dc485f64fc34297cdb057a1512
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/30/2019
ms.locfileid: "73124275"
---
# <a name="interop-marshaling"></a><span data-ttu-id="c9feb-102">相互運用マーシャリング</span><span class="sxs-lookup"><span data-stu-id="c9feb-102">Interop Marshaling</span></span>

<span data-ttu-id="c9feb-103">相互運用マーシャリングでは、メソッド引数と戻り値によって、呼び出し中にマネージド メモリとアンマネージド メモリの間でデータを受け渡す方法が制御されます。</span><span class="sxs-lookup"><span data-stu-id="c9feb-103">Interop marshaling governs how data is passed in method arguments and return values between managed and unmanaged memory during calls.</span></span> <span data-ttu-id="c9feb-104">相互運用マーシャリングは、共通言語ランタイムのマーシャリング サービスによって実行される、ランタイム アクティビティです。</span><span class="sxs-lookup"><span data-stu-id="c9feb-104">Interop marshaling is a run-time activity performed by the common language runtime's marshaling service.</span></span>

<span data-ttu-id="c9feb-105">ほとんどのデータ型は、マネージドとアンマネージドの両方のメモリに共通の表現があります。</span><span class="sxs-lookup"><span data-stu-id="c9feb-105">Most data types have common representations in both managed and unmanaged memory.</span></span> <span data-ttu-id="c9feb-106">相互運用マーシャラーは、これらの型を処理します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-106">The interop marshaler handles these types for you.</span></span> <span data-ttu-id="c9feb-107">その他の型は、あいまいな型であるか、マネージド メモリでまったく表現されていない型である可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c9feb-107">Other types can be ambiguous or not represented at all in managed memory.</span></span>

<span data-ttu-id="c9feb-108">あいまいな型は、複数のアンマネージド表現が 1 つのマネージド型にマップされていたり、配列のサイズなどの型情報が欠落していたりします。</span><span class="sxs-lookup"><span data-stu-id="c9feb-108">An ambiguous type can have either multiple unmanaged representations that map to a single managed type, or missing type information, such as the size of an array.</span></span> <span data-ttu-id="c9feb-109">あいまいな型の場合、マーシャラーは、既定の表現と複数の表現が存在するときのための代替表現とを提供します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-109">For ambiguous types, the marshaler provides a default representation and alternative representations where multiple representations exist.</span></span> <span data-ttu-id="c9feb-110">あいまいな型をマーシャリングする方法について、マーシャラーに明示的な指示を与えることができます。</span><span class="sxs-lookup"><span data-stu-id="c9feb-110">You can supply explicit instructions to the marshaler on how it is to marshal an ambiguous type.</span></span>

## <a name="platform-invoke-and-com-interop-models"></a><span data-ttu-id="c9feb-111">プラットフォーム呼び出しと COM 相互運用のモデル</span><span class="sxs-lookup"><span data-stu-id="c9feb-111">Platform Invoke and COM Interop Models</span></span>

<span data-ttu-id="c9feb-112">共通言語ランタイムは、アンマネージ コードと相互運用するために、次の 2 つのメカニズムを提供します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-112">The common language runtime provides two mechanisms for interoperating with unmanaged code:</span></span>

- <span data-ttu-id="c9feb-113">プラットフォーム呼び出しにより、マネージド コードは、アンマネージド ライブラリからエクスポートされた関数を呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="c9feb-113">Platform invoke, which enables managed code to call functions exported from an unmanaged library.</span></span>
- <span data-ttu-id="c9feb-114">COM 相互運用により、マネージド コードは、インターフェイスを介してコンポーネント オブジェクト モデル (COM) オブジェクトと対話できます。</span><span class="sxs-lookup"><span data-stu-id="c9feb-114">COM interop, which enables managed code to interact with Component Object Model (COM) objects through interfaces.</span></span>

<span data-ttu-id="c9feb-115">プラットフォーム呼び出しと COM 相互運用はどちらも、必要な場合に、相互運用マーシャリングを使用して呼び出し元と呼び出し先との間でメソッド引数を正確に移動します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-115">Both platform invoke and COM interop use interop marshaling to accurately move method arguments between caller and callee and back, if required.</span></span> <span data-ttu-id="c9feb-116">次の図が示すように、プラットフォーム呼び出しメソッドの呼び出しはマネージド コードからアンマネージド コードにフローして、[コールバック関数](callback-functions.md)が関係していない限りその逆の方向にはフローしません。</span><span class="sxs-lookup"><span data-stu-id="c9feb-116">As the following illustration shows, a platform invoke method call flows from managed to unmanaged code and never the other way, except when [callback functions](callback-functions.md) are involved.</span></span> <span data-ttu-id="c9feb-117">プラットフォーム呼び出しの呼び出しはマネージド コードからアンマネージド コードにのみフローしますが、データは入出力パラメーターとして双方向にフローできます。</span><span class="sxs-lookup"><span data-stu-id="c9feb-117">Even though platform invoke calls can flow only from managed to unmanaged code, data can flow in both directions as input or output parameters.</span></span> <span data-ttu-id="c9feb-118">COM 相互運用のメソッド呼び出しは、どちらの方向にもフローできます。</span><span class="sxs-lookup"><span data-stu-id="c9feb-118">COM interop method calls can flow in either direction.</span></span>

<span data-ttu-id="c9feb-119">![プラットフォーム呼び出し](./media/interop-marshaling/interop-marshaling-invoke-and-com.png "プラットフォーム呼び出しと COM 相互運用の呼び出しフロー")</span><span class="sxs-lookup"><span data-stu-id="c9feb-119">![Platform invoke](./media/interop-marshaling/interop-marshaling-invoke-and-com.png "Platform invoke and COM interop call flow")</span></span>

<span data-ttu-id="c9feb-120">最下位のレベルでは、どちらのメカニズムも同じ相互運用マーシャリング サービスを使用します。ただし、特定のデータ型は、COM 相互運用またはプラットフォーム呼び出しでのみサポートされます。</span><span class="sxs-lookup"><span data-stu-id="c9feb-120">At the lowest level, both mechanisms use the same interop marshaling service; however, certain data types are supported exclusively by COM interop or platform invoke.</span></span> <span data-ttu-id="c9feb-121">詳しくは、「[既定のマーシャリング動作](default-marshaling-behavior.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c9feb-121">For details, see [Default Marshaling Behavior](default-marshaling-behavior.md).</span></span>

## <a name="marshaling-and-com-apartments"></a><span data-ttu-id="c9feb-122">マーシャリングと COM アパートメント</span><span class="sxs-lookup"><span data-stu-id="c9feb-122">Marshaling and COM Apartments</span></span>

<span data-ttu-id="c9feb-123">相互運用マーシャラーは、共通言語ランタイム ヒープとアンマネージ ヒープの間でデータをマーシャリングします。</span><span class="sxs-lookup"><span data-stu-id="c9feb-123">The interop marshaler marshals data between the common language runtime heap and the unmanaged heap.</span></span> <span data-ttu-id="c9feb-124">呼び出し元と呼び出し先がデータの同じインスタンスで機能できないときには常に、マーシャリングが生じます。</span><span class="sxs-lookup"><span data-stu-id="c9feb-124">Marshaling occurs whenever the caller and callee cannot operate on the same instance of data.</span></span> <span data-ttu-id="c9feb-125">相互運用マーシャラーにより、呼び出し元と呼び出し先がデータの独自のコピーを持っている場合でも、見かけ上は同じデータに対して機能しているようにすることが可能になります。</span><span class="sxs-lookup"><span data-stu-id="c9feb-125">The interop marshaler makes it possible for the caller and callee to appear to be operating on the same data even if they have their own copy of the data.</span></span>

<span data-ttu-id="c9feb-126">COM には、COM アパートメント間や異なる COM プロセス間でデータをマーシャリングするマーシャラーもあります。</span><span class="sxs-lookup"><span data-stu-id="c9feb-126">COM also has a marshaler that marshals data between COM apartments or different COM processes.</span></span> <span data-ttu-id="c9feb-127">同じ COM アパートメント内でマネージド コードとアンマネージド コード間の呼び出しをする場合は、相互運用マーシャラーが関連する唯一のマーシャラーとなります。</span><span class="sxs-lookup"><span data-stu-id="c9feb-127">When calling between managed and unmanaged code within the same COM apartment, the interop marshaler is the only marshaler involved.</span></span> <span data-ttu-id="c9feb-128">異なる COM アパートメントや異なるプロセス内でマネージド コードとアンマネージド コード間の呼び出しをする場合は、相互運用マーシャラーと COM マーシャラーの両方が関連します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-128">When calling between managed code and unmanaged code in a different COM apartment or a different process, both the interop marshaler and the COM marshaler are involved.</span></span>

### <a name="com-clients-and-managed-servers"></a><span data-ttu-id="c9feb-129">COM クライアントとマネージド サーバー</span><span class="sxs-lookup"><span data-stu-id="c9feb-129">COM Clients and Managed Servers</span></span>

<span data-ttu-id="c9feb-130">[Regasm.exe (アセンブリ登録ツール)](../tools/regasm-exe-assembly-registration-tool.md) によって登録されたタイプ ライブラリのあるエクスポートされたマネージド サーバーでは、`ThreadingModel` レジストリ エントリが `Both` に設定されています。</span><span class="sxs-lookup"><span data-stu-id="c9feb-130">An exported managed server with a type library registered by the [Regasm.exe (Assembly Registration Tool)](../tools/regasm-exe-assembly-registration-tool.md) has a `ThreadingModel` registry entry set to `Both`.</span></span> <span data-ttu-id="c9feb-131">この値は、シングルスレッド アパートメント (STA) またはマルチスレッド アパートメント (MTA) で、サーバーをアクティブ化できることを示します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-131">This value indicates that the server can be activated in a single-threaded apartment (STA) or a multithreaded apartment (MTA).</span></span> <span data-ttu-id="c9feb-132">次の表に示すように、サーバー オブジェクトは、その呼び出し元と同じアパートメント内に作成されます。</span><span class="sxs-lookup"><span data-stu-id="c9feb-132">The server object is created in the same apartment as its caller, as shown in the following table:</span></span>

|<span data-ttu-id="c9feb-133">COM クライアント</span><span class="sxs-lookup"><span data-stu-id="c9feb-133">COM client</span></span>|<span data-ttu-id="c9feb-134">.NET サーバー</span><span class="sxs-lookup"><span data-stu-id="c9feb-134">.NET server</span></span>|<span data-ttu-id="c9feb-135">マーシャリングの要件</span><span class="sxs-lookup"><span data-stu-id="c9feb-135">Marshaling requirements</span></span>|
|----------------|-----------------|-----------------------------|
|<span data-ttu-id="c9feb-136">STA</span><span class="sxs-lookup"><span data-stu-id="c9feb-136">STA</span></span>|<span data-ttu-id="c9feb-137">`Both` は STA になります。</span><span class="sxs-lookup"><span data-stu-id="c9feb-137">`Both` becomes STA.</span></span>|<span data-ttu-id="c9feb-138">同じアパートメントでのマーシャリング。</span><span class="sxs-lookup"><span data-stu-id="c9feb-138">Same-apartment marshaling.</span></span>|
|<span data-ttu-id="c9feb-139">MTA</span><span class="sxs-lookup"><span data-stu-id="c9feb-139">MTA</span></span>|<span data-ttu-id="c9feb-140">`Both` は MTA になります。</span><span class="sxs-lookup"><span data-stu-id="c9feb-140">`Both` becomes MTA.</span></span>|<span data-ttu-id="c9feb-141">同じアパートメントでのマーシャリング。</span><span class="sxs-lookup"><span data-stu-id="c9feb-141">Same-apartment marshaling.</span></span>|

<span data-ttu-id="c9feb-142">クライアントとサーバーが同じアパートメント内にあるため、相互運用マーシャリング サービスはすべてのデータのマーシャリングを自動的に処理します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-142">Because the client and server are in the same apartment, the interop marshaling service automatically handles all data marshaling.</span></span> <span data-ttu-id="c9feb-143">次の図は、同じ COM スタイル アパートメント内のマネージド ヒープとアンマネージド ヒープの間で機能している、相互運用マーシャリング サービスを示しています。</span><span class="sxs-lookup"><span data-stu-id="c9feb-143">The following illustration shows the interop marshaling service operating between managed and unmanaged heaps within the same COM-style apartment.</span></span>

<span data-ttu-id="c9feb-144">![マネージド ヒープとアンマネージド ヒープの間での相互運用マーシャリング](./media/interop-marshaling/interop-heaps-managed-and-unmanaged.gif "同じアパートメントでのマーシャリングのプロセス")</span><span class="sxs-lookup"><span data-stu-id="c9feb-144">![Interop marshaling between managed and unmanaged heaps](./media/interop-marshaling/interop-heaps-managed-and-unmanaged.gif "Same-apartment marshaling process")</span></span>

<span data-ttu-id="c9feb-145">マネージド サーバーをエクスポートする予定の場合は、サーバーのアパートメントが COM クライアントによって決定されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c9feb-145">If you plan to export a managed server, be aware that the COM client determines the apartment of the server.</span></span> <span data-ttu-id="c9feb-146">MTA 内で初期化された COM クライアントから呼び出されるマネージド サーバーは、スレッド セーフを確保する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c9feb-146">A managed server called by a COM client initialized in an MTA must ensure thread safety.</span></span>

### <a name="managed-clients-and-com-servers"></a><span data-ttu-id="c9feb-147">マネージド クライアントと COM サーバー</span><span class="sxs-lookup"><span data-stu-id="c9feb-147">Managed Clients and COM Servers</span></span>

<span data-ttu-id="c9feb-148">マネージド クライアントのアパートメントの既定の設定は MTA です。ただし、.NET クライアントのアプリケーションの種類によっては、既定の設定が変更されることがあります。</span><span class="sxs-lookup"><span data-stu-id="c9feb-148">The default setting for managed client apartments is MTA; however, the application type of the .NET client can change the default setting.</span></span> <span data-ttu-id="c9feb-149">たとえば、Visual Basic クライアント アパートメントの設定は STA です。</span><span class="sxs-lookup"><span data-stu-id="c9feb-149">For example, a Visual Basic client apartment setting is STA.</span></span> <span data-ttu-id="c9feb-150"><xref:System.STAThreadAttribute?displayProperty=nameWithType>、<xref:System.MTAThreadAttribute?displayProperty=nameWithType>、<xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> プロパティ、または <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> プロパティを使用して、マネージド クライアントのアパートメントの設定を変更できます。</span><span class="sxs-lookup"><span data-stu-id="c9feb-150">You can use the <xref:System.STAThreadAttribute?displayProperty=nameWithType>, the <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, the <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> property, or the <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> property to examine and change the apartment setting of a managed client.</span></span>

<span data-ttu-id="c9feb-151">コンポーネントの作成者は、COM サーバーのスレッド アフィニティを設定します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-151">The author of the component sets the thread affinity of a COM server.</span></span> <span data-ttu-id="c9feb-152">次の表は、.NET クライアントと COM サーバーのアパートメント設定の組み合わせを示しています。</span><span class="sxs-lookup"><span data-stu-id="c9feb-152">The following table shows the combinations of apartment settings for .NET clients and COM servers.</span></span> <span data-ttu-id="c9feb-153">また、結果として生じる、組み合わせのためのマーシャリング要件も示しています。</span><span class="sxs-lookup"><span data-stu-id="c9feb-153">It also shows the resulting marshaling requirements for the combinations.</span></span>

|<span data-ttu-id="c9feb-154">.NET クライアント</span><span class="sxs-lookup"><span data-stu-id="c9feb-154">.NET client</span></span>|<span data-ttu-id="c9feb-155">COM サーバー</span><span class="sxs-lookup"><span data-stu-id="c9feb-155">COM server</span></span>|<span data-ttu-id="c9feb-156">マーシャリングの要件</span><span class="sxs-lookup"><span data-stu-id="c9feb-156">Marshaling requirements</span></span>|
|-----------------|----------------|-----------------------------|
|<span data-ttu-id="c9feb-157">MTA (既定)</span><span class="sxs-lookup"><span data-stu-id="c9feb-157">MTA (default)</span></span>|<span data-ttu-id="c9feb-158">MTA</span><span class="sxs-lookup"><span data-stu-id="c9feb-158">MTA</span></span><br /><br /> <span data-ttu-id="c9feb-159">STA</span><span class="sxs-lookup"><span data-stu-id="c9feb-159">STA</span></span>|<span data-ttu-id="c9feb-160">相互運用マーシャリング。</span><span class="sxs-lookup"><span data-stu-id="c9feb-160">Interop marshaling.</span></span><br /><br /> <span data-ttu-id="c9feb-161">相互運用と COM マーシャリング。</span><span class="sxs-lookup"><span data-stu-id="c9feb-161">Interop and COM marshaling.</span></span>|
|<span data-ttu-id="c9feb-162">STA</span><span class="sxs-lookup"><span data-stu-id="c9feb-162">STA</span></span>|<span data-ttu-id="c9feb-163">MTA</span><span class="sxs-lookup"><span data-stu-id="c9feb-163">MTA</span></span><br /><br /> <span data-ttu-id="c9feb-164">STA</span><span class="sxs-lookup"><span data-stu-id="c9feb-164">STA</span></span>|<span data-ttu-id="c9feb-165">相互運用と COM マーシャリング。</span><span class="sxs-lookup"><span data-stu-id="c9feb-165">Interop and COM marshaling.</span></span><br /><br /> <span data-ttu-id="c9feb-166">相互運用マーシャリング。</span><span class="sxs-lookup"><span data-stu-id="c9feb-166">Interop marshaling.</span></span>|

<span data-ttu-id="c9feb-167">マネージド クライアントとアンマネージド サーバーが同じアパートメント内にあるとき、相互運用マーシャリング サービスはすべてのデータのマーシャリングを処理します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-167">When a managed client and unmanaged server are in the same apartment, the interop marshaling service handles all data marshaling.</span></span> <span data-ttu-id="c9feb-168">ただし、クライアントとサーバーが異なるアパートメント内で初期化される場合は、COM マーシャリングも必要となります。</span><span class="sxs-lookup"><span data-stu-id="c9feb-168">However, when client and server are initialized in different apartments, COM marshaling is also required.</span></span> <span data-ttu-id="c9feb-169">次の図では、アパートメント間の呼び出しの要素を示します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-169">The following illustration shows the elements of a cross-apartment call:</span></span>

<span data-ttu-id="c9feb-170">![COM マーシャリング](./media/interop-marshaling/single-process-across-multi-apartment.gif ".NET クライアントと COM オブジェクト間でのアパートメント間の呼び出し")</span><span class="sxs-lookup"><span data-stu-id="c9feb-170">![COM marshaling](./media/interop-marshaling/single-process-across-multi-apartment.gif "Cross-apartment call between a .NET client and COM object")</span></span>

<span data-ttu-id="c9feb-171">アパートメント間のマーシャリングでは、次の操作を実行できます。</span><span class="sxs-lookup"><span data-stu-id="c9feb-171">For cross-apartment marshaling, you can do the following:</span></span>

- <span data-ttu-id="c9feb-172">アパートメント間のマーシャリングのオーバーヘッドを受け入れます。これは、境界を越える呼び出しが多くがある場合にのみ認識されます。</span><span class="sxs-lookup"><span data-stu-id="c9feb-172">Accept the overhead of the cross-apartment marshaling, which is noticeable only when there are many calls across the boundary.</span></span> <span data-ttu-id="c9feb-173">呼び出しがアパートメントの境界を正常に越えるようにするためには、COM コンポーネントのタイプ ライブラリを登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c9feb-173">You must register the type library of the COM component for calls to successfully cross the apartment boundary.</span></span>
- <span data-ttu-id="c9feb-174">クライアント スレッドを STA または MTA に設定して、メイン スレッドを変更します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-174">Alter the main thread by setting the client thread to STA or MTA.</span></span> <span data-ttu-id="c9feb-175">たとえば、C# クライアントが多くの STA COM コンポーネントを呼び出す場合には、メイン スレッドを STA に設定してアパートメント間のマーシャリングを回避できます。</span><span class="sxs-lookup"><span data-stu-id="c9feb-175">For example, if your C# client calls many STA COM components, you can avoid cross-apartment marshaling by setting the main thread to STA.</span></span>

    > [!NOTE]
    > <span data-ttu-id="c9feb-176">C# クライアントのスレッドを STA に設定すると、MTA COM コンポーネントへの呼び出しにはアパートメント間のマーシャリングが必要となります。</span><span class="sxs-lookup"><span data-stu-id="c9feb-176">Once the thread of a C# client is set to STA, calls to MTA COM components will require cross-apartment marshaling.</span></span>

<span data-ttu-id="c9feb-177">アパートメント モデルを明示的に選択する方法については、「[マネージドとアンマネージド スレッド](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/5s8ee185(v=vs.100))」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c9feb-177">For instructions on explicitly selecting an apartment model, see [Managed and Unmanaged Threading](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/5s8ee185(v=vs.100)).</span></span>

## <a name="marshaling-remote-calls"></a><span data-ttu-id="c9feb-178">リモートの呼び出しのマーシャリング</span><span class="sxs-lookup"><span data-stu-id="c9feb-178">Marshaling Remote Calls</span></span>

<span data-ttu-id="c9feb-179">アパートメント間のマーシャリングの場合と同様に、COM マーシャリングは、オブジェクトが別個のプロセス内に存在するときには常に、マネージド コードとアンマネージド コード間の各呼び出しに関与します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-179">As with cross-apartment marshaling, COM marshaling is involved in each call between managed and unmanaged code whenever the objects reside in separate processes.</span></span> <span data-ttu-id="c9feb-180">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-180">For example:</span></span>

- <span data-ttu-id="c9feb-181">リモート ホスト上のマネージド サーバーを呼び出す COM クライアントは、分散 COM (DCOM) を使用します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-181">A COM client that invokes a managed server on a remote host uses distributed COM (DCOM).</span></span>
- <span data-ttu-id="c9feb-182">リモート ホスト上の COM サーバーを呼び出すマネージド クライアントは、DCOM を使用します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-182">A managed client that invokes a COM server on a remote host uses DCOM.</span></span>

<span data-ttu-id="c9feb-183">次の図では、相互運用マーシャリングと COM マーシャリングにより、プロセスとホストの境界を越えて通信チャネルが提供される方法を示します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-183">The following illustration shows how interop marshaling and COM marshaling provide communications channels across process and host boundaries:</span></span>

<span data-ttu-id="c9feb-184">![COM マーシャリング](./media/interop-marshaling/interop-and-com-marshaling.gif "プロセス間のマーシャリング")</span><span class="sxs-lookup"><span data-stu-id="c9feb-184">![COM marshaling](./media/interop-marshaling/interop-and-com-marshaling.gif "Cross-process marshaling")</span></span>

### <a name="preserving-identity"></a><span data-ttu-id="c9feb-185">ID の保持</span><span class="sxs-lookup"><span data-stu-id="c9feb-185">Preserving Identity</span></span>

<span data-ttu-id="c9feb-186">共通言語ランタイムは、マネージド参照とアンマネージド参照の ID を保持します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-186">The common language runtime preserves the identity of managed and unmanaged references.</span></span> <span data-ttu-id="c9feb-187">次の図は、プロセスとホストの境界を越えている、直接アンマネージド参照 (上の行) と直接マネージド参照 (下の行) のフローを示しています。</span><span class="sxs-lookup"><span data-stu-id="c9feb-187">The following illustration shows the flow of direct unmanaged references (top row) and direct managed references (bottom row) across process and host boundaries.</span></span>

<span data-ttu-id="c9feb-188">![COM 呼び出し可能ラッパーとランタイム呼び出し可能ラッパー](./media/interop-marshaling/interop-direct-ref-across-process.gif "プロセスとホストの境界を越えて渡される参照")</span><span class="sxs-lookup"><span data-stu-id="c9feb-188">![COM callable wrapper and runtime callable wrapper](./media/interop-marshaling/interop-direct-ref-across-process.gif "Reference passing across process and host boundaries")</span></span>

<span data-ttu-id="c9feb-189">この図では:</span><span class="sxs-lookup"><span data-stu-id="c9feb-189">In this illustration:</span></span>

- <span data-ttu-id="c9feb-190">アンマネージド クライアントは、COM オブジェクトへの参照を、リモート ホストからその参照を取得するマネージド オブジェクトから取得します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-190">An unmanaged client gets a reference to a COM object from a managed object that gets this reference from a remote host.</span></span> <span data-ttu-id="c9feb-191">リモート処理のメカニズムは DCOM です。</span><span class="sxs-lookup"><span data-stu-id="c9feb-191">The remoting mechanism is DCOM.</span></span>
- <span data-ttu-id="c9feb-192">マネージド クライアントは、マネージド オブジェクトへの参照を、リモート ホストからその参照を取得している COM オブジェクトから取得します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-192">A managed client gets a reference to a managed object from a COM object that gets this reference from a remote host.</span></span> <span data-ttu-id="c9feb-193">リモート処理のメカニズムは DCOM です。</span><span class="sxs-lookup"><span data-stu-id="c9feb-193">The remoting mechanism is DCOM.</span></span>

    > [!NOTE]
    > <span data-ttu-id="c9feb-194">マネージド サーバーのエクスポート済みタイプ ライブラリを登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c9feb-194">The exported type library of the managed server must be registered.</span></span>

<span data-ttu-id="c9feb-195">呼び出し元と呼び出し先の間のプロセス境界の数は関連していません。同じ直接参照が、イン プロセスおよびアウト プロセスの呼び出しで発生します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-195">The number of process boundaries between caller and callee is irrelevant; the same direct referencing occurs for in-process and out-of-process calls.</span></span>

### <a name="managed-remoting"></a><span data-ttu-id="c9feb-196">マネージド リモート処理</span><span class="sxs-lookup"><span data-stu-id="c9feb-196">Managed Remoting</span></span>

<span data-ttu-id="c9feb-197">ランタイムは、プロセスとホストの境界を越えてマネージド オブジェクト間に通信チャネルを確立するために使用できる、マネージド リモート処理も提供します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-197">The runtime also provides managed remoting, which you can use to establish a communications channel between managed objects across process and host boundaries.</span></span> <span data-ttu-id="c9feb-198">次の図に示すように、マネージド リモート処理は、通信コンポーネントの間のファイアウォールに対応できます。</span><span class="sxs-lookup"><span data-stu-id="c9feb-198">Managed remoting can accommodate a firewall between the communicating components, as the following illustration shows:</span></span>

<span data-ttu-id="c9feb-199">![SOAP または TcpChannel](./media/interop-marshaling/interop-remote-soap-or-tcp.gif "SOAP または TcpChannel クラスを使用するファイアウォールを越えたリモート呼び出し") SOAP または TcpChannel クラスを使用したファイアウォールを越えるリモート呼び出し</span><span class="sxs-lookup"><span data-stu-id="c9feb-199">![SOAP or TcpChannel](./media/interop-marshaling/interop-remote-soap-or-tcp.gif "Remote calls across firewalls using SOAP or the TcpChannel class") Remote calls across firewalls using SOAP or the TcpChannel class</span></span>

<span data-ttu-id="c9feb-200">サービス コンポーネントと COM の間の呼び出しなど、一部のアンマネージド呼び出しは SOAP を介して伝達できます。</span><span class="sxs-lookup"><span data-stu-id="c9feb-200">Some unmanaged calls can be channeled through SOAP, such as the calls between serviced components and COM.</span></span>

## <a name="related-topics"></a><span data-ttu-id="c9feb-201">関連トピック</span><span class="sxs-lookup"><span data-stu-id="c9feb-201">Related Topics</span></span>

|<span data-ttu-id="c9feb-202">Title</span><span class="sxs-lookup"><span data-stu-id="c9feb-202">Title</span></span>|<span data-ttu-id="c9feb-203">説明</span><span class="sxs-lookup"><span data-stu-id="c9feb-203">Description</span></span>|
|-----------|-----------------|
|[<span data-ttu-id="c9feb-204">既定のマーシャリング動作</span><span class="sxs-lookup"><span data-stu-id="c9feb-204">Default Marshaling Behavior</span></span>](default-marshaling-behavior.md)|<span data-ttu-id="c9feb-205">相互運用マーシャリング サービスがデータのマーシャリングに使用する規則について説明します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-205">Describes the rules that the interop marshaling service uses to marshal data.</span></span>|
|[<span data-ttu-id="c9feb-206">プラットフォーム呼び出しによるデータのマーシャリング</span><span class="sxs-lookup"><span data-stu-id="c9feb-206">Marshaling Data with Platform Invoke</span></span>](marshaling-data-with-platform-invoke.md)|<span data-ttu-id="c9feb-207">メソッドのパラメーターを宣言してアンマネージ ライブラリによってエクスポートされた関数に引数を渡す方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-207">Describes how to declare method parameters and pass arguments to functions exported by unmanaged libraries.</span></span>|
|[<span data-ttu-id="c9feb-208">COM 相互運用機能によるデータのマーシャリング</span><span class="sxs-lookup"><span data-stu-id="c9feb-208">Marshaling Data with COM Interop</span></span>](marshaling-data-with-com-interop.md)|<span data-ttu-id="c9feb-209">COM ラッパーをカスタマイズしてマーシャリング動作を変更する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-209">Describes how to customize COM wrappers to alter marshaling behavior.</span></span>|
|[<span data-ttu-id="c9feb-210">方法: マネージド コード DCOM を WCF に移行する</span><span class="sxs-lookup"><span data-stu-id="c9feb-210">How to: Migrate Managed-Code DCOM to WCF</span></span>](how-to-migrate-managed-code-dcom-to-wcf.md)|<span data-ttu-id="c9feb-211">DCOM から WCF に移行する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-211">Describes how to migrate from DCOM to WCF.</span></span>|
|[<span data-ttu-id="c9feb-212">方法: HRESULT に例外を割り当てる</span><span class="sxs-lookup"><span data-stu-id="c9feb-212">How to: Map HRESULTs and Exceptions</span></span>](how-to-map-hresults-and-exceptions.md)|<span data-ttu-id="c9feb-213">HRESULT にカスタム例外をマップする方法について説明し、各 HRESULT から .NET Framework での同等の例外クラスへの完全なマッピングを示します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-213">Describes how to map custom exceptions to HRESULTs and provides the complete mapping from each HRESULT to its comparable exception class in the .NET Framework.</span></span>|
|<span data-ttu-id="c9feb-214">[ジェネリック型を使用する相互運用](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms229590(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="c9feb-214">[Interoperating Using Generic Types](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms229590(v=vs.100))</span></span>|<span data-ttu-id="c9feb-215">COM 相互運用性のジェネリック型を使用するとき、どのアクションがサポートされるかについて説明します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-215">Describes which actions are supported when using generic types for COM interoperability.</span></span>|
|[<span data-ttu-id="c9feb-216">アンマネージ コードとの相互運用</span><span class="sxs-lookup"><span data-stu-id="c9feb-216">Interoperating with Unmanaged Code</span></span>](index.md)|<span data-ttu-id="c9feb-217">共通言語ランタイムが提供する相互運用サービスについて説明します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-217">Describes interoperability services provided by the common language runtime.</span></span>|
|<span data-ttu-id="c9feb-218">[高度な COM 相互運用性](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bd9cdfyx(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="c9feb-218">[Advanced COM Interoperability](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bd9cdfyx(v=vs.100))</span></span>|<span data-ttu-id="c9feb-219">.NET Framework アプリケーションに COM コンポーネントを組み込む方法についての詳細情報へのリンクを示します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-219">Provides links to more information about incorporating COM components into your .NET Framework application.</span></span>|
|<span data-ttu-id="c9feb-220">[相互運用のためのデザインの考慮事項](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/61aax4kh(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="c9feb-220">[Design Considerations for Interoperation](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/61aax4kh(v=vs.100))</span></span>|<span data-ttu-id="c9feb-221">統合 COM コンポーネントを記述するためのヒントを示します。</span><span class="sxs-lookup"><span data-stu-id="c9feb-221">Provides tips for writing integrated COM components.</span></span>|

## <a name="reference"></a><span data-ttu-id="c9feb-222">関連項目</span><span class="sxs-lookup"><span data-stu-id="c9feb-222">Reference</span></span>

<xref:System.Runtime.InteropServices?displayProperty=nameWithType>
