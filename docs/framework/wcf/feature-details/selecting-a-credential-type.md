---
title: 資格情報の種類の選択
description: 資格情報、WCF での使用方法、要求された id または機能を確立するための適切な資格情報をアプリケーションに選択する方法について説明します。
ms.date: 03/30/2017
ms.assetid: bf707063-3f30-4304-ab53-0e63413728a8
ms.openlocfilehash: 7a8a6880e5fc3982bb7f470c34a77c771c26effd
ms.sourcegitcommit: 358a28048f36a8dca39a9fe6e6ac1f1913acadd5
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/23/2020
ms.locfileid: "85244921"
---
# <a name="selecting-a-credential-type"></a><span data-ttu-id="286c2-103">資格情報の種類の選択</span><span class="sxs-lookup"><span data-stu-id="286c2-103">Selecting a Credential Type</span></span>
<span data-ttu-id="286c2-104">*資格情報*は、要求された id または機能のいずれかを確立するために使用されるデータ WINDOWS COMMUNICATION FOUNDATION (WCF) です。</span><span class="sxs-lookup"><span data-stu-id="286c2-104">*Credentials* are the data Windows Communication Foundation (WCF) uses to establish either a claimed identity or capabilities.</span></span> <span data-ttu-id="286c2-105">たとえば、パスポートは、政府によって発行される、国籍または地域籍を証明するための資格情報です。</span><span class="sxs-lookup"><span data-stu-id="286c2-105">For example, a passport is a credential a government issues to prove citizenship in a country or region.</span></span> <span data-ttu-id="286c2-106">WCF では、資格情報は、ユーザー名トークンや x.509 証明書など、さまざまな形式になります。</span><span class="sxs-lookup"><span data-stu-id="286c2-106">In WCF, credentials can take many forms, such as user name tokens and X.509 certificates.</span></span> <span data-ttu-id="286c2-107">このトピックでは、資格情報、WCF での使用方法、およびアプリケーションに適切な資格情報を選択する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="286c2-107">This topic discusses credentials, how they are used in WCF, and how to select the right credential for your application.</span></span>  
  
 <span data-ttu-id="286c2-108">多くの国や地域において、運転免許証は資格情報の一例です。</span><span class="sxs-lookup"><span data-stu-id="286c2-108">In many countries and regions, a driver’s license is an example of a credential.</span></span> <span data-ttu-id="286c2-109">運転免許証には、個人を識別する情報や能力を表すデータが記載されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-109">A license contains data that represents a person's identity and capabilities.</span></span> <span data-ttu-id="286c2-110">この免許証には、所有者の写真という形式で所有の証明が含まれています。</span><span class="sxs-lookup"><span data-stu-id="286c2-110">It contains proof of possession in the form of the possessor's picture.</span></span> <span data-ttu-id="286c2-111">免許証は、政府機関など、信頼された証明機関によって発行されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-111">The license is issued by a trusted authority, usually a governmental department of licensing.</span></span> <span data-ttu-id="286c2-112">免許証には発行機関印が押され (国や地域によってはホログラムが使用され) ており、これによって、改ざんあるいは偽造されたものではないことが示されています。</span><span class="sxs-lookup"><span data-stu-id="286c2-112">The license is sealed, and can contain a hologram, showing that it has not been tampered with or counterfeited.</span></span>  
  
 <span data-ttu-id="286c2-113">資格情報の提示には、データ自体の提示とデータの所有証明の提示が関与します。</span><span class="sxs-lookup"><span data-stu-id="286c2-113">Presenting a credential involves presenting both the data and proof of possession of the data.</span></span> <span data-ttu-id="286c2-114">WCF では、トランスポートとメッセージの両方のセキュリティレベルで、さまざまな種類の資格情報をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="286c2-114">WCF supports a variety of credential types at both the transport and message security levels.</span></span> <span data-ttu-id="286c2-115">たとえば、WCF でサポートされている2種類の資格情報 (ユーザー名と (x.509) 証明書の資格情報) を考えてみます。</span><span class="sxs-lookup"><span data-stu-id="286c2-115">For example, consider two types of credentials supported in WCF: user name and (X.509) certificate credentials.</span></span>  
  
 <span data-ttu-id="286c2-116">ユーザー名資格情報で、ユーザー名はクレームされた ID を表しており、パスワードは所有の証明に使用されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-116">For the user name credential, the user name represents the claimed identity and the password provides proof of possession.</span></span> <span data-ttu-id="286c2-117">この場合の信頼された証明機関とは、ユーザー名とパスワードを検証するシステムです。</span><span class="sxs-lookup"><span data-stu-id="286c2-117">The trusted authority in this case is the system that validates the user name and password.</span></span>  
  
 <span data-ttu-id="286c2-118">X.509 証明書の資格情報では、サブジェクト名、サブジェクト代替名、または証明書内の特定のフィールドを id のクレームとして使用できます。また、フィールドやフィールドなどの他のフィールドは、 `Valid From` `Valid To` 証明書の有効性を指定します。</span><span class="sxs-lookup"><span data-stu-id="286c2-118">With an X.509 certificate credential, the subject name, subject alternative name or specific fields within the certificate can be used as claims of identity, while other fields, such as the `Valid From` and `Valid To` fields, specify the validity of the certificate.</span></span>  
  
## <a name="transport-credential-types"></a><span data-ttu-id="286c2-119">トランスポート資格情報の種類</span><span class="sxs-lookup"><span data-stu-id="286c2-119">Transport Credential Types</span></span>  
 <span data-ttu-id="286c2-120">転送セキュリティ モードのバインディングによって使用できるクライアント資格情報の種類を次の表に示します。</span><span class="sxs-lookup"><span data-stu-id="286c2-120">The following table shows the possible types of client credentials that can be used by a binding in transport security mode.</span></span> <span data-ttu-id="286c2-121">サービスを作成する際には、`ClientCredentialType` プロパティを次のいずれかの値に設定し、クライアントがサービスと通信するときに提供する必要がある資格情報の種類を指定します。</span><span class="sxs-lookup"><span data-stu-id="286c2-121">When creating a service, set the `ClientCredentialType` property to one of these values to specify the type of credential that the client must supply to communicate with your service.</span></span> <span data-ttu-id="286c2-122">この種類は、コードまたは構成ファイルで設定できます。</span><span class="sxs-lookup"><span data-stu-id="286c2-122">You can set the types in either code or configuration files.</span></span>  
  
|<span data-ttu-id="286c2-123">設定</span><span class="sxs-lookup"><span data-stu-id="286c2-123">Setting</span></span>|<span data-ttu-id="286c2-124">説明</span><span class="sxs-lookup"><span data-stu-id="286c2-124">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="286c2-125">なし</span><span class="sxs-lookup"><span data-stu-id="286c2-125">None</span></span>|<span data-ttu-id="286c2-126">クライアントが資格情報を提示する必要がないことを指定します。</span><span class="sxs-lookup"><span data-stu-id="286c2-126">Specifies that the client does not need to present any credential.</span></span> <span data-ttu-id="286c2-127">匿名クライアントであると解釈されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-127">This translates to an anonymous client.</span></span>|  
|<span data-ttu-id="286c2-128">Basic</span><span class="sxs-lookup"><span data-stu-id="286c2-128">Basic</span></span>|<span data-ttu-id="286c2-129">クライアントに基本認証を指定します。</span><span class="sxs-lookup"><span data-stu-id="286c2-129">Specifies basic authentication for the client.</span></span> <span data-ttu-id="286c2-130">詳細については、「RFC2617-[HTTP 認証: 基本認証とダイジェスト認証](ftp://ftp.rfc-editor.org/in-notes/rfc2617.txt)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="286c2-130">For additional information, see RFC2617—[HTTP Authentication: Basic and Digest Authentication](ftp://ftp.rfc-editor.org/in-notes/rfc2617.txt).</span></span>|  
|<span data-ttu-id="286c2-131">ダイジェスト</span><span class="sxs-lookup"><span data-stu-id="286c2-131">Digest</span></span>|<span data-ttu-id="286c2-132">クライアントにダイジェスト認証を指定します。</span><span class="sxs-lookup"><span data-stu-id="286c2-132">Specifies digest authentication for the client.</span></span> <span data-ttu-id="286c2-133">詳細については、「RFC2617-[HTTP 認証: 基本認証とダイジェスト認証](ftp://ftp.rfc-editor.org/in-notes/rfc2617.txt)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="286c2-133">For additional information, see RFC2617—[HTTP Authentication: Basic and Digest Authentication](ftp://ftp.rfc-editor.org/in-notes/rfc2617.txt).</span></span>|  
|<span data-ttu-id="286c2-134">Ntlm</span><span class="sxs-lookup"><span data-stu-id="286c2-134">Ntlm</span></span>|<span data-ttu-id="286c2-135">NT LAN Manager (NTLM) 認証を指定します。</span><span class="sxs-lookup"><span data-stu-id="286c2-135">Specifies NT LAN Manager (NTLM) authentication.</span></span> <span data-ttu-id="286c2-136">これは、何らかの理由で Kerberos 認証を使用できないときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-136">This is used when you cannot use Kerberos authentication for some reason.</span></span> <span data-ttu-id="286c2-137">また、プロパティをに設定すると、フォールバックとしての使用を無効にすることもできます <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> `false` 。これにより、NTLM が使用された場合に WCF がベストエフォートで例外をスローするようになります。</span><span class="sxs-lookup"><span data-stu-id="286c2-137">You can also disable its use as a fallback by setting the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property to `false`, which causes WCF to make a best-effort to throw an exception if NTLM is used.</span></span> <span data-ttu-id="286c2-138">ただし、このプロパティを `false` に設定しても、ネットワーク経由で NTLM 資格情報が送信されなくなるとは限りません。</span><span class="sxs-lookup"><span data-stu-id="286c2-138">Note that setting this property to `false` may not prevent NTLM credentials from being sent over the wire.</span></span>|  
|<span data-ttu-id="286c2-139">Windows</span><span class="sxs-lookup"><span data-stu-id="286c2-139">Windows</span></span>|<span data-ttu-id="286c2-140">Windows 認証を指定します。</span><span class="sxs-lookup"><span data-stu-id="286c2-140">Specifies Windows authentication.</span></span> <span data-ttu-id="286c2-141">Windows ドメインで Kerberos プロトコルだけを指定するには、<xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> プロパティを `false` (既定値は `true`) に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="286c2-141">To specify only the Kerberos protocol on a Windows domain, set the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property to `false` (the default is `true`).</span></span>|  
|<span data-ttu-id="286c2-142">証明書</span><span class="sxs-lookup"><span data-stu-id="286c2-142">Certificate</span></span>|<span data-ttu-id="286c2-143">X.509 証明書を使用したクライアント認証を実行します。</span><span class="sxs-lookup"><span data-stu-id="286c2-143">Performs client authentication using an X.509 certificate.</span></span>|  
|<span data-ttu-id="286c2-144">Password</span><span class="sxs-lookup"><span data-stu-id="286c2-144">Password</span></span>|<span data-ttu-id="286c2-145">ユーザーは、ユーザー名とパスワードを提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="286c2-145">User must supply a user name and password.</span></span> <span data-ttu-id="286c2-146">Windows 認証または他のカスタム ソリューションを使用して、ユーザー名とパスワードの組み合わせを検証します。</span><span class="sxs-lookup"><span data-stu-id="286c2-146">Validate the user name/password pair using Windows authentication or another custom solution.</span></span>|  
  
### <a name="message-client-credential-types"></a><span data-ttu-id="286c2-147">メッセージ クライアント資格情報の種類</span><span class="sxs-lookup"><span data-stu-id="286c2-147">Message Client Credential Types</span></span>  
 <span data-ttu-id="286c2-148">メッセージ セキュリティを使用するアプリケーションを作成するときに使用できる資格情報の種類を次の表に示します。</span><span class="sxs-lookup"><span data-stu-id="286c2-148">The following table shows the possible credential types that you can use when creating an application that uses message security.</span></span> <span data-ttu-id="286c2-149">これらの値は、コードまたは構成ファイルで使用できます。</span><span class="sxs-lookup"><span data-stu-id="286c2-149">You can use these values in either code or configuration files.</span></span>  
  
|<span data-ttu-id="286c2-150">設定</span><span class="sxs-lookup"><span data-stu-id="286c2-150">Setting</span></span>|<span data-ttu-id="286c2-151">説明</span><span class="sxs-lookup"><span data-stu-id="286c2-151">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="286c2-152">なし</span><span class="sxs-lookup"><span data-stu-id="286c2-152">None</span></span>|<span data-ttu-id="286c2-153">クライアントが資格情報を提示する必要がないことを指定します。</span><span class="sxs-lookup"><span data-stu-id="286c2-153">Specifies that the client does not need to present a credential.</span></span> <span data-ttu-id="286c2-154">匿名クライアントであると解釈されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-154">This translates to an anonymous client.</span></span>|  
|<span data-ttu-id="286c2-155">Windows</span><span class="sxs-lookup"><span data-stu-id="286c2-155">Windows</span></span>|<span data-ttu-id="286c2-156">Windows 資格情報によって確立されたセキュリティ コンテキストで、SOAP メッセージ交換を実行できます。</span><span class="sxs-lookup"><span data-stu-id="286c2-156">Allows SOAP message exchanges to occur under the security context established with a Windows credential.</span></span>|  
|<span data-ttu-id="286c2-157">ユーザー名</span><span class="sxs-lookup"><span data-stu-id="286c2-157">Username</span></span>|<span data-ttu-id="286c2-158">ユーザー名資格情報を使用したクライアントの認証をサービスで要求できるようにします。</span><span class="sxs-lookup"><span data-stu-id="286c2-158">Allows the service to require that the client be authenticated with a user name credential.</span></span> <span data-ttu-id="286c2-159">WCF では、署名の生成やデータの暗号化など、ユーザー名を使用した暗号化操作が許可されていないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="286c2-159">Note that WCF does not allow any cryptographic operations with user names, such as generating a signature or encrypting data.</span></span> <span data-ttu-id="286c2-160">WCF では、ユーザー名の資格情報を使用するときに、トランスポートが確実にセキュリティで保護されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-160">WCF ensures that the transport is secured when using user name credentials.</span></span>|  
|<span data-ttu-id="286c2-161">証明書</span><span class="sxs-lookup"><span data-stu-id="286c2-161">Certificate</span></span>|<span data-ttu-id="286c2-162">X.509 証明書を使用したクライアントの認証をサービスで要求できるようにします。</span><span class="sxs-lookup"><span data-stu-id="286c2-162">Allows the service to require that the client be authenticated using an X.509 certificate.</span></span>|  
|<span data-ttu-id="286c2-163">IssuedToken</span><span class="sxs-lookup"><span data-stu-id="286c2-163">Issued Token</span></span>|<span data-ttu-id="286c2-164">セキュリティ ポリシーに従って構成されるカスタム トークンです。</span><span class="sxs-lookup"><span data-stu-id="286c2-164">A custom token type configured according to a security policy.</span></span> <span data-ttu-id="286c2-165">既定のトークンの種類は、SAML (Security Assertion Markup Language) です。</span><span class="sxs-lookup"><span data-stu-id="286c2-165">The default token type is Security Assertions Markup Language (SAML).</span></span> <span data-ttu-id="286c2-166">トークンは、セキュリティ トークン サービスによって発行されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-166">The token is issued by a secure token service.</span></span> <span data-ttu-id="286c2-167">詳細については、「[フェデレーションと発行済みトークン](federation-and-issued-tokens.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="286c2-167">For more information, see [Federation and Issued Tokens](federation-and-issued-tokens.md).</span></span>|  
  
### <a name="negotiation-model-of-service-credentials"></a><span data-ttu-id="286c2-168">サービス資格情報のネゴシエーション モデル</span><span class="sxs-lookup"><span data-stu-id="286c2-168">Negotiation Model of Service Credentials</span></span>  
 <span data-ttu-id="286c2-169">*ネゴシエーション*は、資格情報を交換することによって、クライアントとサービスの間の信頼を確立するプロセスです。</span><span class="sxs-lookup"><span data-stu-id="286c2-169">*Negotiation* is the process of establishing trust between a client and a service by exchanging credentials.</span></span> <span data-ttu-id="286c2-170">このプロセスは、ネゴシエーション プロセスの次の手順に必要な情報だけを公開するために、クライアントとサービスとの間で反復して実行されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-170">The process is performed iteratively between the client and the service, so as to disclose only the information necessary for the next step in the negotiation process.</span></span> <span data-ttu-id="286c2-171">実際には、最後に、後続の操作で使用されるサービスの資格情報がクライアントに配信されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-171">In practice, the end result is the delivery of a service's credential to the client to be used in subsequent operations.</span></span>  
  
 <span data-ttu-id="286c2-172">1つの例外を除き、既定では、WCF のシステム指定のバインディングは、メッセージレベルのセキュリティを使用するときにサービス資格情報を自動的にネゴシエートします。</span><span class="sxs-lookup"><span data-stu-id="286c2-172">With one exception, by default the system-provided bindings in WCF negotiate the service credential automatically when using message-level security.</span></span> <span data-ttu-id="286c2-173">(例外はで、 <xref:System.ServiceModel.BasicHttpBinding> 既定ではセキュリティが有効になっていません)。この動作を無効にするには、 <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> プロパティとプロパティを参照してください <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.NegotiateServiceCredential%2A> 。</span><span class="sxs-lookup"><span data-stu-id="286c2-173">(The exception is the <xref:System.ServiceModel.BasicHttpBinding>, which does not enable security by default.) To disable this behavior, see the <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> and <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.NegotiateServiceCredential%2A> properties.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="286c2-174">.NET Framework 3.5 以降で SSL セキュリティを使用する場合、WCF クライアントは、証明書ストア内の中間証明書と SSL ネゴシエーション中に受信した中間証明書の両方を使用して、サービスの証明書に対して証明書チェーンの検証を実行します。</span><span class="sxs-lookup"><span data-stu-id="286c2-174">When SSL security is used with .NET Framework 3.5 and later, a WCF client uses both the intermediate certificates in its certificate store and the intermediate certificates received during SSL negotiation to perform certificate chain validation on the service's certificate.</span></span> <span data-ttu-id="286c2-175">.NET Framework 3.0 では、ローカルの証明書ストアにインストールされている中間証明書のみが使用されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-175">.NET Framework 3.0 only uses the intermediate certificates installed in the local certificate store.</span></span>  
  
#### <a name="out-of-band-negotiation"></a><span data-ttu-id="286c2-176">帯域外ネゴシエーション</span><span class="sxs-lookup"><span data-stu-id="286c2-176">Out-of-Band Negotiation</span></span>  
 <span data-ttu-id="286c2-177">自動ネゴシエーションを無効にした場合、サービスにメッセージを送信する前にクライアント側にサービス資格情報が準備されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="286c2-177">If automatic negotiation is disabled, the service credential must be provisioned at the client prior to sending any messages to the service.</span></span> <span data-ttu-id="286c2-178">これは、*帯域外*プロビジョニングとも呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="286c2-178">This is also known as an *out-of-band* provisioning.</span></span> <span data-ttu-id="286c2-179">たとえば、指定された資格情報の種類が証明書で、自動ネゴシエーションが無効の場合、クライアントはサービス所有者に連絡し、証明書を受け取って、クライアント アプリケーションを実行しているコンピューターにインストールする必要があります。</span><span class="sxs-lookup"><span data-stu-id="286c2-179">For example, if the specified credential type is a certificate, and automatic negotiation is disabled, the client must contact the service owner to receive and install the certificate on the computer running the client application.</span></span> <span data-ttu-id="286c2-180">この方法は、たとえば B2B シナリオで、サービスにアクセスできるクライアントを厳密に制御することが必要な場合に使用される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="286c2-180">This can be done, for example, when you want to strictly control which clients can access a service in a business-to-business scenario.</span></span> <span data-ttu-id="286c2-181">この帯域外ネゴシエーションは、電子メールで実行できます。 x.509 証明書は、Microsoft 管理コンソール (MMC) 証明書スナップインなどのツールを使用して Windows 証明書ストアに格納されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-181">This out-of-band-negotiation can be done in email, and the X.509 certificate is stored in Windows certificate store, using a tool such as the Microsoft Management Console (MMC) Certificates snap-in.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="286c2-182"><xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> プロパティを使用して、帯域外ネゴシエーションによって取得した証明書をサービスに提供します。</span><span class="sxs-lookup"><span data-stu-id="286c2-182">The <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property is used to provide the service with a certificate that was attained through out-of-band negotiation.</span></span> <span data-ttu-id="286c2-183">バインディングでは自動ネゴシエーションが許可されないので、<xref:System.ServiceModel.BasicHttpBinding> クラスを使用するときはこの操作が必要になります。</span><span class="sxs-lookup"><span data-stu-id="286c2-183">This is necessary when using the <xref:System.ServiceModel.BasicHttpBinding> class because the binding does not allow automated negotiation.</span></span> <span data-ttu-id="286c2-184">このプロパティは、相関関係のない双方向シナリオでも使用します。</span><span class="sxs-lookup"><span data-stu-id="286c2-184">The property is also used in an uncorrelated duplex scenario.</span></span> <span data-ttu-id="286c2-185">このシナリオでは、クライアントが先にサーバーへの要求を送信する必要がなく、サーバーからクライアントにメッセージが送信されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-185">This is a scenario where a server sends a message to the client without requiring the client to send a request to the server first.</span></span> <span data-ttu-id="286c2-186">サーバーにはクライアントからの要求がないので、サーバーはクライアントの証明書を使用して、クライアントへのメッセージを暗号化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="286c2-186">Because the server does not have a request from the client, it must use the client's certificate to encrypt the message to the client.</span></span>  
  
## <a name="setting-credential-values"></a><span data-ttu-id="286c2-187">資格情報の値の設定</span><span class="sxs-lookup"><span data-stu-id="286c2-187">Setting Credential Values</span></span>  
 <span data-ttu-id="286c2-188">セキュリティ モードを選択したら、実際の資格情報を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="286c2-188">Once you select a security mode, you must specify the actual credentials.</span></span> <span data-ttu-id="286c2-189">たとえば、資格情報の種類を "Certificate" に設定した場合、特定の資格情報 (特定の X.509 証明書など) をサービスまたはクライアントに関連付ける必要があります。</span><span class="sxs-lookup"><span data-stu-id="286c2-189">For example, if the credential type is set to "certificate," then you must associate a specific credential (such as a specific X.509 certificate) with the service or client.</span></span>  
  
 <span data-ttu-id="286c2-190">サービスをプログラミングしている場合とクライアントをプログラミングしている場合で、資格情報の値を設定する方法が少し異なります。</span><span class="sxs-lookup"><span data-stu-id="286c2-190">Depending on whether you are programming a service or a client, the method for setting the credential value differs slightly.</span></span>  
  
### <a name="setting-service-credentials"></a><span data-ttu-id="286c2-191">サービス資格情報の設定</span><span class="sxs-lookup"><span data-stu-id="286c2-191">Setting Service Credentials</span></span>  
 <span data-ttu-id="286c2-192">トランスポート モードを使用し、HTTP をトランスポートとして使用する場合は、インターネット インフォメーション サービス (IIS) を使用するか、証明書でポートを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="286c2-192">If you are using transport mode, and you are using HTTP as the transport, you must use either Internet Information Services (IIS) or configure the port with a certificate.</span></span> <span data-ttu-id="286c2-193">詳細については、「[トランスポートセキュリティの概要](transport-security-overview.md)」および「 [HTTP トランスポートセキュリティ](http-transport-security.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="286c2-193">For more information, see [Transport Security Overview](transport-security-overview.md) and [HTTP Transport Security](http-transport-security.md).</span></span>  
  
 <span data-ttu-id="286c2-194">コードで資格情報をサービスに提供するには、<xref:System.ServiceModel.ServiceHost> クラスのインスタンスを作成し、<xref:System.ServiceModel.Description.ServiceCredentials> プロパティからアクセスできる <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> クラスを使用して適切な資格情報を指定します。</span><span class="sxs-lookup"><span data-stu-id="286c2-194">To provision a service with credentials in code, create an instance of the <xref:System.ServiceModel.ServiceHost> class and specify the appropriate credential using the <xref:System.ServiceModel.Description.ServiceCredentials> class, accessed through the <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> property.</span></span>  
  
#### <a name="setting-a-certificate"></a><span data-ttu-id="286c2-195">証明書の設定</span><span class="sxs-lookup"><span data-stu-id="286c2-195">Setting a Certificate</span></span>  
 <span data-ttu-id="286c2-196">クライアントに対するサービスの認証に使用される X.509 証明書をサービスに提供するには、<xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A> クラスの <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential> メソッドを使用します。</span><span class="sxs-lookup"><span data-stu-id="286c2-196">To provision a service with an X.509 certificate to be used to authenticate the service to clients, use the <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A> method of the <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential> class.</span></span>  
  
 <span data-ttu-id="286c2-197">クライアント証明書をサービスに提供するには、<xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A> クラスの <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential> メソッドを使用します。</span><span class="sxs-lookup"><span data-stu-id="286c2-197">To provision a service with a client certificate, use the <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A> method of the <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential> class.</span></span>  
  
#### <a name="setting-windows-credentials"></a><span data-ttu-id="286c2-198">Windows 資格情報の設定</span><span class="sxs-lookup"><span data-stu-id="286c2-198">Setting Windows Credentials</span></span>  
 <span data-ttu-id="286c2-199">クライアントが有効なユーザー名とパスワードを指定した場合、その資格情報がクライアントの認証に使用されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-199">If the client specifies a valid user name and password, that credential is used to authenticate the client.</span></span> <span data-ttu-id="286c2-200">それ以外の場合は、現在ログオンしているユーザーの資格情報が使用されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-200">Otherwise, the current logged-on user's credentials are used.</span></span>  
  
### <a name="setting-client-credentials"></a><span data-ttu-id="286c2-201">クライアント資格情報の設定</span><span class="sxs-lookup"><span data-stu-id="286c2-201">Setting Client Credentials</span></span>  
 <span data-ttu-id="286c2-202">WCF では、クライアントアプリケーションは WCF クライアントを使用してサービスに接続します。</span><span class="sxs-lookup"><span data-stu-id="286c2-202">In WCF, client applications use a WCF client to connect to services.</span></span> <span data-ttu-id="286c2-203">各クライアントは、<xref:System.ServiceModel.ClientBase%601> クラスから派生しています。各クライアントでは <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> プロパティを使用して、クライアント資格情報のさまざまな値を指定できます。</span><span class="sxs-lookup"><span data-stu-id="286c2-203">Every client derives from the <xref:System.ServiceModel.ClientBase%601> class, and the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property on the client allows the specification of various values of client credentials.</span></span>  
  
#### <a name="setting-a-certificate"></a><span data-ttu-id="286c2-204">証明書の設定</span><span class="sxs-lookup"><span data-stu-id="286c2-204">Setting a Certificate</span></span>  
 <span data-ttu-id="286c2-205">サービスに対するクライアントの認証に使用される X.509 証明書をサービスに提供するには、<xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A> クラスの <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential> メソッドを使用します。</span><span class="sxs-lookup"><span data-stu-id="286c2-205">To provision a service with an X.509 certificate that is used to authenticate the client to a service, use the <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A> method of the <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential> class.</span></span>  
  
## <a name="how-client-credentials-are-used-to-authenticate-a-client-to-the-service"></a><span data-ttu-id="286c2-206">サービスに対するクライアントの認証でのクライアント資格情報の使用</span><span class="sxs-lookup"><span data-stu-id="286c2-206">How Client Credentials Are Used to Authenticate a Client to the Service</span></span>  
 <span data-ttu-id="286c2-207">サービスとの通信に必要なクライアント資格情報は、<xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> プロパティまたは <xref:System.ServiceModel.ChannelFactory.Credentials%2A> プロパティを使用して提供されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-207">Client credential information required to communicate with a service is provided using either the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property or the <xref:System.ServiceModel.ChannelFactory.Credentials%2A> property.</span></span> <span data-ttu-id="286c2-208">この情報は、サービスに対してクライアントを認証するためにセキュリティ チャネルで使用されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-208">The security channel uses this information to authenticate the client to the service.</span></span> <span data-ttu-id="286c2-209">認証は、次のいずれかの方法で実行されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-209">Authentication is accomplished through one of two modes:</span></span>  
  
- <span data-ttu-id="286c2-210">クライアント資格情報は、最初のメッセージが送信される前に1回使用され、WCF クライアントインスタンスを使用してセキュリティコンテキストを確立します。</span><span class="sxs-lookup"><span data-stu-id="286c2-210">The client credentials are used once before the first message is sent, using the WCF client instance to establish a security context.</span></span> <span data-ttu-id="286c2-211">アプリケーション メッセージはすべて、そのセキュリティ コンテキストで保護されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-211">All application messages are then secured through the security context.</span></span>  
  
- <span data-ttu-id="286c2-212">サービスに送信されたアプリケーション メッセージごとの認証に、クライアント資格情報を使用します。</span><span class="sxs-lookup"><span data-stu-id="286c2-212">The client credentials are used to authenticate every application message sent to the service.</span></span> <span data-ttu-id="286c2-213">この場合、クライアントとサービスとの間にコンテキストは確立されません。</span><span class="sxs-lookup"><span data-stu-id="286c2-213">In this case, no context is established between the client and the service.</span></span>  
  
### <a name="established-identities-cannot-be-changed"></a><span data-ttu-id="286c2-214">変更できない確立された ID</span><span class="sxs-lookup"><span data-stu-id="286c2-214">Established Identities Cannot Be Changed</span></span>  
 <span data-ttu-id="286c2-215">1 つ目の方法を使用した場合、確立されたコンテキストは、クライアント ID に永続的に関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="286c2-215">When the first method is used, the established context is permanently associated with the client identity.</span></span> <span data-ttu-id="286c2-216">つまり、セキュリティ コンテキストが確立されると、クライアントに関連付けられた ID を変更できません。</span><span class="sxs-lookup"><span data-stu-id="286c2-216">That is, once the security context has been established, the identity associated with the client cannot be changed.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="286c2-217">ID の切り替えができないこと (つまり、セキュリティ コンテキストを確立する場合の既定の動作) について、注意が必要な状況があります。</span><span class="sxs-lookup"><span data-stu-id="286c2-217">There is a situation to be aware of when the identity cannot be switched (that is, when establish security context is on, the default behavior).</span></span> <span data-ttu-id="286c2-218">2番目のサービスと通信するサービスを作成した場合、2番目のサービスに対して WCF クライアントを開くために使用した id は変更できません。</span><span class="sxs-lookup"><span data-stu-id="286c2-218">If you create a service that communicates with a second service, the identity used to open the WCF client to the second service cannot be changed.</span></span> <span data-ttu-id="286c2-219">これは、複数のクライアントが最初のサービスを使用できる状況で、2 番目のサービスにアクセスするときに最初のサービスがクライアントを偽装する場合、問題になります。</span><span class="sxs-lookup"><span data-stu-id="286c2-219">This becomes a problem if multiple clients are allowed to use the first service and the service impersonates the clients when accessing the second service.</span></span> <span data-ttu-id="286c2-220">サービスがすべての呼び出し元に対して同じクライアントを再利用する場合、2 番目のサービスへの呼び出しはすべて、2 番目のサービスに対してクライアントを開くために使用した最初の呼び出し元の ID によって実行されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-220">If the service reuses the same client for all callers, all calls to the second service are done under the identity of the first caller that was used to open the client to the second service.</span></span> <span data-ttu-id="286c2-221">つまり、このサービスでは、すべてのクライアントが 2 番目のサービスと通信できるように、最初のクライアントの ID が使用されます。</span><span class="sxs-lookup"><span data-stu-id="286c2-221">In other words, the service uses the identity of the first client for all its clients to communicate with the second service.</span></span> <span data-ttu-id="286c2-222">これによって、権限の昇格が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="286c2-222">This can lead to the elevation of privilege.</span></span> <span data-ttu-id="286c2-223">これがサービスの目的の動作でない場合、各呼び出し元を追跡し、その呼び出し元ごとに 2 番目のサービスに対する新しいクライアントを作成する必要があります。これによって、適切な呼び出し元が 2 番目のサービスと通信するために、サービスは適切なクライアントだけを使用できます。</span><span class="sxs-lookup"><span data-stu-id="286c2-223">If this is not the desired behavior of your service, you must track each caller and create a new client to the second service for every distinct caller, and ensure that the service uses only the right client for the right caller to communicate with the second service.</span></span>  
  
 <span data-ttu-id="286c2-224">資格情報とセキュリティで保護されたセッションの詳細については、「[セキュリティの考慮事項](security-considerations-for-secure-sessions.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="286c2-224">For more information about credentials and secure sessions, see [Security Considerations for Secure Sessions](security-considerations-for-secure-sessions.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="286c2-225">関連項目</span><span class="sxs-lookup"><span data-stu-id="286c2-225">See also</span></span>

- <xref:System.ServiceModel.ClientBase%601?displayProperty=nameWithType>
- <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.ClientCredentials.ClientCertificate%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.BasicHttpMessageSecurity.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.HttpTransportSecurity.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.MessageSecurityOverHttp.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.MessageSecurityOverMsmq.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.MessageSecurityOverTcp.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.TcpTransportSecurity.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A?displayProperty=nameWithType>
- [<span data-ttu-id="286c2-226">セキュリティの概念</span><span class="sxs-lookup"><span data-stu-id="286c2-226">Security Concepts</span></span>](security-concepts.md)
- [<span data-ttu-id="286c2-227">サービスおよびクライアントのセキュリティ保護</span><span class="sxs-lookup"><span data-stu-id="286c2-227">Securing Services and Clients</span></span>](securing-services-and-clients.md)
- [<span data-ttu-id="286c2-228">WCF セキュリティのプログラミング</span><span class="sxs-lookup"><span data-stu-id="286c2-228">Programming WCF Security</span></span>](programming-wcf-security.md)
- [<span data-ttu-id="286c2-229">HTTP トランスポート セキュリティ</span><span class="sxs-lookup"><span data-stu-id="286c2-229">HTTP Transport Security</span></span>](http-transport-security.md)
