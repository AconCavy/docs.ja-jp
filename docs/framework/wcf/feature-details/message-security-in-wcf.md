---
title: WCF のメッセージのセキュリティ
ms.date: 03/30/2017
ms.assetid: a80efb59-591a-4a37-bb3c-8fffa6ca0b7d
ms.openlocfilehash: 32f6659f6ac744ab7af07c23e7e26ea1124d020c
ms.sourcegitcommit: 09b4090b78f52fd09b0e430cd4b26576f1fdf96e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/17/2020
ms.locfileid: "76212069"
---
# <a name="message-security-in-wcf"></a><span data-ttu-id="79b3d-102">WCF のメッセージのセキュリティ</span><span class="sxs-lookup"><span data-stu-id="79b3d-102">Message Security in WCF</span></span>

<span data-ttu-id="79b3d-103">Windows Communication Foundation (WCF) には、セキュリティを提供するための2つの主要モード (`Transport` と `Message`) と、2つのモードを組み合わせた3つのモード (`TransportWithMessageCredential`) があります。</span><span class="sxs-lookup"><span data-stu-id="79b3d-103">Windows Communication Foundation (WCF) has two major modes for providing security (`Transport` and `Message`) and a third mode (`TransportWithMessageCredential`) that combines the two.</span></span> <span data-ttu-id="79b3d-104">ここでは、メッセージ セキュリティとその必要性について説明します。</span><span class="sxs-lookup"><span data-stu-id="79b3d-104">This topic discusses message security and the reasons to use it.</span></span>

## <a name="what-is-message-security"></a><span data-ttu-id="79b3d-105">メッセージ セキュリティとは</span><span class="sxs-lookup"><span data-stu-id="79b3d-105">What Is Message Security?</span></span>

<span data-ttu-id="79b3d-106">メッセージ セキュリティでは、メッセージをセキュリティで保護するために WS-Security 仕様を使用します。</span><span class="sxs-lookup"><span data-stu-id="79b3d-106">Message security uses the WS-Security specification to secure messages.</span></span> <span data-ttu-id="79b3d-107">WS-SECURITY 仕様では、soap メッセージレベルで (トランスポートレベルではなく) 機密性、整合性、および認証を保証する SOAP メッセージングの機能強化について説明しています。</span><span class="sxs-lookup"><span data-stu-id="79b3d-107">The WS-Security specification describes enhancements to SOAP messaging to ensure confidentiality, integrity, and authentication at the SOAP message level (instead of the transport level).</span></span>

<span data-ttu-id="79b3d-108">簡単に言えば、メッセージ セキュリティでは、メッセージごとにセキュリティ資格情報とクレームが署名や暗号化などのメッセージ保護措置と共にカプセル化さるという点で、トランスポート セキュリティと異なります。</span><span class="sxs-lookup"><span data-stu-id="79b3d-108">In brief, message security differs from transport security by encapsulating the security credentials and claims with every message along with any message protection (signing or encryption).</span></span> <span data-ttu-id="79b3d-109">メッセージの内容を変更してメッセージに直接セキュリティを適用することによって、セキュリティで保護されたメッセージは、セキュリティ面で自己完結する形になります。</span><span class="sxs-lookup"><span data-stu-id="79b3d-109">Applying the security directly to the message by modifying its content allows the secured message to be self-containing with respect to the security aspects.</span></span> <span data-ttu-id="79b3d-110">これによって、トランスポート セキュリティでは実現できないシナリオが可能になります。</span><span class="sxs-lookup"><span data-stu-id="79b3d-110">This enables some scenarios that are not possible when transport security is used.</span></span>

## <a name="reasons-to-use-message-security"></a><span data-ttu-id="79b3d-111">メッセージ セキュリティを使用する理由</span><span class="sxs-lookup"><span data-stu-id="79b3d-111">Reasons to Use Message Security</span></span>

<span data-ttu-id="79b3d-112">メッセージ レベルのセキュリティでは、すべてのセキュリティ情報がメッセージ内にカプセル化されます。</span><span class="sxs-lookup"><span data-stu-id="79b3d-112">In message-level security, all of the security information is encapsulated in the message.</span></span> <span data-ttu-id="79b3d-113">トランスポート レベルのセキュリティではなく、メッセージ レベルのセキュリティを使用してメッセージをセキュリティで保護することによって、次の利点を得ることができます。</span><span class="sxs-lookup"><span data-stu-id="79b3d-113">Securing the message with message-level security instead of transport-level security has the following advantages:</span></span>

- <span data-ttu-id="79b3d-114">エンドツーエンドのセキュリティ。</span><span class="sxs-lookup"><span data-stu-id="79b3d-114">End-to-end security.</span></span> <span data-ttu-id="79b3d-115">SSL (Secure Sockets Layer) などのトランスポート セキュリティは、通信が Point-to-Point の場合にのみメッセージを保護します。</span><span class="sxs-lookup"><span data-stu-id="79b3d-115">Transport security, such as Secure Sockets Layer (SSL) only secures messages when the communication is point-to-point.</span></span> <span data-ttu-id="79b3d-116">メッセージが最終の受信者に到達する前に 1 つ以上の SOAP 中継局 (ルーターなど) にルーティングされる場合、中継局でネットワークからメッセージが読み取られると、そのメッセージ自体は保護されない状態になります。</span><span class="sxs-lookup"><span data-stu-id="79b3d-116">If the message is routed to one or more SOAP intermediaries (for example a router) before reaching the ultimate receiver, the message itself is not protected once an intermediary reads it from the wire.</span></span> <span data-ttu-id="79b3d-117">また、クライアントの認証情報は最初の中継局しか使用できず、必要に応じて帯域外の方法で、最終の受信者にその情報を転送する必要があります。</span><span class="sxs-lookup"><span data-stu-id="79b3d-117">Additionally, the client authentication information is available only to the first intermediary and must be re-transmitted to the ultimate receiver in out-of-band fashion, if necessary.</span></span> <span data-ttu-id="79b3d-118">これは、経路全体で各ホップ間に SSL セキュリティを使用している場合にも当てはまります。</span><span class="sxs-lookup"><span data-stu-id="79b3d-118">This applies even if the entire route uses SSL security between individual hops.</span></span> <span data-ttu-id="79b3d-119">メッセージ セキュリティはメッセージに直接作用し、メッセージ内の XML をセキュリティで保護するので、メッセージが最終の受信者に到達するまでに経由する中継局の数に関係なく、メッセージをセキュリティで保護できます。</span><span class="sxs-lookup"><span data-stu-id="79b3d-119">Because message security works directly with the message and secures the XML in it, the security stays with the message regardless of how many intermediaries are involved before it reaches the ultimate receiver.</span></span> <span data-ttu-id="79b3d-120">これによって、真の意味でエンド ツー エンドのセキュリティ シナリオが実現します。</span><span class="sxs-lookup"><span data-stu-id="79b3d-120">This enables a true end-to-end security scenario.</span></span>

- <span data-ttu-id="79b3d-121">柔軟性の向上。</span><span class="sxs-lookup"><span data-stu-id="79b3d-121">Increased flexibility.</span></span> <span data-ttu-id="79b3d-122">メッセージ全体ではなく、メッセージの一部を署名または暗号化できます。</span><span class="sxs-lookup"><span data-stu-id="79b3d-122">Parts of the message, instead of the entire message, can be signed or encrypted.</span></span> <span data-ttu-id="79b3d-123">つまり、中継局は、その中継局に対して用意されたメッセージの一部を確認できます。</span><span class="sxs-lookup"><span data-stu-id="79b3d-123">This means that intermediaries can view the parts of the message that are intended for them.</span></span> <span data-ttu-id="79b3d-124">メッセージ内の情報の一部を中継局に渡す必要があり、メッセージの改ざんを確実に防止する必要もある場合は、メッセージを暗号化せずに署名だけを行うことができます。</span><span class="sxs-lookup"><span data-stu-id="79b3d-124">If the sender needs to make part of the information in the message visible to the intermediaries but wants to ensure that it is not tampered with, it can just sign it but leave it unencrypted.</span></span> <span data-ttu-id="79b3d-125">署名はメッセージの一部なので、最終の受信者は受信メッセージ内の情報が元のままの状態であることを確認できます。</span><span class="sxs-lookup"><span data-stu-id="79b3d-125">Since the signature is part of the message, the ultimate receiver can verify that the information in the message was received intact.</span></span> <span data-ttu-id="79b3d-126">シナリオの 1 つとして、Action ヘッダーの値に従ってメッセージをルーティングする SOAP 中継局サービスが考えられます。</span><span class="sxs-lookup"><span data-stu-id="79b3d-126">One scenario might have a SOAP intermediary service that routes message according the Action header value.</span></span> <span data-ttu-id="79b3d-127">既定では、WCF はアクション値を暗号化しませんが、メッセージセキュリティが使用されている場合は署名します。</span><span class="sxs-lookup"><span data-stu-id="79b3d-127">By default, WCF does not encrypt the Action value but signs it if message security is used.</span></span> <span data-ttu-id="79b3d-128">この情報はすべての中継局で使用できますが、変更はできなくなります。</span><span class="sxs-lookup"><span data-stu-id="79b3d-128">Therefore, this information is available to all intermediaries, but no one can change it.</span></span>

- <span data-ttu-id="79b3d-129">複数のトランスポートに対するサポート。</span><span class="sxs-lookup"><span data-stu-id="79b3d-129">Support for multiple transports.</span></span> <span data-ttu-id="79b3d-130">複数のトランスポートに対するサポート : セキュリティ用のプロトコルに依存することなく、名前付きパイプ、TCP などの複数の異なるトランスポートを経由して、セキュリティで保護されたメッセージを送信できます。</span><span class="sxs-lookup"><span data-stu-id="79b3d-130">You can send secured messages over many different transports, such as named pipes and TCP, without having to rely on the protocol for security.</span></span> <span data-ttu-id="79b3d-131">トランスポート レベルのセキュリティでは、すべてのセキュリティ情報の有効範囲が 1 つの特定のトランスポート接続に限定されるので、メッセージの内容からその情報を使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="79b3d-131">With transport-level security, all the security information is scoped to a single particular transport connection and is not available from the message content itself.</span></span> <span data-ttu-id="79b3d-132">メッセージ セキュリティでは、メッセージの送信に使用するトランスポートの種類に関係なく、メッセージがセキュリティで保護されます。セキュリティ コンテキストはメッセージの内部に直接埋め込まれます。</span><span class="sxs-lookup"><span data-stu-id="79b3d-132">Message security makes the message secure regardless of what transport you use to transmit the message, and the security context is directly embedded inside the message.</span></span>

- <span data-ttu-id="79b3d-133">資格情報とクレームのセットを広範囲にサポート。</span><span class="sxs-lookup"><span data-stu-id="79b3d-133">Support for a wide set of credentials and claims.</span></span> <span data-ttu-id="79b3d-134">メッセージ セキュリティは、SOAP メッセージの内部で任意の種類のクレームを送信できる拡張可能なフレームワークを提供する WS-Security 仕様に基づいています。</span><span class="sxs-lookup"><span data-stu-id="79b3d-134">The message security is based on the WS-Security specification, which provides an extensible framework capable of transmitting any type of claim inside the SOAP message.</span></span> <span data-ttu-id="79b3d-135">トランスポート セキュリティとは異なり、使用できる認証機構またはクレームはトランスポートの機能によって制限されません。</span><span class="sxs-lookup"><span data-stu-id="79b3d-135">Unlike transport security, the set of authentication mechanisms, or claims, that you can use is not limited by the transport capabilities.</span></span> <span data-ttu-id="79b3d-136">WCF メッセージセキュリティには、複数の種類の認証とクレーム転送が含まれており、必要に応じて追加の型をサポートするように拡張できます。</span><span class="sxs-lookup"><span data-stu-id="79b3d-136">WCF message security includes multiple types of authentication and claim transmission and can be extended to support additional types as necessary.</span></span> <span data-ttu-id="79b3d-137">このため、たとえば、フェデレーション資格情報シナリオは、メッセージ セキュリティなしでは実現できません。</span><span class="sxs-lookup"><span data-stu-id="79b3d-137">For those reasons, for example, a federated credentials scenario is not possible without message security.</span></span> <span data-ttu-id="79b3d-138">WCF がサポートするフェデレーションシナリオの詳細については、「[フェデレーションと発行済みトークン](../../../../docs/framework/wcf/feature-details/federation-and-issued-tokens.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="79b3d-138">For more information about federation scenarios WCF supports, see [Federation and Issued Tokens](../../../../docs/framework/wcf/feature-details/federation-and-issued-tokens.md).</span></span>

## <a name="how-message-and-transport-security-compare"></a><span data-ttu-id="79b3d-139">メッセージ セキュリティとトランスポート セキュリティの比較</span><span class="sxs-lookup"><span data-stu-id="79b3d-139">How Message and Transport Security Compare</span></span>

### <a name="pros-and-cons-of-transport-level-security"></a><span data-ttu-id="79b3d-140">トランスポート レベルのセキュリティの利点と欠点</span><span class="sxs-lookup"><span data-stu-id="79b3d-140">Pros and Cons of Transport-Level Security</span></span>

<span data-ttu-id="79b3d-141">トランスポート セキュリティの利点は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="79b3d-141">Transport security has the following advantages:</span></span>

- <span data-ttu-id="79b3d-142">通信元と通信先では XML レベルのセキュリティ概念を理解する必要がありません。</span><span class="sxs-lookup"><span data-stu-id="79b3d-142">Does not require that the communicating parties understand XML-level security concepts.</span></span> <span data-ttu-id="79b3d-143">このため、たとえば、通信のセキュリティ保護に HTTPS が使用されている場合に相互運用性が向上します。</span><span class="sxs-lookup"><span data-stu-id="79b3d-143">This can improve the interoperability, for example, when HTTPS is used to secure the communication.</span></span>

- <span data-ttu-id="79b3d-144">パフォーマンスが全般的に向上します。</span><span class="sxs-lookup"><span data-stu-id="79b3d-144">Generally improved performance.</span></span>

- <span data-ttu-id="79b3d-145">ハードウェア アクセラレータを使用できます。</span><span class="sxs-lookup"><span data-stu-id="79b3d-145">Hardware accelerators are available.</span></span>

- <span data-ttu-id="79b3d-146">ストリーミングが可能です。</span><span class="sxs-lookup"><span data-stu-id="79b3d-146">Streaming is possible.</span></span>

 <span data-ttu-id="79b3d-147">トランスポート セキュリティの欠点は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="79b3d-147">Transport security has the following disadvantages:</span></span>

- <span data-ttu-id="79b3d-148">セキュリティが提供されるのはホップからホップのみです。</span><span class="sxs-lookup"><span data-stu-id="79b3d-148">Hop-to-hop only.</span></span>

- <span data-ttu-id="79b3d-149">資格情報のセットが制限され、拡張はできません。</span><span class="sxs-lookup"><span data-stu-id="79b3d-149">Limited and inextensible set of credentials.</span></span>

- <span data-ttu-id="79b3d-150">トランスポートに依存します。</span><span class="sxs-lookup"><span data-stu-id="79b3d-150">Transport-dependent.</span></span>

### <a name="disadvantages-of-message-level-security"></a><span data-ttu-id="79b3d-151">メッセージ レベルのセキュリティの欠点</span><span class="sxs-lookup"><span data-stu-id="79b3d-151">Disadvantages of Message-Level Security</span></span>

<span data-ttu-id="79b3d-152">メッセージ セキュリティの欠点は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="79b3d-152">Message security has the following disadvantages:</span></span>

- <span data-ttu-id="79b3d-153">パフォーマンス</span><span class="sxs-lookup"><span data-stu-id="79b3d-153">Performance</span></span>

- <span data-ttu-id="79b3d-154">メッセージ ストリーミングを使用できません。</span><span class="sxs-lookup"><span data-stu-id="79b3d-154">Cannot use message streaming.</span></span>

- <span data-ttu-id="79b3d-155">XML レベルのセキュリティ機構の実装と WS-Security 仕様のサポートが必要です。</span><span class="sxs-lookup"><span data-stu-id="79b3d-155">Requires implementation of XML-level security mechanisms and support for WS-Security specification.</span></span> <span data-ttu-id="79b3d-156">これは、相互運用性に影響する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="79b3d-156">This might affect the interoperability.</span></span>

## <a name="see-also"></a><span data-ttu-id="79b3d-157">関連項目</span><span class="sxs-lookup"><span data-stu-id="79b3d-157">See also</span></span>

- [<span data-ttu-id="79b3d-158">Securing Services and Clients</span><span class="sxs-lookup"><span data-stu-id="79b3d-158">Securing Services and Clients</span></span>](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)
- [<span data-ttu-id="79b3d-159">トランスポート セキュリティ</span><span class="sxs-lookup"><span data-stu-id="79b3d-159">Transport Security</span></span>](../../../../docs/framework/wcf/feature-details/transport-security.md)
- [<span data-ttu-id="79b3d-160">方法 : トランスポート セキュリティとメッセージ資格情報を使用する</span><span class="sxs-lookup"><span data-stu-id="79b3d-160">How to: Use Transport Security and Message Credentials</span></span>](../../../../docs/framework/wcf/feature-details/how-to-use-transport-security-and-message-credentials.md)
- <span data-ttu-id="79b3d-161">[Microsoft のパターンとプラクティス、第3章: トランスポートとメッセージ層のセキュリティの実装](https://docs.microsoft.com/previous-versions/msp-n-p/ff647370(v=pandp.10))</span><span class="sxs-lookup"><span data-stu-id="79b3d-161">[Microsoft Patterns and Practices, Chapter 3: Implementing Transport and Message Layer Security](https://docs.microsoft.com/previous-versions/msp-n-p/ff647370(v=pandp.10))</span></span>
