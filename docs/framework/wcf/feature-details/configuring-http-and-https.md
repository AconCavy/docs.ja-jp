---
title: HTTP および HTTPS の構成
ms.date: 04/08/2019
helpviewer_keywords:
- configuring HTTP [WCF]
ms.assetid: b0c29a86-bc0c-41b3-bc1e-4eb5bb5714d4
ms.openlocfilehash: f7fd2bad6ced09b638cc1bb5d539fab1b9ce7d25
ms.sourcegitcommit: 30a558d23e3ac5a52071121a52c305c85fe15726
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/25/2019
ms.locfileid: "75336699"
---
# <a name="configuring-http-and-https"></a><span data-ttu-id="f2a3b-102">HTTP および HTTPS の構成</span><span class="sxs-lookup"><span data-stu-id="f2a3b-102">Configuring HTTP and HTTPS</span></span>

<span data-ttu-id="f2a3b-103">WCF サービスと WCF クライアントは、HTTP および HTTPS を介して通信できます。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-103">WCF services and clients can communicate over HTTP and HTTPS.</span></span> <span data-ttu-id="f2a3b-104">HTTP または HTTPS の設定は、インターネット インフォメーション サービス (IIS) またはコマンド ライン ツールを使用して構成します。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-104">The HTTP/HTTPS settings are configured by using Internet Information Services (IIS) or through the use of a command-line tool.</span></span> <span data-ttu-id="f2a3b-105">WCF サービスが IIS でホストされている場合は、IIS 内で HTTP または HTTPS の設定を構成できます (inetmgr.exe ツールを使用)。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-105">When a WCF service is hosted under IIS HTTP or HTTPS settings can be configured within IIS (using the inetmgr.exe tool).</span></span> <span data-ttu-id="f2a3b-106">WCF サービスが自己ホスト型の場合は、コマンド ライン ツールを使用して HTTP または HTTPS の設定を構成します。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-106">If a WCF service is self-hosted, HTTP or HTTPS settings are configured by using a command-line tool.</span></span>

<span data-ttu-id="f2a3b-107">少なくとも、URL 登録を構成し、サービスが使用する URL に対してファイアウォールの例外を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-107">At a minimum, you want to configure a URL registration and add a Firewall exception for the URL your service will be using.</span></span> <span data-ttu-id="f2a3b-108">これらの設定は、Netsh.exe ツールを使用して構成できます。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-108">You can configure these settings with the Netsh.exe tool.</span></span>

## <a name="configuring-namespace-reservations"></a><span data-ttu-id="f2a3b-109">名前空間予約の構成</span><span class="sxs-lookup"><span data-stu-id="f2a3b-109">Configuring namespace reservations</span></span>

<span data-ttu-id="f2a3b-110">名前空間予約では、HTTP URL 名前空間の一部に対する権限を特定のユーザー グループに割り当てます。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-110">Namespace reservation assigns the rights for a portion of the HTTP URL namespace to a particular group of users.</span></span> <span data-ttu-id="f2a3b-111">予約により、これらのユーザーには名前空間のその部分をリッスンするサービスを作成する権利が与えられます。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-111">A reservation gives those users the right to create services that listen on that portion of the namespace.</span></span> <span data-ttu-id="f2a3b-112">予約は、予約パスのすべてのサブパスを対象とする URL プレフィックスです。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-112">Reservations are URL prefixes, meaning that the reservation covers all subpaths of the reservation path.</span></span> <span data-ttu-id="f2a3b-113">名前空間予約では、2 つの方法でワイルドカードを使用できます。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-113">Namespace reservations permit two ways to use wildcards.</span></span> <span data-ttu-id="f2a3b-114">HTTP Server API ドキュメントでは、[ワイルドカードを含む名前空間クレーム間の解決の順序](/windows/desktop/Http/routing-incoming-requests)について説明します。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-114">The HTTP Server API documentation describes the [order of resolution between namespace claims that involve wildcards](/windows/desktop/Http/routing-incoming-requests).</span></span>

<span data-ttu-id="f2a3b-115">実行中のアプリケーションは、同様の要求を作成して、名前空間登録を追加できます。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-115">A running application can create a similar request to add namespace registrations.</span></span> <span data-ttu-id="f2a3b-116">名前空間の同じ部分について、登録と予約の間で競合が発生します。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-116">Registrations and reservations compete for portions of the namespace.</span></span> <span data-ttu-id="f2a3b-117">[ワイルドカードを含む名前空間クレーム間の解決](/windows/desktop/Http/routing-incoming-requests)順序に従って、予約が優先順位に従って、登録より優先される場合があります。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-117">A reservation may have precedence over a registration according to the order of resolution given in the [order of resolution between namespace claims that involve wildcards](/windows/desktop/Http/routing-incoming-requests).</span></span> <span data-ttu-id="f2a3b-118">この場合、実行中のアプリケーションがクレームを受信する動作が、予約によってブロックされます。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-118">In this case, the reservation blocks the running application from receiving requests.</span></span>

<span data-ttu-id="f2a3b-119">次の例では、Netsh.exe ツールを使用します。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-119">The following example uses the Netsh.exe tool:</span></span>

```console
netsh http add urlacl url=http://+:80/MyUri user=DOMAIN\user
```

<span data-ttu-id="f2a3b-120">このコマンドは、DOMAIN\user アカウントの指定した URL 名前空間の URL 予約を追加します。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-120">This command adds a URL reservation for the specified URL namespace for the DOMAIN\user account.</span></span> <span data-ttu-id="f2a3b-121">Netsh コマンドの使用方法の詳細については、コマンドプロンプトで「`netsh http add urlacl /?`」と入力し、Enter キーを押します。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-121">For more information on using the netsh command, type `netsh http add urlacl /?` in a command-prompt and press Enter.</span></span>

## <a name="configuring-a-firewall-exception"></a><span data-ttu-id="f2a3b-122">ファイアウォールの例外の構成</span><span class="sxs-lookup"><span data-stu-id="f2a3b-122">Configuring a firewall exception</span></span>

<span data-ttu-id="f2a3b-123">HTTP 経由の通信を行う WCF サービスを自己ホストする際は、例外をファイアウォール構成に追加して、特定の URL を使用した着信接続を可能にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-123">When self-hosting a WCF service that communicates over HTTP, an exception must be added to the firewall configuration to allow inbound connections using a particular URL.</span></span>

## <a name="configuring-ssl-certificates"></a><span data-ttu-id="f2a3b-124">SSL 証明書の構成</span><span class="sxs-lookup"><span data-stu-id="f2a3b-124">Configuring SSL certificates</span></span>

<span data-ttu-id="f2a3b-125">SSL (Secure Sockets Layer) プロトコルは、クライアントとサーバー上で証明書を使用して暗号化キーを格納します。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-125">The Secure Sockets Layer (SSL) protocol uses certificates on the client and server to store encryption keys.</span></span> <span data-ttu-id="f2a3b-126">サーバーは、クライアントがサーバーの ID を検証できるように接続時に SSL 証明書を提供します。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-126">The server provides its SSL certificate when a connection is made so that the client can verify the server identity.</span></span> <span data-ttu-id="f2a3b-127">また、サーバーはクライアントに証明書を要求して、接続の両側で相互認証を実行することもできます。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-127">The server can also request a certificate from the client to provide mutual authentication of both sides of the connection.</span></span>

<span data-ttu-id="f2a3b-128">証明書は、接続の IP アドレスとポート番号に基づいて集中ストアに格納されます。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-128">Certificates are stored in a centralized store according to the IP address and port number of the connection.</span></span> <span data-ttu-id="f2a3b-129">特別な IP アドレス 0.0.0.0 は、ローカル コンピューターの任意の IP アドレスに一致します。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-129">The special IP address 0.0.0.0 matches any IP address for the local machine.</span></span> <span data-ttu-id="f2a3b-130">証明書ストアは、パスに基づいて Url を区別しないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-130">Note that the certificate store doesn't distinguish URLs based on the path.</span></span> <span data-ttu-id="f2a3b-131">同じ IP アドレスとポートの組み合わせを持つサービスは、そのサービスの URL でのパスが異なる場合でも証明書を共有する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-131">Services with the same IP address and port combination must share certificates even if the path in the URL for the services is different.</span></span>

<span data-ttu-id="f2a3b-132">詳細な手順については、「[方法: SSL 証明書を使用してポートを構成する](how-to-configure-a-port-with-an-ssl-certificate.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-132">For step-by-step instructions, see [How to: Configure a Port with an SSL Certificate](how-to-configure-a-port-with-an-ssl-certificate.md).</span></span>

## <a name="configuring-the-ip-listen-list"></a><span data-ttu-id="f2a3b-133">IP リッスン一覧の構成</span><span class="sxs-lookup"><span data-stu-id="f2a3b-133">Configuring the IP Listen List</span></span>

<span data-ttu-id="f2a3b-134">HTTP Server API は、ユーザーが URL を登録すると、IP アドレスとポートだけにバインドします。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-134">The HTTP Server API only binds to an IP address and port once a user registers a URL.</span></span> <span data-ttu-id="f2a3b-135">既定では、HTTP Server API は、コンピューターのすべての IP アドレスに対して、URL でポートにバインドします。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-135">By default, the HTTP Server API binds to the port in the URL for all of the IP addresses of the machine.</span></span> <span data-ttu-id="f2a3b-136">HTTP サーバー API を使用していないアプリケーションが、以前に IP アドレスとポートの組み合わせにバインドされている場合、競合が発生します。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-136">A conflict arises if an application that doesn't use the HTTP Server API has previously bound to that combination of IP address and port.</span></span> <span data-ttu-id="f2a3b-137">IP リッスン一覧を使用すると、コンピューターの一部の IP アドレスに対してポートを使用するアプリケーションと WCF サービスを共存させることができます。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-137">The IP Listen List allows WCF services to coexist with applications that use a port for some of the IP addresses of the machine.</span></span> <span data-ttu-id="f2a3b-138">IP リッスン一覧にエントリがある場合、HTTP Server API は、その一覧に指定されている IP アドレスだけにバインドします。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-138">If the IP Listen List contains any entries, the HTTP Server API only binds to those IP addresses that the list specifies.</span></span> <span data-ttu-id="f2a3b-139">IP リッスン一覧を変更するには、管理特権が必要です。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-139">Modifying the IP Listen List requires administrative privileges.</span></span>

<span data-ttu-id="f2a3b-140">次の例に示すように、netsh ツールを使用して IP リッスン一覧を変更します。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-140">Use the netsh tool to modify the IP Listen List, as shown in the following example:</span></span>

```console
netsh http add iplisten ipaddress=0.0.0.0:8000
```

## <a name="other-configuration-settings"></a><span data-ttu-id="f2a3b-141">その他の構成設定</span><span class="sxs-lookup"><span data-stu-id="f2a3b-141">Other configuration settings</span></span>

<span data-ttu-id="f2a3b-142"><xref:System.ServiceModel.WSDualHttpBinding> を使用すると、クライアント接続では、名前空間予約と Windows ファイアウォールに対応できる既定値が使用されます。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-142">When using <xref:System.ServiceModel.WSDualHttpBinding>, the client connection uses defaults that are compatible with namespace reservations and the Windows firewall.</span></span> <span data-ttu-id="f2a3b-143">双方向接続のクライアント ベース アドレスをカスタマイズする場合、クライアント上で HTTP 設定を行い、新しいアドレスに一致させる必要があります。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-143">If you choose to customize the client base address of a dual connection, then you also must configure these HTTP settings on the client to match the new address.</span></span>

<span data-ttu-id="f2a3b-144">HTTP サーバー API には、Httpcfg.exe では利用できない高度な構成設定がいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-144">The HTTP Server API has some advanced configuration settings that aren't available through HttpCfg.</span></span> <span data-ttu-id="f2a3b-145">この設定は、レジストリで管理され、HTTP Server API を使用するシステムで実行中のすべてのアプリケーションに適用されます。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-145">These settings are maintained in the registry and apply to all applications running on the systems that use the HTTP Server APIs.</span></span> <span data-ttu-id="f2a3b-146">これらの設定の詳細については、「 [IIS の http.sys レジストリ設定](https://support.microsoft.com/help/820129/http-sys-registry-settings-for-windows)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-146">For information about these settings, see [Http.sys registry settings for IIS](https://support.microsoft.com/help/820129/http-sys-registry-settings-for-windows).</span></span> <span data-ttu-id="f2a3b-147">ほとんどのユーザーは、これらの設定を変更する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="f2a3b-147">Most users don't need to change these settings.</span></span>

## <a name="see-also"></a><span data-ttu-id="f2a3b-148">関連項目</span><span class="sxs-lookup"><span data-stu-id="f2a3b-148">See also</span></span>

- <xref:System.ServiceModel.WSDualHttpBinding>
- [<span data-ttu-id="f2a3b-149">方法 : SSL 証明書を使用してポートを構成する</span><span class="sxs-lookup"><span data-stu-id="f2a3b-149">How to: Configure a Port with an SSL Certificate</span></span>](how-to-configure-a-port-with-an-ssl-certificate.md)
