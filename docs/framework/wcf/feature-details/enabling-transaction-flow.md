---
title: トランザクション フローの有効化
ms.date: 03/30/2017
helpviewer_keywords:
- transactions [WCF], enabling flow
ms.assetid: a03f5041-5049-43f4-897c-e0292d4718f7
ms.openlocfilehash: 8aff6afb09c97d7d01f5e7b7f1b92ae24bb99fb7
ms.sourcegitcommit: fbb8a593a511ce667992502a3ce6d8f65c594edf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/16/2019
ms.locfileid: "74141753"
---
# <a name="enabling-transaction-flow"></a><span data-ttu-id="a2f96-102">トランザクション フローの有効化</span><span class="sxs-lookup"><span data-stu-id="a2f96-102">Enabling Transaction Flow</span></span>
<span data-ttu-id="a2f96-103">Windows Communication Foundation (WCF) では、トランザクションフローを制御するための柔軟なオプションが用意されています。</span><span class="sxs-lookup"><span data-stu-id="a2f96-103">Windows Communication Foundation (WCF) provides highly flexible options for controlling transaction flow.</span></span> <span data-ttu-id="a2f96-104">サービスのトランザクション フローの設定は、属性と構成の組み合わせを使用して表すことができます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-104">A service's transaction flow settings can be expressed using a combination of attributes and configuration.</span></span>  
  
## <a name="transaction-flow-settings"></a><span data-ttu-id="a2f96-105">トランザクション フローの設定</span><span class="sxs-lookup"><span data-stu-id="a2f96-105">Transaction Flow Settings</span></span>  
 <span data-ttu-id="a2f96-106">トランザクション フローの設定は、次の 3 つの値の積集合の結果として、サービス エンドポイントに対して生成されます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-106">Transaction flow settings are generated for a service endpoint as a result of the intersection of the following three values:</span></span>  
  
- <span data-ttu-id="a2f96-107">サービス コントラクトの各メソッドに指定された <xref:System.ServiceModel.TransactionFlowAttribute> 属性。</span><span class="sxs-lookup"><span data-stu-id="a2f96-107">The <xref:System.ServiceModel.TransactionFlowAttribute> attribute specified for each method in the service contract.</span></span>  
  
- <span data-ttu-id="a2f96-108">特定のバインディングの `TransactionFlow` バインディング プロパティ。</span><span class="sxs-lookup"><span data-stu-id="a2f96-108">The `TransactionFlow` binding property in the specific binding.</span></span>  
  
- <span data-ttu-id="a2f96-109">特定のバインディングの `TransactionFlowProtocol` バインディング プロパティ。</span><span class="sxs-lookup"><span data-stu-id="a2f96-109">The `TransactionFlowProtocol` binding property in the specific binding.</span></span> <span data-ttu-id="a2f96-110">`TransactionFlowProtocol` バインディング プロパティでは、トランザクションをフローさせるために使用できる 2 つのトランザクション プロトコルのいずれかを選択できます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-110">The `TransactionFlowProtocol` binding property enables you to choose among two different transaction protocols that you can use to flow a transaction.</span></span> <span data-ttu-id="a2f96-111">次のセクションでは、これらのプロパティについてそれぞれ簡単に説明します。</span><span class="sxs-lookup"><span data-stu-id="a2f96-111">The following sections briefly describe each of them.</span></span>  
  
### <a name="ws-atomictransaction-protocol"></a><span data-ttu-id="a2f96-112">WS-AtomicTransaction プロトコル</span><span class="sxs-lookup"><span data-stu-id="a2f96-112">WS-AtomicTransaction Protocol</span></span>  
 <span data-ttu-id="a2f96-113">サード パーティのプロトコル スタックとの相互運用性が必要なシナリオでは、WS-AT (WS-AtomicTransaction) プロトコルが有用です。</span><span class="sxs-lookup"><span data-stu-id="a2f96-113">The WS-AtomicTransaction (WS-AT) protocol is useful for scenarios when interoperability with third-party protocol stacks is required.</span></span>  
  
### <a name="oletransactions-protocol"></a><span data-ttu-id="a2f96-114">OleTransactions プロトコル</span><span class="sxs-lookup"><span data-stu-id="a2f96-114">OleTransactions Protocol</span></span>  
 <span data-ttu-id="a2f96-115">OleTransactions プロトコルは、サードパーティのプロトコル スタックとの相互運用性が必要ではなく、WS-AT プロトコル サービスがローカルで無効になっていること、または既存のネットワーク トポロジが WS-AT の使用に向いていないことがサービスを配置する前に既にわかっている場合に有効です。</span><span class="sxs-lookup"><span data-stu-id="a2f96-115">The OleTransactions protocol is useful for scenarios when interoperability with third-party protocol stacks is not required, and the deployer of a service knows in advance that the WS-AT protocol service is disabled locally or the existing network topology does not favor the usage of WS-AT.</span></span>  
  
 <span data-ttu-id="a2f96-116">これらのさまざまな組み合わせを使用して生成できるトランザクション フローの種類を次の表に示します。</span><span class="sxs-lookup"><span data-stu-id="a2f96-116">The following table shows the different types of transaction flows that can be generated using these various combinations.</span></span>  
  
|<span data-ttu-id="a2f96-117">TransactionFlow</span><span class="sxs-lookup"><span data-stu-id="a2f96-117">TransactionFlow</span></span><br /><br /> <span data-ttu-id="a2f96-118">バインド</span><span class="sxs-lookup"><span data-stu-id="a2f96-118">binding</span></span>|<span data-ttu-id="a2f96-119">TransactionFlow バインディング プロパティ</span><span class="sxs-lookup"><span data-stu-id="a2f96-119">TransactionFlow binding property</span></span>|<span data-ttu-id="a2f96-120">TransactionFlowProtocol バインディング プロパティ</span><span class="sxs-lookup"><span data-stu-id="a2f96-120">TransactionFlowProtocol binding protocol</span></span>|<span data-ttu-id="a2f96-121">トランザクション フローの種類</span><span class="sxs-lookup"><span data-stu-id="a2f96-121">Type of transaction flow</span></span>|  
|---------------------------------|--------------------------------------|----------------------------------------------|------------------------------|  
|<span data-ttu-id="a2f96-122">必須</span><span class="sxs-lookup"><span data-stu-id="a2f96-122">Mandatory</span></span>|<span data-ttu-id="a2f96-123">TRUE</span><span class="sxs-lookup"><span data-stu-id="a2f96-123">true</span></span>|<span data-ttu-id="a2f96-124">WS-AT</span><span class="sxs-lookup"><span data-stu-id="a2f96-124">WS-AT</span></span>|<span data-ttu-id="a2f96-125">トランザクションは、相互運用可能な WS-AT 形式でフローさせる必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2f96-125">Transaction must be flowed in the interoperable WS-AT format.</span></span>|  
|<span data-ttu-id="a2f96-126">必須</span><span class="sxs-lookup"><span data-stu-id="a2f96-126">Mandatory</span></span>|<span data-ttu-id="a2f96-127">TRUE</span><span class="sxs-lookup"><span data-stu-id="a2f96-127">true</span></span>|<span data-ttu-id="a2f96-128">OleTransactions</span><span class="sxs-lookup"><span data-stu-id="a2f96-128">OleTransactions</span></span>|<span data-ttu-id="a2f96-129">トランザクションは、WCF OleTransactions 形式でフローさせる必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2f96-129">Transaction must be flowed in the WCF OleTransactions format.</span></span>|  
|<span data-ttu-id="a2f96-130">必須</span><span class="sxs-lookup"><span data-stu-id="a2f96-130">Mandatory</span></span>|<span data-ttu-id="a2f96-131">False</span><span class="sxs-lookup"><span data-stu-id="a2f96-131">false</span></span>|<span data-ttu-id="a2f96-132">利用不可</span><span class="sxs-lookup"><span data-stu-id="a2f96-132">Not applicable</span></span>|<span data-ttu-id="a2f96-133">この構成は無効なため、適用できません。</span><span class="sxs-lookup"><span data-stu-id="a2f96-133">Not applicable because this is an invalid configuration.</span></span>|  
|<span data-ttu-id="a2f96-134">Allowed</span><span class="sxs-lookup"><span data-stu-id="a2f96-134">Allowed</span></span>|<span data-ttu-id="a2f96-135">TRUE</span><span class="sxs-lookup"><span data-stu-id="a2f96-135">true</span></span>|<span data-ttu-id="a2f96-136">WS-AT</span><span class="sxs-lookup"><span data-stu-id="a2f96-136">WS-AT</span></span>|<span data-ttu-id="a2f96-137">トランザクションは、相互運用可能な WS-AT 形式でフローさせることができます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-137">Transaction may be flowed in the interoperable WS-AT format.</span></span>|  
|<span data-ttu-id="a2f96-138">Allowed</span><span class="sxs-lookup"><span data-stu-id="a2f96-138">Allowed</span></span>|<span data-ttu-id="a2f96-139">TRUE</span><span class="sxs-lookup"><span data-stu-id="a2f96-139">true</span></span>|<span data-ttu-id="a2f96-140">OleTransactions</span><span class="sxs-lookup"><span data-stu-id="a2f96-140">OleTransactions</span></span>|<span data-ttu-id="a2f96-141">トランザクションは、WCF OleTransactions 形式でフローさせることができます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-141">Transaction may be flowed in the WCF OleTransactions format.</span></span>|  
|<span data-ttu-id="a2f96-142">Allowed</span><span class="sxs-lookup"><span data-stu-id="a2f96-142">Allowed</span></span>|<span data-ttu-id="a2f96-143">False</span><span class="sxs-lookup"><span data-stu-id="a2f96-143">false</span></span>|<span data-ttu-id="a2f96-144">任意の値</span><span class="sxs-lookup"><span data-stu-id="a2f96-144">Any value</span></span>|<span data-ttu-id="a2f96-145">トランザクションは送信されません。</span><span class="sxs-lookup"><span data-stu-id="a2f96-145">A transaction is not flowed.</span></span>|  
|<span data-ttu-id="a2f96-146">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="a2f96-146">NotAllowed</span></span>|<span data-ttu-id="a2f96-147">任意の値</span><span class="sxs-lookup"><span data-stu-id="a2f96-147">Any value</span></span>|<span data-ttu-id="a2f96-148">任意の値</span><span class="sxs-lookup"><span data-stu-id="a2f96-148">Any value</span></span>|<span data-ttu-id="a2f96-149">トランザクションは送信されません。</span><span class="sxs-lookup"><span data-stu-id="a2f96-149">A transaction is not flowed.</span></span>|  
  
 <span data-ttu-id="a2f96-150">メッセージ処理の結果を次の表にまとめます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-150">The following table summarizes the message processing result.</span></span>  
  
|<span data-ttu-id="a2f96-151">受信メッセージ</span><span class="sxs-lookup"><span data-stu-id="a2f96-151">Incoming message</span></span>|<span data-ttu-id="a2f96-152">トランザクション フローの設定</span><span class="sxs-lookup"><span data-stu-id="a2f96-152">TransactionFlow setting</span></span>|<span data-ttu-id="a2f96-153">トランザクション ヘッダー</span><span class="sxs-lookup"><span data-stu-id="a2f96-153">Transaction header</span></span>|<span data-ttu-id="a2f96-154">メッセージ処理の結果</span><span class="sxs-lookup"><span data-stu-id="a2f96-154">Message processing result</span></span>|  
|----------------------|-----------------------------|------------------------|-------------------------------|  
|<span data-ttu-id="a2f96-155">トランザクションは予期されたプロトコル形式に一致します</span><span class="sxs-lookup"><span data-stu-id="a2f96-155">Transaction matches expected protocol format</span></span>|<span data-ttu-id="a2f96-156">Allowed または Mandatory</span><span class="sxs-lookup"><span data-stu-id="a2f96-156">Allowed or Mandatory</span></span>|<span data-ttu-id="a2f96-157">`MustUnderstand` と `true` は等しい。</span><span class="sxs-lookup"><span data-stu-id="a2f96-157">`MustUnderstand` equals `true`.</span></span>|<span data-ttu-id="a2f96-158">プロセス</span><span class="sxs-lookup"><span data-stu-id="a2f96-158">Process</span></span>|  
|<span data-ttu-id="a2f96-159">トランザクションは予期されたプロトコル形式に一致しません</span><span class="sxs-lookup"><span data-stu-id="a2f96-159">Transaction does not match expected protocol format</span></span>|<span data-ttu-id="a2f96-160">必須</span><span class="sxs-lookup"><span data-stu-id="a2f96-160">Mandatory</span></span>|<span data-ttu-id="a2f96-161">`MustUnderstand` と `false` は等しい。</span><span class="sxs-lookup"><span data-stu-id="a2f96-161">`MustUnderstand` equals `false`.</span></span>|<span data-ttu-id="a2f96-162">トランザクションが必須のため拒否</span><span class="sxs-lookup"><span data-stu-id="a2f96-162">Rejected because a transaction is required</span></span>|  
|<span data-ttu-id="a2f96-163">トランザクションは予期されたプロトコル形式に一致しません</span><span class="sxs-lookup"><span data-stu-id="a2f96-163">Transaction does not match expected protocol format</span></span>|<span data-ttu-id="a2f96-164">Allowed</span><span class="sxs-lookup"><span data-stu-id="a2f96-164">Allowed</span></span>|<span data-ttu-id="a2f96-165">`MustUnderstand` と `false` は等しい。</span><span class="sxs-lookup"><span data-stu-id="a2f96-165">`MustUnderstand` equals `false`.</span></span>|<span data-ttu-id="a2f96-166">ヘッダーが認識されないため拒否</span><span class="sxs-lookup"><span data-stu-id="a2f96-166">Rejected because the header is not understood</span></span>|  
|<span data-ttu-id="a2f96-167">任意のプロトコル形式を使用しているトランザクション</span><span class="sxs-lookup"><span data-stu-id="a2f96-167">Transaction using any protocol format</span></span>|<span data-ttu-id="a2f96-168">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="a2f96-168">NotAllowed</span></span>|<span data-ttu-id="a2f96-169">`MustUnderstand` と `false` は等しい。</span><span class="sxs-lookup"><span data-stu-id="a2f96-169">`MustUnderstand` equals `false`.</span></span>|<span data-ttu-id="a2f96-170">ヘッダーが認識されないため拒否</span><span class="sxs-lookup"><span data-stu-id="a2f96-170">Rejected because the header is not understood</span></span>|  
|<span data-ttu-id="a2f96-171">トランザクションなし</span><span class="sxs-lookup"><span data-stu-id="a2f96-171">No transaction</span></span>|<span data-ttu-id="a2f96-172">必須</span><span class="sxs-lookup"><span data-stu-id="a2f96-172">Mandatory</span></span>|<span data-ttu-id="a2f96-173">N/A</span><span class="sxs-lookup"><span data-stu-id="a2f96-173">N/A</span></span>|<span data-ttu-id="a2f96-174">トランザクションが必須のため拒否</span><span class="sxs-lookup"><span data-stu-id="a2f96-174">Rejected because a transaction is required</span></span>|  
|<span data-ttu-id="a2f96-175">トランザクションなし</span><span class="sxs-lookup"><span data-stu-id="a2f96-175">No transaction</span></span>|<span data-ttu-id="a2f96-176">Allowed</span><span class="sxs-lookup"><span data-stu-id="a2f96-176">Allowed</span></span>|<span data-ttu-id="a2f96-177">N/A</span><span class="sxs-lookup"><span data-stu-id="a2f96-177">N/A</span></span>|<span data-ttu-id="a2f96-178">プロセス</span><span class="sxs-lookup"><span data-stu-id="a2f96-178">Process</span></span>|  
|<span data-ttu-id="a2f96-179">トランザクションなし</span><span class="sxs-lookup"><span data-stu-id="a2f96-179">No transaction</span></span>|<span data-ttu-id="a2f96-180">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="a2f96-180">NotAllowed</span></span>|<span data-ttu-id="a2f96-181">N/A</span><span class="sxs-lookup"><span data-stu-id="a2f96-181">N/A</span></span>|<span data-ttu-id="a2f96-182">プロセス</span><span class="sxs-lookup"><span data-stu-id="a2f96-182">Process</span></span>|  
  
 <span data-ttu-id="a2f96-183">コントラクトの各メソッドには、トランザクション フローに関するさまざまな要件を割り当てることができますが、トランザクション フローのプロトコル設定のスコープは、バインディングのレベルになります。</span><span class="sxs-lookup"><span data-stu-id="a2f96-183">While each method on a contract can have different transaction flow requirements, the transaction flow protocol setting is scoped at the level of the binding.</span></span> <span data-ttu-id="a2f96-184">このため、同じエンドポイント (ひいては同じバインディング) を共有するすべてのメソッドは、トランザクション フローを許可または必要とする同じポリシー、および同じトランザクション プロトコル (該当する場合) を共有します。</span><span class="sxs-lookup"><span data-stu-id="a2f96-184">This means that all methods that share the same endpoint (and therefore the same binding) also share the same policy allowing or requiring transaction flow, as well as the same transaction protocol if applicable.</span></span>  
  
## <a name="enabling-transaction-flow-at-the-method-level"></a><span data-ttu-id="a2f96-185">メソッド レベルでのトランザクション フローの有効化</span><span class="sxs-lookup"><span data-stu-id="a2f96-185">Enabling Transaction Flow at the Method Level</span></span>  
 <span data-ttu-id="a2f96-186">トランザクション フローの要件は、サービス コントラクトのすべてのメソッドで常に同じであるとは限りません。</span><span class="sxs-lookup"><span data-stu-id="a2f96-186">Transaction flow requirements are not always the same for all methods in a service contract.</span></span> <span data-ttu-id="a2f96-187">そのため、WCF では、各メソッドのトランザクションフローの基本設定を表すことができる属性ベースの機構も提供されます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-187">Therefore, WCF also provides an attribute-based mechanism to allow each method's transaction flow preferences to be expressed.</span></span> <span data-ttu-id="a2f96-188">これは、サービス操作がトランザクション ヘッダーを受け入れるレベルを指定する <xref:System.ServiceModel.TransactionFlowAttribute> によって実現されます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-188">This is achieved by the <xref:System.ServiceModel.TransactionFlowAttribute> that specifies the level in which a service operation accepts a transaction header.</span></span> <span data-ttu-id="a2f96-189">トランザクション フローを有効にする場合は、この属性を使用してサービス コントラクト メソッドをマークする必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2f96-189">You should mark your service contract methods with this attribute if you want to enable transaction flow.</span></span> <span data-ttu-id="a2f96-190">この属性は、<xref:System.ServiceModel.TransactionFlowOption> 列挙値のいずれかを取り、既定値は <xref:System.ServiceModel.TransactionFlowOption.NotAllowed> です。</span><span class="sxs-lookup"><span data-stu-id="a2f96-190">This attribute takes one of the values of the <xref:System.ServiceModel.TransactionFlowOption> enumeration, in which the default value is <xref:System.ServiceModel.TransactionFlowOption.NotAllowed>.</span></span> <span data-ttu-id="a2f96-191"><xref:System.ServiceModel.TransactionFlowOption.NotAllowed> 以外の値を指定する場合、メソッドは一方向ではない必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2f96-191">If any value except <xref:System.ServiceModel.TransactionFlowOption.NotAllowed> is specified, the method is required to not be one-way.</span></span> <span data-ttu-id="a2f96-192">開発者は、この属性を使用して、メソッド レベルのトランザクション フローに関する要件や制約をデザイン時に指定できます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-192">A developer can use this attribute to specify method-level transaction flow requirements or constraints at design time.</span></span>  
  
## <a name="enabling-transaction-flow-at-the-endpoint-level"></a><span data-ttu-id="a2f96-193">エンドポイント レベルでのトランザクション フローの有効化</span><span class="sxs-lookup"><span data-stu-id="a2f96-193">Enabling Transaction Flow at the Endpoint Level</span></span>  
 <span data-ttu-id="a2f96-194"><xref:System.ServiceModel.TransactionFlowAttribute> 属性によって提供されるメソッドレベルのトランザクションフロー設定に加えて、WCF では、管理者が上位レベルでトランザクションフローを制御できるようにするためのエンドポイント全体のトランザクションフローの設定が提供されます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-194">In addition to the method-level transaction flow setting  the <xref:System.ServiceModel.TransactionFlowAttribute> attribute provides, WCF provides an endpoint-wide setting for transaction flow to allow administrators to control transaction flow at a higher level.</span></span>  
  
 <span data-ttu-id="a2f96-195">これは、<xref:System.ServiceModel.Channels.TransactionFlowBindingElement> によって実現され、エンドポイントのバインディング設定で受信トランザクション フローを有効化または無効化する他に、受信トランザクションに必要なトランザクション プロトコル形式を指定できるようになります。</span><span class="sxs-lookup"><span data-stu-id="a2f96-195">This is achieved by the <xref:System.ServiceModel.Channels.TransactionFlowBindingElement>, which enables you to enable or disable incoming transaction flow in an endpoint’s binding settings, as well as to specify the desired transaction protocol format for incoming transactions.</span></span>  
  
 <span data-ttu-id="a2f96-196">バインディングによりトランザクション フローが無効にされているとき、サービス コントラクトのいずれかの操作が受信トランザクションを必要とした場合は、サービスの起動時に検証例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-196">If the binding has disabled transaction flow, but one of the operations on a service contract requires an incoming transaction, then a validation exception is thrown at service startup.</span></span>  
  
 <span data-ttu-id="a2f96-197">WCF に用意されているほとんどの継続的バインディングには、`transactionFlow` 属性と `transactionProtocol` 属性が含まれており、受信トランザクションを受け入れるように特定のバインディングを構成できます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-197">Most of the standing bindings WCF provides contain the `transactionFlow` and `transactionProtocol` attributes to enable you to configure the specific binding to accept incoming transactions.</span></span> <span data-ttu-id="a2f96-198">構成要素の設定の詳細については、「 [\<binding >](../../configure-apps/file-schema/wcf/bindings.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a2f96-198">For more information about setting the configuration elements, see [\<binding>](../../configure-apps/file-schema/wcf/bindings.md).</span></span>  
  
 <span data-ttu-id="a2f96-199">管理者や展開担当者は、エンドポイント レベルのトランザクション フローを使用することで、展開時に構成ファイルを使用してトランザクション フローの要件や制約を構成できます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-199">An administrator or deployer can use endpoint-level transaction flow to configure transaction flow requirements or constraints at deployment time using the configuration file.</span></span>  
  
## <a name="security"></a><span data-ttu-id="a2f96-200">セキュリティ</span><span class="sxs-lookup"><span data-stu-id="a2f96-200">Security</span></span>  
 <span data-ttu-id="a2f96-201">システムのセキュリティと整合性を確保するために、アプリケーション間でトランザクションをフローさせるときは、メッセージ交換をセキュリティで保護する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2f96-201">To ensure system security and integrity, you must secure message exchanges when flowing transactions between applications.</span></span> <span data-ttu-id="a2f96-202">同じトランザクションに参加する資格のないアプリケーションには、トランザクションの詳細をフローさせたり、公開したりしないでください。</span><span class="sxs-lookup"><span data-stu-id="a2f96-202">You should not flow or disclose transaction details to any application that is not entitled to participate in the same transaction.</span></span>  
  
 <span data-ttu-id="a2f96-203">メタデータ交換を使用して、不明な、または信頼されていない Web サービスに WCF クライアントを生成する場合、これらの Web サービスに対する呼び出しでは、可能であれば現在のトランザクションを抑制する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2f96-203">When generating WCF clients to unknown or untrusted Web services through the use of metadata exchange, calls to operations on these Web services should suppress the current transaction if possible.</span></span> <span data-ttu-id="a2f96-204">この方法を次の例に示します。</span><span class="sxs-lookup"><span data-stu-id="a2f96-204">The following example demonstrates how to do this.</span></span>  
  
```csharp
//client code which has an ambient transaction  
using (TransactionScope scope = new TransactionScope(TransactionScopeOption.Suppress))  
{  
    // No transaction will flow to this operation  
    untrustedProxy.Operation1(...);  
    scope.Complete();  
}  
//remainder of client code  
```  
  
 <span data-ttu-id="a2f96-205">さらに、サービスは、認証および承認済みのクライアントからの受信トランザクションのみを受け入れるように構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2f96-205">In addition, services should be configured to accept incoming transactions only from clients that they have authenticated and authorized.</span></span> <span data-ttu-id="a2f96-206">受信トランザクションは、高信頼クライアントから送られてきた場合にのみ受け入れるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2f96-206">Incoming transactions should only be accepted if they come from highly trusted clients.</span></span>  
  
## <a name="policy-assertions"></a><span data-ttu-id="a2f96-207">ポリシー アサーション</span><span class="sxs-lookup"><span data-stu-id="a2f96-207">Policy Assertions</span></span>  
 <span data-ttu-id="a2f96-208">WCF では、ポリシーアサーションを使用してトランザクションフローを制御します。</span><span class="sxs-lookup"><span data-stu-id="a2f96-208">WCF uses policy assertions to control transaction flow.</span></span> <span data-ttu-id="a2f96-209">ポリシー アサーションは、コントラクト、構成、および属性を集約して生成される、サービスのポリシー ドキュメントに含まれています。</span><span class="sxs-lookup"><span data-stu-id="a2f96-209">Policy assertions can be found in a service’s policy document, which is generated by aggregating contracts, configuration, and attributes.</span></span> <span data-ttu-id="a2f96-210">クライアントは、HTTP GET または WS-MetadataExchange 要求/応答を使用して、サービスのポリシー ドキュメントを取得できます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-210">The client can obtain the service’s policy document using an HTTP GET or a WS-MetadataExchange request-reply.</span></span> <span data-ttu-id="a2f96-211">クライアントは、取得したポリシー ドキュメントを処理して、トランザクション フローをサポートまたは必要とする可能性があるサービス コントラクトの操作を判別できます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-211">Clients can then process the policy document to determine which operations on a service contract may support or require transaction flow.</span></span>  
  
 <span data-ttu-id="a2f96-212">トランザクション フローのポリシー アサーションは、クライアントがサービスに送信する必要がある、トランザクションを表す SOAP ヘッダーを指定することで、トランザクション フローに影響します。</span><span class="sxs-lookup"><span data-stu-id="a2f96-212">Transaction flow policy assertions affect transaction flow by specifying the SOAP headers that a client should send to a service to represent a transaction.</span></span> <span data-ttu-id="a2f96-213">すべてのトランザクション ヘッダーの `MustUnderstand` は、`true` に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a2f96-213">All transaction headers must be marked with `MustUnderstand` equal to `true`.</span></span> <span data-ttu-id="a2f96-214">これ以外の値に設定されたメッセージは、SOAP エラーによりすべて拒否されます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-214">Any message with a header marked otherwise is rejected with a SOAP fault.</span></span>  
  
 <span data-ttu-id="a2f96-215">トランザクション関連のポリシー アサーションは、1 つの操作に 1 つしか存在できません。</span><span class="sxs-lookup"><span data-stu-id="a2f96-215">Only one transaction-related policy assertion can be present on a single operation.</span></span> <span data-ttu-id="a2f96-216">1つの操作に複数のトランザクションアサーションがあるポリシードキュメントは無効と見なされ、WCF によって拒否されます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-216">Policy documents with more than one transaction assertion on an operation are considered invalid and are rejected by WCF.</span></span> <span data-ttu-id="a2f96-217">さらに、トランザクション プロトコルも各ポートの種類の内部に 1 つしか存在できません。</span><span class="sxs-lookup"><span data-stu-id="a2f96-217">In addition, only a single transaction protocol can be present inside each port type.</span></span> <span data-ttu-id="a2f96-218">1つのポートの種類で複数のトランザクションプロトコルを参照する操作を含むポリシードキュメントは無効と見なされ、 [ServiceModel メタデータユーティリティツール (svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)によって拒否されます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-218">Policy documents with operations referencing more than one transaction protocol inside a single port type are considered invalid, and are rejected by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span> <span data-ttu-id="a2f96-219">また、出力メッセージや一方向の入力メッセージに関するトランザクション アサーションが存在するポリシー ドキュメントも無効と見なされます。</span><span class="sxs-lookup"><span data-stu-id="a2f96-219">Policy documents with transaction assertions present on output messages or one-way input messages are also considered invalid.</span></span>
