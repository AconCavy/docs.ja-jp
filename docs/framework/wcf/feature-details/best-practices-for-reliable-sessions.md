---
title: 信頼できるセッションのベスト プラクティス
ms.date: 03/30/2017
ms.assetid: b94f6e01-8070-40b6-aac7-a2cb7b4cb4f2
ms.openlocfilehash: 1d9671e7e3124d535b66de8cd8468f76dcb32b10
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "61857988"
---
# <a name="best-practices-for-reliable-sessions"></a>信頼できるセッションのベスト プラクティス

このトピックでは、信頼できるセッションのベスト プラクティスについて説明します。

## <a name="setting-maxtransferwindowsize"></a>MaxTransferWindowSize の設定

信頼できるセッションでは、Windows Communication Foundation (WCF) では、転送ウィンドウを使用して、クライアントとサービスでメッセージを保持します。 <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> プロパティは、この転送ウィンドウに保持できるメッセージの最大数を表します。

送信者、転送ウィンドウが; の受信確認を待機中に保持できるメッセージの数を示します受信側サービスのバッファーに書き込むメッセージの数を示します。

適切なサイズの選択は、ネットワークの効率性と、サービスの最適な容量に影響します。 次のセクションでは、このプロパティと値の影響の値を選択する際の考慮事項について説明します。

既定の転送ウィンドウ サイズには、8 つのメッセージです。

### <a name="efficient-use-of-the-network"></a>ネットワークの効率的な使用

このコンテキストで、用語*ネットワーク*クライアント (送信側) とサービス (受信者) 間の通信の基盤として使用されるすべてのリソースに対応しています。 これは、SOAP ルーターや HTTP プロキシ/ファイアウォールを含むトランスポート接続や任意の中継ぎ局の間のブリッジ含まれます。

ネットワーク効率が高いとは、その伝送容量を最大限に活用できるということです。 1 秒間、ネットワーク経由で転送されるデータの量 (*データ レート*) と送信者から受信側にデータ転送にかかる時間 (*待機時間*) くらい効果的に影響を与えるネットワーク利用します。

送信側については、転送ウィンドウに保持できる受信確認の到着を待機しているメッセージの数が <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> プロパティによって表されます。 ネットワーク待機時間が長いと、応答性の送信者と効果的なネットワーク使用率を確保するために、転送ウィンドウ サイズを増やす必要があります。

たとえば、送信者がデータ レート保持した場合でも、待機時間は大きくなります送信者と受信者の間にいくつかの中継ぎ局が存在か、データが非可逆仲介機能またはネットワークを通過する必要があります。 そのため、ネットワーク上で送信するための新しいメッセージを受け入れる前に、転送ウィンドウ内のメッセージに対して受信確認を待機するでセンダー側が。 高待機時間、有効性を含む、小さい方のバッファー、ネットワーク使用率。 一方で、サービスは、クライアントによって送信されるデータの高率をキャッチアップする必要があるために、高すぎる転送ウィンドウ サイズはサービスに影響可能性があります。

### <a name="running-the-service-to-capacity"></a>容量にサービスを実行します。

ネットワークを効率的に使用すると、同じくらい理想的も行う最適処理能力で実行するサービス。 受信側の転送ウィンドウ サイズは、処理待ちのメッセージをいくつまで保持しておけるかを表します。 メッセージをこのようにバッファーに保持することは、ネットワークのフロー制御だけでなく、処理能力を最大限に活用したサービス稼働にも役立ちます。 たとえば、バッファーが 1 つのメッセージとメッセージは、サービスが処理できるよりも速く到着する場合、ネットワーク メッセージを削除する場合があり、容量を無駄にまたは使用率が低い可能性があります。

バッファーを使用してでは、同時に受信し、以前に受信したメッセージの処理中にメッセージをバッファーにサービスの可用性を高めます。

同じを使用することをお勧めします。`MaxTransferWindowSize`送信者と受信者の両方でします。

### <a name="enabling-flow-control"></a>フロー制御を有効にします。

*フロー制御*により、送信者と受信者、互いの対応すること、つまり、メッセージの消費し処理のメカニズムは、生成されるとしている高速です。 クライアントとサービスの転送ウィンドウ サイズは、送信側と受信側が妥当な許容範囲内で同期できるように設定しなければなりません。

プロパティを設定することを強くお勧め<xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A>に`true`WCF クライアントと WCF サービスの間の信頼できるセッションを使用している場合。

## <a name="setting-maxpendingchannels"></a>MaxPendingChannels の設定

さまざまなクライアントから信頼できるセッションと通信するサービスを記述する場合は、多くのクライアントが同時に、サービスに信頼できるセッションを確立することです。 このとき、サービスの応答性は、`MaxPendingChannels` プロパティによって決まります。

信頼できるセッション チャネルが送信側によって作成されると、両者のハンドシェイクによって信頼できるセッションが確立します。 これが終わるとチャネルは保留チャネル キューに入り、サービス側からの応答を待機する状態になります。 `MaxPendingChannels` プロパティは、この状態にできるチャネルの数を表します。

チャネルを受け付けられない状態になるサービスのことができます。 キューがいっぱいの場合は、信頼できるセッションを確立しようとするは拒否され、クライアントが再試行する必要があります。

キューで保留中のチャネルが長期間キューに残ることもできます。 それまでは、信頼できるセッションのアイドル タイムアウトが発生しとなり、チャネルを faulted 状態に遷移します。

同時に複数のクライアントをサービスするサービスを記述する場合は、お客様のニーズに適した値を設定してください。 設定の値が高すぎる、`MaxPendingChannels`プロパティが、ワーキング セットに影響します。

既定値<xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A>が 4 つのチャンネルになります。

## <a name="reliable-sessions-and-hosting"></a>信頼できるセッションとホスティング

ときに web を信頼できるセッションを使用するサービスをホストしている、次の重要な考慮事項を点に注意する必要があります。

- 信頼できるセッションはステートフルであり、状態は AppDomain で管理されます。 したがって、信頼できるセッションでやりとりするメッセージはすべて、同じ AppDomain で処理する必要があります。 ファームやガーデンのサイズが 1 つのノードより大きい web ファームと web ガーデンは、この制約を保証できません。

- 双方向 HTTP チャネルを使用して、信頼できるセッション (たとえばを使用して`WsDualHttpBinding`) の 2 つ HTTP クライアント接続数ごとの既定値を超える要求できます。 つまり、双方向の信頼できるセッションは、同時にアプリケーションとプロトコル メッセージは、任意の時点に各方法転送可能性があるため、最大で 2 つの接続に要求できます。 、特定の状況によっては、サービスのメッセージ交換パターンを双方向 HTTP と信頼できるセッションを使用して、web でホストされるサービス デッドロックが発生することはこれは意味します。 クライアントごとの許容の HTTP 接続の数を増やすに、関連する構成ファイルに、以下を追加します (たとえば、 *web.config*問題のあるサービスの)。

  ```xml
  <configuration>
    <system.net>
      <connectionManagement>
        <add name="*" maxconnection="4" />
      </connectionManagement>
    </system.net>
  </configuration>
  ```

  値、`maxconnection`属性が必要な接続の数。 この場合の最小値は、4 つの接続を指定する必要があります。
