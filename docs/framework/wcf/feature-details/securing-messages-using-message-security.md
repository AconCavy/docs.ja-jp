---
title: メッセージ セキュリティを使用したメッセージのセキュリティ保護
ms.date: 03/30/2017
ms.assetid: a17ebe67-836b-4c52-9a81-2c3d58e225ee
ms.openlocfilehash: cf014c8aa972c45140a523573b9806996062b40f
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "61991030"
---
# <a name="securing-messages-using-message-security"></a>メッセージ セキュリティを使用したメッセージのセキュリティ保護
このセクションを使用する場合、WCF メッセージ セキュリティをについて説明します<xref:System.ServiceModel.NetMsmqBinding>します。  
  
> [!NOTE]
>  このトピックを読む前にお勧めお読みになる[セキュリティの概念](../../../../docs/framework/wcf/feature-details/security-concepts.md)します。  
  
 次の図は、WCF を使用してキューに置かれた通信の概念モデルを提供します。 この図および用語を使用して、トランスポート セキュリティの  
  
 概念について解説します。  
  
 ![アプリケーション ダイアグラムをキューに置かれた](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "分散キュー図")  
  
 送信するには、WCF を使用してメッセージをキューに置かれた、WCF メッセージはメッセージ キュー (MSMQ) メッセージの本文としてアタッチされます。 トランスポート セキュリティが MSMQ メッセージ全体を保護するのに対し、メッセージ (SOAP) セキュリティは MSMQ メッセージの本文だけを保護します。  
  
 メッセージ セキュリティの重要な概念は、クライアントが受信側アプリケーション (サービス) のメッセージを保護する点にあります。これは、クライアントがターゲット キューのメッセージを保護するトランスポート セキュリティとは異なります。 そのため、メッセージのセキュリティを使用して、WCF メッセージをセキュリティで保護するときに MSMQ 再生一部されません。  
  
 WCF メッセージ セキュリティは、証明書または Kerberos プロトコルなどの既存のセキュリティ インフラストラクチャと統合される WCF メッセージに、セキュリティ ヘッダーを追加します。  
  
## <a name="message-credential-type"></a>メッセージ資格情報の種類  
 メッセージ セキュリティを使用すると、サービスとクライアントは、資格情報を提示して相互を認証します。 メッセージ セキュリティを選択するには、<xref:System.ServiceModel.NetMsmqBinding.Security%2A> モードを `Message` または `Both` (トランスポート セキュリティとメッセージ セキュリティの両方を使用) に設定します。  
  
 サービスは、<xref:System.ServiceModel.ServiceSecurityContext.Current%2A> プロパティを使用して、クライアントを認証するために使用される資格情報を検査できます。 このプロパティを使用して承認チェックも追加できますが、これを実装するかどうかはサービスで選択します。  
  
 ここでは、さまざまな資格情報の種類およびそれらをキューで使用する方法について説明します。  
  
### <a name="certificate"></a>証明書  
 資格情報の種類に証明書を設定すると、X509 証明書を使用してサービスとクライアントが識別されます。  
  
 一般的なシナリオでは、信頼された証明機関によってクライアントとサービスに有効な証明書が発行されます。 その後、接続が確立され、クライアントは、サービスの証明書を使用してサービスの有効性を確認することにより、サービスを信頼できるかどうかを判断します。 同様に、サービスは、クライアントの証明書を使用してクライアントの信頼性を検証します。  
  
 キューは切断されているため、クライアントとサービスが同時にオンライン状態にならない可能性があります。 したがって、クライアントとサービスは、帯域外で証明書を交換する必要があります。 特にクライアントは、信頼されたストア内にサービスの証明書 (証明機関にチェーンできる) を保持しているという理由で、正しいサービスと通信していると信じる必要があります。 クライアントを認証する場合、サービスはメッセージに添付された X509 証明書を使用し、ストア内の証明書と照合してクライアントの信頼性を確認します。 この場合も、証明書は証明機関にチェーンされている必要があります。  
  
 Windows を実行しているコンピューターでは、証明書は数種類のストアで保持されています。 異なるストアの詳細については、次を参照してください。[証明書のストア](https://go.microsoft.com/fwlink/?LinkId=87787)します。  
  
### <a name="windows"></a>Windows  
 メッセージ資格情報の種類に Windows を設定すると、Kerberos プロトコルが使用されます。  
  
 Kerberos プロトコルは、ドメインのユーザーを認証するためのセキュリティ機構で、認証済みユーザーは、ドメインの他のエンティティとの間にセキュリティで保護されたコンテキストを確立できます。  
  
 キューを使用した通信で Kerberos プロトコルを使用する場合の問題は、キー配布センター (KDC) が配布するクライアント ID を含むチケットの有効期間が比較的短いことです。 A*有効期間*チケットの有効性を示す、Kerberos チケットに関連付けられています。 そのため、遅延が大きい場合、クライアントを認証するサービスに対してトークンがまだ有効であるかどうかを確信できなくなります。  
  
 この種類の資格情報を使用する場合、SERVICE アカウントでサービスが実行されている必要があります。  
  
 メッセージ資格情報を選択すると、既定で Kerberos プロトコルが使用されます。 詳細については、次を参照してください。[探索 Kerberos、Windows 2000 でのセキュリティの配布用のプロトコル](https://go.microsoft.com/fwlink/?LinkId=87790)します。  
  
### <a name="username-password"></a>ユーザー名とパスワード  
 このプロパティを使用すると、クライアントは、メッセージのセキュリティ ヘッダーに含まれるユーザー名とパスワードを使用してサーバーに認証できます。  
  
### <a name="issuedtoken"></a>IssuedToken  
 クライアントは、セキュリティ トークン サービスを使用してトークンを発行できます。発行されたトークンをサービスへのメッセージに添付することで、クライアントが認証されます。  
  
## <a name="using-transport-and-message-security"></a>トランスポート セキュリティとメッセージ セキュリティの使用  
 トランスポート セキュリティとメッセージ セキュリティの両方を使用する場合は、トランスポート レベルと SOAP メッセージ レベルの両方で同じ証明書を使用してメッセージを保護する必要があります。  
  
## <a name="see-also"></a>関連項目

- [トランスポート セキュリティを使用したメッセージのセキュリティ保護](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md)
- [メッセージ キューを介したメッセージ セキュリティ](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)
- [セキュリティの概念](../../../../docs/framework/wcf/feature-details/security-concepts.md)
- [サービスおよびクライアントのセキュリティ保護](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)
