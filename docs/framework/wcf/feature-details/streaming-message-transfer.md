---
title: メッセージ転送ストリーミング
ms.date: 03/30/2017
ms.assetid: 72a47a51-e5e7-4b76-b24a-299d51e0ae5a
ms.openlocfilehash: 462144856750a1b8726b574fdc82746da2d72ff7
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/09/2020
ms.locfileid: "84594791"
---
# <a name="streaming-message-transfer"></a><span data-ttu-id="2842e-102">メッセージ転送ストリーミング</span><span class="sxs-lookup"><span data-stu-id="2842e-102">Streaming Message Transfer</span></span>
<span data-ttu-id="2842e-103">Windows Communication Foundation (WCF) トランスポートでは、メッセージを転送するための2つのモードがサポートしています。</span><span class="sxs-lookup"><span data-stu-id="2842e-103">Windows Communication Foundation (WCF) transports support two modes for transferring messages:</span></span>  
  
- <span data-ttu-id="2842e-104">バッファー転送では、転送が完了するまで、メッセージ全体がメモリ バッファーに保持されます。</span><span class="sxs-lookup"><span data-stu-id="2842e-104">Buffered transfers hold the entire message in a memory buffer until the transfer is complete.</span></span> <span data-ttu-id="2842e-105">受信側がメッセージを読み取るためには、バッファー内のメッセージが完全に配信される必要があります。</span><span class="sxs-lookup"><span data-stu-id="2842e-105">A buffered message must be completely delivered before a receiver can read it.</span></span>  
  
- <span data-ttu-id="2842e-106">ストリーミング転送では、ストリームとしてメッセージが公開されます。</span><span class="sxs-lookup"><span data-stu-id="2842e-106">Streamed transfers expose the message as a stream.</span></span> <span data-ttu-id="2842e-107">受信側は、メッセージが完全に配信される前にメッセージの処理を開始できます。</span><span class="sxs-lookup"><span data-stu-id="2842e-107">The receiver starts processing the message before it is completely delivered.</span></span>  
  
- <span data-ttu-id="2842e-108">ストリーミング転送では、大容量のメモリ バッファーが不要なため、サービスのスケーラビリティを向上できます。</span><span class="sxs-lookup"><span data-stu-id="2842e-108">Streamed transfers can improve the scalability of a service by eliminating the requirement for large memory buffers.</span></span> <span data-ttu-id="2842e-109">転送モードを変更することによってスケーラビリティが向上するかどうかは、転送されるメッセージのサイズによって決まります。</span><span class="sxs-lookup"><span data-stu-id="2842e-109">Whether changing the transfer mode improves scalability depends on the size of the messages being transferred.</span></span> <span data-ttu-id="2842e-110">メッセージのサイズが大きい場合は、ストリーム転送の使用をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="2842e-110">Large message sizes favor using streamed transfers.</span></span>  
  
 <span data-ttu-id="2842e-111">既定では、HTTP、TCP/IP、および名前付きパイプの各トランスポートはバッファー転送を使用します。</span><span class="sxs-lookup"><span data-stu-id="2842e-111">By default, the HTTP, TCP/IP, and named pipe transports use buffered transfers.</span></span> <span data-ttu-id="2842e-112">ここでは、これらのトランスポートをバッファー転送モードからストリーミング転送モードに切り替える方法と、その結果について説明します。</span><span class="sxs-lookup"><span data-stu-id="2842e-112">This document describes how to switch these transports from a buffered to streamed transfer mode and the consequences of doing so.</span></span>  
  
## <a name="enabling-streamed-transfers"></a><span data-ttu-id="2842e-113">ストリーミング転送の有効化</span><span class="sxs-lookup"><span data-stu-id="2842e-113">Enabling Streamed Transfers</span></span>  
 <span data-ttu-id="2842e-114">バッファー転送モードとストリーミング転送モードは、トランスポートのバインド要素で切り替えます。</span><span class="sxs-lookup"><span data-stu-id="2842e-114">Selecting between buffered and streamed transfer modes is done on the binding element of the transport.</span></span> <span data-ttu-id="2842e-115">バインディング要素には、<xref:System.ServiceModel.TransferMode> プロパティがあり、`Buffered`、`Streamed`、`StreamedRequest`、または `StreamedResponse` に設定できます。</span><span class="sxs-lookup"><span data-stu-id="2842e-115">The binding element has a <xref:System.ServiceModel.TransferMode> property that can be set to `Buffered`, `Streamed`, `StreamedRequest`, or `StreamedResponse`.</span></span> <span data-ttu-id="2842e-116">転送モードを `Streamed` に設定すると、両方向のストリーミング通信が可能になります。</span><span class="sxs-lookup"><span data-stu-id="2842e-116">Setting the transfer mode to `Streamed` enables streaming communication in both directions.</span></span> <span data-ttu-id="2842e-117">転送モードを `StreamedRequest` または `StreamedResponse` に設定すると、指定した方向のストリーミング通信だけが有効になります。</span><span class="sxs-lookup"><span data-stu-id="2842e-117">Setting the transfer mode to `StreamedRequest` or `StreamedResponse` enables streaming communication in the indicated direction only.</span></span>  
  
 <span data-ttu-id="2842e-118"><xref:System.ServiceModel.BasicHttpBinding>、<xref:System.ServiceModel.NetTcpBinding>、および <xref:System.ServiceModel.NetNamedPipeBinding> の各バインディングは、<xref:System.ServiceModel.TransferMode> プロパティを公開します。</span><span class="sxs-lookup"><span data-stu-id="2842e-118">The <xref:System.ServiceModel.BasicHttpBinding>, <xref:System.ServiceModel.NetTcpBinding>, and <xref:System.ServiceModel.NetNamedPipeBinding> bindings expose the <xref:System.ServiceModel.TransferMode> property.</span></span> <span data-ttu-id="2842e-119">他のトランスポートの場合、転送モードを設定するにはカスタム バインドを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2842e-119">For other transports, you must create a custom binding to set the transfer mode.</span></span>  
  
 <span data-ttu-id="2842e-120">バッファー転送とストリーミング転送のどちらを使用するかは、エンドポイントごとにローカルに決定します。</span><span class="sxs-lookup"><span data-stu-id="2842e-120">The decision to use either buffered or streamed transfers is a local decision of the endpoint.</span></span> <span data-ttu-id="2842e-121">HTTP トランスポートの場合、転送モードは、接続、つまりサーバーなどの中継局に伝達されません。</span><span class="sxs-lookup"><span data-stu-id="2842e-121">For HTTP transports, the transfer mode does not propagate across a connection, or to servers and other intermediaries.</span></span> <span data-ttu-id="2842e-122">転送モードの設定は、サービス インターフェイスの記述に反映されません。</span><span class="sxs-lookup"><span data-stu-id="2842e-122">Setting the transfer mode is not reflected in the description of the service interface.</span></span> <span data-ttu-id="2842e-123">サービスに対してクライアント クラスを生成した後、ストリーミング転送で使用する予定のサービスの構成ファイルを編集し、転送モードを設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2842e-123">After generating a client class for a service, you must edit the configuration file for services intended to be used with streamed transfers to set the mode.</span></span> <span data-ttu-id="2842e-124">TCP トランスポートと名前付きパイプ トランスポートの場合、転送モードはポリシー アサーションとして伝達されます。</span><span class="sxs-lookup"><span data-stu-id="2842e-124">For TCP and named pipe transports, the transfer mode is propagated as a policy assertion.</span></span>  
  
 <span data-ttu-id="2842e-125">コードサンプルについては、「[方法: ストリーミングを有効にする](how-to-enable-streaming.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="2842e-125">For code samples, see [How to: Enable Streaming](how-to-enable-streaming.md).</span></span>  
  
## <a name="enabling-asynchronous-streaming"></a><span data-ttu-id="2842e-126">非同期ストリーミングの有効化</span><span class="sxs-lookup"><span data-stu-id="2842e-126">Enabling Asynchronous Streaming</span></span>  
 <span data-ttu-id="2842e-127">非同期ストリーミングを有効にするには、エンドポイントの <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior> 動作をサービス ホストに追加し、その <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.AsynchronousSendEnabled%2A> プロパティを `true` に設定します。</span><span class="sxs-lookup"><span data-stu-id="2842e-127">To enable asynchronous streaming, add the  <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior> endpoint behavior to the service host and set its <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.AsynchronousSendEnabled%2A> property to `true`.</span></span>  
  
 <span data-ttu-id="2842e-128">WCF のこのバージョンでは、他にも送信側の実際の非同期ストリーミング機能が追加されています。</span><span class="sxs-lookup"><span data-stu-id="2842e-128">This version of WCF also adde the capability of true asynchronous streaming on the send side.</span></span> <span data-ttu-id="2842e-129">これによって、複数のクライアントにメッセージをストリーム出力するシナリオで、一部のクライアントがネットワークの混雑により読み取りが遅いか、読み取りをまったく行っていない場合に、サービスのスケーラビリティが向上します。</span><span class="sxs-lookup"><span data-stu-id="2842e-129">This improves scalability of the service in scenarios where it is streaming messages to multiple clients some of which are slow in reading; possibly due to network congestion or are not reading at all.</span></span> <span data-ttu-id="2842e-130">このようなシナリオでは、WCF はクライアントごとのサービスの個別のスレッドをブロックしません。</span><span class="sxs-lookup"><span data-stu-id="2842e-130">In these scenarios WCF no longer blocks individual threads on the service per client.</span></span> <span data-ttu-id="2842e-131">サービスはこれによってこれまで以上のクライアントを処理できるようになり、スケーラビリティが向上します。</span><span class="sxs-lookup"><span data-stu-id="2842e-131">This ensures that the service is able to process many more clients thereby improving the scalability of the service.</span></span>  
  
## <a name="restrictions-on-streamed-transfers"></a><span data-ttu-id="2842e-132">ストリーミング転送の制限</span><span class="sxs-lookup"><span data-stu-id="2842e-132">Restrictions on Streamed Transfers</span></span>  
 <span data-ttu-id="2842e-133">ストリーミング転送モードを使用すると、ランタイムによって追加の制限が適用されます。</span><span class="sxs-lookup"><span data-stu-id="2842e-133">Using the streamed transfer mode causes the run time to enforce additional restrictions.</span></span>  
  
 <span data-ttu-id="2842e-134">ストリーミングされたトランスポートで発生する操作は、最大で 1 つの入力パラメーターまたは出力パラメーターが指定されたコントラクトを持つことができます。</span><span class="sxs-lookup"><span data-stu-id="2842e-134">Operations that occur across a streamed transport can have a contract with at most one input or output parameter.</span></span> <span data-ttu-id="2842e-135">設定するパラメーターは、メッセージの本文全体に対応し、<xref:System.ServiceModel.Channels.Message>、 <xref:System.IO.Stream> の派生型、または <xref:System.Xml.Serialization.IXmlSerializable> 実装であることが必要です。</span><span class="sxs-lookup"><span data-stu-id="2842e-135">That parameter corresponds to the entire body of the message and must be a <xref:System.ServiceModel.Channels.Message>, a derived type of <xref:System.IO.Stream>, or an <xref:System.Xml.Serialization.IXmlSerializable> implementation.</span></span> <span data-ttu-id="2842e-136">操作の戻り値を取得することは、出力パラメーターを取得することと同じです。</span><span class="sxs-lookup"><span data-stu-id="2842e-136">Having a return value for an operation is equivalent to having an output parameter.</span></span>  
  
 <span data-ttu-id="2842e-137">信頼できるメッセージング、トランザクション、SOAP メッセージレベルのセキュリティなどの一部の WCF 機能では、送信メッセージのバッファリングに依存しています。</span><span class="sxs-lookup"><span data-stu-id="2842e-137">Some WCF features, such as reliable messaging, transactions, and SOAP message-level security, rely on buffering messages for transmissions.</span></span> <span data-ttu-id="2842e-138">これらの機能を使用すると、ストリーミングによって得られるパフォーマンス上の利点が減少したり、失われたりする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="2842e-138">Using these features may reduce or eliminate the performance benefits gained by using streaming.</span></span> <span data-ttu-id="2842e-139">ストリーミングされたトランスポートをセキュリティで保護する場合は、トランスポート レベルのセキュリティだけを使用するか、または、トランスポート レベルのセキュリティと認証のみのメッセージ セキュリティを組み合わせて使用してください。</span><span class="sxs-lookup"><span data-stu-id="2842e-139">To secure a streamed transport, use transport-level security only or use transport-level security plus authentication-only message security.</span></span>  
  
 <span data-ttu-id="2842e-140">SOAP ヘッダーは、転送モードがストリーミングに設定されている場合でも、必ずバッファーされます。</span><span class="sxs-lookup"><span data-stu-id="2842e-140">SOAP headers are always buffered, even when the transfer mode is set to streamed.</span></span> <span data-ttu-id="2842e-141">メッセージのヘッダーが `MaxBufferSize` トランスポート クォータのサイズを超えないようにしてください。</span><span class="sxs-lookup"><span data-stu-id="2842e-141">The headers for a message must not exceed the size of the `MaxBufferSize` transport quota.</span></span> <span data-ttu-id="2842e-142">この設定の詳細については、「[トランスポートクォータ](transport-quotas.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="2842e-142">For more information about this setting, see [Transport Quotas](transport-quotas.md).</span></span>  
  
## <a name="differences-between-buffered-and-streamed-transfers"></a><span data-ttu-id="2842e-143">バッファー転送とストリーミング転送の違い</span><span class="sxs-lookup"><span data-stu-id="2842e-143">Differences Between Buffered and Streamed Transfers</span></span>  
 <span data-ttu-id="2842e-144">転送モードをバッファーからストリーミングに変更すると、TCP トランスポートと名前付きパイプ トランスポートのネイティブなチャネル形状も変更されます。</span><span class="sxs-lookup"><span data-stu-id="2842e-144">Changing the transfer mode from buffered to streamed also changes the native channel shape of the TCP and named pipe transports.</span></span> <span data-ttu-id="2842e-145">バッファー転送では、ネイティブなチャネル形状は <xref:System.ServiceModel.Channels.IDuplexSessionChannel> です。</span><span class="sxs-lookup"><span data-stu-id="2842e-145">For buffered transfers, the native channel shape is <xref:System.ServiceModel.Channels.IDuplexSessionChannel>.</span></span> <span data-ttu-id="2842e-146">ストリーム転送では、ネイティブなチャネル形状は <xref:System.ServiceModel.Channels.IRequestChannel> と <xref:System.ServiceModel.Channels.IReplyChannel> です。</span><span class="sxs-lookup"><span data-stu-id="2842e-146">For streamed transfers, the native channels are <xref:System.ServiceModel.Channels.IRequestChannel> and <xref:System.ServiceModel.Channels.IReplyChannel>.</span></span> <span data-ttu-id="2842e-147">これらのトランスポートを直接 (つまり、サービス コントラクトを介さずに) 使用する既存のアプリケーションで転送モードを変更するには、チャネル ファクトリおよびリスナーの予測されるチャネル形状を変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2842e-147">Changing the transfer mode in an existing application that uses these transports directly (that is, not through a service contract) requires changing the expected channel shape for channel factories and listeners.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2842e-148">関連項目</span><span class="sxs-lookup"><span data-stu-id="2842e-148">See also</span></span>

- [<span data-ttu-id="2842e-149">方法: ストリーミングを有効にする</span><span class="sxs-lookup"><span data-stu-id="2842e-149">How to: Enable Streaming</span></span>](how-to-enable-streaming.md)
