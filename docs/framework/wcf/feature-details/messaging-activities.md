---
title: メッセージング アクティビティ
ms.date: 03/30/2017
ms.assetid: 8498f215-1823-4aba-a6e1-391407f8c273
ms.openlocfilehash: 69a0e9a415b10d9c58d04eac27e48b1ed6a78064
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/09/2020
ms.locfileid: "84576396"
---
# <a name="messaging-activities"></a><span data-ttu-id="0e384-102">メッセージング アクティビティ</span><span class="sxs-lookup"><span data-stu-id="0e384-102">Messaging activities</span></span>

<span data-ttu-id="0e384-103">アクティビティを管理することで、ワークフローが WCF メッセージを送受信できるようになります。</span><span class="sxs-lookup"><span data-stu-id="0e384-103">Messaging activities allow workflows to send and receive WCF messages.</span></span> <span data-ttu-id="0e384-104">メッセージング アクティビティをワークフローに追加することで、任意に複雑なメッセージ交換パターン (MEP) をモデル化できます。</span><span class="sxs-lookup"><span data-stu-id="0e384-104">By adding messaging activities to a workflow you can model any arbitrarily complex message exchange patterns (MEP).</span></span>

## <a name="message-exchange-patterns"></a><span data-ttu-id="0e384-105">メッセージ交換パターン</span><span class="sxs-lookup"><span data-stu-id="0e384-105">Message exchange patterns</span></span>

<span data-ttu-id="0e384-106">基本的なメッセージ交換パターンは、次の 3 種類です。</span><span class="sxs-lookup"><span data-stu-id="0e384-106">There are three basic message exchange patterns:</span></span>

- <span data-ttu-id="0e384-107">**データグラム**-データグラム mep を使用する場合、クライアントはサービスにメッセージを送信しますが、サービスは応答しません。</span><span class="sxs-lookup"><span data-stu-id="0e384-107">**Datagram** - When using the datagram MEP the client sends a message to the service, but the service does not respond.</span></span> <span data-ttu-id="0e384-108">これは、"ファイア アンド フォーゲット (撃ち放し)" と呼ばれる場合があります。</span><span class="sxs-lookup"><span data-stu-id="0e384-108">This is sometimes called "fire and forget".</span></span> <span data-ttu-id="0e384-109">このような交換では、配信の成否について帯域外での確認が必要になります。</span><span class="sxs-lookup"><span data-stu-id="0e384-109">A fire and forget exchange is one that requires out-of-band confirmation of successful delivery.</span></span> <span data-ttu-id="0e384-110">メッセージが移動中に失われて、サービスに到達しない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0e384-110">The message might be lost in transit and never reach the service.</span></span> <span data-ttu-id="0e384-111">クライアントが正常にメッセージを送信した場合でも、サービスがメッセージを受信したとは限りません。</span><span class="sxs-lookup"><span data-stu-id="0e384-111">If the client successfully sends a message, it does not guarantee that the service has received the message.</span></span> <span data-ttu-id="0e384-112">サービスは、メッセージングの不可欠な構成要素であり、これを基盤として独自の MEP を構築できます。</span><span class="sxs-lookup"><span data-stu-id="0e384-112">The datagram is a fundamental building block for messaging, as you can build your own MEPs on top of it.</span></span>

- <span data-ttu-id="0e384-113">**要求-応答**-要求-応答 mep を使用する場合、クライアントはサービスにメッセージを送信し、サービスは必要な処理を実行してから、クライアントに応答を返します。</span><span class="sxs-lookup"><span data-stu-id="0e384-113">**Request-Response** - When using the request-response MEP the client sends a message to the service, the service does the required processing, and then sends a response back to the client.</span></span> <span data-ttu-id="0e384-114">パターンは、要求 - 応答のペアで構成されます。</span><span class="sxs-lookup"><span data-stu-id="0e384-114">The pattern consists of request-response pairs.</span></span> <span data-ttu-id="0e384-115">要求 - 応答呼び出しの例として、リモート プロシージャ コール (RPC) やブラウザー GET 要求などがあります。</span><span class="sxs-lookup"><span data-stu-id="0e384-115">Examples of request-response calls are remote procedure calls (RPC) and browser GET requests.</span></span> <span data-ttu-id="0e384-116">このパターンは、半二重とも呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="0e384-116">This pattern is also known as half-duplex.</span></span>

- <span data-ttu-id="0e384-117">**双方向-双**方向 mep を使用すると、クライアントとサービスはメッセージを任意の順序で相互に送信できます。</span><span class="sxs-lookup"><span data-stu-id="0e384-117">**Duplex** - When using the duplex MEP the client and service can send messages to each other in any order.</span></span> <span data-ttu-id="0e384-118">二重 MEP は、話される語の 1 つずつがメッセージである電話の会話に似ています。</span><span class="sxs-lookup"><span data-stu-id="0e384-118">The duplex MEP is like a phone conversation, where each word being spoken is a message.</span></span>

<span data-ttu-id="0e384-119">メッセージング アクティビティを使用すると、これらの基本の MEP のほかに、任意の複雑な MEP を実装できます。</span><span class="sxs-lookup"><span data-stu-id="0e384-119">The messaging activities allow you to implement any of these basic MEPs as well as any arbitrarily complex MEP.</span></span>

## <a name="messaging-activities"></a><span data-ttu-id="0e384-120">メッセージング アクティビティ</span><span class="sxs-lookup"><span data-stu-id="0e384-120">Messaging activities</span></span>

<span data-ttu-id="0e384-121">[!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] では、次のメッセージング アクティビティが定義されています。</span><span class="sxs-lookup"><span data-stu-id="0e384-121">The [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] defines the following messaging activities:</span></span>

- <span data-ttu-id="0e384-122"><xref:System.ServiceModel.Activities.Send> - メッセージの送信には <xref:System.ServiceModel.Activities.Send> アクティビティを使用します。</span><span class="sxs-lookup"><span data-stu-id="0e384-122"><xref:System.ServiceModel.Activities.Send>- Use the <xref:System.ServiceModel.Activities.Send> activity to send a message.</span></span>

- <span data-ttu-id="0e384-123"><xref:System.ServiceModel.Activities.SendReply> - 受信したメッセージに対する応答の送信には、<xref:System.ServiceModel.Activities.SendReply> アクティビティを使用します。</span><span class="sxs-lookup"><span data-stu-id="0e384-123"><xref:System.ServiceModel.Activities.SendReply> - Use the <xref:System.ServiceModel.Activities.SendReply> activity to send a response to a received message.</span></span> <span data-ttu-id="0e384-124">このアクティビティは、要求/応答 MEP を実装した場合に、ワークフロー サービスによって使用されます。</span><span class="sxs-lookup"><span data-stu-id="0e384-124">This activity is used by workflow services when implementing a request/reply MEP.</span></span>

- <span data-ttu-id="0e384-125"><xref:System.ServiceModel.Activities.Receive>- メッセージの受信には <xref:System.ServiceModel.Activities.Receive> アクティビティを使用します。</span><span class="sxs-lookup"><span data-stu-id="0e384-125"><xref:System.ServiceModel.Activities.Receive>- Use the <xref:System.ServiceModel.Activities.Receive> activity to receive a message.</span></span>

- <span data-ttu-id="0e384-126"><xref:System.ServiceModel.Activities.ReceiveReply> - 応答メッセージの受信には <xref:System.ServiceModel.Activities.ReceiveReply> アクティビティを使用します。</span><span class="sxs-lookup"><span data-stu-id="0e384-126"><xref:System.ServiceModel.Activities.ReceiveReply> - Use the <xref:System.ServiceModel.Activities.ReceiveReply> activity to receive a reply message.</span></span> <span data-ttu-id="0e384-127">このアクティビティは、要求/応答 MEP を実装した場合に、ワークフロー サービス クライアントによって使用されます。</span><span class="sxs-lookup"><span data-stu-id="0e384-127">This activity is used by workflow service clients when implementing a request/reply MEP.</span></span>

## <a name="messaging-activities-and-message-exchange-patterns"></a><span data-ttu-id="0e384-128">メッセージングアクティビティとメッセージ交換パターン</span><span class="sxs-lookup"><span data-stu-id="0e384-128">Messaging activities and message exchange patterns</span></span>

<span data-ttu-id="0e384-129">データグラム MEP には、メッセージを送信するクライアントとメッセージを受信するサービスが必要です。</span><span class="sxs-lookup"><span data-stu-id="0e384-129">A datagram MEP involves a client sending a message and a service receiving the message.</span></span> <span data-ttu-id="0e384-130">クライアントがワークフローの場合は、<xref:System.ServiceModel.Activities.Send> アクティビティを使用してメッセージを送信します。</span><span class="sxs-lookup"><span data-stu-id="0e384-130">If the client is a workflow use a <xref:System.ServiceModel.Activities.Send> activity to send the message.</span></span> <span data-ttu-id="0e384-131">そのメッセージをワークフローで受信するには、<xref:System.ServiceModel.Activities.Receive> アクティビティを使用します。</span><span class="sxs-lookup"><span data-stu-id="0e384-131">To receive that message in a workflow, use a <xref:System.ServiceModel.Activities.Receive> activity.</span></span> <span data-ttu-id="0e384-132"><xref:System.ServiceModel.Activities.Send> アクティビティと <xref:System.ServiceModel.Activities.Receive> アクティビティのどちらにも、`Content` という名前のプロパティがあります。</span><span class="sxs-lookup"><span data-stu-id="0e384-132">The <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> activities each have a property named `Content`.</span></span> <span data-ttu-id="0e384-133">このプロパティには、送信または受信されるデータが保持されます。</span><span class="sxs-lookup"><span data-stu-id="0e384-133">This property contains the data being sent or received.</span></span> <span data-ttu-id="0e384-134">要求 - 応答 MEP を実装する場合は、クライアントとサービスの両方で、アクティビティの組を使用します。</span><span class="sxs-lookup"><span data-stu-id="0e384-134">When implementing the request-response MEP both the client and the service use pairs of activities.</span></span> <span data-ttu-id="0e384-135">クライアントは、<xref:System.ServiceModel.Activities.Send> アクティビティを使用してメッセージを送信し、<xref:System.ServiceModel.Activities.ReceiveReply> アクティビティを使用してサービスからの応答を受信します。</span><span class="sxs-lookup"><span data-stu-id="0e384-135">The client uses a <xref:System.ServiceModel.Activities.Send> activity to send the message and a <xref:System.ServiceModel.Activities.ReceiveReply> activity to receive the response from the service.</span></span> <span data-ttu-id="0e384-136">これらの 2 つのアクティビティは、<xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> プロパティによって互いに関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="0e384-136">These two activities are associated with each other by the <xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> property.</span></span> <span data-ttu-id="0e384-137">このプロパティは、元のメッセージを送信した <xref:System.ServiceModel.Activities.Send> アクティビティに設定されます。</span><span class="sxs-lookup"><span data-stu-id="0e384-137">This property is set to the <xref:System.ServiceModel.Activities.Send> activity that sent the original message.</span></span> <span data-ttu-id="0e384-138">サービスも、相互に関連付けられた、<xref:System.ServiceModel.Activities.Receive> および <xref:System.ServiceModel.Activities.SendReply> というアクティビティのペアを使用します。</span><span class="sxs-lookup"><span data-stu-id="0e384-138">The service also uses a pair of associated activities: <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="0e384-139">これらの 2 つのアクティビティは、<xref:System.ServiceModel.Activities.SendReply.Request%2A> プロパティによって関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="0e384-139">These two activities are associated by the <xref:System.ServiceModel.Activities.SendReply.Request%2A> property.</span></span> <span data-ttu-id="0e384-140">このプロパティは、元のメッセージを受信した <xref:System.ServiceModel.Activities.Receive> アクティビティに設定されます。</span><span class="sxs-lookup"><span data-stu-id="0e384-140">This property is set to the <xref:System.ServiceModel.Activities.Receive> activity that received the original message.</span></span> <span data-ttu-id="0e384-141"><xref:System.ServiceModel.Activities.ReceiveReply> アクティビティおよび <xref:System.ServiceModel.Activities.SendReply> アクティビティを使用すると、<xref:System.ServiceModel.Activities.Send> アクティビティおよび <xref:System.ServiceModel.Activities.Receive> アクティビティと同様に、<xref:System.ServiceModel.Channels.Message> インスタンスまたはメッセージ コントラクト型を送信できます。</span><span class="sxs-lookup"><span data-stu-id="0e384-141">The <xref:System.ServiceModel.Activities.ReceiveReply> and <xref:System.ServiceModel.Activities.SendReply> activities, like <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> allow you to send a <xref:System.ServiceModel.Channels.Message> instance or a message contract type.</span></span>

<span data-ttu-id="0e384-142">ワークフローは長時間にわたって実行されることが多いため、通信の二重パターンでは、長時間のメッセージ交換をサポートすることも重要です。</span><span class="sxs-lookup"><span data-stu-id="0e384-142">Because of the long-running nature of workflows, it is important for the duplex pattern of communication to also support long-running conversations.</span></span> <span data-ttu-id="0e384-143">長時間のメッセージ交換をサポートするには、メッセージ交換を開始するクライアントが、後でデータが利用可能になった時点でクライアントにコールバックする機会をサービスに提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0e384-143">To support long-running conversations, clients who initiate the conversation must provide the service with an opportunity to call it back at a later time when the data becomes available.</span></span> <span data-ttu-id="0e384-144">たとえば、マネージャーの承認を受けるために発注書の要求が送信された場合に、この要求が、1 日、1 週間、または 1 年間処理されない可能性があるとします。この場合、マネージャーが発注書を承認するワークフローは、承認を受けた後に再開することを認識している必要があります。</span><span class="sxs-lookup"><span data-stu-id="0e384-144">For example, a purchase order request is submitted for manager approval, but it might not be processed for a day, a week, or even a year; the workflow that manages the purchase order approval must know to resume after the approval is given.</span></span> <span data-ttu-id="0e384-145">この二重通信のパターンは、相関関係を使用するワークフローでサポートされています。</span><span class="sxs-lookup"><span data-stu-id="0e384-145">This pattern of duplex communication is supported in workflows using correlation.</span></span> <span data-ttu-id="0e384-146">二重パターンを実装するには、<xref:System.ServiceModel.Activities.Send> アクティビティと <xref:System.ServiceModel.Activities.Receive> アクティビティを使用します。</span><span class="sxs-lookup"><span data-stu-id="0e384-146">To implement a duplex pattern, use <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> activities.</span></span> <span data-ttu-id="0e384-147">アクティビティで <xref:System.ServiceModel.Activities.Receive> 、を使用して関連付けを初期化し <xref:System.ServiceModel.Activities.CorrelationHandle> ます。</span><span class="sxs-lookup"><span data-stu-id="0e384-147">On the <xref:System.ServiceModel.Activities.Receive> activity, initialize a correlation using <xref:System.ServiceModel.Activities.CorrelationHandle>.</span></span> <span data-ttu-id="0e384-148"><xref:System.ServiceModel.Activities.Send> アクティビティで、その関連付けハンドルを <xref:System.ServiceModel.Activities.Send.CorrelatesWith%2A> プロパティの値として設定します。</span><span class="sxs-lookup"><span data-stu-id="0e384-148">On the <xref:System.ServiceModel.Activities.Send> activity set that correlation handle as the <xref:System.ServiceModel.Activities.Send.CorrelatesWith%2A> property value.</span></span> <span data-ttu-id="0e384-149">詳細については、「[永続的な二重](durable-duplex-correlation.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0e384-149">For more information, see [Durable Duplex](durable-duplex-correlation.md).</span></span>

> [!NOTE]
> <span data-ttu-id="0e384-150">コールバック相関関係 ("永続的な二重") を使用したワークフローの二重化の実装は、実行時間の長いメッセージ交換を想定しています。</span><span class="sxs-lookup"><span data-stu-id="0e384-150">Workflow’s implementation of duplex using a callback correlation ("Durable Duplex") is intended for long-running conversations.</span></span> <span data-ttu-id="0e384-151">これは、コールバック コントラクトを使用する WCF の二重と同じではありません。WCF の二重では、メッセージ交換が短時間 (チャネルの有効期間) で処理されます。</span><span class="sxs-lookup"><span data-stu-id="0e384-151">This is not the same as WCF duplex with callback contracts where the conversation is short-running (the lifetime of the channel).</span></span>

## <a name="message-formatting-and-messaging-activities"></a><span data-ttu-id="0e384-152">メッセージの書式設定とメッセージングアクティビティ</span><span class="sxs-lookup"><span data-stu-id="0e384-152">Message formatting and messaging activities</span></span>

<span data-ttu-id="0e384-153"><xref:System.ServiceModel.Activities.Receive> アクティビティと <xref:System.ServiceModel.Activities.ReceiveReply> アクティビティには、`Content` という名前のプロパティがあります。</span><span class="sxs-lookup"><span data-stu-id="0e384-153">The <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.ReceiveReply> activities have a property named `Content`.</span></span> <span data-ttu-id="0e384-154">このプロパティは <xref:System.ServiceModel.Activities.ReceiveContent> 型で、<xref:System.ServiceModel.Activities.Receive> アクティビティまたは <xref:System.ServiceModel.Activities.ReceiveReply> アクティビティが受信するデータを表します。</span><span class="sxs-lookup"><span data-stu-id="0e384-154">This property is of type <xref:System.ServiceModel.Activities.ReceiveContent> and represents data the <xref:System.ServiceModel.Activities.Receive> or <xref:System.ServiceModel.Activities.ReceiveReply> activity receives.</span></span> <span data-ttu-id="0e384-155">.NET Framework では、<xref:System.ServiceModel.Activities.ReceiveMessageContent> および <xref:System.ServiceModel.Activities.ReceiveParametersContent> という 2 つの関連クラスが定義されています。どちらも、<xref:System.ServiceModel.Activities.ReceiveContent> から派生しています。</span><span class="sxs-lookup"><span data-stu-id="0e384-155">The .NET Framework defines two related classes called <xref:System.ServiceModel.Activities.ReceiveMessageContent> and <xref:System.ServiceModel.Activities.ReceiveParametersContent> both of which are derived from <xref:System.ServiceModel.Activities.ReceiveContent>.</span></span> <span data-ttu-id="0e384-156">ワークフロー サービスでデータを受信するには、<xref:System.ServiceModel.Activities.Receive> アクティビティまたは <xref:System.ServiceModel.Activities.ReceiveReply> アクティビティの `Content` プロパティを、これらの型のいずれかのインスタンスに設定します。</span><span class="sxs-lookup"><span data-stu-id="0e384-156">Set the <xref:System.ServiceModel.Activities.Receive> or <xref:System.ServiceModel.Activities.ReceiveReply> activity’s `Content` property to an instance of one of these types to receive data into a workflow service.</span></span> <span data-ttu-id="0e384-157">どの型を使用するかは、アクティビティが受信するデータの型によって異なります。</span><span class="sxs-lookup"><span data-stu-id="0e384-157">The type to use depends upon the type of data the activity receives.</span></span> <span data-ttu-id="0e384-158">アクティビティが `Message` オブジェクト型またはメッセージ コントラクト型を受信する場合は、<xref:System.ServiceModel.Activities.ReceiveMessageContent> を使用します。</span><span class="sxs-lookup"><span data-stu-id="0e384-158">If the activity receives a `Message` object or a message contract type, use <xref:System.ServiceModel.Activities.ReceiveMessageContent>.</span></span> <span data-ttu-id="0e384-159">シリアル化できるデータ コントラクトまたは XML 型をアクティビティが受信した場合には、<xref:System.ServiceModel.Activities.ReceiveParametersContent> を使用します。</span><span class="sxs-lookup"><span data-stu-id="0e384-159">If the activity receives a set of data contract or XML types that can be serialized, use <xref:System.ServiceModel.Activities.ReceiveParametersContent>.</span></span> <span data-ttu-id="0e384-160"><xref:System.ServiceModel.Activities.ReceiveParametersContent> では複数のパラメーターを送信できますが、<xref:System.ServiceModel.Activities.ReceiveMessageContent> で送信できるのは、1 つのオブジェクト、つまり、メッセージ (またはメッセージ コントラクト型) のみです。</span><span class="sxs-lookup"><span data-stu-id="0e384-160"><xref:System.ServiceModel.Activities.ReceiveParametersContent> allows you to send multiple parameters, whereas <xref:System.ServiceModel.Activities.ReceiveMessageContent> only allows you to send one object, the message (or message contract type).</span></span>

> [!NOTE]
> <span data-ttu-id="0e384-161"><xref:System.ServiceModel.Activities.ReceiveMessageContent> は、シリアル化できるデータ コントラクトまたは XML 型が 1 つだけの場合も使用できます。</span><span class="sxs-lookup"><span data-stu-id="0e384-161"><xref:System.ServiceModel.Activities.ReceiveMessageContent> can also be used with a single data contract or XML type that can be serialized.</span></span> <span data-ttu-id="0e384-162">パラメーターが 1 つだけの <xref:System.ServiceModel.Activities.ReceiveParametersContent> を使用する場合と、<xref:System.ServiceModel.Activities.ReceiveMessageContent> に直接渡されるオブジェクトとの違いは、ワイヤ形式です。</span><span class="sxs-lookup"><span data-stu-id="0e384-162">The difference between using <xref:System.ServiceModel.Activities.ReceiveParametersContent> with a single parameter and the object passed directly to <xref:System.ServiceModel.Activities.ReceiveMessageContent> is the wire-format.</span></span> <span data-ttu-id="0e384-163">パラメーターのコンテンツは、操作名に対応する XML 要素でラップされ、シリアル化されたオブジェクトは、パラメーター名を使用した XML 要素でラップされます (例: `<Echo><msg>Hello, World</msg></Echo>`)。</span><span class="sxs-lookup"><span data-stu-id="0e384-163">The parameter’s content is wrapped in an XML element that corresponds to the operation name and the serialized object is wrapped in an XML element using the parameter name (for example, `<Echo><msg>Hello, World</msg></Echo>`).</span></span> <span data-ttu-id="0e384-164">メッセージの内容は、操作名によってラップされません。</span><span class="sxs-lookup"><span data-stu-id="0e384-164">The message content is not wrapped by the operation name.</span></span> <span data-ttu-id="0e384-165">代わりに、シリアル化されたオブジェクトが、XML 修飾型の名前を使用して XML 要素内に格納されます (例: `<string>Hello, World</string>`)。</span><span class="sxs-lookup"><span data-stu-id="0e384-165">Instead, the serialized object is placed within an XML element using the XML-qualified type name (for example, `<string>Hello, World</string>`).</span></span>

<span data-ttu-id="0e384-166"><xref:System.ServiceModel.Activities.Send> アクティビティと <xref:System.ServiceModel.Activities.SendReply> アクティビティにも、`Content` という名前のプロパティがあります。</span><span class="sxs-lookup"><span data-stu-id="0e384-166">The <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.SendReply> activities also have a property named `Content`.</span></span> <span data-ttu-id="0e384-167">このプロパティは <xref:System.ServiceModel.Activities.SendContent> 型で、<xref:System.ServiceModel.Activities.Send> アクティビティまたは <xref:System.ServiceModel.Activities.SendReply> アクティビティが送信するデータを表します。</span><span class="sxs-lookup"><span data-stu-id="0e384-167">This property is of type <xref:System.ServiceModel.Activities.SendContent> and represents data the <xref:System.ServiceModel.Activities.Send> or <xref:System.ServiceModel.Activities.SendReply> activity sends.</span></span> <span data-ttu-id="0e384-168">.NET Framework では、<xref:System.ServiceModel.Activities.SendMessageContent> および <xref:System.ServiceModel.Activities.SendParametersContent> という 2 つの関連型が定義されています。どちらも、<xref:System.ServiceModel.Activities.SendContent> から派生しています。</span><span class="sxs-lookup"><span data-stu-id="0e384-168">The .NET Framework defines two related types called <xref:System.ServiceModel.Activities.SendMessageContent> and <xref:System.ServiceModel.Activities.SendParametersContent> both of which are derived from <xref:System.ServiceModel.Activities.SendContent>.</span></span> <span data-ttu-id="0e384-169">ワークフロー サービスからデータを送信するには、<xref:System.ServiceModel.Activities.Send> アクティビティまたは <xref:System.ServiceModel.Activities.SendReply> アクティビティの `Content` プロパティを、これらの型のいずれかのインスタンスに設定します。</span><span class="sxs-lookup"><span data-stu-id="0e384-169">Set the <xref:System.ServiceModel.Activities.Send> or <xref:System.ServiceModel.Activities.SendReply> activity’s `Content` property to an instance of one of these types to send data from a workflow service.</span></span> <span data-ttu-id="0e384-170">どの型を使用するかは、アクティビティが送信するデータの型によって異なります。</span><span class="sxs-lookup"><span data-stu-id="0e384-170">The type to use depends upon the type of data the activity sends.</span></span> <span data-ttu-id="0e384-171">アクティビティが `Message` オブジェクト型またはメッセージ コントラクト型を送信する場合は、<xref:System.ServiceModel.Activities.SendMessageContent> を使用します。</span><span class="sxs-lookup"><span data-stu-id="0e384-171">If the activity sends a `Message` object or a message contract type, use <xref:System.ServiceModel.Activities.SendMessageContent>.</span></span> <span data-ttu-id="0e384-172">アクティビティがデータ コントラクト型を送信する場合は、<xref:System.ServiceModel.Activities.SendParametersContent> を使用します。</span><span class="sxs-lookup"><span data-stu-id="0e384-172">If the activity sends a data contract type use <xref:System.ServiceModel.Activities.SendParametersContent>.</span></span> <span data-ttu-id="0e384-173"><xref:System.ServiceModel.Activities.SendParametersContent> では複数のパラメーターを送信できますが、<xref:System.ServiceModel.Activities.SendMessageContent> で送信できるのは、1 つのオブジェクト、つまり、メッセージ (またはメッセージ コントラクト型) のみです。</span><span class="sxs-lookup"><span data-stu-id="0e384-173"><xref:System.ServiceModel.Activities.SendParametersContent> allows you to send multiple parameters, whereas <xref:System.ServiceModel.Activities.SendMessageContent> only allows you to send one object, the message (or the message contract type).</span></span>

<span data-ttu-id="0e384-174">強制的にメッセージング アクティビティを使用してプログラミングを行う場合は、汎用の <xref:System.Activities.InArgument%601> および <xref:System.Activities.OutArgument%601> を使用して、メッセージまたは <xref:System.ServiceModel.Activities.Send>、<xref:System.ServiceModel.Activities.SendReply>、<xref:System.ServiceModel.Activities.Receive>、および <xref:System.ServiceModel.Activities.ReceiveReply> アクティビティのパラメーター プロパティに割り当てるオブジェクトをラップします。</span><span class="sxs-lookup"><span data-stu-id="0e384-174">When programming imperatively with the messaging activities, you use the generic <xref:System.Activities.InArgument%601> and <xref:System.Activities.OutArgument%601> to wrap the objects you assign to the message or parameters properties of the <xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.Receive>, and <xref:System.ServiceModel.Activities.ReceiveReply> activities.</span></span> <span data-ttu-id="0e384-175">アクティビティとアクティビティにはを使用し、アクティビティとアクティビティにはを使用し <xref:System.Activities.InArgument%601> <xref:System.ServiceModel.Activities.Send> <xref:System.ServiceModel.Activities.SendReply> <xref:System.Activities.OutArgument%601> <xref:System.ServiceModel.Activities.Receive> <xref:System.ServiceModel.Activities.ReceiveReply> ます。</span><span class="sxs-lookup"><span data-stu-id="0e384-175">Use <xref:System.Activities.InArgument%601> for the <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.SendReply> activities and <xref:System.Activities.OutArgument%601> for <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.ReceiveReply> activities.</span></span> <span data-ttu-id="0e384-176">`In` 引数は、データがアクティビティに渡されるため、送信アクティビティで使用されます。</span><span class="sxs-lookup"><span data-stu-id="0e384-176">`In` arguments are used with the send activities because the data is being passed into the activities.</span></span> <span data-ttu-id="0e384-177">`Out` 引数は、データがアクティビティから渡されるため、受信アクティビティで使用されます。この例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="0e384-177">`Out` arguments are used with the receive activities because data is being passed out of the activities, as shown in the following example.</span></span>

```csharp
Receive reserveSeat = new Receive
{
    ...
    Content = new ReceiveParametersContent
    {
        Parameters =
        {
            { "ReservationInfo", new OutArgument<ReservationRequest>(reservationInfo) }
        }
    }
};
SendReply reserveSeat = new SendReply
{
    ...
    Request = reserveSeat,
    Content = new SendParametersContent
    {
        Parameters =
        {
            { "ReservationId", new InArgument<string>(reservationId) }
        }
    },
};
```

<span data-ttu-id="0e384-178">void を返す要求/応答操作を定義するワークフロー サービスを実装する場合は、<xref:System.ServiceModel.Activities.SendReply> アクティビティをインスタンス化して、<xref:System.ServiceModel.Activities.SendReply.Content%2A> プロパティをコンテンツの種類 (<xref:System.ServiceModel.Activities.SendMessageContent> または <xref:System.ServiceModel.Activities.SendParametersContent>) のいずれかのインスタンスに設定します。この例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="0e384-178">When implementing a workflow service that defines a request/response operation that returns void, you must instantiate a <xref:System.ServiceModel.Activities.SendReply> activity and set the <xref:System.ServiceModel.Activities.SendReply.Content%2A> property to an empty instance of one of the content types (<xref:System.ServiceModel.Activities.SendMessageContent> or <xref:System.ServiceModel.Activities.SendParametersContent>) as shown in the following example.</span></span>

```csharp
Receive rcv = new Receive()
{
ServiceContractName = "IService",
OperationName = "NullReturningContract",
Content = new ReceiveParametersContent( new Dictionary<string, OutArgument>() { { "message", new OutArgument<string>() } } )
};
SendReply sr = new SendReply()
{
Request = rcv
   Content = new SendParametersContent();
};
```

## <a name="add-service-reference"></a><span data-ttu-id="0e384-179">サービス参照の追加</span><span class="sxs-lookup"><span data-stu-id="0e384-179">Add service reference</span></span>

<span data-ttu-id="0e384-180">ワークフローアプリケーションからワークフローサービスを呼び出すと、Visual Studio 2012 は、 <xref:System.ServiceModel.Activities.Send> <xref:System.ServiceModel.Activities.ReceiveReply> 要求/応答 mep で使用される通常のアクティビティとアクティビティをカプセル化するカスタムメッセージングアクティビティを生成します。</span><span class="sxs-lookup"><span data-stu-id="0e384-180">When calling a workflow service from a workflow application, Visual Studio 2012 generates custom messaging activities that encapsulate the usual <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.ReceiveReply> activities used in a request/reply MEP.</span></span> <span data-ttu-id="0e384-181">この機能を使用するには、Visual Studio でクライアントプロジェクトを右クリック**Add**し、[  >  **サービス参照**の追加] を選択します。</span><span class="sxs-lookup"><span data-stu-id="0e384-181">To use this feature, right-click the client project in Visual Studio and select **Add** > **Service Reference**.</span></span> <span data-ttu-id="0e384-182">アドレス ボックスにサービスのベース アドレスを入力し、[移動] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="0e384-182">Type the base address of the service in the address box and click Go.</span></span> <span data-ttu-id="0e384-183">使用可能なサービスが [**サービス:** ] ボックスに表示されます。</span><span class="sxs-lookup"><span data-stu-id="0e384-183">The available services are displayed in the **Services:** box.</span></span> <span data-ttu-id="0e384-184">サービス ノードを展開して、サポートされるコントラクトを表示します。</span><span class="sxs-lookup"><span data-stu-id="0e384-184">Expand the service node to display the contracts supported.</span></span> <span data-ttu-id="0e384-185">呼び出すコントラクトを選択すると、[**操作**] ボックスに使用可能な操作の一覧が表示されます。</span><span class="sxs-lookup"><span data-stu-id="0e384-185">Select the contract you want to call and the list of available operations is displayed in the **Operations** box.</span></span> <span data-ttu-id="0e384-186">生成されたアクティビティの名前空間を指定し、[ **OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="0e384-186">You can then specify the namespace for the generated activity and click **OK**.</span></span> <span data-ttu-id="0e384-187">操作が正常に完了したことを示すダイアログが表示され、プロジェクトを再度ビルドすると、生成されたカスタム アクティビティがツールボックスに表示されます。</span><span class="sxs-lookup"><span data-stu-id="0e384-187">You then see a dialog that says the operation completed successfully and that the generated custom activities are in the toolbox after you have rebuilt the project.</span></span> <span data-ttu-id="0e384-188">サービス コントラクトに定義されている操作ごとに 1 つのアクティビティがあります。</span><span class="sxs-lookup"><span data-stu-id="0e384-188">There is one activity for each operation defined on the service contract.</span></span> <span data-ttu-id="0e384-189">プロジェクトを再度ビルドしたら、カスタム アクティビティをワークフローにドラッグ アンド ドロップして、必要なプロパティをプロパティ ウィンドウで設定できます。</span><span class="sxs-lookup"><span data-stu-id="0e384-189">After rebuilding the project you can drag and drop the custom activities onto your workflow and set any required properties in the properties window.</span></span>

## <a name="messaging-activity-templates"></a><span data-ttu-id="0e384-190">メッセージングアクティビティテンプレート</span><span class="sxs-lookup"><span data-stu-id="0e384-190">Messaging activity templates</span></span>

<span data-ttu-id="0e384-191">クライアントとサービスで要求/応答 MEP を簡単に設定できるようにするために、Visual Studio 2012 では2つのメッセージングアクティビティテンプレートが提供されています。</span><span class="sxs-lookup"><span data-stu-id="0e384-191">To make setting up a request/response MEP on the client and service easier, Visual Studio 2012 provides two messaging activity templates.</span></span> <span data-ttu-id="0e384-192">`System.ServiceModel.Activities.Design.ReceiveAndSendReply` はサービスで、`System.ServiceModel.Activities.Design.SendAndReceiveReply` はクライアントで使用されます。</span><span class="sxs-lookup"><span data-stu-id="0e384-192">`System.ServiceModel.Activities.Design.ReceiveAndSendReply` is used on the service and `System.ServiceModel.Activities.Design.SendAndReceiveReply` is used on the client.</span></span> <span data-ttu-id="0e384-193">どちらの場合も、テンプレートによって、適切なメッセージング アクティビティがワークフローに追加されます。</span><span class="sxs-lookup"><span data-stu-id="0e384-193">In both cases the templates add the appropriate messaging activities to your workflow.</span></span> <span data-ttu-id="0e384-194">サービスの場合、`System.ServiceModel.Activities.Design.ReceiveAndSendReply` は <xref:System.ServiceModel.Activities.Receive> アクティビティを追加し、次に <xref:System.ServiceModel.Activities.SendReply> アクティビティを追加します。</span><span class="sxs-lookup"><span data-stu-id="0e384-194">On the service, the `System.ServiceModel.Activities.Design.ReceiveAndSendReply` adds a <xref:System.ServiceModel.Activities.Receive> activity followed by a <xref:System.ServiceModel.Activities.SendReply> activity.</span></span> <span data-ttu-id="0e384-195"><xref:System.ServiceModel.Activities.SendReply.Request> プロパティは自動的に <xref:System.ServiceModel.Activities.Receive> アクティビティに設定されます。</span><span class="sxs-lookup"><span data-stu-id="0e384-195">The <xref:System.ServiceModel.Activities.SendReply.Request> property is automatically set to the <xref:System.ServiceModel.Activities.Receive> activity.</span></span> <span data-ttu-id="0e384-196">クライアントの場合、`System.ServiceModel.Activities.Design.SendAndReceiveReply` は <xref:System.ServiceModel.Activities.Send> アクティビティを追加し、次に <xref:System.ServiceModel.Activities.ReceiveReply> アクティビティを追加します。</span><span class="sxs-lookup"><span data-stu-id="0e384-196">On the client, the `System.ServiceModel.Activities.Design.SendAndReceiveReply` adds a <xref:System.ServiceModel.Activities.Send> activity followed by a <xref:System.ServiceModel.Activities.ReceiveReply>.</span></span> <span data-ttu-id="0e384-197"><xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> プロパティは自動的に <xref:System.ServiceModel.Activities.Send> アクティビティに設定されます。</span><span class="sxs-lookup"><span data-stu-id="0e384-197">The <xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> property is automatically set to the <xref:System.ServiceModel.Activities.Send> activity.</span></span> <span data-ttu-id="0e384-198">これらのテンプレートは、適切なテンプレートをワークフローにドラッグ アンド ドロップするだけで使用できます。</span><span class="sxs-lookup"><span data-stu-id="0e384-198">To use these templates, just drag and drop the appropriate template onto your workflow.</span></span>

## <a name="messaging-activities-and-transactions"></a><span data-ttu-id="0e384-199">メッセージングアクティビティとトランザクション</span><span class="sxs-lookup"><span data-stu-id="0e384-199">Messaging activities and transactions</span></span>

<span data-ttu-id="0e384-200">ワークフロー サービスが呼び出されるときに、サービス操作にトランザクションをフローする必要がある場合があります。</span><span class="sxs-lookup"><span data-stu-id="0e384-200">When a call is made to a workflow service you may want to flow a transaction to the service operation.</span></span> <span data-ttu-id="0e384-201">それには、<xref:System.ServiceModel.Activities.Receive> アクティビティを <xref:System.ServiceModel.Activities.TransactedReceiveScope> アクティビティ内に配置します。</span><span class="sxs-lookup"><span data-stu-id="0e384-201">To do this place the <xref:System.ServiceModel.Activities.Receive> activity within a <xref:System.ServiceModel.Activities.TransactedReceiveScope> activity.</span></span> <span data-ttu-id="0e384-202"><xref:System.ServiceModel.Activities.TransactedReceiveScope> アクティビティには、`Receive` アクティビティと本体が含まれます。</span><span class="sxs-lookup"><span data-stu-id="0e384-202">The <xref:System.ServiceModel.Activities.TransactedReceiveScope> activity contains a `Receive` activity and a body.</span></span> <span data-ttu-id="0e384-203">サービスにフローされるトランザクションは、<xref:System.ServiceModel.Activities.TransactedReceiveScope> の本体の実行の開始から終了まで、アンビエント トランザクションのままです。</span><span class="sxs-lookup"><span data-stu-id="0e384-203">The transaction flowed to the service remains ambient throughout the execution of the body of the <xref:System.ServiceModel.Activities.TransactedReceiveScope>.</span></span> <span data-ttu-id="0e384-204">トランザクションは、本体の実行が終了した時点で完了します。</span><span class="sxs-lookup"><span data-stu-id="0e384-204">The transaction is completed when the body finishes executing.</span></span> <span data-ttu-id="0e384-205">ワークフローとトランザクションの詳細については、「[ワークフロートランザクション](../../windows-workflow-foundation/workflow-transactions.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0e384-205">For more information about workflows and transactions see [Workflow Transactions](../../windows-workflow-foundation/workflow-transactions.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="0e384-206">関連項目</span><span class="sxs-lookup"><span data-stu-id="0e384-206">See also</span></span>

- [<span data-ttu-id="0e384-207">ワークフロー サービスでエラーを送受信する方法</span><span class="sxs-lookup"><span data-stu-id="0e384-207">How to Send and Receive Faults in Workflow Services</span></span>](https://go.microsoft.com/fwlink/?LinkId=189151)
- [<span data-ttu-id="0e384-208">長時間のワークフロー サービスの作成</span><span class="sxs-lookup"><span data-stu-id="0e384-208">Creating a Long-running Workflow Service</span></span>](creating-a-long-running-workflow-service.md)
