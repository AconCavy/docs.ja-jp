---
title: サポートされていないシナリオ
ms.date: 03/30/2017
ms.assetid: 72027d0f-146d-40c5-9d72-e94392c8bb40
ms.openlocfilehash: a963b46d22f2103cddcc8fd080feefc39070690c
ms.sourcegitcommit: 7088f87e9a7da144266135f4b2397e611cf0a228
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/11/2020
ms.locfileid: "75901271"
---
# <a name="unsupported-scenarios"></a><span data-ttu-id="76018-102">サポートされていないシナリオ</span><span class="sxs-lookup"><span data-stu-id="76018-102">Unsupported scenarios</span></span>

<span data-ttu-id="76018-103">Windows Communication Foundation (WCF) では、さまざまな理由により、特定のセキュリティシナリオがサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="76018-103">For various reasons, Windows Communication Foundation (WCF) does not support some specific security scenarios.</span></span> <span data-ttu-id="76018-104">たとえば、[!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition では SSPI または Kerberos 認証プロトコルが実装されていないため、WCF では、そのプラットフォームで Windows 認証を使用してサービスを実行することはサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="76018-104">For example, [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition does not implement the SSPI or Kerberos authentication protocols, and therefore WCF does not support running a service with Windows authentication on that platform.</span></span> <span data-ttu-id="76018-105">Windows XP Home Edition で WCF を実行する場合は、ユーザー名/パスワードや HTTP/HTTPS 統合認証などの他の認証メカニズムがサポートされます。</span><span class="sxs-lookup"><span data-stu-id="76018-105">Other authentication mechanisms, such as username/password and HTTP/HTTPS integrated authentication are supported when running WCF under Windows XP Home Edition.</span></span>

## <a name="impersonation-scenarios"></a><span data-ttu-id="76018-106">権限借用のシナリオ</span><span class="sxs-lookup"><span data-stu-id="76018-106">Impersonation scenarios</span></span>

### <a name="impersonated-identity-might-not-flow-when-clients-make-asynchronous-calls"></a><span data-ttu-id="76018-107">クライアントが非同期呼び出しを行うときに、偽装された id が流れないことがある</span><span class="sxs-lookup"><span data-stu-id="76018-107">Impersonated identity might not flow when clients make asynchronous calls</span></span>
 <span data-ttu-id="76018-108">WCF クライアントが、偽装で Windows 認証を使用して WCF サービスへの非同期呼び出しを行うと、偽装 ID ではなくクライアント プロセスの ID で認証が行われる場合があります。</span><span class="sxs-lookup"><span data-stu-id="76018-108">When a WCF client makes asynchronous calls to a WCF service using Windows authentication under impersonation, authentication might occur with the identity of the client process instead of the impersonated identity.</span></span>

### <a name="windows-xp-and-secure-context-token-cookie-enabled"></a><span data-ttu-id="76018-109">Windows XP およびセキュリティで保護されたコンテキストトークン cookie 有効</span><span class="sxs-lookup"><span data-stu-id="76018-109">Windows XP and secure context token cookie enabled</span></span>

<span data-ttu-id="76018-110">WCF では偽装がサポートされていないため、次の条件に該当する場合は <xref:System.InvalidOperationException> がスローされます。</span><span class="sxs-lookup"><span data-stu-id="76018-110">WCF does not support impersonation and an <xref:System.InvalidOperationException> is thrown when the following conditions exist:</span></span>

- <span data-ttu-id="76018-111">オペレーティング システムが [!INCLUDE[wxp](../../../../includes/wxp-md.md)] である。</span><span class="sxs-lookup"><span data-stu-id="76018-111">The operating system is [!INCLUDE[wxp](../../../../includes/wxp-md.md)].</span></span>

- <span data-ttu-id="76018-112">認証モードで Windows ID が生成された。</span><span class="sxs-lookup"><span data-stu-id="76018-112">The authentication mode results in a Windows identity.</span></span>

- <span data-ttu-id="76018-113"><xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> の <xref:System.ServiceModel.OperationBehaviorAttribute> プロパティが <xref:System.ServiceModel.ImpersonationOption.Required> に設定されています。</span><span class="sxs-lookup"><span data-stu-id="76018-113">The <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property of the <xref:System.ServiceModel.OperationBehaviorAttribute> is set to <xref:System.ServiceModel.ImpersonationOption.Required>.</span></span>

- <span data-ttu-id="76018-114">状態ベースのセキュリティ コンテキスト トークン (SCT: Security Context Token) が作成された (既定では、作成は無効になっています)。</span><span class="sxs-lookup"><span data-stu-id="76018-114">A state-based security context token (SCT) is created (by default, creation is disabled).</span></span>

 <span data-ttu-id="76018-115">状態ベースの SCT はカスタム バインディングの使用によってのみ作成できます。</span><span class="sxs-lookup"><span data-stu-id="76018-115">The state-based SCT can only be created using a custom binding.</span></span> <span data-ttu-id="76018-116">詳細については、「[方法: セキュリティで保護されたセッションのセキュリティコンテキストトークンを作成](how-to-create-a-security-context-token-for-a-secure-session.md)する」を参照してください。コードでは、トークンは <xref:System.ServiceModel.Channels.SecurityBindingElement.CreateSspiNegotiationBindingElement%28System.Boolean%29?displayProperty=nameWithType> または <xref:System.ServiceModel.Channels.SecurityBindingElement.CreateSecureConversationBindingElement%28System.ServiceModel.Channels.SecurityBindingElement%2CSystem.Boolean%29?displayProperty=nameWithType> メソッドを使用してセキュリティバインド要素 (<xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> または <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement>) を作成し、`requireCancellation` パラメーターを `false`に設定することによって有効にします。</span><span class="sxs-lookup"><span data-stu-id="76018-116">For more information, see [How to: Create a Security Context Token for a Secure Session](how-to-create-a-security-context-token-for-a-secure-session.md).) In code, the token is enabled by creating a security binding element (either <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> or <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement>) using the <xref:System.ServiceModel.Channels.SecurityBindingElement.CreateSspiNegotiationBindingElement%28System.Boolean%29?displayProperty=nameWithType> or the <xref:System.ServiceModel.Channels.SecurityBindingElement.CreateSecureConversationBindingElement%28System.ServiceModel.Channels.SecurityBindingElement%2CSystem.Boolean%29?displayProperty=nameWithType> method and setting the `requireCancellation` parameter to `false`.</span></span> <span data-ttu-id="76018-117">このパラメーターは、SCT のキャッシュを参照します。</span><span class="sxs-lookup"><span data-stu-id="76018-117">The parameter refers to the caching of the SCT.</span></span> <span data-ttu-id="76018-118">値を `false` に設定することによって、状態ベースの SCT 機能が有効になります。</span><span class="sxs-lookup"><span data-stu-id="76018-118">Setting the value to `false` enables the state-based SCT feature.</span></span>

 <span data-ttu-id="76018-119">または、構成において、<`customBinding`> を作成し、<`security`> 要素を追加して `authenticationMode` 属性に SecureConversation および `requireSecurityContextCancellation` 属性に `true` を設定することによってもトークンが有効になります。</span><span class="sxs-lookup"><span data-stu-id="76018-119">Alternatively, in configuration, the token is enabled by creating a <`customBinding`>, then adding a <`security`> element, and setting the `authenticationMode` attribute to SecureConversation and the `requireSecurityContextCancellation` attribute to `true`.</span></span>

> [!NOTE]
> <span data-ttu-id="76018-120">上記の要件は限定的です。</span><span class="sxs-lookup"><span data-stu-id="76018-120">The preceding requirements are specific.</span></span> <span data-ttu-id="76018-121">たとえば、<xref:System.ServiceModel.Channels.SecurityBindingElement.CreateKerberosBindingElement%2A> は Windows ID を生成するバインド要素を作成しますが、SCT を確立しません。</span><span class="sxs-lookup"><span data-stu-id="76018-121">For example, the <xref:System.ServiceModel.Channels.SecurityBindingElement.CreateKerberosBindingElement%2A> creates a binding element that results in a Windows identity, but does not establish an SCT.</span></span> <span data-ttu-id="76018-122">したがって、`Required` で [!INCLUDE[wxp](../../../../includes/wxp-md.md)] オプションと共に使用できます。</span><span class="sxs-lookup"><span data-stu-id="76018-122">Therefore, you can use it with the `Required` option on [!INCLUDE[wxp](../../../../includes/wxp-md.md)].</span></span>

### <a name="possible-aspnet-conflict"></a><span data-ttu-id="76018-123">考えられる ASP.NET の競合</span><span class="sxs-lookup"><span data-stu-id="76018-123">Possible ASP.NET conflict</span></span>

<span data-ttu-id="76018-124">WCF と ASP.NET は、どちらも偽装を有効または無効にすることができます。</span><span class="sxs-lookup"><span data-stu-id="76018-124">WCF and ASP.NET can both enable or disable impersonation.</span></span> <span data-ttu-id="76018-125">ASP.NET が WCF アプリケーションをホストする場合、WCF と ASP.NET の構成設定の間に競合が存在する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="76018-125">When ASP.NET hosts a WCF application, a conflict may exist between the WCF and ASP.NET configuration settings.</span></span> <span data-ttu-id="76018-126">競合が発生した場合は、<xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> プロパティが <xref:System.ServiceModel.ImpersonationOption.NotAllowed>に設定されていない限り、WCF 設定が優先されます。この場合、ASP.NET impersonation 設定が優先されます。</span><span class="sxs-lookup"><span data-stu-id="76018-126">In case of conflict, the WCF setting takes precedence, unless the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property is set to <xref:System.ServiceModel.ImpersonationOption.NotAllowed>, in which case the ASP.NET impersonation setting takes precedence.</span></span>

### <a name="assembly-loads-may-fail-under-impersonation"></a><span data-ttu-id="76018-127">アセンブリの読み込みが偽装の下で失敗することがある</span><span class="sxs-lookup"><span data-stu-id="76018-127">Assembly loads may fail under impersonation</span></span>

<span data-ttu-id="76018-128">偽装されたコンテキストにアセンブリを読み込むためのアクセス権がない場合、共通言語ランタイム (CLR: Common Language Runtime) が AppDomain のアセンブリを初めて読み込もうとしたときに、その <xref:System.AppDomain> はエラーをキャッシュします。</span><span class="sxs-lookup"><span data-stu-id="76018-128">If the impersonated context does not have access rights to load an assembly and if it is the first time the common language runtime (CLR) is attempting to load the assembly for that AppDomain, the <xref:System.AppDomain> caches the failure.</span></span> <span data-ttu-id="76018-129">この場合、偽装を元に戻した後、元に戻されたコンテキストにアセンブリを読み込むためのアクセス権があったとしても、それ以降のアセンブリの読み込みは失敗します。</span><span class="sxs-lookup"><span data-stu-id="76018-129">Subsequent attempts to load that assembly (or assemblies) fail, even after reverting the impersonation, and even if the reverted context has access rights to load the assembly.</span></span> <span data-ttu-id="76018-130">これは、ユーザーコンテキストが変更された後に CLR が読み込みを再試行しないためです。</span><span class="sxs-lookup"><span data-stu-id="76018-130">This is because the CLR does not reattempt the load after the user context is changed.</span></span> <span data-ttu-id="76018-131">このエラーから回復するには、アプリケーション ドメインを再起動する必要があります。</span><span class="sxs-lookup"><span data-stu-id="76018-131">You must restart the application domain to recover from the failure.</span></span>

> [!NOTE]
> <span data-ttu-id="76018-132"><xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> クラスの <xref:System.ServiceModel.Security.WindowsClientCredential> プロパティの既定値は <xref:System.Security.Principal.TokenImpersonationLevel.Identification> です。</span><span class="sxs-lookup"><span data-stu-id="76018-132">The default value for the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property of the <xref:System.ServiceModel.Security.WindowsClientCredential> class is <xref:System.Security.Principal.TokenImpersonationLevel.Identification>.</span></span> <span data-ttu-id="76018-133">ほとんどの場合、ID レベルの偽装コンテキストには、追加のアセンブリを読み込むための権限がありません。</span><span class="sxs-lookup"><span data-stu-id="76018-133">In most cases, an identification-level impersonation context has no rights to load any additional assemblies.</span></span> <span data-ttu-id="76018-134">これは既定値であるため、非常に一般的な状態として認識しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="76018-134">This is the default value, so this is a very common condition to be aware of.</span></span> <span data-ttu-id="76018-135">ID レベルの偽装は、偽装プロセスが `SeImpersonate` 権限を持たない場合にも発生します。</span><span class="sxs-lookup"><span data-stu-id="76018-135">Identification-level impersonation also occurs when the impersonating process does not have the `SeImpersonate` privilege.</span></span> <span data-ttu-id="76018-136">詳細については、「[委任と偽装](delegation-and-impersonation-with-wcf.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="76018-136">For more information, see [Delegation and Impersonation](delegation-and-impersonation-with-wcf.md).</span></span>

### <a name="delegation-requires-credential-negotiation"></a><span data-ttu-id="76018-137">委任には資格情報ネゴシエーションが必要</span><span class="sxs-lookup"><span data-stu-id="76018-137">Delegation requires credential negotiation</span></span>

<span data-ttu-id="76018-138">委任で Kerberos 認証プロトコルを使用するには、資格情報ネゴシエーションを使用する Kerberos プロトコル ("マルチレッグ" Kerberos または "マルチステップ" Kerberos とも呼ばれます) を実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="76018-138">To use the Kerberos authentication protocol with delegation, you must implement the Kerberos protocol with credential negotiation (sometimes called multi-leg or multi-step Kerberos).</span></span> <span data-ttu-id="76018-139">資格情報ネゴシエーションを使用しない Kerberos 認証 (ワンショット Kerberos またはシングルレッグ Kerberos とも呼ばれる) を実装した場合は、例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="76018-139">If you implement Kerberos authentication without credential negotiation (sometimes called one-shot or single-leg Kerberos), an exception is thrown.</span></span> <span data-ttu-id="76018-140">資格情報ネゴシエーションを実装する方法の詳細については、「 [Windows 認証エラーのデバッグ](debugging-windows-authentication-errors.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="76018-140">For more information about how to implement credential negotiation, see [Debugging Windows Authentication Errors](debugging-windows-authentication-errors.md).</span></span>

## <a name="cryptography"></a><span data-ttu-id="76018-141">暗号</span><span class="sxs-lookup"><span data-stu-id="76018-141">Cryptography</span></span>

### <a name="sha-256-supported-only-for-symmetric-key-usages"></a><span data-ttu-id="76018-142">SHA-256 は、対称キーの使用に対してのみサポートされます。</span><span class="sxs-lookup"><span data-stu-id="76018-142">SHA-256 supported only for symmetric key usages</span></span>

<span data-ttu-id="76018-143">WCF では、システム指定のバインディングでアルゴリズムスイートを使用して指定できる、さまざまな暗号化および署名ダイジェスト作成アルゴリズムがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="76018-143">WCF supports a variety of encryption and signature digest creation algorithms that you can specify using the algorithm suite in the system-provided bindings.</span></span> <span data-ttu-id="76018-144">セキュリティを強化するために、WCF では、署名ダイジェストハッシュを作成するためのセキュアハッシュアルゴリズム (SHA) 2 アルゴリズム (具体的には SHA-256) がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="76018-144">For improved security, WCF supports Secure Hash Algorithm (SHA) 2 algorithms, specifically SHA-256, for creating signature digest hashes.</span></span> <span data-ttu-id="76018-145">このリリースは、Kerberos キーなどの対称キーを使用する場合、およびメッセージに署名するために X.509 証明書を使用しない場合に限り SHA-256 をサポートします。</span><span class="sxs-lookup"><span data-stu-id="76018-145">This release supports SHA-256 only for symmetric key usages, such as Kerberos keys, and where an X.509 certificate is not used to sign the message.</span></span> <span data-ttu-id="76018-146">現在のところ、WCF では、x.509 証明256書で使用される RSA 署名はサポートされていません。これは、WinFX で RSA SHA256 がサポートされていないためです。</span><span class="sxs-lookup"><span data-stu-id="76018-146">WCF does not support RSA signatures (used in X.509 certificates) using SHA-256 hash due to the current lack of support for RSA-SHA256 in the WinFX.</span></span>

### <a name="fips-compliant-sha-256-hashes-not-supported"></a><span data-ttu-id="76018-147">FIPS 準拠の SHA-256 ハッシュはサポートされていません</span><span class="sxs-lookup"><span data-stu-id="76018-147">FIPS-compliant SHA-256 hashes not supported</span></span>

<span data-ttu-id="76018-148">WCF では、256 SHA-1 FIPS 準拠ハッシュはサポートされていないため、FIPS 準拠アルゴリズムを使用するシステムでは、SHA-256 を使用するアルゴリズムスイートは WCF ではサポートされません。</span><span class="sxs-lookup"><span data-stu-id="76018-148">WCF does not support SHA-256 FIPS-compliant hashes, so algorithm suites that use SHA-256 are not supported by WCF on systems where use of FIPS-compliant algorithms is required.</span></span>

### <a name="fips-compliant-algorithms-may-fail-if-registry-is-edited"></a><span data-ttu-id="76018-149">レジストリを編集すると、FIPS 準拠のアルゴリズムが失敗することがある</span><span class="sxs-lookup"><span data-stu-id="76018-149">FIPS-compliant algorithms may fail if registry is edited</span></span>

<span data-ttu-id="76018-150">連邦情報処理規格 (FIPS: Federal Information Processing Standards) 準拠のアルゴリズムを有効または無効にするには、Microsoft 管理コンソール (MMC: Microsoft Management Console) のローカル セキュリティ設定スナップインを使用します。</span><span class="sxs-lookup"><span data-stu-id="76018-150">You can enable and disable Federal Information Processing Standards (FIPS)-compliant algorithms by using the Local Security Settings Microsoft Management Console (MMC) snap-in.</span></span> <span data-ttu-id="76018-151">レジストリでこの設定にアクセスすることもできます。</span><span class="sxs-lookup"><span data-stu-id="76018-151">You can also access the setting in the registry.</span></span> <span data-ttu-id="76018-152">ただし、WCF では、レジストリを使用した設定のリセットはサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="76018-152">Note, however, that WCF does not support using the registry to reset the setting.</span></span> <span data-ttu-id="76018-153">値を 1 または 0 以外に設定すると、CLR とオペレーティング システム間で不整合が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="76018-153">If the value is set to anything other than 1 or 0, inconsistent results can occur between the CLR and the operating system.</span></span>

### <a name="fips-compliant-aes-encryption-limitation"></a><span data-ttu-id="76018-154">FIPS 準拠の AES 暗号化の制限</span><span class="sxs-lookup"><span data-stu-id="76018-154">FIPS-compliant AES encryption limitation</span></span>

<span data-ttu-id="76018-155">FIPS 準拠の AES 暗号化は、識別レベルの権限借用の下にある双方向コールバックでは機能しません。</span><span class="sxs-lookup"><span data-stu-id="76018-155">FIPS-compliant AES encryption does not work in duplex callbacks under identification level impersonation.</span></span>

### <a name="cngksp-certificates"></a><span data-ttu-id="76018-156">CNG/KSP 証明書</span><span class="sxs-lookup"><span data-stu-id="76018-156">CNG/KSP certificates</span></span>

<span data-ttu-id="76018-157">*CRYPTOGRAPHY API: Next Generation (CNG)* は、CryptoAPI の長期的な後継です。</span><span class="sxs-lookup"><span data-stu-id="76018-157">*Cryptography API: Next Generation (CNG)* is the long-term replacement for the CryptoAPI.</span></span> <span data-ttu-id="76018-158">この API は、windows Vista、Windows Server 2008、およびそれ以降の Windows バージョンのアンマネージコードで使用できます。</span><span class="sxs-lookup"><span data-stu-id="76018-158">This API is available in unmanaged code on Windows Vista, Windows Server 2008, and later Windows versions.</span></span>

 <span data-ttu-id="76018-159">.NET Framework 4.6.1 以前のバージョンでは、従来の CryptoAPI を使用して CNG/KSP 証明書を処理するため、これらの証明書はサポートされません。</span><span class="sxs-lookup"><span data-stu-id="76018-159">.NET Framework 4.6.1 and earlier versions do not support these certificates because they use the legacy CryptoAPI to handle CNG/KSP certificates.</span></span> <span data-ttu-id="76018-160">これらの証明書を .NET Framework 4.6.1 以前のバージョンで使用すると、例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="76018-160">The use of these certificates with   .NET Framework 4.6.1 and earlier versions will cause an exception.</span></span>

 <span data-ttu-id="76018-161">証明書に KSP が使用されているかどうかを知る方法は 2 つあります。</span><span class="sxs-lookup"><span data-stu-id="76018-161">There are two possible ways to tell if a certificate uses KSP:</span></span>

- <span data-ttu-id="76018-162">`p/invoke` を `CertGetCertificateContextProperty` に対して実行し、返された `dwProvType` で `CertGetCertificateContextProperty` を調べる。</span><span class="sxs-lookup"><span data-stu-id="76018-162">Do a `p/invoke` of `CertGetCertificateContextProperty`, and inspect `dwProvType` on the returned `CertGetCertificateContextProperty`.</span></span>

- <span data-ttu-id="76018-163">証明書を照会するには、コマンドラインから `certutil` コマンドを使用します。</span><span class="sxs-lookup"><span data-stu-id="76018-163">Use the  `certutil` command from the command line for querying certificates.</span></span> <span data-ttu-id="76018-164">詳細については、「[証明書のトラブルシューティングに関する Certutil タスク](https://docs.microsoft.com/previous-versions/orphan-topics/ws.10/cc772619(v=ws.10))」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="76018-164">For more information, see [Certutil tasks for troubleshooting certificates](https://docs.microsoft.com/previous-versions/orphan-topics/ws.10/cc772619(v=ws.10)).</span></span>

## <a name="message-security-fails-if-using-aspnet-impersonation-and-aspnet-compatibility-is-required"></a><span data-ttu-id="76018-165">ASP.NET 権限借用を使用し、ASP.NET compatibility が必要な場合は、メッセージセキュリティが失敗する</span><span class="sxs-lookup"><span data-stu-id="76018-165">Message security fails if using ASP.NET impersonation and ASP.NET compatibility is required</span></span>

<span data-ttu-id="76018-166">WCF では、クライアント認証が行われないようにするため、次の設定の組み合わせはサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="76018-166">WCF does not support the following combination of settings because they can prevent client authentication from occurring:</span></span>

- <span data-ttu-id="76018-167">ASP.NET の偽装が有効になっています。</span><span class="sxs-lookup"><span data-stu-id="76018-167">ASP.NET Impersonation is enabled.</span></span> <span data-ttu-id="76018-168">これは、web.config ファイルで、<`identity`> 要素の `impersonate` 属性を `true`に設定することによって行われます。</span><span class="sxs-lookup"><span data-stu-id="76018-168">This is done in the Web.config file by setting the `impersonate` attribute of the <`identity`> element to `true`.</span></span>

- <span data-ttu-id="76018-169">ASP.NET 互換モードを有効にするには[\<serviceHostingEnvironment >](../../configure-apps/file-schema/wcf/servicehostingenvironment.md)の `aspNetCompatibilityEnabled` 属性を `true`に設定します。</span><span class="sxs-lookup"><span data-stu-id="76018-169">ASP.NET compatibility mode is enabled by setting the `aspNetCompatibilityEnabled` attribute of the [\<serviceHostingEnvironment>](../../configure-apps/file-schema/wcf/servicehostingenvironment.md) to `true`.</span></span>

- <span data-ttu-id="76018-170">メッセージ モード セキュリティを使用している。</span><span class="sxs-lookup"><span data-stu-id="76018-170">Message mode security is used.</span></span>

<span data-ttu-id="76018-171">回避策として、ASP.NET 互換モードをオフにします。</span><span class="sxs-lookup"><span data-stu-id="76018-171">The work-around is to turn off the ASP.NET compatibility mode.</span></span> <span data-ttu-id="76018-172">または、ASP.NET 互換モードが必要な場合は、ASP.NET 権限借用機能を無効にし、代わりに WCF によって提供される偽装を使用します。</span><span class="sxs-lookup"><span data-stu-id="76018-172">Or, if the ASP.NET compatibility mode is required, disable the ASP.NET impersonation feature and use WCF-provided impersonation instead.</span></span> <span data-ttu-id="76018-173">詳細については、「[委任と偽装](delegation-and-impersonation-with-wcf.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="76018-173">For more information, see [Delegation and Impersonation](delegation-and-impersonation-with-wcf.md).</span></span>

## <a name="ipv6-literal-address-failure"></a><span data-ttu-id="76018-174">IPv6 リテラルアドレスのエラー</span><span class="sxs-lookup"><span data-stu-id="76018-174">IPv6 literal address failure</span></span>

<span data-ttu-id="76018-175">クライアントとサービスが同じコンピューター上に存在し、サービスに対して IPv6 リテラル アドレスが使用されている場合は、セキュリティ要求が失敗します。</span><span class="sxs-lookup"><span data-stu-id="76018-175">Security requests fail when the client and service are on the same machine, and IPv6 literal addresses are used for the service.</span></span>

 <span data-ttu-id="76018-176">IPv6 リテラル アドレスは、サービスとクライアントがそれぞれ異なるコンピューター上に存在する場合に機能します。</span><span class="sxs-lookup"><span data-stu-id="76018-176">Literal IPv6 addresses work if the service and client are on different machines.</span></span>

## <a name="wsdl-retrieval-failures-with-federated-trust"></a><span data-ttu-id="76018-177">フェデレーション信頼での WSDL の取得エラー</span><span class="sxs-lookup"><span data-stu-id="76018-177">WSDL retrieval failures with federated trust</span></span>

<span data-ttu-id="76018-178">WCF では、フェデレーション信頼チェーン内のノードごとに1つの WSDL ドキュメントが必要です。</span><span class="sxs-lookup"><span data-stu-id="76018-178">WCF requires exactly one WSDL document for each node in the federated trust chain.</span></span> <span data-ttu-id="76018-179">エンドポイントを指定するときにループにならないように注意する必要があります。</span><span class="sxs-lookup"><span data-stu-id="76018-179">Be careful not to set up a loop when specifying endpoints.</span></span> <span data-ttu-id="76018-180">ループになる場合の例の 1 つは、フェデレーション信頼チェーンの WSDL ダウンロードの使用で、同じ WSDL ドキュメントの中に複数のリンクがある場合です。</span><span class="sxs-lookup"><span data-stu-id="76018-180">One way in which loops can arise is using a WSDL download of federated trust chains with two or more links in the same WSDL document.</span></span> <span data-ttu-id="76018-181">この問題がよく発生するシナリオは、セキュリティ トークン サーバーとセキュリティ トークン サービスが同じ ServiceHost の中にあるフェデレーション サービスです。</span><span class="sxs-lookup"><span data-stu-id="76018-181">A common scenario that can produce this problem is a federated service where the Security Token Server and the service are contained inside the same ServiceHost.</span></span>

 <span data-ttu-id="76018-182">そのような状況の例は次の 3 つのエンドポイント アドレスを使うサービスです。</span><span class="sxs-lookup"><span data-stu-id="76018-182">An example of this situation is a service with the following three endpoint addresses:</span></span>

- <span data-ttu-id="76018-183">`http://localhost/CalculatorService/service` (サービス)</span><span class="sxs-lookup"><span data-stu-id="76018-183">`http://localhost/CalculatorService/service` (the service)</span></span>

- <span data-ttu-id="76018-184">`http://localhost/CalculatorService/issue_ticket` (STS)</span><span class="sxs-lookup"><span data-stu-id="76018-184">`http://localhost/CalculatorService/issue_ticket` (the STS)</span></span>

- <span data-ttu-id="76018-185">`http://localhost/CalculatorService/mex` (メタデータエンドポイント)</span><span class="sxs-lookup"><span data-stu-id="76018-185">`http://localhost/CalculatorService/mex` (the metadata endpoint)</span></span>

 <span data-ttu-id="76018-186">これによって例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="76018-186">This throws an exception.</span></span>

 <span data-ttu-id="76018-187">このシナリオでエラーを避けるには、`issue_ticket` エンドポイントを別のところに置きます。</span><span class="sxs-lookup"><span data-stu-id="76018-187">You can make this scenario work by putting the `issue_ticket` endpoint elsewhere.</span></span>

## <a name="wsdl-import-attributes-can-be-lost"></a><span data-ttu-id="76018-188">WSDL インポート属性が失われる可能性があります</span><span class="sxs-lookup"><span data-stu-id="76018-188">WSDL import attributes can be lost</span></span>

<span data-ttu-id="76018-189">WSDL インポートの際に、WCF は `<wst:Claims>` テンプレート内の `RST` 要素にあるインポート属性を追跡できなくなることがあります。</span><span class="sxs-lookup"><span data-stu-id="76018-189">WCF loses track of the attributes on a `<wst:Claims>` element in an `RST` template when doing a WSDL import.</span></span> <span data-ttu-id="76018-190">これは、クレームの種類のコレクションを直接使用する代わりに `<Claims>` を直接 `WSFederationHttpBinding.Security.Message.TokenRequestParameters` または `IssuedSecurityTokenRequestParameters.AdditionalRequestParameters` 内で指定した場合に、WSDL インポートの際に発生します。</span><span class="sxs-lookup"><span data-stu-id="76018-190">This happens during a WSDL import if you specify `<Claims>` directly in `WSFederationHttpBinding.Security.Message.TokenRequestParameters` or `IssuedSecurityTokenRequestParameters.AdditionalRequestParameters` instead of using the claim type collections directly.</span></span>  <span data-ttu-id="76018-191">インポートが属性を失うので、WSDL を介して正しいバインディングのラウンド トリップが行われません。したがって、クライアント側で不適切になります。</span><span class="sxs-lookup"><span data-stu-id="76018-191">Since the import loses the attributes, the binding does not round trip properly through WSDL and hence is incorrect on the client side.</span></span>

 <span data-ttu-id="76018-192">解決策は、インポートを行った後、クライアント側で直接バインディングを変更することです。</span><span class="sxs-lookup"><span data-stu-id="76018-192">The fix is to modify the binding directly on the client after doing the import.</span></span>

## <a name="see-also"></a><span data-ttu-id="76018-193">関連項目</span><span class="sxs-lookup"><span data-stu-id="76018-193">See also</span></span>

- [<span data-ttu-id="76018-194">セキュリティの考慮事項</span><span class="sxs-lookup"><span data-stu-id="76018-194">Security Considerations</span></span>](security-considerations-in-wcf.md)
- [<span data-ttu-id="76018-195">情報の漏えい</span><span class="sxs-lookup"><span data-stu-id="76018-195">Information Disclosure</span></span>](information-disclosure.md)
- [<span data-ttu-id="76018-196">権限の昇格</span><span class="sxs-lookup"><span data-stu-id="76018-196">Elevation of Privilege</span></span>](elevation-of-privilege.md)
- [<span data-ttu-id="76018-197">サービス拒否</span><span class="sxs-lookup"><span data-stu-id="76018-197">Denial of Service</span></span>](denial-of-service.md)
- [<span data-ttu-id="76018-198">改変</span><span class="sxs-lookup"><span data-stu-id="76018-198">Tampering</span></span>](tampering.md)
- [<span data-ttu-id="76018-199">リプレイ攻撃</span><span class="sxs-lookup"><span data-stu-id="76018-199">Replay Attacks</span></span>](replay-attacks.md)
