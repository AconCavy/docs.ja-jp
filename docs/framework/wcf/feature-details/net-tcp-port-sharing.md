---
title: Net.TCP ポート共有
ms.date: 03/30/2017
helpviewer_keywords:
- port activation [WCF]
- port sharing [WCF]
ms.assetid: f13692ee-a179-4439-ae72-50db9534eded
ms.openlocfilehash: d9c6caa546d9f31f4e68b850dc1b1e750da2e93c
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/09/2020
ms.locfileid: "84598763"
---
# <a name="nettcp-port-sharing"></a><span data-ttu-id="7e7e0-102">Net.TCP ポート共有</span><span class="sxs-lookup"><span data-stu-id="7e7e0-102">Net.TCP Port Sharing</span></span>
<span data-ttu-id="7e7e0-103">Windows Communication Foundation (WCF) は、高パフォーマンス通信用の新しい TCP ベースのネットワークプロトコル (net.tcp://) を提供します。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-103">Windows Communication Foundation (WCF) provides a new TCP-based network protocol (net.tcp://) for high-performance communication.</span></span> <span data-ttu-id="7e7e0-104">また、WCF には、net.tcp ポートを複数のユーザープロセスで共有できるようにする Net.tcp ポート共有サービスである、新しいシステムコンポーネントも導入されています。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-104">WCF also introduces a new system component, the Net.TCP Port Sharing Service that enables net.tcp ports to be shared across multiple user processes.</span></span>  
  
## <a name="background-and-motivation"></a><span data-ttu-id="7e7e0-105">背景と動機</span><span class="sxs-lookup"><span data-stu-id="7e7e0-105">Background and Motivation</span></span>  
 <span data-ttu-id="7e7e0-106">TCP/IP プロトコルの導入当初は、それを使用するアプリケーション プロトコルは少ししかありませんでした。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-106">When the TCP/IP protocol was first introduced, only a small number of application protocols made use of it.</span></span> <span data-ttu-id="7e7e0-107">TCP/IP では、ポート番号を使用して一意の 16 ビットのポート番号を各アプリケーション プロトコルに割り当てることでアプリケーションが区別されました。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-107">TCP/IP used port numbers to differentiate between applications by assigning a unique 16-bit port number to each application protocol.</span></span> <span data-ttu-id="7e7e0-108">たとえば、現在 HTTP トラフィックは TCP ポート 80、SMTP は TCP ポート 25、FTP は TCP ポート 20 と 21 を使用するように標準化されています。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-108">For example, HTTP traffic today is standardized to use TCP port 80, SMTP uses TCP port 25, and FTP uses TCP ports 20 and 21.</span></span> <span data-ttu-id="7e7e0-109">他のアプリケーションで TCP をトランスポートとして使用する場合は、規則により、または正式な標準化を通じて別の利用可能なポート番号を選択できます。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-109">Other applications using TCP as a transport can choose another available port number, either by convention or through formal standardization.</span></span>  
  
 <span data-ttu-id="7e7e0-110">ポート番号を使用してアプリケーションを区別することについては、セキュリティの問題がありました。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-110">Using port numbers to distinguish between applications had security problems.</span></span> <span data-ttu-id="7e7e0-111">通常、ファイアウォールは、よく知られたわずかなエントリ ポイントを除いてすべてのポートの TCP トラフィックをブロックするよう構成されています。そのため、非標準のポートを使用するアプリケーションを展開する際に、企業のファイアウォールまたはパーソナル ファイアウォールがあるために展開が複雑になることや、展開が不可能になる場合がよくあります。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-111">Firewalls are generally configured to block TCP traffic on all ports except for a few well-known entry points, so deploying an application that uses a non-standard port is often complicated or even impossible due to the presence of corporate and personal firewalls.</span></span> <span data-ttu-id="7e7e0-112">アプリケーションが、許可済みの標準の Well-known ポートで通信できる場合は、外部攻撃の侵入経路を減らすことができます。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-112">Applications that can communicate over standard, well-known ports that are already permitted, reduce the external attack surface.</span></span> <span data-ttu-id="7e7e0-113">多くのファイアウォールは、TCP ポート 80 のトラフィックを既定で許可するよう構成されているため、多くのネットワーク アプリケーションが HTTP プロトコルを利用します。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-113">Many network applications make use of the HTTP protocol because most firewalls are configured by default to allow traffic on TCP port 80.</span></span>  
  
 <span data-ttu-id="7e7e0-114">多くの異なる HTTP アプリケーションのトラフィックを 1 つの TCP ポートに多重化する HTTP.SYS モデルが、Windows プラットフォームで標準になってきました。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-114">The HTTP.SYS model in which traffic for many different HTTP applications is multiplexed onto a single TCP port has become standard on the Windows platform.</span></span> <span data-ttu-id="7e7e0-115">このモデルを使用すると、ファイアウォール管理者は共通の制御点を使用できるようになり、また、アプリケーション開発者はネットワークを利用できる新しいアプリケーションを構築する際に、展開コストを最小限にできます。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-115">This provides a common point of control for firewall administrators while allowing application developers to minimize the deployment cost of building new applications that can make use of the network.</span></span>  
  
 <span data-ttu-id="7e7e0-116">インターネット インフォメーション サービス (IIS) には、HTTP アプリケーション間でポートを共有する機能が以前からあります。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-116">The ability to share ports across multiple HTTP applications has long been a feature of Internet Information Services (IIS).</span></span> <span data-ttu-id="7e7e0-117">ただし、これは HTTP の導入にのみ使用されていました。このインフラストラクチャが完全に一般化された SYS (カーネルモードの HTTP プロトコルリスナー) と IIS 6.0。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-117">However, it was only with the introduction of HTTP.SYS (the kernel-mode HTTP protocol listener) with IIS 6.0 that this infrastructure was fully generalized.</span></span> <span data-ttu-id="7e7e0-118">実際には、HTTP.SYS が、任意のユーザー プロセスで HTTP トラフィック専用の TCP ポートを共有することを許可します。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-118">In effect, HTTP.SYS allows arbitrary user processes to share the TCP ports dedicated to HTTP traffic.</span></span> <span data-ttu-id="7e7e0-119">この機能により、多数の HTTP アプリケーションが同一の物理コンピューター上にそれぞれ別の独立したプロセスとして共存しながら、TCP ポート 80 でのトラフィックの送受信に必要なネットワーク インフラストラクチャを共有することができます。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-119">This capability allows many HTTP applications to coexist on the same physical machine in separate, isolated processes while sharing the network infrastructure required to send and receive traffic over TCP port 80.</span></span> <span data-ttu-id="7e7e0-120">Net.TCP ポート共有サービスは、net.tcp アプリケーションで同じ種類のポート共有を可能にします。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-120">The Net.TCP Port Sharing Service enables the same type of port sharing for net.tcp applications.</span></span>  
  
## <a name="port-sharing-architecture"></a><span data-ttu-id="7e7e0-121">ポート共有アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="7e7e0-121">Port Sharing Architecture</span></span>  
 <span data-ttu-id="7e7e0-122">WCF のポート共有アーキテクチャには、次の3つの主要なコンポーネントがあります。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-122">The Port Sharing architecture in WCF has three main components:</span></span>  
  
- <span data-ttu-id="7e7e0-123">ワーカー プロセス : 共有ポートを使用して net.tcp:// で通信するすべてのプロセスです。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-123">A Worker Process: Any process communicating over net.tcp:// using shared ports.</span></span>  
  
- <span data-ttu-id="7e7e0-124">WCF TCP transport: net.tcp://プロトコルを実装します。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-124">The WCF TCP transport: Implements the net.tcp:// protocol.</span></span>  
  
- <span data-ttu-id="7e7e0-125">Net.TCP ポート共有サービス : 多数のワーカー プロセスで 1 つの TCP ポートを共有できます。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-125">The Net.TCP Port Sharing Service: Allows many worker processes to share the same TCP port.</span></span>  
  
 <span data-ttu-id="7e7e0-126">Net.TCP ポート共有サービスは、net.tcp:// を通じて通信されるワーカー プロセスの代わりに net.tcp:// 接続を受け入れるユーザー モードの Windows サービスです。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-126">The Net.TCP Port Sharing Service is a user-mode Windows service that accepts net.tcp:// connections on behalf of the worker processes that connect through it.</span></span> <span data-ttu-id="7e7e0-127">ソケット接続が到着すると、ポート共有サービスは受信メッセージ ストリームを検査して送信先アドレスを取得します。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-127">When a socket connection arrives, the port sharing service inspects the incoming message stream to obtain its destination address.</span></span> <span data-ttu-id="7e7e0-128">このアドレスを基にポート共有サービスは、最終的に処理されるアプリケーションにデータ ストリームをルーティングできます。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-128">Based on this address, the port sharing service can route the data stream to the application that ultimately processes it.</span></span>  
  
 <span data-ttu-id="7e7e0-129">net.tcp:// ポート共有を使用する WCF サービスがポートを開いた場合、WCF TCP トランスポート インフラストラクチャでは、アプリケーション プロセスで TCP ソケットを直接開くことはできません。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-129">When a WCF service that uses net.tcp:// port sharing opens, the WCF TCP transport infrastructure does not directly open a TCP socket in the application process.</span></span> <span data-ttu-id="7e7e0-130">その代わりにトランスポート インフラストラクチャは、サービスのベース アドレス URI (Uniform Resource Identifier) を Net.TCP ポート共有サービスに登録し、ポート共有サービスがトランスポート インフラストラクチャの代わりにメッセージをリッスンするまで待機します。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-130">Instead, the transport infrastructure registers the service’s base address Uniform Resource Identifier (URI) with the Net.TCP Port Sharing Service and waits for the port sharing service to listen for messages on its behalf.</span></span>  <span data-ttu-id="7e7e0-131">アプリケーション サービス宛てのメッセージが到着すると、そのメッセージはポート共有サービスによりディスパッチされます。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-131">The port sharing service dispatches messages addressed to the application service as they arrive.</span></span>  
  
## <a name="installing-port-sharing"></a><span data-ttu-id="7e7e0-132">ポート共有のインストール</span><span class="sxs-lookup"><span data-stu-id="7e7e0-132">Installing Port Sharing</span></span>  
 <span data-ttu-id="7e7e0-133">Net.tcp ポート共有サービスは、WinFX をサポートするすべてのオペレーティングシステムで使用できますが、サービスは既定では有効になっていません。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-133">The Net.TCP Port Sharing Service is available on all operating systems that support WinFX, but the service is not enabled by default.</span></span> <span data-ttu-id="7e7e0-134">セキュリティ予防措置として、管理者は Net.TCP ポート共有サービスを初めて使用する前に手動で有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-134">As a security precaution, an administrator must manually enable the Net.TCP Port Sharing Service prior to first use.</span></span> <span data-ttu-id="7e7e0-135">Net.TCP ポート共有サービスでは、ポート共有サービスが所有するネットワーク ソケットのいくつかの特性を操作するための構成オプションが公開されます。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-135">The Net.TCP Port Sharing Service exposes configuration options that allow you to manipulate several characteristics of the network sockets owned by the port sharing service.</span></span> <span data-ttu-id="7e7e0-136">詳細については、「[方法: Net.tcp ポート共有サービスを有効](how-to-enable-the-net-tcp-port-sharing-service.md)にする」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-136">For more information, see [How to: Enable the Net.TCP Port Sharing Service](how-to-enable-the-net-tcp-port-sharing-service.md).</span></span>  
  
## <a name="using-nettcp-port-sharing-in-an-application"></a><span data-ttu-id="7e7e0-137">アプリケーションでの Net.tcp ポート共有の使用</span><span class="sxs-lookup"><span data-stu-id="7e7e0-137">Using Net.tcp Port Sharing in an Application</span></span>  
 <span data-ttu-id="7e7e0-138">WCF アプリケーションで net.tcp://ポート共有を使用する最も簡単な方法は、を使用してサービスを公開して <xref:System.ServiceModel.NetTcpBinding> から、プロパティを使用して Net.tcp ポート共有サービスを有効にすることです <xref:System.ServiceModel.NetTcpBinding.PortSharingEnabled%2A> 。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-138">The easiest way to use net.tcp:// port sharing in your WCF application is to expose a service using the <xref:System.ServiceModel.NetTcpBinding> and then to enable Net.TCP Port Sharing Service using the <xref:System.ServiceModel.NetTcpBinding.PortSharingEnabled%2A> property.</span></span>  
  
 <span data-ttu-id="7e7e0-139">これを行う方法の詳細については、「[方法: ポート共有を使用するように WCF サービスを構成](how-to-configure-a-wcf-service-to-use-port-sharing.md)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-139">For more information about how to do this, see [How to: Configure a WCF Service to Use Port Sharing](how-to-configure-a-wcf-service-to-use-port-sharing.md).</span></span>  
  
## <a name="security-implications-of-port-sharing"></a><span data-ttu-id="7e7e0-140">ポート共有のセキュリティへの影響</span><span class="sxs-lookup"><span data-stu-id="7e7e0-140">Security Implications of Port Sharing</span></span>  
 <span data-ttu-id="7e7e0-141">Net.TCP ポート共有サービスは、アプリケーションとネットワークの間に、処理を行うための 1 つの層を提供しますが、アプリケーションでポート共有を使用する場合、アプリケーションがネットワークを直接リッスンしている場合と同様に、アプリケーションをセキュリティで保護する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-141">Although the Net.TCP Port Sharing Service provides a layer of processing between applications and the network, applications that use port sharing should still be secured as if they were directly listening on the network.</span></span> <span data-ttu-id="7e7e0-142">具体的には、ポート共有を使用するアプリケーションでは、そのアプリケーションが実行される際のプロセス特権を評価する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-142">Specifically, applications that use port sharing should evaluate the process privileges under which they run.</span></span> <span data-ttu-id="7e7e0-143">組み込みの Network Service アカウントを使用してアプリケーションを実行することを検討します。このアカウントはネットワーク通信に必要な最小限のプロセス特権のセットを使用して実行されます。</span><span class="sxs-lookup"><span data-stu-id="7e7e0-143">Consider running your application using the built-in Network Service account, which runs with the minimal set of process privileges required for network communication.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7e7e0-144">関連項目</span><span class="sxs-lookup"><span data-stu-id="7e7e0-144">See also</span></span>

- [<span data-ttu-id="7e7e0-145">Net.TCP ポート共有サービスを構成する</span><span class="sxs-lookup"><span data-stu-id="7e7e0-145">Configuring the Net.TCP Port Sharing Service</span></span>](configuring-the-net-tcp-port-sharing-service.md)
- [<span data-ttu-id="7e7e0-146">ホスティング</span><span class="sxs-lookup"><span data-stu-id="7e7e0-146">Hosting</span></span>](hosting.md)
- [<span data-ttu-id="7e7e0-147">方法: ポート共有を使用するように WCF サービスを構成する</span><span class="sxs-lookup"><span data-stu-id="7e7e0-147">How to: Configure a WCF Service to Use Port Sharing</span></span>](how-to-configure-a-wcf-service-to-use-port-sharing.md)
- [<span data-ttu-id="7e7e0-148">方法: Net.TCP ポート共有サービスを有効にする</span><span class="sxs-lookup"><span data-stu-id="7e7e0-148">How to: Enable the Net.TCP Port Sharing Service</span></span>](how-to-enable-the-net-tcp-port-sharing-service.md)
