---
title: サービス ID と認証
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- authentication [WCF], specifying the identity of a service
ms.assetid: a4c8f52c-5b30-45c4-a545-63244aba82be
ms.openlocfilehash: 6c12c3aadf53f9fddef2f0b0124994db15565cb5
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/09/2020
ms.locfileid: "84600375"
---
# <a name="service-identity-and-authentication"></a><span data-ttu-id="5795d-102">サービス ID と認証</span><span class="sxs-lookup"><span data-stu-id="5795d-102">Service Identity and Authentication</span></span>
<span data-ttu-id="5795d-103">サービスの*エンドポイント id*は、サービス Web サービス記述言語 (WSDL) から生成された値です。</span><span class="sxs-lookup"><span data-stu-id="5795d-103">A service's *endpoint identity* is a value generated from the service Web Services Description Language (WSDL).</span></span> <span data-ttu-id="5795d-104">この値は、すべてのクライアントに反映され、サービスの認証に使用されます。</span><span class="sxs-lookup"><span data-stu-id="5795d-104">This value, propagated to any client, is used to authenticate the service.</span></span> <span data-ttu-id="5795d-105">クライアントがエンドポイントとの通信を開始し、サービスがクライアントに対して認証を行った後に、クライアントは、エンドポイント ID 値とエンドポイントの認証プロセスから返された実際の値を比較します。</span><span class="sxs-lookup"><span data-stu-id="5795d-105">After the client initiates a communication to an endpoint and the service authenticates itself to the client, the client compares the endpoint identity value with the actual value the endpoint authentication process returned.</span></span> <span data-ttu-id="5795d-106">この 2 つの値が一致した場合、クライアントは要求したサービス エンドポイントに接続していることを確認できます。</span><span class="sxs-lookup"><span data-stu-id="5795d-106">If they match, the client is assured it has contacted the expected service endpoint.</span></span> <span data-ttu-id="5795d-107">これは、悪意のあるサービスによってホストされるエンドポイントにクライアントがリダイレクトされるのを防ぐことによって、*フィッシング*に対する保護として機能します。</span><span class="sxs-lookup"><span data-stu-id="5795d-107">This functions as a protection against *phishing* by preventing a client from being redirected to an endpoint hosted by a malicious service.</span></span>  
  
 <span data-ttu-id="5795d-108">Id 設定を示すサンプルアプリケーションについては、「[サービス id のサンプル](../samples/service-identity-sample.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5795d-108">For a sample application that demonstrates identity setting, see [Service Identity Sample](../samples/service-identity-sample.md).</span></span> <span data-ttu-id="5795d-109">エンドポイントとエンドポイントアドレスの詳細については、「[アドレス](endpoint-addresses.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5795d-109">For more information about endpoints and endpoint addresses, see [Addresses](endpoint-addresses.md).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="5795d-110">認証に NTLM (NT LanMan) を使用する場合、NTLM ではクライアントがサーバーを認証できないため、サービス ID はチェックされません。</span><span class="sxs-lookup"><span data-stu-id="5795d-110">When you use NT LanMan (NTLM) for authentication, the service identity is not checked because, under NTLM, the client is unable to authenticate the server.</span></span> <span data-ttu-id="5795d-111">NTLM はコンピューターが Windows ワークグループの一部である場合、または Kerberos 認証をサポートしていない古いバージョンの Windows が実行されている場合に使用されます。</span><span class="sxs-lookup"><span data-stu-id="5795d-111">NTLM is used when computers are part of a Windows workgroup, or when running an older version of Windows that does not support Kerberos authentication.</span></span>  
  
 <span data-ttu-id="5795d-112">クライアントがセキュリティで保護されたチャネルを開始してサービスにメッセージを送信すると、Windows Communication Foundation (WCF) インフラストラクチャによってサービスが認証され、サービス id がクライアントが使用するエンドポイントアドレスに指定された id と一致する場合にのみメッセージが送信されます。</span><span class="sxs-lookup"><span data-stu-id="5795d-112">When the client initiates a secure channel to send a message to a service over it, the Windows Communication Foundation (WCF) infrastructure authenticates the service, and only sends the message if the service identity matches the identity specified in the endpoint address the client uses.</span></span>  
  
 <span data-ttu-id="5795d-113">ID の処理は、次の 2 段階から成ります。</span><span class="sxs-lookup"><span data-stu-id="5795d-113">Identity processing consists of the following stages:</span></span>  
  
- <span data-ttu-id="5795d-114">デザイン時に、クライアント開発者は、(WSDL を通じて公開される) エンドポイントのメタデータでサービスの ID を確認します。</span><span class="sxs-lookup"><span data-stu-id="5795d-114">At design time, the client developer determines the service's identity from the endpoint's metadata (exposed through WSDL).</span></span>  
  
- <span data-ttu-id="5795d-115">実行時に、クライアント アプリケーションは、メッセージをサービスに送信する前に、サービスのセキュリティ資格情報のクレームを確認します。</span><span class="sxs-lookup"><span data-stu-id="5795d-115">At runtime, the client application checks the claims of the service's security credentials before sending any messages to the service.</span></span>  
  
 <span data-ttu-id="5795d-116">クライアントでの ID の処理は、サービスでのクライアント認証と似ています。</span><span class="sxs-lookup"><span data-stu-id="5795d-116">Identity processing on the client is analogous to client authentication on the service.</span></span> <span data-ttu-id="5795d-117">セキュリティで保護されたサービスは、クライアントの資格情報が認証されるまでコードを実行しません。</span><span class="sxs-lookup"><span data-stu-id="5795d-117">A secure service does not execute code until the client's credentials have been authenticated.</span></span> <span data-ttu-id="5795d-118">同様に、クライアントは、サービスのメタデータによって事前に認識されている内容に基づいて、サービスの資格情報が認証されるまでメッセージを送信しません。</span><span class="sxs-lookup"><span data-stu-id="5795d-118">Likewise, the client does not send messages to the service until the service's credentials have been authenticated based on what is known in advance from the service's metadata.</span></span>  
  
 <span data-ttu-id="5795d-119"><xref:System.ServiceModel.EndpointAddress.Identity%2A> クラスの <xref:System.ServiceModel.EndpointAddress> プロパティは、クライアントによって呼び出されるサービスの ID を表します。</span><span class="sxs-lookup"><span data-stu-id="5795d-119">The <xref:System.ServiceModel.EndpointAddress.Identity%2A> property of the <xref:System.ServiceModel.EndpointAddress> class represents the identity of the service called by the client.</span></span> <span data-ttu-id="5795d-120">サービスはこの <xref:System.ServiceModel.EndpointAddress.Identity%2A> をサービスのメタデータ内に公開します。</span><span class="sxs-lookup"><span data-stu-id="5795d-120">The service publishes the <xref:System.ServiceModel.EndpointAddress.Identity%2A> in its metadata.</span></span> <span data-ttu-id="5795d-121">クライアント開発者がサービスエンドポイントに対して[ServiceModel メタデータユーティリティツール (svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md)を実行すると、生成された構成にサービスのプロパティの値が含まれ <xref:System.ServiceModel.EndpointAddress.Identity%2A> ます。</span><span class="sxs-lookup"><span data-stu-id="5795d-121">When the client developer runs the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) against the service endpoint, the generated configuration contains the value of the service's <xref:System.ServiceModel.EndpointAddress.Identity%2A> property.</span></span> <span data-ttu-id="5795d-122">WCF インフラストラクチャ (セキュリティを使用して構成されている場合) は、サービスが指定された id を所有していることを確認します。</span><span class="sxs-lookup"><span data-stu-id="5795d-122">The WCF infrastructure (if configured with security) verifies that the service possesses the identity specified.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="5795d-123">メタデータには、サービスに要求される ID が含まれています。したがって、安全な方法 (サービスの HTTPS エンドポイントを作成するなど) でサービス メタデータを公開することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="5795d-123">The metadata contains the expected identity of the service, so it is recommended that you expose the service metadata through secure means, for example, by creating an HTTPS endpoint for the service.</span></span> <span data-ttu-id="5795d-124">詳細については、「[方法: メタデータエンドポイントをセキュリティで保護](how-to-secure-metadata-endpoints.md)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5795d-124">For more information, see [How to: Secure Metadata Endpoints](how-to-secure-metadata-endpoints.md).</span></span>  
  
## <a name="identity-types"></a><span data-ttu-id="5795d-125">ID の種類</span><span class="sxs-lookup"><span data-stu-id="5795d-125">Identity Types</span></span>  
 <span data-ttu-id="5795d-126">サービスは、6種類の id を提供できます。</span><span class="sxs-lookup"><span data-stu-id="5795d-126">A service can provide six types of identities.</span></span> <span data-ttu-id="5795d-127">ID の各種類は、構成内の `<identity>` 要素に含めることのできる要素に対応します。</span><span class="sxs-lookup"><span data-stu-id="5795d-127">Each identity type corresponds to an element that can be contained inside the `<identity>` element in configuration.</span></span> <span data-ttu-id="5795d-128">使用する ID の種類は、シナリオとサービスのセキュリティ要件によって異なります。</span><span class="sxs-lookup"><span data-stu-id="5795d-128">The type used depends on the scenario and the service's security requirements.</span></span> <span data-ttu-id="5795d-129">ID の各種類の説明を次の表に示します。</span><span class="sxs-lookup"><span data-stu-id="5795d-129">The following table describes each identity type.</span></span>  
  
|<span data-ttu-id="5795d-130">ID の種類</span><span class="sxs-lookup"><span data-stu-id="5795d-130">Identity type</span></span>|<span data-ttu-id="5795d-131">説明</span><span class="sxs-lookup"><span data-stu-id="5795d-131">Description</span></span>|<span data-ttu-id="5795d-132">一般的なシナリオ</span><span class="sxs-lookup"><span data-stu-id="5795d-132">Typical scenario</span></span>|  
|-------------------|-----------------|----------------------|  
|<span data-ttu-id="5795d-133">ドメイン ネーム システム (DNS)</span><span class="sxs-lookup"><span data-stu-id="5795d-133">Domain Name System (DNS)</span></span>|<span data-ttu-id="5795d-134">この要素は X.509 証明書または Windows アカウントと一緒に使用します。</span><span class="sxs-lookup"><span data-stu-id="5795d-134">Use this element with X.509 certificates or Windows accounts.</span></span> <span data-ttu-id="5795d-135">資格情報に指定されている DNS 名とこの要素で指定されている値とが比較されます。</span><span class="sxs-lookup"><span data-stu-id="5795d-135">It compares the DNS name specified in the credential with the value specified in this element.</span></span>|<span data-ttu-id="5795d-136">DNS チェックを行うことにより、DNS 名またはサブジェクト名を含む証明書を使用できます。</span><span class="sxs-lookup"><span data-stu-id="5795d-136">A DNS check enables you to use certificates with DNS or subject names.</span></span> <span data-ttu-id="5795d-137">同じ DNS 名またはサブジェクト名を使用して証明書が再発行された場合、ID 検査は引き続き有効になります。</span><span class="sxs-lookup"><span data-stu-id="5795d-137">If a certificate is reissued with the same DNS or subject name, then the identity check is still valid.</span></span> <span data-ttu-id="5795d-138">証明書を再発行すると、新しい RSA キーが取得されますが、同じ DNS 名またはサブジェクト名が保持されます。</span><span class="sxs-lookup"><span data-stu-id="5795d-138">When a certificate is reissued, it gets a new RSA key but retains the same DNS or subject name.</span></span> <span data-ttu-id="5795d-139">つまり、クライアントはサービスの ID 情報を更新する必要がありません。</span><span class="sxs-lookup"><span data-stu-id="5795d-139">This means that clients do not have to update their identity information about the service.</span></span>|  
|<span data-ttu-id="5795d-140">証明書。</span><span class="sxs-lookup"><span data-stu-id="5795d-140">Certificate.</span></span> <span data-ttu-id="5795d-141">`ClientCredentialType` が Certificate に設定されている場合の既定値です。</span><span class="sxs-lookup"><span data-stu-id="5795d-141">The default when `ClientCredentialType` is set to Certificate.</span></span>|<span data-ttu-id="5795d-142">この要素は、クライアントと比較するための Base64 でエンコードされた X.509 証明書の値を指定します。</span><span class="sxs-lookup"><span data-stu-id="5795d-142">This element specifies a Base64-encoded X.509 certificate value to compare with the client.</span></span><br /><br /> <span data-ttu-id="5795d-143">また、サービスを認証するための資格情報として CardSpace を使用する場合にも、この要素を使用します。</span><span class="sxs-lookup"><span data-stu-id="5795d-143">Also use this element when using a CardSpace as a credential to authenticate the service.</span></span>|<span data-ttu-id="5795d-144">この要素は、証明書の拇印の値に基づいて、認証を 1 つの証明書に制限します。</span><span class="sxs-lookup"><span data-stu-id="5795d-144">This element restricts authentication to a single certificate based upon its thumbprint value.</span></span> <span data-ttu-id="5795d-145">拇印の値は一意であるため、この制限によってより厳密な認証が可能になります。</span><span class="sxs-lookup"><span data-stu-id="5795d-145">This enables stricter authentication because thumbprint values are unique.</span></span> <span data-ttu-id="5795d-146">同じサブジェクト名を使用して証明書が再発行された場合、証明書には新しい拇印が含まれることになるので注意が必要です。</span><span class="sxs-lookup"><span data-stu-id="5795d-146">This comes with one caveat: If the certificate is reissued with the same Subject name, it also has a new Thumbprint.</span></span> <span data-ttu-id="5795d-147">つまり、新しい拇印が認識されていない場合、クライアントはサービスを検証できなくなります。</span><span class="sxs-lookup"><span data-stu-id="5795d-147">Therefore, clients are not able to validate the service unless the new thumbprint is known.</span></span> <span data-ttu-id="5795d-148">証明書の拇印を検索する方法の詳細については、「[方法: 証明書のサムプリントを取得する](how-to-retrieve-the-thumbprint-of-a-certificate.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5795d-148">For more information about finding a certificate's thumbprint, see [How to: Retrieve the Thumbprint of a Certificate](how-to-retrieve-the-thumbprint-of-a-certificate.md).</span></span>|  
|<span data-ttu-id="5795d-149">証明書参照</span><span class="sxs-lookup"><span data-stu-id="5795d-149">Certificate Reference</span></span>|<span data-ttu-id="5795d-150">前述の証明書オプションと同じです。</span><span class="sxs-lookup"><span data-stu-id="5795d-150">Identical to the Certificate option described previously.</span></span> <span data-ttu-id="5795d-151">ただし、この要素を使用すると、証明書の名前と証明書を取得するストアの場所を指定できます。</span><span class="sxs-lookup"><span data-stu-id="5795d-151">However, this element enables you to specify a certificate name and store location from which to retrieve the certificate.</span></span>|<span data-ttu-id="5795d-152">前述の証明書のシナリオと同じです。</span><span class="sxs-lookup"><span data-stu-id="5795d-152">Same as the Certificate scenario described previously.</span></span><br /><br /> <span data-ttu-id="5795d-153">利点は、証明書ストアの場所を変更できることです。</span><span class="sxs-lookup"><span data-stu-id="5795d-153">The benefit is that the certificate store location can change.</span></span>|  
|<span data-ttu-id="5795d-154">RSA</span><span class="sxs-lookup"><span data-stu-id="5795d-154">RSA</span></span>|<span data-ttu-id="5795d-155">この要素は、クライアントと比較するための RSA キーの値を指定します。</span><span class="sxs-lookup"><span data-stu-id="5795d-155">This element specifies an RSA key value to compare with the client.</span></span> <span data-ttu-id="5795d-156">これは証明書オプションに似ていますが、証明書の拇印を使用するのではなく、証明書の RSA キーを使用します。</span><span class="sxs-lookup"><span data-stu-id="5795d-156">This is similar to the certificate option but rather than using the certificate's thumbprint, the certificate's RSA key is used instead.</span></span>|<span data-ttu-id="5795d-157">RSA チェックを行うと、証明書の RSA キーに基づいて、単一の証明書に基づく認証に明確に制限できます。</span><span class="sxs-lookup"><span data-stu-id="5795d-157">An RSA check enables you to specifically restrict authentication to a single certificate based upon its RSA key.</span></span> <span data-ttu-id="5795d-158">これにより、RSA キーが変更された場合に既存のクライアントでサービスが使用できなくなるのと引き換えに、特定の RSA キーをより厳しく認証できます。</span><span class="sxs-lookup"><span data-stu-id="5795d-158">This enables stricter authentication of a specific RSA key at the expense of the service, which no longer works with existing clients if the RSA key value changes.</span></span>|  
|<span data-ttu-id="5795d-159">ユーザー プリンシパル名 (UPN)。</span><span class="sxs-lookup"><span data-stu-id="5795d-159">User principal name (UPN).</span></span> <span data-ttu-id="5795d-160">`ClientCredentialType` が Windows に設定されており、サービス プロセスがシステム アカウントのいずれかで実行されていない場合の既定値です。</span><span class="sxs-lookup"><span data-stu-id="5795d-160">The default when the `ClientCredentialType` is set to Windows and the service process is not running under one of the system accounts.</span></span>|<span data-ttu-id="5795d-161">この要素は、サービスを実行中の UPN を指定します。</span><span class="sxs-lookup"><span data-stu-id="5795d-161">This element specifies the UPN that the service is running under.</span></span> <span data-ttu-id="5795d-162">「[認証のためのサービス id のオーバーライド](../extending/overriding-the-identity-of-a-service-for-authentication.md)」の「Kerberos プロトコルと id」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="5795d-162">See the Kerberos Protocol and Identity section of [Overriding the Identity of a Service for Authentication](../extending/overriding-the-identity-of-a-service-for-authentication.md).</span></span>|<span data-ttu-id="5795d-163">この設定では、サービスが特定の Windows ユーザー アカウントで実行されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="5795d-163">This ensures that the service is running under a specific Windows user account.</span></span> <span data-ttu-id="5795d-164">このユーザー アカウントは、現在ログオンしているユーザーである場合もあれば、特定のユーザー アカウントで実行されているサービスである場合もあります。</span><span class="sxs-lookup"><span data-stu-id="5795d-164">The user account can be either the current logged-on user or the service running under a particular user account.</span></span><br /><br /> <span data-ttu-id="5795d-165">サービスが Active Directory 環境のドメイン アカウントで実行されている場合、この設定では Windows Kerberos セキュリティを利用します。</span><span class="sxs-lookup"><span data-stu-id="5795d-165">This setting takes advantage of Windows Kerberos security if the service is running under a domain account within an Active Directory environment.</span></span>|  
|<span data-ttu-id="5795d-166">サービス プリンシパル名 (SPN)。</span><span class="sxs-lookup"><span data-stu-id="5795d-166">Service principal name (SPN).</span></span> <span data-ttu-id="5795d-167">`ClientCredentialType` が Windows に設定されており、サービス プロセスがシステム アカウント (LocalService、LocalSystem、または NetworkService) のいずれかで実行されている場合の既定値です。</span><span class="sxs-lookup"><span data-stu-id="5795d-167">The default when the `ClientCredentialType` is set to Windows and the service process is running under one of the system accounts—LocalService, LocalSystem, or NetworkService.</span></span>|<span data-ttu-id="5795d-168">この要素は、サービスのアカウントに関連付けられている SPN を指定します。</span><span class="sxs-lookup"><span data-stu-id="5795d-168">This element specifies the SPN associated with the service's account.</span></span> <span data-ttu-id="5795d-169">「[認証のためのサービス id のオーバーライド](../extending/overriding-the-identity-of-a-service-for-authentication.md)」の「Kerberos プロトコルと id」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="5795d-169">See the Kerberos Protocol and Identity section of [Overriding the Identity of a Service for Authentication](../extending/overriding-the-identity-of-a-service-for-authentication.md).</span></span>|<span data-ttu-id="5795d-170">これにより、SPN と SPN に関連付けられた特定の Windows アカウントによってサービスが識別されます。</span><span class="sxs-lookup"><span data-stu-id="5795d-170">This ensures that the SPN and the specific Windows account associated with the SPN identify the service.</span></span><br /><br /> <span data-ttu-id="5795d-171">Setspn.exe ツールを使用すると、サービスのユーザー アカウントに対してコンピューター アカウントを関連付けることができます。</span><span class="sxs-lookup"><span data-stu-id="5795d-171">You can use the Setspn.exe tool to associate a machine account for the service's user account.</span></span><br /><br /> <span data-ttu-id="5795d-172">サービスがシステム アカウントのいずれか、または SPN 名に関連付けられたドメイン アカウントで実行されており、コンピューターが Active Directory 環境のドメインのメンバーである場合、この設定では Windows Kerberos セキュリティを利用します。</span><span class="sxs-lookup"><span data-stu-id="5795d-172">This setting takes advantage of Windows Kerberos security if the service is running under one of the system accounts or under a domain account that has an associated SPN name with it and the computer is a member of a domain within an Active Directory environment.</span></span>|  
  
## <a name="specifying-identity-at-the-service"></a><span data-ttu-id="5795d-173">サービスでの ID の指定</span><span class="sxs-lookup"><span data-stu-id="5795d-173">Specifying Identity at the Service</span></span>  
 <span data-ttu-id="5795d-174">クライアント資格情報の種類を選択すると、サービス メタデータで公開される ID の種類が指定されるため、通常、サービスで ID を設定する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="5795d-174">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="5795d-175">サービス id をオーバーライドまたは指定する方法の詳細については、「[認証のためのサービス id のオーバーライド](../extending/overriding-the-identity-of-a-service-for-authentication.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5795d-175">For more information about how to override or specify service identity, see [Overriding the Identity of a Service for Authentication](../extending/overriding-the-identity-of-a-service-for-authentication.md).</span></span>  
  
## <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="5795d-176">\<identity>構成での要素の使用</span><span class="sxs-lookup"><span data-stu-id="5795d-176">Using the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="5795d-177">上記の例で示したバインディングのクライアント資格情報の種類を `Certificate,` に変更すると、次のコードに示すように、生成される WSDL には、Base64 でシリアル化された、ID 値用の X.509 証明書が含まれます。</span><span class="sxs-lookup"><span data-stu-id="5795d-177">If you change the client credential type in the binding previously shown to `Certificate,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="5795d-178">これは、Windows 以外のすべてのクライアント資格情報の種類の既定値です。</span><span class="sxs-lookup"><span data-stu-id="5795d-178">This is the default for all client credential types other than Windows.</span></span>  

 <span data-ttu-id="5795d-179">`<identity>`構成の要素を使用するか、コードで id を設定することにより、既定のサービス id の値を変更したり、id の種類を変更したりできます。</span><span class="sxs-lookup"><span data-stu-id="5795d-179">You can change the value of the default service identity or change the type of the identity by using the `<identity>` element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="5795d-180">値 `contoso.com` を使用してドメイン ネーム システム (DNS) ID を設定する構成コードを次に示します。</span><span class="sxs-lookup"><span data-stu-id="5795d-180">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  

## <a name="setting-identity-programmatically"></a><span data-ttu-id="5795d-181">プログラムによる ID の設定</span><span class="sxs-lookup"><span data-stu-id="5795d-181">Setting Identity Programmatically</span></span>  
 <span data-ttu-id="5795d-182">WCF によって自動的に決定されるため、サービスで id を明示的に指定する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="5795d-182">Your service does not have to explicitly specify an identity, because WCF automatically determines it.</span></span> <span data-ttu-id="5795d-183">ただし、WCF では、必要に応じてエンドポイントの id を指定できます。</span><span class="sxs-lookup"><span data-stu-id="5795d-183">However, WCF allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="5795d-184">特定の DNS ID を持つ新しいサービス エンドポイントを追加するコードを次に示します。</span><span class="sxs-lookup"><span data-stu-id="5795d-184">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="specifying-identity-at-the-client"></a><span data-ttu-id="5795d-185">クライアントでの ID の指定</span><span class="sxs-lookup"><span data-stu-id="5795d-185">Specifying Identity at the Client</span></span>  
 <span data-ttu-id="5795d-186">設計時に、クライアント開発者は通常、 [ServiceModel メタデータユーティリティツール (svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md)を使用してクライアント構成を生成します。</span><span class="sxs-lookup"><span data-stu-id="5795d-186">At design time, a client developer typically uses the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) to generate client configuration.</span></span> <span data-ttu-id="5795d-187">生成された構成ファイル (クライアントが使用するもの) には、サービスの ID が含まれます。</span><span class="sxs-lookup"><span data-stu-id="5795d-187">The generated configuration file (intended for use by the client) contains the server's identity.</span></span> <span data-ttu-id="5795d-188">たとえば、次のコードは、前の例で示した DNS ID を指定するサービスから生成されたものです。</span><span class="sxs-lookup"><span data-stu-id="5795d-188">For example, the following code is generated from a service that specifies a DNS identity, as shown in the preceding example.</span></span> <span data-ttu-id="5795d-189">クライアントのエンドポイント ID 値が、サービスのエンドポイント ID 値と一致していることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="5795d-189">Note that the client's endpoint identity value matches that of the service.</span></span> <span data-ttu-id="5795d-190">この場合、クライアントは、サービスの Windows (Kerberos) 資格情報を受け取るときに、この値が `contoso.com` であることを要求します。</span><span class="sxs-lookup"><span data-stu-id="5795d-190">In this case, when the client receives the Windows (Kerberos) credentials for the service, it expects the value to be `contoso.com`.</span></span>  

 <span data-ttu-id="5795d-191">サービスでクライアント資格情報の種類として Windows ではなく証明書を指定した場合は、証明書の DNS プロパティの値が `contoso.com` であることが要求されます </span><span class="sxs-lookup"><span data-stu-id="5795d-191">If, instead of Windows, the service specifies a certificate as the client credential type, then the certificate's DNS property is expected to be the value `contoso.com`.</span></span> <span data-ttu-id="5795d-192">(DNS プロパティが `null` の場合は、証明書のサブジェクト名が `contoso.com` である必要があります)。</span><span class="sxs-lookup"><span data-stu-id="5795d-192">(Or if the DNS property is `null`, the certificate's subject name must be `contoso.com`.)</span></span>  
  
#### <a name="using-a-specific-value-for-identity"></a><span data-ttu-id="5795d-193">ID の特定の値の使用</span><span class="sxs-lookup"><span data-stu-id="5795d-193">Using a Specific Value for Identity</span></span>  
 <span data-ttu-id="5795d-194">次のクライアント構成ファイルは、サービスの ID に特定の値を要求する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="5795d-194">The following client configuration file shows how the service's identity is expected to be a specific value.</span></span> <span data-ttu-id="5795d-195">次の例では、クライアントは 2 つのエンドポイントと通信できます。</span><span class="sxs-lookup"><span data-stu-id="5795d-195">In the following example, the client can communicate with two endpoints.</span></span> <span data-ttu-id="5795d-196">1 つ目のエンドポイントは証明書の拇印で識別され、もう 1 つは証明書の RSA キーで識別されます。</span><span class="sxs-lookup"><span data-stu-id="5795d-196">The first is identified with a certificate thumbprint and the second with a certificate RSA key.</span></span> <span data-ttu-id="5795d-197">つまり、公開キーと秘密キーのペアだけが含まれた証明書ですが、この証明書は信頼された証明機関によって発行されたものではありません。</span><span class="sxs-lookup"><span data-stu-id="5795d-197">That is, a certificate that contains only a public key/private key pair, but is not issued by a trusted authority.</span></span>  

## <a name="identity-checking-at-run-time"></a><span data-ttu-id="5795d-198">実行時の ID 検査</span><span class="sxs-lookup"><span data-stu-id="5795d-198">Identity Checking at Run Time</span></span>  
 <span data-ttu-id="5795d-199">デザイン時には、クライアント開発者はサービスのメタデータで ID を確認します。</span><span class="sxs-lookup"><span data-stu-id="5795d-199">At design time, a client developer determines the server's identity through its metadata.</span></span> <span data-ttu-id="5795d-200">実行時には、サービスのエンドポイントを呼び出す前に ID 検査が実行されます。</span><span class="sxs-lookup"><span data-stu-id="5795d-200">At runtime, the identity check is performed before calling any endpoints on the service.</span></span>  
  
 <span data-ttu-id="5795d-201">ID 値は、メタデータで指定された認証の種類 (つまり、サービスで使用される資格情報の種類) に関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="5795d-201">The identity value is tied to the type of authentication specified by metadata; in other words, the type of credentials used for the service.</span></span>  
  
 <span data-ttu-id="5795d-202">認証に X.509 証明書を使用するメッセージ レベルまたはトランスポート レベルの SSL (Secure Sockets Layer) を使用して認証を行うようにチャネルが構成されている場合、次の ID 値が有効になります。</span><span class="sxs-lookup"><span data-stu-id="5795d-202">If the channel is configured to authenticate using message- or transport-level Secure Sockets Layer (SSL) with X.509 certificates for authentication, the following identity values are valid:</span></span>  
  
- <span data-ttu-id="5795d-203">DNS。</span><span class="sxs-lookup"><span data-stu-id="5795d-203">DNS.</span></span> <span data-ttu-id="5795d-204">WCF では、SSL ハンドシェイク中に指定された証明書に、 `CommonName` クライアントの dns id に指定された値と等しい dns または (CN) 属性が含まれていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="5795d-204">WCF ensures that the certificate provided during the SSL handshake contains a DNS or `CommonName` (CN) attribute equal to the value specified in the DNS identity on the client.</span></span> <span data-ttu-id="5795d-205">この検査は、サーバー証明書の有効性の確認とは別に行われます。</span><span class="sxs-lookup"><span data-stu-id="5795d-205">Note that these checks are done in addition to determining the validity of the server certificate.</span></span> <span data-ttu-id="5795d-206">既定では、サーバー証明書が信頼されたルート証明機関によって発行されていることが WCF によって検証されます。</span><span class="sxs-lookup"><span data-stu-id="5795d-206">By default, WCF validates that the server certificate is issued by a trusted root authority.</span></span>  
  
- <span data-ttu-id="5795d-207">証明書。</span><span class="sxs-lookup"><span data-stu-id="5795d-207">Certificate.</span></span> <span data-ttu-id="5795d-208">SSL ハンドシェイク中に、WCF は、リモートエンドポイントが id で指定された正確な証明書の値を確実に提供するようにします。</span><span class="sxs-lookup"><span data-stu-id="5795d-208">During the SSL handshake, WCF ensures that the remote endpoint provides the exact certificate value specified in the identity.</span></span>  
  
- <span data-ttu-id="5795d-209">証明書参照。</span><span class="sxs-lookup"><span data-stu-id="5795d-209">Certificate Reference.</span></span> <span data-ttu-id="5795d-210">証明書と同じです。</span><span class="sxs-lookup"><span data-stu-id="5795d-210">Same as Certificate.</span></span>  
  
- <span data-ttu-id="5795d-211">RSA。</span><span class="sxs-lookup"><span data-stu-id="5795d-211">RSA.</span></span> <span data-ttu-id="5795d-212">SSL ハンドシェイク中に、WCF は、リモートエンドポイントが id で指定された正確な RSA キーを確実に提供するようにします。</span><span class="sxs-lookup"><span data-stu-id="5795d-212">During the SSL handshake, WCF ensures that the remote endpoint provides the exact RSA key specified in the identity.</span></span>  
  
 <span data-ttu-id="5795d-213">サービスが認証に Windows 資格情報を使用するメッセージ レベルまたはトランスポート レベル SSL の認証を行い、資格情報をネゴシエートする場合、次の ID 値が有効になります。</span><span class="sxs-lookup"><span data-stu-id="5795d-213">If the service authenticates using message- or transport-level SSL with a Windows credential for authentication, and negotiates the credential, the following identity values are valid:</span></span>  
  
- <span data-ttu-id="5795d-214">DNS。</span><span class="sxs-lookup"><span data-stu-id="5795d-214">DNS.</span></span> <span data-ttu-id="5795d-215">ネゴシエーションでは、DNS 名を確認できるように、サービスの SPN が渡されます。</span><span class="sxs-lookup"><span data-stu-id="5795d-215">The negotiation passes the service's SPN so that the DNS name can be checked.</span></span> <span data-ttu-id="5795d-216">SPN の形式は `host/<dns name>` です。</span><span class="sxs-lookup"><span data-stu-id="5795d-216">The SPN is in the form `host/<dns name>`.</span></span>  
  
- <span data-ttu-id="5795d-217">SPN。</span><span class="sxs-lookup"><span data-stu-id="5795d-217">SPN.</span></span> <span data-ttu-id="5795d-218">サービスの明示的な SPN (例 : `host/myservice`) が返されます。</span><span class="sxs-lookup"><span data-stu-id="5795d-218">An explicit service SPN is returned, for example, `host/myservice`.</span></span>  
  
- <span data-ttu-id="5795d-219">UPN。</span><span class="sxs-lookup"><span data-stu-id="5795d-219">UPN.</span></span> <span data-ttu-id="5795d-220">サービス アカウントの UPN です。</span><span class="sxs-lookup"><span data-stu-id="5795d-220">The UPN of the service account.</span></span> <span data-ttu-id="5795d-221">UPN の形式は `username` @ `domain` です。</span><span class="sxs-lookup"><span data-stu-id="5795d-221">The UPN is in the form `username`@`domain`.</span></span> <span data-ttu-id="5795d-222">たとえば、サービスがユーザー アカウントで実行されている場合、UPN は `username@contoso.com` のようになります。</span><span class="sxs-lookup"><span data-stu-id="5795d-222">For example, when the service is running in a user account, it may be `username@contoso.com`.</span></span>  
  
 <span data-ttu-id="5795d-223">(<xref:System.ServiceModel.EndpointAddress.Identity%2A> プロパティを使用して) ID をプログラムによって指定することは任意です。</span><span class="sxs-lookup"><span data-stu-id="5795d-223">Specifying the identity programmatically (using the <xref:System.ServiceModel.EndpointAddress.Identity%2A> property) is optional.</span></span> <span data-ttu-id="5795d-224">ID が指定されておらず、クライアント資格情報の種類が Windows の場合、既定値は、先頭に "host/" リテラルが付加されたサービス エンドポイント アドレスのホスト名の部分に値が設定された SPN になります。</span><span class="sxs-lookup"><span data-stu-id="5795d-224">If no identity is specified, and the client credential type is Windows, the default is SPN with the value set to the hostname part of the service endpoint address prefixed with the "host/" literal.</span></span> <span data-ttu-id="5795d-225">ID が指定されておらず、クライアント資格情報の種類が証明書の場合、既定値は `Certificate` です。</span><span class="sxs-lookup"><span data-stu-id="5795d-225">If no identity is specified, and the client credential type is a certificate, the default is `Certificate`.</span></span> <span data-ttu-id="5795d-226">これは、メッセージ レベルとトランスポート レベルの両方のセキュリティに適用されます。</span><span class="sxs-lookup"><span data-stu-id="5795d-226">This applies to both message- and transport-level security.</span></span>  
  
## <a name="identity-and-custom-bindings"></a><span data-ttu-id="5795d-227">ID とカスタム バインド</span><span class="sxs-lookup"><span data-stu-id="5795d-227">Identity and Custom Bindings</span></span>  
 <span data-ttu-id="5795d-228">サービスの ID は使用するバインディングの種類によって異なるため、カスタム バインディングの作成時には、適切な ID が公開されていることを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5795d-228">Because the identity of a service depends on the binding type used, ensure that an appropriate identity is exposed when creating a custom binding.</span></span> <span data-ttu-id="5795d-229">たとえば、次のコード例では、セキュリティで保護された通信のブートストラップ バインディングの ID と、エンドポイントのバインディングの ID が一致していないため、セキュリティの種類と適合しない ID が公開されます。</span><span class="sxs-lookup"><span data-stu-id="5795d-229">For example, in the following code example, the identity exposed is not compatible with the security type, because the identity for the secure conversation bootstrap binding does not match the identity for the binding on the endpoint.</span></span> <span data-ttu-id="5795d-230">セキュリティで保護された通信のバインディングでは DNS ID が設定され、<xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement> では UPN ID または SPN ID が設定されます。</span><span class="sxs-lookup"><span data-stu-id="5795d-230">The secure conversation binding sets the DNS identity, while the <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement> sets the UPN or SPN identity.</span></span>  
  
 [!code-csharp[C_Identity#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#8)]
 [!code-vb[C_Identity#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#8)]  
  
 <span data-ttu-id="5795d-231">カスタムバインディングのバインド要素を正しくスタックする方法の詳細については、「[ユーザー定義バインディングの作成](../extending/creating-user-defined-bindings.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5795d-231">For more information about how to stack binding elements correctly for a custom binding, see [Creating User-Defined Bindings](../extending/creating-user-defined-bindings.md).</span></span> <span data-ttu-id="5795d-232">を使用したカスタムバインディングの作成の詳細については <xref:System.ServiceModel.Channels.SecurityBindingElement> 、「[方法: 指定した認証モードのための](how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md)内容を作成する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5795d-232">For more information about creating a custom binding with the <xref:System.ServiceModel.Channels.SecurityBindingElement>, see [How to: Create a SecurityBindingElement for a Specified Authentication Mode](how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5795d-233">関連項目</span><span class="sxs-lookup"><span data-stu-id="5795d-233">See also</span></span>

- [<span data-ttu-id="5795d-234">方法: SecurityBindingElement を使用してカスタム バインドを作成する</span><span class="sxs-lookup"><span data-stu-id="5795d-234">How to: Create a Custom Binding Using the SecurityBindingElement</span></span>](how-to-create-a-custom-binding-using-the-securitybindingelement.md)
- [<span data-ttu-id="5795d-235">方法: 指定した認証モード用の SecurityBindingElement を作成する</span><span class="sxs-lookup"><span data-stu-id="5795d-235">How to: Create a SecurityBindingElement for a Specified Authentication Mode</span></span>](how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md)
- [<span data-ttu-id="5795d-236">方法: カスタム クライアント ID 検証機能を作成する</span><span class="sxs-lookup"><span data-stu-id="5795d-236">How to: Create a Custom Client Identity Verifier</span></span>](../extending/how-to-create-a-custom-client-identity-verifier.md)
- [<span data-ttu-id="5795d-237">資格情報の種類の選択</span><span class="sxs-lookup"><span data-stu-id="5795d-237">Selecting a Credential Type</span></span>](selecting-a-credential-type.md)
- [<span data-ttu-id="5795d-238">証明書の使用</span><span class="sxs-lookup"><span data-stu-id="5795d-238">Working with Certificates</span></span>](working-with-certificates.md)
- [<span data-ttu-id="5795d-239">ServiceModel メタデータ ユーティリティ ツール (Svcutil.exe)</span><span class="sxs-lookup"><span data-stu-id="5795d-239">ServiceModel Metadata Utility Tool (Svcutil.exe)</span></span>](../servicemodel-metadata-utility-tool-svcutil-exe.md)
- [<span data-ttu-id="5795d-240">ユーザー定義バインディングの作成</span><span class="sxs-lookup"><span data-stu-id="5795d-240">Creating User-Defined Bindings</span></span>](../extending/creating-user-defined-bindings.md)
- [<span data-ttu-id="5795d-241">方法: 証明書のサムプリントを取得する</span><span class="sxs-lookup"><span data-stu-id="5795d-241">How to: Retrieve the Thumbprint of a Certificate</span></span>](how-to-retrieve-the-thumbprint-of-a-certificate.md)
