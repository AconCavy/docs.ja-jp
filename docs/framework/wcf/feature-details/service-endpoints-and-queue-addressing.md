---
title: サービス エンドポイントとキューのアドレス指定
ms.date: 03/30/2017
ms.assetid: 7d2d59d7-f08b-44ed-bd31-913908b83d97
ms.openlocfilehash: ec932e83a2b37330f54be545a45358a5ab055423
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/24/2020
ms.locfileid: "76744620"
---
# <a name="service-endpoints-and-queue-addressing"></a><span data-ttu-id="e7756-102">サービス エンドポイントとキューのアドレス指定</span><span class="sxs-lookup"><span data-stu-id="e7756-102">Service Endpoints and Queue Addressing</span></span>
<span data-ttu-id="e7756-103">ここでは、キューから読み取るサービスをクライアントがアドレス指定するしくみと、サービス エンドポイントがキューにマップされるしくみについて説明します。</span><span class="sxs-lookup"><span data-stu-id="e7756-103">This topic discusses how clients address services that read from queues and how service endpoints map to queues.</span></span> <span data-ttu-id="e7756-104">次の図は、従来の Windows Communication Foundation (WCF) のキューに置かれたアプリケーションの展開を示しています。</span><span class="sxs-lookup"><span data-stu-id="e7756-104">As a reminder, the following illustration shows the classic Windows Communication Foundation (WCF) queued application deployment.</span></span>  
  
 <span data-ttu-id="e7756-105">![キューに登録されたアプリケーションの図](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "配信キュー図")</span><span class="sxs-lookup"><span data-stu-id="e7756-105">![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="e7756-106">クライアントは、メッセージをサービスに送信するために、メッセージをターゲット キューにアドレス指定します。</span><span class="sxs-lookup"><span data-stu-id="e7756-106">For the client to send the message to the service, the client addresses the message to the Target Queue.</span></span> <span data-ttu-id="e7756-107">サービスは、キューからメッセージを読み取るために、リッスン アドレスをターゲット キューに設定します。</span><span class="sxs-lookup"><span data-stu-id="e7756-107">For the service to read messages from the queue, it sets its listen address to the Target Queue.</span></span> <span data-ttu-id="e7756-108">WCF でのアドレス指定は Uniform Resource Identifier (URI) ベースですが、メッセージキュー (MSMQ) キュー名は URI ベースではありません。</span><span class="sxs-lookup"><span data-stu-id="e7756-108">Addressing in WCF is Uniform Resource Identifier (URI)-based while Message Queuing (MSMQ) queue names are not URI-based.</span></span> <span data-ttu-id="e7756-109">このため、WCF を使用して MSMQ で作成されたキューのアドレスを解決する方法を理解することが不可欠です。</span><span class="sxs-lookup"><span data-stu-id="e7756-109">It is therefore essential to understand how to address queues created in MSMQ using WCF.</span></span>  
  
## <a name="msmq-addressing"></a><span data-ttu-id="e7756-110">MSMQ のアドレス指定</span><span class="sxs-lookup"><span data-stu-id="e7756-110">MSMQ Addressing</span></span>  
 <span data-ttu-id="e7756-111">MSMQ は、パスと形式名を使用してキューを識別します。</span><span class="sxs-lookup"><span data-stu-id="e7756-111">MSMQ uses paths and format names to identify a queue.</span></span> <span data-ttu-id="e7756-112">パスでは、ホスト名と `QueueName` を指定します。</span><span class="sxs-lookup"><span data-stu-id="e7756-112">Paths specify a host name and a `QueueName`.</span></span> <span data-ttu-id="e7756-113">必要に応じて、ホスト名と `Private$` の間に `QueueName` を指定して、Active Directory ディレクトリ サービスで公開されないプライベート キューを示すこともできます。</span><span class="sxs-lookup"><span data-stu-id="e7756-113">Optionally, there can be a `Private$` between the host name and the `QueueName` to indicate a private queue that is not published in the Active Directory directory service.</span></span>  
  
 <span data-ttu-id="e7756-114">パス名は "FormatNames" にマップされ、ルーティングやキューマネージャー転送プロトコルなど、アドレスの追加の側面を決定します。</span><span class="sxs-lookup"><span data-stu-id="e7756-114">Path names are mapped to "FormatNames" to determine additional aspects of the address, including routing and queue manager transfer protocol.</span></span> <span data-ttu-id="e7756-115">キュー マネージャーは、ネイティブの MSMQ プロトコルと SOAP リライアブル メッセージ プロトコル (SRMP: SOAP Reliable Messaging Protocol) の 2 つの転送プロトコルをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="e7756-115">The Queue Manager supports two transfer protocols: native MSMQ protocol and SOAP Reliable Messaging Protocol (SRMP).</span></span>  
  
 <span data-ttu-id="e7756-116">MSMQ のパスと形式名の詳細については、「[メッセージキューについ](https://docs.microsoft.com/previous-versions/windows/desktop/legacy/ms706032(v=vs.85))て」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e7756-116">For more information about MSMQ path and format names, see [About Message Queuing](https://docs.microsoft.com/previous-versions/windows/desktop/legacy/ms706032(v=vs.85)).</span></span>  
  
## <a name="netmsmqbinding-and-service-addressing"></a><span data-ttu-id="e7756-117">NetMsmqBinding とサービスのアドレス指定</span><span class="sxs-lookup"><span data-stu-id="e7756-117">NetMsmqBinding and Service Addressing</span></span>  
 <span data-ttu-id="e7756-118">メッセージをサービスにアドレス指定するときは、通信に使用するトランスポートに基づいて URI のスキームが選択されます。</span><span class="sxs-lookup"><span data-stu-id="e7756-118">When addressing a message to a service, the scheme in the URI is chosen based on the transport used for communication.</span></span> <span data-ttu-id="e7756-119">WCF の各トランスポートには、一意のスキームがあります。</span><span class="sxs-lookup"><span data-stu-id="e7756-119">Each transport in WCF has a unique scheme.</span></span> <span data-ttu-id="e7756-120">このスキームには、通信に使用されるトランスポートの性質を反映する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7756-120">The scheme must reflect the nature of transport used for communication.</span></span> <span data-ttu-id="e7756-121">たとえば、net.tcp、net.pipe、HTTP などがあります。</span><span class="sxs-lookup"><span data-stu-id="e7756-121">For example, net.tcp, net.pipe, HTTP, and so on.</span></span>  
  
 <span data-ttu-id="e7756-122">WCF の MSMQ キューに置かれたトランスポートは、net.tcp スキームを公開します。</span><span class="sxs-lookup"><span data-stu-id="e7756-122">The MSMQ queued transport in WCF exposes a net.msmq scheme.</span></span> <span data-ttu-id="e7756-123">net.msmq スキームを使用してアドレス指定されたすべてのメッセージは、`NetMsmqBinding` を使用して、MSMQ のキューに置かれたトランスポート チャネル経由で送信されます。</span><span class="sxs-lookup"><span data-stu-id="e7756-123">Any message addressed using the net.msmq scheme is sent using the `NetMsmqBinding` over the MSMQ queued transport channel.</span></span>  
  
 <span data-ttu-id="e7756-124">WCF でのキューのアドレス指定は、次のパターンに基づいています。</span><span class="sxs-lookup"><span data-stu-id="e7756-124">The addressing of a queue in WCF is based on the following pattern:</span></span>  
  
 <span data-ttu-id="e7756-125">net.msmq: // \<*host-name*> / [private/] \<*queue-name*></span><span class="sxs-lookup"><span data-stu-id="e7756-125">net.msmq: // \<*host-name*> / [private/] \<*queue-name*></span></span>  
  
 <span data-ttu-id="e7756-126">それぞれの文字について以下に説明します。</span><span class="sxs-lookup"><span data-stu-id="e7756-126">where:</span></span>  
  
- <span data-ttu-id="e7756-127">\<*ホスト名*> は、ターゲットキューをホストするコンピューターの名前です。</span><span class="sxs-lookup"><span data-stu-id="e7756-127">\<*host-name*> is the name of the machine that hosts the Target Queue.</span></span>  
  
- <span data-ttu-id="e7756-128">[private] はオプションです。</span><span class="sxs-lookup"><span data-stu-id="e7756-128">[private] is optional.</span></span> <span data-ttu-id="e7756-129">専用キューであるターゲット キューをアドレス指定するときに使用します。</span><span class="sxs-lookup"><span data-stu-id="e7756-129">It is used when addressing a Target Queue that is a private queue.</span></span> <span data-ttu-id="e7756-130">パブリック キューをアドレス指定する場合は、private を指定しないでください。</span><span class="sxs-lookup"><span data-stu-id="e7756-130">To address a public queue, you must not specify private.</span></span> <span data-ttu-id="e7756-131">MSMQ のパスとは異なり、WCF URI 形式には "$" はありません。</span><span class="sxs-lookup"><span data-stu-id="e7756-131">Note that, unlike MSMQ paths, there is no "$" in the WCF URI form.</span></span>  
  
- <span data-ttu-id="e7756-132">\<*キュー名*> はキューの名前です。</span><span class="sxs-lookup"><span data-stu-id="e7756-132">\<*queue-name*> is the name of the queue.</span></span> <span data-ttu-id="e7756-133">キュー名では、サブキューを参照することもできます。</span><span class="sxs-lookup"><span data-stu-id="e7756-133">The queue name can also refer to a subqueue.</span></span> <span data-ttu-id="e7756-134">したがって、\<*キュー名*> = \<*キューの名前の*> [;*サブキュー名*] を指定します。</span><span class="sxs-lookup"><span data-stu-id="e7756-134">Thus, \<*queue-name*> = \<*name-of-queue*>[;*sub-queue-name*].</span></span>  
  
 <span data-ttu-id="e7756-135">例 1 : コンピューター abc atadatum.com でホストされているプライベート キュー PurchaseOrders をアドレス指定する場合、URI は net.msmq://abc.adatum.com/private/PurchaseOrders になります。</span><span class="sxs-lookup"><span data-stu-id="e7756-135">Example1: To address a private queue PurchaseOrders hosted on computer abc atadatum.com, the URI would be net.msmq://abc.adatum.com/private/PurchaseOrders.</span></span>  
  
 <span data-ttu-id="e7756-136">例 2 : コンピューター def atadatum.com でホストされているパブリック キュー AccountsPayable をアドレス指定する場合、URI は net.msmq://def.adatum.com/AccountsPayable になります。</span><span class="sxs-lookup"><span data-stu-id="e7756-136">Example2: To address a public queue AccountsPayable hosted on computer def atadatum.com, the URI would be net.msmq://def.adatum.com/AccountsPayable.</span></span>  
  
 <span data-ttu-id="e7756-137">キュー アドレスは、メッセージを読み取るリスナーにより、リッスン URI として使用されます。</span><span class="sxs-lookup"><span data-stu-id="e7756-137">The queue address is used as the Listen URI by the Listener to read messages from.</span></span> <span data-ttu-id="e7756-138">つまり、キュー アドレスは TCP ソケットのリッスン ポートと同じです。</span><span class="sxs-lookup"><span data-stu-id="e7756-138">In other words, the queue address is equivalent to the listen port of TCP socket.</span></span>  
  
 <span data-ttu-id="e7756-139">キューから読み取りを行うエンドポイントは、ServiceHost を開いたときにあらかじめ指定されているスキームと同じスキームを使用して、キューのアドレスを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7756-139">An endpoint that reads from a queue must specify the address of the queue using the same scheme specified previously when opening the ServiceHost.</span></span> <span data-ttu-id="e7756-140">例については、「 [NET MSMQ Binding](../../../../docs/framework/wcf/samples/net-msmq-binding.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e7756-140">For examples, see [Net MSMQ Binding](../../../../docs/framework/wcf/samples/net-msmq-binding.md).</span></span>  
  
### <a name="multiple-contracts-in-a-queue"></a><span data-ttu-id="e7756-141">キュー内の複数のコントラクト</span><span class="sxs-lookup"><span data-stu-id="e7756-141">Multiple Contracts in a Queue</span></span>  
 <span data-ttu-id="e7756-142">キュー内のメッセージは、さまざまなコントラクトを実装している可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e7756-142">Messages in a queue can implement different contracts.</span></span> <span data-ttu-id="e7756-143">この場合、すべてのメッセージを正常に読み取って処理するためには、次のいずれかの処置を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7756-143">In this case, it is essential that one of the following is true to successfully read and process all messages:</span></span>  
  
- <span data-ttu-id="e7756-144">すべてのコントラクトを実装するサービス エンドポイントを指定します。</span><span class="sxs-lookup"><span data-stu-id="e7756-144">Specify an endpoint for a service that implements all the contracts.</span></span> <span data-ttu-id="e7756-145">この方法をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e7756-145">This is the recommended approach.</span></span>  
  
- <span data-ttu-id="e7756-146">異なるコントラクトを持つ複数のエンドポイントを指定します。ただし、すべてのエンドポイントで同じ `NetMsmqBinding` オブジェクトを使用するようにしてください。</span><span class="sxs-lookup"><span data-stu-id="e7756-146">Specify multiple endpoints with different contracts, but ensure that all the endpoints use the same `NetMsmqBinding` object.</span></span> <span data-ttu-id="e7756-147">ServiceModel のディスパッチ ロジックでは、ディスパッチ用のトランスポート チャネルからメッセージを読み取るメッセージ ポンプを使用します。メッセージ ポンプは、最終的にコントラクトに基づいてこれらのメッセージをさまざまなエンドポイントに非多重化します。</span><span class="sxs-lookup"><span data-stu-id="e7756-147">The dispatching logic in ServiceModel uses a message pump that reads messages out of the transport channel for dispatch, which eventually de-multiplexes messages based on the contract to different endpoints.</span></span> <span data-ttu-id="e7756-148">メッセージ ポンプは、リッスン URI とバインディングの組み合わせに対して作成されます。</span><span class="sxs-lookup"><span data-stu-id="e7756-148">A message pump is created for a listen URI/Binding pair.</span></span> <span data-ttu-id="e7756-149">キュー アドレスは、キューに格納されたリスナーにより、リッスン URI として使用されます。</span><span class="sxs-lookup"><span data-stu-id="e7756-149">The queue address is used as the Listen URI by the queued listener.</span></span> <span data-ttu-id="e7756-150">すべてのエンドポイントで同じバインディング オブジェクトを使用するようにすると、1 つのメッセージ ポンプを使用してメッセージを読み取り、コントラクトに基づいて関連するエンドポイントに非多重化できるようになります。</span><span class="sxs-lookup"><span data-stu-id="e7756-150">Having all the endpoints use the same binding object ensures that a single message pump is used to read the message and de-multiplex to relevant endpoints based on the contract.</span></span>  
  
### <a name="srmp-messaging"></a><span data-ttu-id="e7756-151">SRMP メッセージング</span><span class="sxs-lookup"><span data-stu-id="e7756-151">SRMP Messaging</span></span>  
 <span data-ttu-id="e7756-152">既に説明したように、キュー間の転送には SRMP プロトコルを使用できます。</span><span class="sxs-lookup"><span data-stu-id="e7756-152">As previously discussed, you can use the SRMP protocol for queue-to-queue transfers.</span></span> <span data-ttu-id="e7756-153">このプロトコルは、HTTP トランスポートを使用して転送キューとターゲット キューの間でメッセージを送信する場合に使用するのが一般的です。</span><span class="sxs-lookup"><span data-stu-id="e7756-153">This is commonly used when an HTTP transport transmits messages between the Transmission Queue and the Target Queue.</span></span>  
  
 <span data-ttu-id="e7756-154">SRMP 転送プロトコルを使用するには、前述の net.msmq URI スキームを使用してメッセージをアドレス指定し、`QueueTransferProtocol` の `NetMsmqBinding` プロパティで SRMP または Secured SRMP を指定します。</span><span class="sxs-lookup"><span data-stu-id="e7756-154">To use the SRMP transfer protocol, address messages using the net.msmq URI scheme, as mentioned previously, and specify the choice of SRMP or Secured SRMP in the `QueueTransferProtocol` property of the `NetMsmqBinding`.</span></span>  
  
 <span data-ttu-id="e7756-155">`QueueTransferProtocol` プロパティの指定は、送信専用の機能です。</span><span class="sxs-lookup"><span data-stu-id="e7756-155">Specifying the `QueueTransferProtocol` property is a send-only feature.</span></span> <span data-ttu-id="e7756-156">これは、使用するキュー転送プロトコルの種類の、クライアントによる指示です。</span><span class="sxs-lookup"><span data-stu-id="e7756-156">This is an indication by the client which kind of queue transfer protocol to use.</span></span>  
  
### <a name="using-active-directory"></a><span data-ttu-id="e7756-157">Active Directory の使用</span><span class="sxs-lookup"><span data-stu-id="e7756-157">Using Active Directory</span></span>  
 <span data-ttu-id="e7756-158">MSMQ は、Active Directory 統合をサポートします。</span><span class="sxs-lookup"><span data-stu-id="e7756-158">MSMQ comes with support for Active Directory integration.</span></span> <span data-ttu-id="e7756-159">MSMQ を Active Directory 統合と共にインストールした場合、コンピューターを Windows ドメインに含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7756-159">When MSMQ is installed with Active Directory integration, the machine must be part of a Windows domain.</span></span> <span data-ttu-id="e7756-160">Active Directory は、検出のためにキューを公開するために使用されます。このようなキューは、*パブリックキュー*と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="e7756-160">Active Directory is used to publish queues for discovery; such queues are called *public queues*.</span></span> <span data-ttu-id="e7756-161">アドレス指定されたキューは、Active Directory を使用して解決できます。</span><span class="sxs-lookup"><span data-stu-id="e7756-161">When addressing a queue, the queue can be resolved using Active Directory.</span></span> <span data-ttu-id="e7756-162">これは、ドメイン ネーム システム (DNS: Domain Name System) を使用して、ネットワーク名の IP アドレスを解決するしくみに似ています。</span><span class="sxs-lookup"><span data-stu-id="e7756-162">This is similar to how Domain Name System (DNS) is used to resolve the IP address of a network name.</span></span> <span data-ttu-id="e7756-163">`UseActiveDirectory` の `NetMsmqBinding` プロパティは、キューに置かれたチャネルでキューの URI を解決するために Active Directory を使用する必要があるかどうかを示すブール値です。</span><span class="sxs-lookup"><span data-stu-id="e7756-163">The `UseActiveDirectory` property in `NetMsmqBinding` is a Boolean that indicates whether the queued channel must use Active Directory to resolve the queue URI.</span></span> <span data-ttu-id="e7756-164">既定では `false` に設定されています。</span><span class="sxs-lookup"><span data-stu-id="e7756-164">By default it is set to `false`.</span></span> <span data-ttu-id="e7756-165">`UseActiveDirectory` プロパティを `true` に設定すると、キューに置かれたチャネルは、Active Directory を使用して net.msmq:// URI を形式名に変換します。</span><span class="sxs-lookup"><span data-stu-id="e7756-165">If the `UseActiveDirectory` property is set to `true`, then the queued channel uses Active Directory to convert the net.msmq:// URI to format name.</span></span>  
  
 <span data-ttu-id="e7756-166">`UseActiveDirectory` プロパティは、メッセージの送信時にキューのアドレスを解決するために使用されるので、メッセージを送信するクライアントに対してのみ有効です。</span><span class="sxs-lookup"><span data-stu-id="e7756-166">The `UseActiveDirectory` property is meaningful only for the client that is sending the message because it is used to resolve the address of the queue when sending messages.</span></span>  
  
### <a name="mapping-netmsmq-uri-to-message-queuing-format-names"></a><span data-ttu-id="e7756-167">メッセージ キュー形式名への net.msmq URI のマップ</span><span class="sxs-lookup"><span data-stu-id="e7756-167">Mapping net.msmq URI to Message Queuing Format Names</span></span>  
 <span data-ttu-id="e7756-168">キューに置かれたチャネルは、チャネルに提供された net.msmq URI 名を MSMQ 形式名にマップします。</span><span class="sxs-lookup"><span data-stu-id="e7756-168">The queued channel handles mapping the net.msmq URI name provided to the channel to MSMQ format names.</span></span> <span data-ttu-id="e7756-169">これらをマップする際に使用されるルールを次の表にまとめます。</span><span class="sxs-lookup"><span data-stu-id="e7756-169">The following table summarizes the rules used to map between them.</span></span>  
  
|<span data-ttu-id="e7756-170">WCF の URI ベースのキュー アドレス</span><span class="sxs-lookup"><span data-stu-id="e7756-170">WCF URI-based queue address</span></span>|<span data-ttu-id="e7756-171">UseActiveDirectory プロパティ</span><span class="sxs-lookup"><span data-stu-id="e7756-171">Use Active Directory property</span></span>|<span data-ttu-id="e7756-172">QueueTransferProtocol プロパティ</span><span class="sxs-lookup"><span data-stu-id="e7756-172">Queue Transfer Protocol property</span></span>|<span data-ttu-id="e7756-173">結果の MSMQ 形式名</span><span class="sxs-lookup"><span data-stu-id="e7756-173">Resulting MSMQ format names</span></span>|  
|----------------------------------|-----------------------------------|--------------------------------------|---------------------------------|  
|<span data-ttu-id="e7756-174">Net.msmq://\<machine-name>/private/abc</span><span class="sxs-lookup"><span data-stu-id="e7756-174">Net.msmq://\<machine-name>/private/abc</span></span>|<span data-ttu-id="e7756-175">False (既定値)</span><span class="sxs-lookup"><span data-stu-id="e7756-175">False (default)</span></span>|<span data-ttu-id="e7756-176">Native (既定値)</span><span class="sxs-lookup"><span data-stu-id="e7756-176">Native (default)</span></span>|<span data-ttu-id="e7756-177">DIRECT=OS:machine-name\private$\abc</span><span class="sxs-lookup"><span data-stu-id="e7756-177">DIRECT=OS:machine-name\private$\abc</span></span>|  
|<span data-ttu-id="e7756-178">Net.msmq://\<machine-name>/private/abc</span><span class="sxs-lookup"><span data-stu-id="e7756-178">Net.msmq://\<machine-name>/private/abc</span></span>|<span data-ttu-id="e7756-179">[False]</span><span class="sxs-lookup"><span data-stu-id="e7756-179">False</span></span>|<span data-ttu-id="e7756-180">SRMP</span><span class="sxs-lookup"><span data-stu-id="e7756-180">SRMP</span></span>|<span data-ttu-id="e7756-181">DIRECT =http://machine/msmq/private $/abc</span><span class="sxs-lookup"><span data-stu-id="e7756-181">DIRECT=http://machine/msmq/private$/abc</span></span>|  
|<span data-ttu-id="e7756-182">Net.msmq://\<machine-name>/private/abc</span><span class="sxs-lookup"><span data-stu-id="e7756-182">Net.msmq://\<machine-name>/private/abc</span></span>|<span data-ttu-id="e7756-183">True</span><span class="sxs-lookup"><span data-stu-id="e7756-183">True</span></span>|<span data-ttu-id="e7756-184">ネイティブ</span><span class="sxs-lookup"><span data-stu-id="e7756-184">Native</span></span>|<span data-ttu-id="e7756-185">PUBLIC=some-guid (キューの GUID)</span><span class="sxs-lookup"><span data-stu-id="e7756-185">PUBLIC=some-guid (the GUID of the queue)</span></span>|  
  
### <a name="reading-messages-from-the-dead-letter-queue-or-the-poison-message-queue"></a><span data-ttu-id="e7756-186">配信不能キューまたは有害メッセージ キューからのメッセージの読み取り</span><span class="sxs-lookup"><span data-stu-id="e7756-186">Reading Messages from the Dead-Letter Queue or the Poison-Message Queue</span></span>  
 <span data-ttu-id="e7756-187">ターゲット キューのサブキューである有害メッセージ キューからメッセージを読み取るには、サブキューのアドレスを使用して `ServiceHost` を開きます。</span><span class="sxs-lookup"><span data-stu-id="e7756-187">To read messages from a poison-message queue that is a subqueue of the target queue, open the `ServiceHost` with the address of the subqueue.</span></span>  
  
 <span data-ttu-id="e7756-188">例 : ローカル コンピューターの PurchaseOrders 専用キューの有害メッセージ キューから読み取るサービスでは、net.msmq://localhost/private/PurchaseOrders;poison というアドレスを指定します。</span><span class="sxs-lookup"><span data-stu-id="e7756-188">Example: A service that reads from the poison-message queue of the PurchaseOrders private queue from the local machine would address net.msmq://localhost/private/PurchaseOrders;poison.</span></span>  
  
 <span data-ttu-id="e7756-189">システム トランザクション配信不能キューからメッセージを読み取るには、URI を net.msmq://localhost/system$;DeadXact という形式にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7756-189">To read messages from a system transactional dead-letter queue, the URI must be of the form: net.msmq://localhost/system$;DeadXact.</span></span>  
  
 <span data-ttu-id="e7756-190">システム非トランザクション配信不能キューからメッセージを読み取るには、URI を net.msmq://localhost/system$;DeadLetter という形式にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7756-190">To read messages from a system nontransactional dead-letter queue, the URI must be of the form: net.msmq://localhost/system$;DeadLetter.</span></span>  
  
 <span data-ttu-id="e7756-191">カスタムの配信不能キューを使用する場合は、配信不能キューをローカル コンピューターに配置する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7756-191">When using a custom dead-letter queue, note that the dead-letter queue must reside on the local computer.</span></span> <span data-ttu-id="e7756-192">そのため、配信不能キューの URI は次の形式に限定されます。</span><span class="sxs-lookup"><span data-stu-id="e7756-192">As such, the URI for the dead-letter queue is restricted to the form:</span></span>  
  
 <span data-ttu-id="e7756-193">net.msmq: //localhost/ [private/]  \<*custom-dead-letter-queue-name*>.</span><span class="sxs-lookup"><span data-stu-id="e7756-193">net.msmq: //localhost/ [private/]  \<*custom-dead-letter-queue-name*>.</span></span>  
  
 <span data-ttu-id="e7756-194">WCF サービスは、受信したすべてのメッセージが、リッスンしている特定のキューにアドレス指定されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="e7756-194">A WCF service verifies that all messages it receives were addressed to the particular queue it is listening on.</span></span> <span data-ttu-id="e7756-195">メッセージの送信先キューとメッセージが置かれているキューが一致しない場合、サービスはメッセージを処理しません。</span><span class="sxs-lookup"><span data-stu-id="e7756-195">If the message’s destination queue does not match the queue it is found in, the service does not process the message.</span></span> <span data-ttu-id="e7756-196">この問題には、配信不能キューをリッスンしているサービスが対処する必要があります。これは、配信不能キューにあるメッセージが、他の場所に配信されることになっていたメッセージであるためです。</span><span class="sxs-lookup"><span data-stu-id="e7756-196">This is an issue that services listening to a dead-letter queue must address because any message in the dead-letter queue was meant to be delivered elsewhere.</span></span> <span data-ttu-id="e7756-197">配信不能キューや有害メッセージ キューからメッセージを読み取るには、`ServiceBehavior` パラメーターが設定された <xref:System.ServiceModel.AddressFilterMode.Any> を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7756-197">To read messages from a dead-letter queue, or from a poison queue, a `ServiceBehavior` with the <xref:System.ServiceModel.AddressFilterMode.Any> parameter must be used.</span></span> <span data-ttu-id="e7756-198">例については、「[配信不能キュー](../../../../docs/framework/wcf/samples/dead-letter-queues.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e7756-198">For an example, see [Dead Letter Queues](../../../../docs/framework/wcf/samples/dead-letter-queues.md).</span></span>  
  
## <a name="msmqintegrationbinding-and-service-addressing"></a><span data-ttu-id="e7756-199">MsmqIntegrationBinding とサービスのアドレス指定</span><span class="sxs-lookup"><span data-stu-id="e7756-199">MsmqIntegrationBinding and Service Addressing</span></span>  
 <span data-ttu-id="e7756-200">`MsmqIntegrationBinding` は、従来の MSMQ アプリケーションとの通信に使用されます。</span><span class="sxs-lookup"><span data-stu-id="e7756-200">The `MsmqIntegrationBinding` is used for communication with traditional MSMQ applications.</span></span> <span data-ttu-id="e7756-201">既存の MSMQ アプリケーションとの相互運用を容易にするために、WCF では、形式名のアドレス指定のみがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="e7756-201">To ease interoperation with an existing MSMQ application, WCF supports only format name addressing.</span></span> <span data-ttu-id="e7756-202">そのため、このバインディングを使用して送信されるメッセージは、次の URI スキームに従う必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7756-202">Thus, messages sent using this binding must conform to the URI scheme:</span></span>  
  
 <span data-ttu-id="e7756-203">msmq.formatname:\<*MSMQ-format-name*>></span><span class="sxs-lookup"><span data-stu-id="e7756-203">msmq.formatname:\<*MSMQ-format-name*>></span></span>  
  
 <span data-ttu-id="e7756-204">MSMQ 形式名は、「 [About Message Queuing](https://docs.microsoft.com/previous-versions/windows/desktop/legacy/ms706032(v=vs.85))」で msmq によって指定された形式です。</span><span class="sxs-lookup"><span data-stu-id="e7756-204">The MSMQ-format-name is of the form specified by MSMQ in [About Message Queuing](https://docs.microsoft.com/previous-versions/windows/desktop/legacy/ms706032(v=vs.85)).</span></span>  
  
 <span data-ttu-id="e7756-205">`MsmqIntegrationBinding` を使用してキューからメッセージを受信する場合、使用できるのは、直接形式名とパブリック/プライベート形式名 (ActiveDirectory 統合が必要です) のみです。</span><span class="sxs-lookup"><span data-stu-id="e7756-205">Note that you can only use direct format names, and public and private format names (requires Active Directory integration) when receiving messages from a queue using `MsmqIntegrationBinding`.</span></span> <span data-ttu-id="e7756-206">ただし、直接形式名を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e7756-206">However, it is advised that you use direct format names.</span></span> <span data-ttu-id="e7756-207">たとえば、Windows Vista では、他の形式名を使用するとエラーが発生します。これは、システムがサブキューを開こうとして、直接形式名でのみ開くことができるためです。</span><span class="sxs-lookup"><span data-stu-id="e7756-207">For example, on Windows Vista, using any other format name causes an error because the system attempts to open a subqueue, which can only be opened with direct format names.</span></span>  
  
 <span data-ttu-id="e7756-208">`MsmqIntegrationBinding` を使用して SRMP のアドレス指定を行う場合は、インターネット インフォメーション サービス (IIS: Internet Information Services) のディスパッチを支援するために、直接形式名で /msmq/ を追加するという要件はありません。</span><span class="sxs-lookup"><span data-stu-id="e7756-208">When addressing SRMP using `MsmqIntegrationBinding`, there is no requirement to add /msmq/ in the direct format name to help Internet Information Services (IIS) with dispatching.</span></span> <span data-ttu-id="e7756-209">たとえば、DIRECT =http://adatum.com/msmq/private $/abc ではなく、SRMP プロトコルを使用してキュー abc を指定する場合は、DIRECT =http://adatum.com/private $/abc. を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7756-209">For example: When addressing a queue abc using the SRMP protocol, instead of DIRECT=http://adatum.com/msmq/private$/abc, you should use DIRECT=http://adatum.com/private$/abc.</span></span>  
  
 <span data-ttu-id="e7756-210">`MsmqIntegrationBinding` では、net.msmq:// によるアドレス指定を使用できないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e7756-210">Note that you cannot use net.msmq:// addressing with `MsmqIntegrationBinding`.</span></span> <span data-ttu-id="e7756-211">`MsmqIntegrationBinding` は自由形式の MSMQ 形式名のアドレス指定をサポートしているため、このバインディングを使用する WCF サービスを使用して、MSMQ のマルチキャストおよび配布リスト機能を使用できます。</span><span class="sxs-lookup"><span data-stu-id="e7756-211">Because `MsmqIntegrationBinding` supports free-form MSMQ format name addressing, you can use a WCF service that uses this binding to use multicast and distribution list features in MSMQ.</span></span> <span data-ttu-id="e7756-212">ただし、`CustomDeadLetterQueue` を使用するときに、`MsmqIntegrationBinding` を指定する場合を除きます。</span><span class="sxs-lookup"><span data-stu-id="e7756-212">One exception is specifying `CustomDeadLetterQueue` when using the `MsmqIntegrationBinding`.</span></span> <span data-ttu-id="e7756-213">これは、`NetMsmqBinding` を使用して指定するのと同様に、net.msmq:// という形式にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="e7756-213">It must be of the form net.msmq://, similar to how it is specified using the `NetMsmqBinding`.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e7756-214">関連項目</span><span class="sxs-lookup"><span data-stu-id="e7756-214">See also</span></span>

- [<span data-ttu-id="e7756-215">キューに置かれたアプリケーションの Web ホスト</span><span class="sxs-lookup"><span data-stu-id="e7756-215">Web Hosting a Queued Application</span></span>](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md)
