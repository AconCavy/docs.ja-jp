---
title: ランタイムがアセンブリを検索する方法
ms.date: 03/30/2017
helpviewer_keywords:
- app.config files, assembly locations
- deploying applications [.NET Framework], assembly locations
- application configuration files, locating assemblies
- .NET Framework application deployment, locating assemblies
- locating assemblies
- assemblies [.NET Framework], location
ms.assetid: 772ac6f4-64d2-4cfb-92fd-58096dcd6c34
ms.openlocfilehash: c462a6df2d5221907a6b574c33bb8fa1c52abac5
ms.sourcegitcommit: 9a97c76e141333394676bc5d264c6624b6f45bcf
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/08/2020
ms.locfileid: "75741340"
---
# <a name="how-the-runtime-locates-assemblies"></a><span data-ttu-id="468d8-102">ランタイムがアセンブリを検索する方法</span><span class="sxs-lookup"><span data-stu-id="468d8-102">How the Runtime Locates Assemblies</span></span>

<span data-ttu-id="468d8-103">.NET Framework アプリケーションを正しく配置するには、アプリケーションを構成するアセンブリを共通言語ランタイムがどのように検索し、バインドするかを理解している必要があります。</span><span class="sxs-lookup"><span data-stu-id="468d8-103">To successfully deploy your .NET Framework application, you must understand how the common language runtime locates and binds to the assemblies that make up your application.</span></span> <span data-ttu-id="468d8-104">既定では、ランタイムはアプリケーションを構成するアセンブリの正しいバージョンをバインドしようとします。</span><span class="sxs-lookup"><span data-stu-id="468d8-104">By default, the runtime attempts to bind with the exact version of an assembly that the application was built with.</span></span> <span data-ttu-id="468d8-105">この既定の動作は、構成ファイルの設定によってオーバーライドできます。</span><span class="sxs-lookup"><span data-stu-id="468d8-105">This default behavior can be overridden by configuration file settings.</span></span>

<span data-ttu-id="468d8-106">共通言語ランタイムは、アセンブリを検索し、アセンブリの参照を解決しようとするときにいくつかの手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="468d8-106">The common language runtime performs a number of steps when attempting to locate an assembly and resolve an assembly reference.</span></span> <span data-ttu-id="468d8-107">それぞれの手順については、後続のセクションで説明します。</span><span class="sxs-lookup"><span data-stu-id="468d8-107">Each step is explained in the following sections.</span></span> <span data-ttu-id="468d8-108">ランタイムがアセンブリを検索する方法の説明では、「プローブ」という用語が頻繁に使用されます。プローブとは、アセンブリの名前およびカルチャに基づいてアセンブリを特定するための一連のヒューリスティックです。</span><span class="sxs-lookup"><span data-stu-id="468d8-108">The term probing is often used when describing how the runtime locates assemblies; it refers to the set of heuristics used to locate the assembly based on its name and culture.</span></span>

> [!NOTE]
> <span data-ttu-id="468d8-109">Windows SDK に含まれている[アセンブリ バインディング ログ ビューアー (Fuslogvw.exe)](../tools/fuslogvw-exe-assembly-binding-log-viewer.md) を使用すると、ログ ファイル内のバインディング情報を表示できます。</span><span class="sxs-lookup"><span data-stu-id="468d8-109">You can view binding information in the log file using the [Assembly Binding Log Viewer (Fuslogvw.exe)](../tools/fuslogvw-exe-assembly-binding-log-viewer.md), which is included in the Windows SDK.</span></span>

## <a name="initiating-the-bind"></a><span data-ttu-id="468d8-110">バインドの開始</span><span class="sxs-lookup"><span data-stu-id="468d8-110">Initiating the Bind</span></span>

<span data-ttu-id="468d8-111">アセンブリを検索し、バインドするプロセスは、ランタイムが別のアセンブリへの参照を解決しようとしたときに開始します。</span><span class="sxs-lookup"><span data-stu-id="468d8-111">The process of locating and binding to an assembly begins when the runtime attempts to resolve a reference to another assembly.</span></span> <span data-ttu-id="468d8-112">この参照は、静的参照または動的参照のいずれかです。</span><span class="sxs-lookup"><span data-stu-id="468d8-112">This reference can be either static or dynamic.</span></span> <span data-ttu-id="468d8-113">コンパイラは、ビルド時に静的参照をアセンブリ マニフェストのメタデータに記録します。</span><span class="sxs-lookup"><span data-stu-id="468d8-113">The compiler records static references in the assembly manifest's metadata at build time.</span></span> <span data-ttu-id="468d8-114">動的参照は、 <xref:System.Reflection.Assembly.Load%2A?displayProperty=nameWithType>など、各種のメソッド呼び出しの結果として実行時に生成されます。</span><span class="sxs-lookup"><span data-stu-id="468d8-114">Dynamic references are constructed on the fly as a result of calling various methods, such as <xref:System.Reflection.Assembly.Load%2A?displayProperty=nameWithType>.</span></span>

<span data-ttu-id="468d8-115">お勧めするアセンブリの参照方法は、アセンブリ名、バージョン、カルチャ、および公開キー トークン (存在する場合) を含む完全参照を使用することです。</span><span class="sxs-lookup"><span data-stu-id="468d8-115">The preferred way to reference an assembly is to use a full reference, including the assembly name, version, culture, and public key token (if one exists).</span></span> <span data-ttu-id="468d8-116">ランタイムはこれらの情報を使用して、このセクションで後述する手順に従ってアセンブリを検索します。</span><span class="sxs-lookup"><span data-stu-id="468d8-116">The runtime uses this information to locate the assembly, following the steps described later in this section.</span></span> <span data-ttu-id="468d8-117">静的アセンブリまたは動的アセンブリのいずれかへの参照に関係なく、ランタイムは同じ解決プロセスを使用します。</span><span class="sxs-lookup"><span data-stu-id="468d8-117">The runtime uses the same resolution process regardless of whether the reference is for a static or dynamic assembly.</span></span>

<span data-ttu-id="468d8-118">アセンブリ名だけを指定するなど、アセンブリについての情報の一部だけを指定した呼び出しメソッドを提供することで、アセンブリを動的に参照することもできます。</span><span class="sxs-lookup"><span data-stu-id="468d8-118">You can also make a dynamic reference to an assembly by providing the calling method with only partial information about the assembly, such as specifying only the assembly name.</span></span> <span data-ttu-id="468d8-119">その場合は、アセンブリの検索はアプリケーション ディレクトリ内だけでなされ、その他のチェックは実行されません。</span><span class="sxs-lookup"><span data-stu-id="468d8-119">In this case, only the application directory is searched for the assembly, and no other checking occurs.</span></span> <span data-ttu-id="468d8-120"><xref:System.Reflection.Assembly.Load%2A?displayProperty=nameWithType> や <xref:System.AppDomain.Load%2A?displayProperty=nameWithType>などのアセンブリの読み込み用のさまざまなメソッドを使用した部分参照を作成します。</span><span class="sxs-lookup"><span data-stu-id="468d8-120">You make a partial reference using any of the various methods for loading assemblies such as <xref:System.Reflection.Assembly.Load%2A?displayProperty=nameWithType> or <xref:System.AppDomain.Load%2A?displayProperty=nameWithType>.</span></span>

<span data-ttu-id="468d8-121">最後に、<xref:System.Reflection.Assembly.Load%2A?displayProperty=nameWithType> などのメソッドを使用して動的参照を作成し、情報の一部だけを提供できます。その後で、アプリケーション構成ファイル内の [\<qualifyAssembly>](../configure-apps/file-schema/runtime/qualifyassembly-element.md) 要素を使用してその参照を修飾します。</span><span class="sxs-lookup"><span data-stu-id="468d8-121">Finally, you can make a dynamic reference using a method such as <xref:System.Reflection.Assembly.Load%2A?displayProperty=nameWithType> and provide only partial information; you then qualify the reference using the [\<qualifyAssembly>](../configure-apps/file-schema/runtime/qualifyassembly-element.md) element in the application configuration file.</span></span> <span data-ttu-id="468d8-122">この要素を使用すると、完全な参照情報 (名前、バージョン、カルチャ、および適用可能な場合は公開キー トークン) をコード内ではなく、アプリケーション構成ファイル内に提供できます。</span><span class="sxs-lookup"><span data-stu-id="468d8-122">This element allows you to provide the full reference information (name, version, culture and, if applicable, the public key token) in your application configuration file instead of in your code.</span></span> <span data-ttu-id="468d8-123">アプリケーション ディレクトリ外部のアセンブリへの参照を完全に限定する必要がある場合、またはグローバル アセンブリ キャッシュ内のアセンブリを参照するが、完全参照をコード内ではなく構成ファイル内に指定する方が便利な場合は、この手法を使用します。</span><span class="sxs-lookup"><span data-stu-id="468d8-123">You would use this technique if you wanted to fully qualify a reference to an assembly outside the application directory, or if you wanted to reference an assembly in the global assembly cache but you wanted the convenience of specifying the full reference in the configuration file instead of in your code.</span></span>

> [!NOTE]
> <span data-ttu-id="468d8-124">このタイプの部分参照は、複数のアプリケーションで共有されるアセンブリに対しては使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="468d8-124">This type of partial reference should not be used with assemblies that are shared among several applications.</span></span> <span data-ttu-id="468d8-125">構成設定はアセンブリ別ではなくアプリケーション別に適用されるため、このタイプの部分参照を使用する共有アセンブリについては、その共有アセンブリを使用するアプリケーションごとに、そのアプリケーションの構成ファイル内に限定情報を含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="468d8-125">Because configuration settings are applied per application and not per assembly, a shared assembly using this type of partial reference would require each application using the shared assembly to have the qualifying information in its configuration file.</span></span>

<span data-ttu-id="468d8-126">ランタイムは、次の手順を使用することによってアセンブリ参照を解決します。</span><span class="sxs-lookup"><span data-stu-id="468d8-126">The runtime uses the following steps to resolve an assembly reference:</span></span>

1. <span data-ttu-id="468d8-127">適用可能な構成ファイル (アプリケーション構成ファイル、発行者ポリシー ファイル、マシン構成ファイルなど) をチェックして、[正しいアセンブリ バージョンを決定します。](#step1)</span><span class="sxs-lookup"><span data-stu-id="468d8-127">[Determines the correct assembly version](#step1) by examining applicable configuration files, including the application configuration file, publisher policy file, and machine configuration file.</span></span> <span data-ttu-id="468d8-128">構成ファイルがリモート コンピューターに配置されている場合、ランタイムは最初にアプリケーション構成ファイルを検索し、ダウンロードする必要があります。</span><span class="sxs-lookup"><span data-stu-id="468d8-128">If the configuration file is located on a remote machine, the runtime must locate and download the application configuration file first.</span></span>

2. <span data-ttu-id="468d8-129">[以前にアセンブリ名がバインドされているかどうかをチェック](#step2) し、バインドされている場合は、前に読み込んだアセンブリを使用します。</span><span class="sxs-lookup"><span data-stu-id="468d8-129">[Checks whether the assembly name has been bound to before](#step2) and, if so, uses the previously loaded assembly.</span></span> <span data-ttu-id="468d8-130">前にアセンブリの読み込み要求が失敗している場合は、アセンブリの読み込みを試みることなく要求が直ちにエラーとなります。</span><span class="sxs-lookup"><span data-stu-id="468d8-130">If a previous request to load the assembly failed, the request is failed immediately without attempting to load the assembly.</span></span>

    > [!NOTE]
    > <span data-ttu-id="468d8-131">アセンブリ バインディング エラーのキャッシュは、.NET Framework Version 2.0 で新たに追加されました。</span><span class="sxs-lookup"><span data-stu-id="468d8-131">The caching of assembly binding failures is new in the .NET Framework version 2.0.</span></span>

3. <span data-ttu-id="468d8-132">[グローバル アセンブリ キャッシュをチェックします](#step3)。</span><span class="sxs-lookup"><span data-stu-id="468d8-132">[Checks the global assembly cache](#step3).</span></span> <span data-ttu-id="468d8-133">そこにアセンブリが見つかった場合は、ランタイムでそのアセンブリが使用されます。</span><span class="sxs-lookup"><span data-stu-id="468d8-133">If the assembly is found there, the runtime uses this assembly.</span></span>

4. <span data-ttu-id="468d8-134">次の手順を使用することによって、[アセンブリのプローブ](#step4) を実行します。</span><span class="sxs-lookup"><span data-stu-id="468d8-134">[Probes for the assembly](#step4) using the following steps:</span></span>

    1. <span data-ttu-id="468d8-135">構成と発行者ポリシーが元の参照に影響しない場合およびバインド要求が <xref:System.Reflection.Assembly.LoadFrom%2A?displayProperty=nameWithType> メソッドを使用することによって作成されている場合、ランタイムは位置ヒントをチェックします。</span><span class="sxs-lookup"><span data-stu-id="468d8-135">If configuration and publisher policy do not affect the original reference and if the bind request was created using the <xref:System.Reflection.Assembly.LoadFrom%2A?displayProperty=nameWithType> method, the runtime checks for location hints.</span></span>

    2. <span data-ttu-id="468d8-136">構成ファイル内でコードベースが見つかった場合、ランタイムはその場所だけをチェックします。</span><span class="sxs-lookup"><span data-stu-id="468d8-136">If a codebase is found in the configuration files, the runtime checks only this location.</span></span> <span data-ttu-id="468d8-137">このプローブが失敗した場合、ランタイムはバインド要求が失敗したと判断し、それ以上のプローブは実行しません。</span><span class="sxs-lookup"><span data-stu-id="468d8-137">If this probe fails, the runtime determines that the binding request failed and no other probing occurs.</span></span>

    3. <span data-ttu-id="468d8-138">「 [手順 4: コードベースまたはプローブによるアセンブリの検索](#step4)」で説明するヒューリスティックを使用してアセンブリをプローブします。</span><span class="sxs-lookup"><span data-stu-id="468d8-138">Probes for the assembly using the heuristics described in the [probing section](#step4).</span></span> <span data-ttu-id="468d8-139">プローブしてもアセンブリが見つからなかった場合、ランタイムは Windows Installer に対してアセンブリを提供するように要求します。</span><span class="sxs-lookup"><span data-stu-id="468d8-139">If the assembly is not found after probing, the runtime requests the Windows Installer to provide the assembly.</span></span> <span data-ttu-id="468d8-140">これは、オンデマンド インストール機能として実行されます。</span><span class="sxs-lookup"><span data-stu-id="468d8-140">This acts as an install-on-demand feature.</span></span>

        > [!NOTE]
        > <span data-ttu-id="468d8-141">厳密な名前を持たないアセンブリについては、ランタイムはバージョン チェックをしません。また、厳密な名前を持たないアセンブリについては、グローバル アセンブリ キャッシュ内のチェックも実行しません。</span><span class="sxs-lookup"><span data-stu-id="468d8-141">There is no version checking for assemblies without strong names, nor does the runtime check in the global assembly cache for assemblies without strong names.</span></span>

<a name="step1"></a>

## <a name="step-1-examining-the-configuration-files"></a><span data-ttu-id="468d8-142">手順 1: 構成ファイルのチェック</span><span class="sxs-lookup"><span data-stu-id="468d8-142">Step 1: Examining the Configuration Files</span></span>

<span data-ttu-id="468d8-143">アセンブリ バインディング動作は、次の 3 つの XML ファイルに基づいて、さまざまなレベルで設定できます。</span><span class="sxs-lookup"><span data-stu-id="468d8-143">Assembly binding behavior can be configured at different levels based on three XML files:</span></span>

- <span data-ttu-id="468d8-144">アプリケーション構成ファイル</span><span class="sxs-lookup"><span data-stu-id="468d8-144">Application configuration file.</span></span>

- <span data-ttu-id="468d8-145">発行者ポリシー ファイル</span><span class="sxs-lookup"><span data-stu-id="468d8-145">Publisher policy file.</span></span>

- <span data-ttu-id="468d8-146">マシン構成ファイル</span><span class="sxs-lookup"><span data-stu-id="468d8-146">Machine configuration file.</span></span>

<span data-ttu-id="468d8-147">これらのファイルには、特定のアセンブリについて、バインディング リダイレクト、コードの場所、バインディング モードなどの情報が同じ構文で記述されています。</span><span class="sxs-lookup"><span data-stu-id="468d8-147">These files follow the same syntax and provide information such as binding redirects, the location of code, and binding modes for particular assemblies.</span></span> <span data-ttu-id="468d8-148">バインディング プロセスをリダイレクトする各構成ファイルは [\<assemblyBinding> 要素](../configure-apps/file-schema/runtime/assemblybinding-element-for-runtime.md)を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="468d8-148">Each configuration file can contain an [\<assemblyBinding> element](../configure-apps/file-schema/runtime/assemblybinding-element-for-runtime.md) that redirects the binding process.</span></span> <span data-ttu-id="468d8-149">[\<assemblyBinding> 要素](../configure-apps/file-schema/runtime/assemblybinding-element-for-runtime.md)の子要素には [\<dependentAssembly> 要素](../configure-apps/file-schema/runtime/dependentassembly-element.md)が含まれます。</span><span class="sxs-lookup"><span data-stu-id="468d8-149">The child elements of the [\<assemblyBinding> element](../configure-apps/file-schema/runtime/assemblybinding-element-for-runtime.md) include the [\<dependentAssembly> element](../configure-apps/file-schema/runtime/dependentassembly-element.md).</span></span> <span data-ttu-id="468d8-150">[\<dependentAssembly> 要素](../configure-apps/file-schema/runtime/dependentassembly-element.md)の子は、[\<assemblyIdentity> 要素](/visualstudio/deployment/assemblyidentity-element-clickonce-deployment)、[\<bindingRedirect> 要素](../configure-apps/file-schema/runtime/bindingredirect-element.md)と、[\<codeBase> 要素](../configure-apps/file-schema/runtime/codebase-element.md)が含まれます。</span><span class="sxs-lookup"><span data-stu-id="468d8-150">The children of [\<dependentAssembly> element](../configure-apps/file-schema/runtime/dependentassembly-element.md) include the [\<assemblyIdentity> element](/visualstudio/deployment/assemblyidentity-element-clickonce-deployment), the [\<bindingRedirect> element](../configure-apps/file-schema/runtime/bindingredirect-element.md), and the [\<codeBase> element](../configure-apps/file-schema/runtime/codebase-element.md).</span></span>

> [!NOTE]
> <span data-ttu-id="468d8-151">構成情報は、この 3 つの構成ファイル内に含まれていますが、すべての要素がすべての構成ファイルで有効なわけではありません。</span><span class="sxs-lookup"><span data-stu-id="468d8-151">Configuration information can be found in the three configuration files; not all elements are valid in all configuration files.</span></span> <span data-ttu-id="468d8-152">たとえば、バインディング モードやプライベート パス情報は、アプリケーション構成ファイルだけに含めることができます。</span><span class="sxs-lookup"><span data-stu-id="468d8-152">For example, binding mode and private path information can only be in the application configuration file.</span></span> <span data-ttu-id="468d8-153">各ファイルに含まれる情報の完全な一覧については、「 [構成ファイルを使用してアプリを構成する方法](../configure-apps/index.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="468d8-153">For a complete list of the information that is contained in each file, see [Configuring Apps by Using Configuration Files](../configure-apps/index.md).</span></span>

### <a name="application-configuration-file"></a><span data-ttu-id="468d8-154">アプリケーション構成ファイル</span><span class="sxs-lookup"><span data-stu-id="468d8-154">Application Configuration File</span></span>

<span data-ttu-id="468d8-155">最初に、共通言語ランタイムは、アプリケーション構成ファイル内に呼び出し元アセンブリのマニフェストに格納されているバージョン情報をオーバーライドする情報がないかどうかをチェックします。</span><span class="sxs-lookup"><span data-stu-id="468d8-155">First, the common language runtime checks the application configuration file for information that overrides the version information stored in the calling assembly's manifest.</span></span> <span data-ttu-id="468d8-156">アプリケーション構成ファイルはアプリケーションと共に配置できますが、アプリケーションの実行にとっては必須ではありません。</span><span class="sxs-lookup"><span data-stu-id="468d8-156">The application configuration file can be deployed with an application, but is not required for application execution.</span></span> <span data-ttu-id="468d8-157">通常、このファイルはほとんど瞬時に取得できますが、Internet Explorer Web ベースのシナリオの場合のように、アプリケーション ベースがリモート コンピューターに存在するときは、構成ファイルをダウンロードする必要があります。</span><span class="sxs-lookup"><span data-stu-id="468d8-157">Usually the retrieval of this file is almost instantaneous, but in situations where the application base is on a remote computer, such as in an Internet Explorer Web-based scenario, the configuration file must be downloaded.</span></span>

<span data-ttu-id="468d8-158">クライアント実行可能ファイルの場合、アプリケーション構成ファイルは、アプリケーションの実行可能ファイルと同じディレクトリに配置され、実行可能ファイルと同じ名前に拡張子 .config を付けた基本名が割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="468d8-158">For client executables, the application configuration file resides in the same directory as the application's executable and has the same base name as the executable with a .config extension.</span></span> <span data-ttu-id="468d8-159">たとえば、C:\Program Files\Myapp\Myapp.exe の構成ファイルは、C:\Program Files\Myapp\Myapp.exe.config です。ブラウザー ベースのシナリオでは、HTML ファイルは明示的に構成ファイルを指すために **\<link>** 要素を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="468d8-159">For example, the configuration file for C:\Program Files\Myapp\Myapp.exe is C:\Program Files\Myapp\Myapp.exe.config. In a browser-based scenario, the HTML file must use the **\<link>** element to explicitly point to the configuration file.</span></span>

<span data-ttu-id="468d8-160">次のコードは、アプリケーション構成ファイルの簡単な例を示します。</span><span class="sxs-lookup"><span data-stu-id="468d8-160">The following code provides a simple example of an application configuration file.</span></span> <span data-ttu-id="468d8-161">この例では、 <xref:System.Diagnostics.TextWriterTraceListener> を <xref:System.Diagnostics.Debug.Listeners%2A> コレクションに追加し、デバッグ情報のファイルへの記録を有効にします。</span><span class="sxs-lookup"><span data-stu-id="468d8-161">This example adds a <xref:System.Diagnostics.TextWriterTraceListener> to the <xref:System.Diagnostics.Debug.Listeners%2A> collection to enable recording debug information to a file.</span></span>

```xml
<configuration>
   <system.diagnostics>
      <trace useGlobalLock="false" autoflush="true" indentsize="0">
         <listeners>
            <add name="myListener" type="System.Diagnostics.TextWriterTraceListener, system version=1.0.3300.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" initializeData="c:\myListener.log" />
         </listeners>
      </trace>
   </system.diagnostics>
</configuration>
```

### <a name="publisher-policy-file"></a><span data-ttu-id="468d8-162">発行者ポリシー ファイル</span><span class="sxs-lookup"><span data-stu-id="468d8-162">Publisher Policy File</span></span>

<span data-ttu-id="468d8-163">次に、ランタイムは、発行者ポリシー ファイルが存在する場合、このファイルをチェックします。</span><span class="sxs-lookup"><span data-stu-id="468d8-163">Second, the runtime examines the publisher policy file, if one exists.</span></span> <span data-ttu-id="468d8-164">発行者ポリシー ファイルは、コンポーネントの発行者が共有コンポーネントへの修正または更新として配布します。</span><span class="sxs-lookup"><span data-stu-id="468d8-164">Publisher policy files are distributed by a component publisher as a fix or update to a shared component.</span></span> <span data-ttu-id="468d8-165">それらのファイルには、アセンブリ参照を新しいバージョンに伝える共有コンポーネントの発行者によって発行された互換情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="468d8-165">These files contain compatibility information issued by the publisher of the shared component that directs an assembly reference to a new version.</span></span> <span data-ttu-id="468d8-166">アプリケーション構成ファイルやマシン構成ファイルとは異なり、発行者ポリシー ファイルは、グローバル アセンブリ キャッシュにインストールする必要のあるその発行者ポリシー ファイルに固有のアセンブリに含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="468d8-166">Unlike application and machine configuration files, publisher policy files are contained in their own assembly that must be installed in the global assembly cache.</span></span>

<span data-ttu-id="468d8-167">発行者ポリシーの構成ファイルの例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="468d8-167">The following is an example of a Publisher Policy configuration file:</span></span>

```xml
<configuration>
    <runtime>
        <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">

            <dependentAssembly>
                <assemblyIdentity name="asm6" publicKeyToken="c0305c36380ba429" />
                <bindingRedirect oldVersion="3.0.0.0" newVersion="2.0.0.0"/>
            </dependentAssembly>

        </assemblyBinding>
    </runtime>
</configuration>
```

<span data-ttu-id="468d8-168">アセンブリを作成するには、[Al.exe (アセンブリ リンカー)](../tools/al-exe-assembly-linker.md) ツールを使用し、次のようにコマンドを指定します。</span><span class="sxs-lookup"><span data-stu-id="468d8-168">To create an assembly, you can use the [Al.exe (Assembly Linker)](../tools/al-exe-assembly-linker.md) tool with a command such as the following:</span></span>

```console
Al.exe /link:asm6.exe.config /out:policy.3.0.asm6.dll /keyfile: compatkey.dat /v:3.0.0.0
```

<span data-ttu-id="468d8-169">`compatkey.dat` は厳密な名前のキー ファイルです。</span><span class="sxs-lookup"><span data-stu-id="468d8-169">`compatkey.dat` is a strong-name key file.</span></span> <span data-ttu-id="468d8-170">このコマンドにより、グローバル アセンブリ キャッシュに配置できる、厳密な名前のアセンブリが作成されます。</span><span class="sxs-lookup"><span data-stu-id="468d8-170">This command creates a strong-named assembly you can place in the global assembly cache.</span></span>

> [!NOTE]
> <span data-ttu-id="468d8-171">発行者ポリシーは、同じ共有コンポーネントを使用するすべてのアプリケーションに適用されます。</span><span class="sxs-lookup"><span data-stu-id="468d8-171">Publisher policy affects all applications that use a shared component.</span></span>

<span data-ttu-id="468d8-172">発行者ポリシー構成ファイルは、アプリケーションからのバージョン情報 (つまり、アセンブリ マニフェストまたはアプリケーション構成ファイルからのバージョン情報) をオーバーライドします。</span><span class="sxs-lookup"><span data-stu-id="468d8-172">The publisher policy configuration file overrides version information that comes from the application (that is, from the assembly manifest or from the application configuration file).</span></span> <span data-ttu-id="468d8-173">アプリケーション構成ファイルに、アセンブリ マニフェストに指定されているバージョンをリダイレクトするように指示するステートメントがない場合、発行者ポリシー ファイルは、アセンブリ マニフェストに指定されているバージョンをオーバーライドします。</span><span class="sxs-lookup"><span data-stu-id="468d8-173">If there is no statement in the application configuration file to redirect the version specified in the assembly manifest, the publisher policy file overrides the version specified in the assembly manifest.</span></span> <span data-ttu-id="468d8-174">しかし、アプリケーション構成ファイルにリダイレクト ステートメントがある場合、発行者ポリシーは、マニフェストに指定されているバージョンではなく、アプリケーション構成ファイル内のバージョン情報をオーバーライドします。</span><span class="sxs-lookup"><span data-stu-id="468d8-174">However, if there is a redirecting statement in the application configuration file, publisher policy overrides that version rather than the one specified in the manifest.</span></span>

<span data-ttu-id="468d8-175">発行者ポリシー ファイルを使用するのは、共有コンポーネントが更新され、そのコンポーネントを使用するすべてのアプリケーションが共有コンポーネントの新しいバージョンを選択する必要がある場合です。</span><span class="sxs-lookup"><span data-stu-id="468d8-175">A publisher policy file is used when a shared component is updated and the new version of the shared component should be picked up by all applications using that component.</span></span> <span data-ttu-id="468d8-176">アプリケーション構成ファイルにセーフ モードが適用されていない限り、アプリケーション構成ファイル内の設定は、発行者ポリシー ファイル内の設定によってオーバーライドされます。</span><span class="sxs-lookup"><span data-stu-id="468d8-176">The settings in the publisher policy file override settings in the application configuration file, unless the application configuration file enforces safe mode.</span></span>

#### <a name="safe-mode"></a><span data-ttu-id="468d8-177">セーフ モード</span><span class="sxs-lookup"><span data-stu-id="468d8-177">Safe Mode</span></span>
<span data-ttu-id="468d8-178">通常、発行者ポリシー ファイルは、Service Pack またはプログラム更新の一部として明示的にインストールされます。</span><span class="sxs-lookup"><span data-stu-id="468d8-178">Publisher policy files are usually explicitly installed as part of a service pack or program update.</span></span> <span data-ttu-id="468d8-179">アップグレードされた共有コンポーネントに何か問題がある場合は、セーフ モードを使用して発行者ポリシー ファイル内のオーバーライドを無視できます。</span><span class="sxs-lookup"><span data-stu-id="468d8-179">If there is any problem with the upgraded shared component, you can ignore the overrides in the publisher policy file using safe mode.</span></span> <span data-ttu-id="468d8-180">セーフ モードは **\<publisherPolicy apply="yes**&#124;**no"/>** 要素によって決まります。この要素は、アプリケーション構成ファイルだけにあります。</span><span class="sxs-lookup"><span data-stu-id="468d8-180">Safe mode is determined by the **\<publisherPolicy apply="yes**&#124;**no"/>** element, located only in the application configuration file.</span></span> <span data-ttu-id="468d8-181">この要素は、発行者ポリシーの構成情報をバインディング プロセスから削除するかどうかを指定します。</span><span class="sxs-lookup"><span data-stu-id="468d8-181">It specifies whether the publisher policy configuration information should be removed from the binding process.</span></span>

<span data-ttu-id="468d8-182">セーフ モードは、アプリケーション全体に対して設定するか、または選択したアセンブリに対して設定できます。</span><span class="sxs-lookup"><span data-stu-id="468d8-182">Safe mode can be set for the entire application or for selected assemblies.</span></span> <span data-ttu-id="468d8-183">つまり、アプリケーションを構成するすべてのアセンブリのポリシーをオフに設定するか、または一部のアセンブリについてだけポリシーをオフにし、それ以外はオフにしないように設定できます。</span><span class="sxs-lookup"><span data-stu-id="468d8-183">That is, you can turn off the policy for all assemblies that make up the application, or turn it on for some assemblies but not others.</span></span> <span data-ttu-id="468d8-184">アプリケーションを構成するアセンブリに発行者ポリシーを選択的に適用するには、 **\<publisherPolicy apply\=no/>** を設定し、\<**dependentAssembly**> 要素を使用して適用対象のアセンブリを指定します。</span><span class="sxs-lookup"><span data-stu-id="468d8-184">To selectively apply publisher policy to assemblies that make up an application, set **\<publisherPolicy apply\=no/>** and specify which assemblies you want to be affected using the \<**dependentAssembly**> element.</span></span> <span data-ttu-id="468d8-185">アプリケーションを構成するすべてのアセンブリに発行者ポリシーを適用するには、依存アセンブリの場合は、要素なしの **\<publisherPolicy apply\=no/>** を設定します。</span><span class="sxs-lookup"><span data-stu-id="468d8-185">To apply publisher policy to all assemblies that make up the application, set **\<publisherPolicy apply\=no/>** with no dependent assembly elements.</span></span> <span data-ttu-id="468d8-186">構成の詳細については、「 [構成ファイルを使用してアプリを構成する方法](../configure-apps/index.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="468d8-186">For more about configuration, see [Configuring Apps by using Configuration Files](../configure-apps/index.md).</span></span>

### <a name="machine-configuration-file"></a><span data-ttu-id="468d8-187">マシン構成ファイル</span><span class="sxs-lookup"><span data-stu-id="468d8-187">Machine Configuration File</span></span>
<span data-ttu-id="468d8-188">3 番目に、ランタイムはマシン構成ファイルをチェックします。</span><span class="sxs-lookup"><span data-stu-id="468d8-188">Third, the runtime examines the machine configuration file.</span></span> <span data-ttu-id="468d8-189">このファイルは、Machine.config という名前で、ローカル コンピューターの、ランタイムがインストールされているルート ディレクトリの Config サブディレクトリにあります。</span><span class="sxs-lookup"><span data-stu-id="468d8-189">This file, called Machine.config, resides on the local computer in the Config subdirectory of the root directory where the runtime is installed.</span></span> <span data-ttu-id="468d8-190">管理者は、このマシン構成ファイルを使用して、そのコンピューターに固有のアセンブリ バインディング制限を指定できます。</span><span class="sxs-lookup"><span data-stu-id="468d8-190">This file can be used by administrators to specify assembly binding restrictions that are local to that computer.</span></span> <span data-ttu-id="468d8-191">マシン構成ファイル内の設定は、ほかのすべての構成設定に優先します。ただし、これは、他のすべての構成設定をこのマシン構成ファイルに配置する必要があるという意味ではありません。</span><span class="sxs-lookup"><span data-stu-id="468d8-191">The settings in the machine configuration file take precedence over all other configuration settings; however, this does not mean that all configuration settings should be put in this file.</span></span> <span data-ttu-id="468d8-192">管理者ポリシー ファイルによって決定されるバージョンは最終的であり、オーバーライドすることはできません。</span><span class="sxs-lookup"><span data-stu-id="468d8-192">The version determined by the administrator policy file is final, and cannot be overridden.</span></span> <span data-ttu-id="468d8-193">Machine.config ファイル内に指定されたオーバーライドは、すべてのアプリケーションに作用します。</span><span class="sxs-lookup"><span data-stu-id="468d8-193">Overrides specified in the Machine.config file affect all applications.</span></span> <span data-ttu-id="468d8-194">構成ファイルの詳細については、「 [構成ファイルを使用してアプリを構成する方法](../configure-apps/index.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="468d8-194">For more information about configuration files, see [Configuring Apps by using Configuration Files](../configure-apps/index.md).</span></span>

<a name="step2"></a> 

## <a name="step-2-checking-for-previously-referenced-assemblies"></a><span data-ttu-id="468d8-195">手順 2: 前に参照したアセンブリの検索</span><span class="sxs-lookup"><span data-stu-id="468d8-195">Step 2: Checking for Previously Referenced Assemblies</span></span>

<span data-ttu-id="468d8-196">要求されたアセンブリが以前の呼び出しでも要求されていた場合、共通言語ランタイムは既に読み込まれているアセンブリを使用します。</span><span class="sxs-lookup"><span data-stu-id="468d8-196">If the requested assembly has also been requested in previous calls, the common language runtime uses the assembly that is already loaded.</span></span> <span data-ttu-id="468d8-197">アプリケーションを構成するアセンブリの名前付けの場合、これが影響を及ぼすこともあります。</span><span class="sxs-lookup"><span data-stu-id="468d8-197">This can have ramifications when naming assemblies that make up an application.</span></span> <span data-ttu-id="468d8-198">アセンブリの名前付けの詳細については、「 [アセンブリ名](../../standard/assembly/names.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="468d8-198">For more information about naming assemblies, see [Assembly Names](../../standard/assembly/names.md).</span></span>

<span data-ttu-id="468d8-199">アセンブリに対する前の要求が失敗している場合、そのアセンブリに対する後続の要求は、アセンブリの読み込みを試みることなく即座に失敗します。</span><span class="sxs-lookup"><span data-stu-id="468d8-199">If a previous request for the assembly failed, subsequent requests for the assembly are failed immediately without attempting to load the assembly.</span></span> <span data-ttu-id="468d8-200">.NET Framework Version 2.0 からは、アセンブリ バインディング エラーがキャッシュされ、キャッシュされた情報を使用してアセンブリの読み込みを試みるかどうかが判断されるようになりました。</span><span class="sxs-lookup"><span data-stu-id="468d8-200">Starting with the .NET Framework version 2.0, assembly binding failures are cached, and the cached information is used to determine whether to attempt to load the assembly.</span></span>

> [!NOTE]
> <span data-ttu-id="468d8-201">バインディング エラーをキャッシュしない .NET Framework Version 1.0 および 1.1 の動作に戻すには、構成ファイルに [\<disableCachingBindingFailures> 要素](../configure-apps/file-schema/runtime/disablecachingbindingfailures-element.md)を追加します。</span><span class="sxs-lookup"><span data-stu-id="468d8-201">To revert to the behavior of the .NET Framework versions 1.0 and 1.1, which did not cache binding failures, include the [\<disableCachingBindingFailures> Element](../configure-apps/file-schema/runtime/disablecachingbindingfailures-element.md) in your configuration file.</span></span>

<a name="step3"></a>

## <a name="step-3-checking-the-global-assembly-cache"></a><span data-ttu-id="468d8-202">手順 3: グローバル アセンブリ キャッシュのチェック</span><span class="sxs-lookup"><span data-stu-id="468d8-202">Step 3: Checking the Global Assembly Cache</span></span>

<span data-ttu-id="468d8-203">厳密な名前の付いたアセンブリの場合、バインディング プロセスは、続いてグローバル アセンブリ キャッシュ内を調べます。</span><span class="sxs-lookup"><span data-stu-id="468d8-203">For strong-named assemblies, the binding process continues by looking in the global assembly cache.</span></span> <span data-ttu-id="468d8-204">グローバル アセンブリ キャッシュには、コンピューター上の複数のアプリケーションで使用できるアセンブリが格納されています。</span><span class="sxs-lookup"><span data-stu-id="468d8-204">The global assembly cache stores assemblies that can be used by several applications on a computer.</span></span> <span data-ttu-id="468d8-205">グローバル アセンブリ キャッシュに配置するアセンブリには、すべて厳密な名前を付ける必要があります。</span><span class="sxs-lookup"><span data-stu-id="468d8-205">All assemblies in the global assembly cache must have strong names.</span></span>

<a name="step4"></a>

## <a name="step-4-locating-the-assembly-through-codebases-or-probing"></a><span data-ttu-id="468d8-206">手順 4: コードベースまたはプローブによるアセンブリの検索</span><span class="sxs-lookup"><span data-stu-id="468d8-206">Step 4: Locating the Assembly through Codebases or Probing</span></span>

<span data-ttu-id="468d8-207">共通言語ランタイムは、呼び出し元アセンブリの参照および構成ファイル内の情報を使用して正しいアセンブリ バージョンを決定した後、およびグローバル アセンブリ キャッシュ内をチェック (厳密な名前が付いたアセンブリの場合だけ) した後で、アセンブリの検索を試みます。</span><span class="sxs-lookup"><span data-stu-id="468d8-207">After the correct assembly version has been determined by using the information in the calling assembly's reference and in the configuration files, and after it has checked in the global assembly cache (only for strong-named assemblies), the common language runtime attempts to find the assembly.</span></span> <span data-ttu-id="468d8-208">アセンブリを検索するプロセスは、次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="468d8-208">The process of locating an assembly involves the following steps:</span></span>

1. <span data-ttu-id="468d8-209">[\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) 要素は、アプリケーション構成ファイルに格納されている場合、ランタイムはこの要素に指定されている場所を調べます。</span><span class="sxs-lookup"><span data-stu-id="468d8-209">If a [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element is found in the application configuration file, the runtime checks the specified location.</span></span> <span data-ttu-id="468d8-210">一致するアセンブリが見つかった場合は、そのアセンブリが使用され、プローブは実行されません。</span><span class="sxs-lookup"><span data-stu-id="468d8-210">If a match is found, that assembly is used and no probing occurs.</span></span> <span data-ttu-id="468d8-211">指定されている場所でアセンブリが見つからなかった場合、バインド要求は失敗します。</span><span class="sxs-lookup"><span data-stu-id="468d8-211">If the assembly is not found there, the binding request fails.</span></span>

2. <span data-ttu-id="468d8-212">次に、ランタイムは、後でこのセクションで指定する規則に従って、参照先アセンブリをプローブします。</span><span class="sxs-lookup"><span data-stu-id="468d8-212">The runtime then probes for the referenced assembly using the rules specified later in this section.</span></span>

> [!NOTE]
> <span data-ttu-id="468d8-213">アセンブリがディレクトリ内に複数バージョンあり、特定バージョンのアセンブリを参照する場合は、[\<probing>](../configure-apps/file-schema/runtime/probing-element.md) 要素の `privatePath` 属性ではなく [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) 要素を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="468d8-213">If you have multiple versions of an assembly in a directory and you want to reference a particular version of that assembly, you must use the [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element instead of the `privatePath` attribute of the [\<probing>](../configure-apps/file-schema/runtime/probing-element.md) element.</span></span> <span data-ttu-id="468d8-214">[\<probing>](../configure-apps/file-schema/runtime/probing-element.md) 要素を使用すると、ランタイムは、参照されている単純なアセンブリ名に一致するアセンブリを初めて検出した時点で、それが適切な一致かどうかに関係なくプローブを停止します。</span><span class="sxs-lookup"><span data-stu-id="468d8-214">If you use the [\<probing>](../configure-apps/file-schema/runtime/probing-element.md) element, the runtime stops probing the first time it finds an assembly that matches the simple assembly name referenced, whether it is a correct match or not.</span></span> <span data-ttu-id="468d8-215">適切な一致である場合は、そのアセンブリが使用されます。</span><span class="sxs-lookup"><span data-stu-id="468d8-215">If it is a correct match, that assembly is used.</span></span> <span data-ttu-id="468d8-216">適切な一致でない場合、プローブは停止し、バインディングは失敗します。</span><span class="sxs-lookup"><span data-stu-id="468d8-216">If it is not a correct match, probing stops and binding fails.</span></span>

### <a name="locating-the-assembly-through-codebases"></a><span data-ttu-id="468d8-217">コードベースによるアセンブリの検索</span><span class="sxs-lookup"><span data-stu-id="468d8-217">Locating the Assembly through Codebases</span></span>

<span data-ttu-id="468d8-218">コードベース情報は、構成ファイルで [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) 要素を使用して指定できます。</span><span class="sxs-lookup"><span data-stu-id="468d8-218">Codebase information can be provided by using a [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element in a configuration file.</span></span> <span data-ttu-id="468d8-219">コードベースは、ランタイムが参照先アセンブリのプローブを試みる前に、常にチェックされます。</span><span class="sxs-lookup"><span data-stu-id="468d8-219">This codebase is always checked before the runtime attempts to probe for the referenced assembly.</span></span> <span data-ttu-id="468d8-220">最終バージョン リダイレクトを含む発行者ポリシー ファイルに [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) 要素も含まれている場合、その [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) 要素が使用されます。</span><span class="sxs-lookup"><span data-stu-id="468d8-220">If a publisher policy file containing the final version redirect also contains a [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element, that [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element is the one that is used.</span></span> <span data-ttu-id="468d8-221">たとえば、アプリケーション構成ファイルに [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) 要素が指定されていて、アプリケーション情報をオーバーライドする発行者ポリシー ファイルにも [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) 要素が指定されている場合、発行者ポリシー ファイルの [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) 要素が使用されます。</span><span class="sxs-lookup"><span data-stu-id="468d8-221">For example, if your application configuration file specifies a [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element, and a publisher policy file that is overriding the application information also specifies a [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element, the [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element in the publisher policy file is used.</span></span>

<span data-ttu-id="468d8-222">一致が [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) 要素で指定された場所に見つからなかった場合、バインド要求は失敗し、その後の手順は実行されません。</span><span class="sxs-lookup"><span data-stu-id="468d8-222">If no match is found at the location specified by the [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element, the bind request fails and no further steps are taken.</span></span> <span data-ttu-id="468d8-223">ランタイムは、アセンブリが呼び出し元アセンブリの検索条件と一致すると判断したときにそのアセンブリを使用します。</span><span class="sxs-lookup"><span data-stu-id="468d8-223">If the runtime determines that an assembly matches the calling assembly's criteria, it uses that assembly.</span></span> <span data-ttu-id="468d8-224">[\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) の特定の要素に指定されたファイルが読み込まれると、ランタイムは、名前、バージョン、カルチャ、および公開キーが呼び出し元アセンブリの参照と一致するかどうかをチェックします。</span><span class="sxs-lookup"><span data-stu-id="468d8-224">When the file specified by the given [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element is loaded, the runtime checks to make sure that the name, version, culture, and public key match the calling assembly's reference.</span></span>

> [!NOTE]
> <span data-ttu-id="468d8-225">アプリケーションのルート ディレクトリの外部で参照されているアセンブリは、厳密な名前が付けられていなければならず、グローバル アセンブリ キャッシュにインストールするか、または [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) 要素を使用して指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="468d8-225">Referenced assemblies outside the application's root directory must have strong names and must either be installed in the global assembly cache or specified using the [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element.</span></span>

### <a name="locating-the-assembly-through-probing"></a><span data-ttu-id="468d8-226">プローブによるアセンブリの検索</span><span class="sxs-lookup"><span data-stu-id="468d8-226">Locating the Assembly through Probing</span></span>

<span data-ttu-id="468d8-227">アプリケーション構成ファイルに [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) 要素がない場合、ランタイムは 4 個の条件を使用してアセンブリをプローブします。</span><span class="sxs-lookup"><span data-stu-id="468d8-227">If there is no [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element in the application configuration file, the runtime probes for the assembly using four criteria:</span></span>

- <span data-ttu-id="468d8-228">アプリケーション ベース (アプリケーションが実行されるルート位置)。</span><span class="sxs-lookup"><span data-stu-id="468d8-228">Application base, which is the root location where the application is being executed.</span></span>

- <span data-ttu-id="468d8-229">カルチャ (参照先アセンブリのカルチャ属性)。</span><span class="sxs-lookup"><span data-stu-id="468d8-229">Culture, which is the culture attribute of the assembly being referenced.</span></span>

- <span data-ttu-id="468d8-230">名前 (参照先アセンブリの名前)。</span><span class="sxs-lookup"><span data-stu-id="468d8-230">Name, which is the name of the referenced assembly.</span></span>

- <span data-ttu-id="468d8-231">[\<probing>](../configure-apps/file-schema/runtime/probing-element.md) 要素の `privatePath` 属性 (ルート位置の下にあるサブディレクトリのユーザー定義の一覧)。</span><span class="sxs-lookup"><span data-stu-id="468d8-231">The `privatePath` attribute of the [\<probing>](../configure-apps/file-schema/runtime/probing-element.md) element, which is the user-defined list of subdirectories under the root location.</span></span> <span data-ttu-id="468d8-232">この場所は、アプリケーション ドメインの <xref:System.AppDomainSetup.PrivateBinPath?displayProperty=nameWithType> プロパティを使用して、アプリケーション構成ファイルとマネージド コード内に指定できます。</span><span class="sxs-lookup"><span data-stu-id="468d8-232">This location can be specified in the application configuration file and in managed code using the <xref:System.AppDomainSetup.PrivateBinPath?displayProperty=nameWithType> property for an application domain.</span></span> <span data-ttu-id="468d8-233">マネージド コード内に指定した場合は、マネージド コード `privatePath` が先にプローブされ、その後でアプリケーション構成ファイルに指定したパスがプローブされます。</span><span class="sxs-lookup"><span data-stu-id="468d8-233">When specified in managed code, the managed code `privatePath` is probed first, followed by the path specified in the application configuration file.</span></span>

#### <a name="probing-the-application-base-and-culture-directories"></a><span data-ttu-id="468d8-234">アプリケーション ベース ディレクトリとカルチャ ディレクトリのプローブ</span><span class="sxs-lookup"><span data-stu-id="468d8-234">Probing the Application Base and Culture Directories</span></span>

<span data-ttu-id="468d8-235">ランタイムは、常に、アプリケーションのベース (URL またはコンピューター上のアプリケーションのルート ディレクトリのいずれか) からプローブを開始します。</span><span class="sxs-lookup"><span data-stu-id="468d8-235">The runtime always begins probing in the application's base, which can be either a URL or the application's root directory on a computer.</span></span> <span data-ttu-id="468d8-236">アプリケーション ベースで参照先アセンブリが見つからず、カルチャ情報が提供されていない場合、ランタイムはそのアセンブリ名を持つすべてのサブディレクトリ内を検索します。</span><span class="sxs-lookup"><span data-stu-id="468d8-236">If the referenced assembly is not found in the application base and no culture information is provided, the runtime searches any subdirectories with the assembly name.</span></span> <span data-ttu-id="468d8-237">プローブされるディレクトリは、次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="468d8-237">The directories probed include:</span></span>

- <span data-ttu-id="468d8-238">[application base] / [assembly name].dll</span><span class="sxs-lookup"><span data-stu-id="468d8-238">[application base] / [assembly name].dll</span></span>

- <span data-ttu-id="468d8-239">[application base] / [assembly name] / [assembly name].dll</span><span class="sxs-lookup"><span data-stu-id="468d8-239">[application base] / [assembly name] / [assembly name].dll</span></span>

<span data-ttu-id="468d8-240">参照先アセンブリについてのカルチャ情報が指定されている場合は、次のディレクトリだけがプローブされます。</span><span class="sxs-lookup"><span data-stu-id="468d8-240">If culture information is specified for the referenced assembly, only the following directories are probed:</span></span>

- <span data-ttu-id="468d8-241">[application base] / [culture] / [assembly name].dll</span><span class="sxs-lookup"><span data-stu-id="468d8-241">[application base] / [culture] / [assembly name].dll</span></span>

- <span data-ttu-id="468d8-242">[application base] / [culture] / [assembly name] / [assembly name].dll</span><span class="sxs-lookup"><span data-stu-id="468d8-242">[application base] / [culture] / [assembly name] / [assembly name].dll</span></span>

#### <a name="probing-with-the-privatepath-attribute"></a><span data-ttu-id="468d8-243">privatePath 属性を使用したプローブ</span><span class="sxs-lookup"><span data-stu-id="468d8-243">Probing with the privatePath Attribute</span></span>

<span data-ttu-id="468d8-244">参照アセンブリの名前をカルチャ サブディレクトリとサブディレクトリの他に、ランタイムは、[\<probing>](../configure-apps/file-schema/runtime/probing-element.md) 要素の `privatePath` 属性を使用して指定されたディレクトリをプローブします。</span><span class="sxs-lookup"><span data-stu-id="468d8-244">In addition to the culture subdirectories and the subdirectories named for the referenced assembly, the runtime also probes directories specified using the `privatePath` attribute of the [\<probing>](../configure-apps/file-schema/runtime/probing-element.md) element.</span></span> <span data-ttu-id="468d8-245">`privatePath` 属性を使用して指定するディレクトリは、アプリケーションのルート ディレクトリのサブディレクトリである必要があります。</span><span class="sxs-lookup"><span data-stu-id="468d8-245">The directories specified using the `privatePath` attribute must be subdirectories of the application's root directory.</span></span> <span data-ttu-id="468d8-246">プローブされるディレクトリは、参照先アセンブリ要求にカルチャ情報が含まれているかどうかによって異なります。</span><span class="sxs-lookup"><span data-stu-id="468d8-246">The directories probed vary depending on whether culture information is included in the referenced assembly request.</span></span>

<span data-ttu-id="468d8-247">ランタイムは、参照されている単純なアセンブリ名に一致するアセンブリを最初に見つけた時点で、それが適切な一致かどうかに関係なく、プローブを停止します。</span><span class="sxs-lookup"><span data-stu-id="468d8-247">The runtime stops probing the first time it finds an assembly that matches the simple assembly name referenced, whether it is a correct match or not.</span></span> <span data-ttu-id="468d8-248">適切な一致である場合は、そのアセンブリが使用されます。</span><span class="sxs-lookup"><span data-stu-id="468d8-248">If it is a correct match, that assembly is used.</span></span> <span data-ttu-id="468d8-249">適切な一致でない場合、プローブは停止し、バインディングは失敗します。</span><span class="sxs-lookup"><span data-stu-id="468d8-249">If it is not a correct match, probing stops and binding fails.</span></span>

<span data-ttu-id="468d8-250">カルチャが含まれている場合は、次のディレクトリがプローブされます。</span><span class="sxs-lookup"><span data-stu-id="468d8-250">If culture is included, the following directories are probed:</span></span>

- <span data-ttu-id="468d8-251">[application base] / [binpath] / [culture] / [assembly name].dll</span><span class="sxs-lookup"><span data-stu-id="468d8-251">[application base] / [binpath] / [culture] / [assembly name].dll</span></span>

- <span data-ttu-id="468d8-252">[application base] / [binpath] / [culture] / [assembly name] / [assembly name].dll</span><span class="sxs-lookup"><span data-stu-id="468d8-252">[application base] / [binpath] / [culture] / [assembly name] / [assembly name].dll</span></span>

<span data-ttu-id="468d8-253">カルチャ情報が含まれていない場合は、次のディレクトリがプローブされます。</span><span class="sxs-lookup"><span data-stu-id="468d8-253">If culture information is not included, the following directories are probed:</span></span>

- <span data-ttu-id="468d8-254">[application base] / [binpath] / [assembly name].dll</span><span class="sxs-lookup"><span data-stu-id="468d8-254">[application base] / [binpath] / [assembly name].dll</span></span>

- <span data-ttu-id="468d8-255">[application base] / [binpath] / [assembly name] / [assembly name].dll</span><span class="sxs-lookup"><span data-stu-id="468d8-255">[application base] / [binpath] / [assembly name] / [assembly name].dll</span></span>

#### <a name="probing-examples"></a><span data-ttu-id="468d8-256">プローブの例</span><span class="sxs-lookup"><span data-stu-id="468d8-256">Probing Examples</span></span>

<span data-ttu-id="468d8-257">次の情報が指定されています。</span><span class="sxs-lookup"><span data-stu-id="468d8-257">Given the following information:</span></span>

- <span data-ttu-id="468d8-258">参照先アセンブリの名前: myAssembly</span><span class="sxs-lookup"><span data-stu-id="468d8-258">Referenced assembly name: myAssembly</span></span>

- <span data-ttu-id="468d8-259">アプリケーション ルート ディレクトリ: `http://www.code.microsoft.com`</span><span class="sxs-lookup"><span data-stu-id="468d8-259">Application root directory: `http://www.code.microsoft.com`</span></span>

- <span data-ttu-id="468d8-260">構成ファイルの [\<probing>](../configure-apps/file-schema/runtime/probing-element.md) 要素による指定: bin</span><span class="sxs-lookup"><span data-stu-id="468d8-260">[\<probing>](../configure-apps/file-schema/runtime/probing-element.md) element in configuration file specifies: bin</span></span>

- <span data-ttu-id="468d8-261">カルチャ: de</span><span class="sxs-lookup"><span data-stu-id="468d8-261">Culture: de</span></span>

<span data-ttu-id="468d8-262">ランタイムは、次の URL をプローブします。</span><span class="sxs-lookup"><span data-stu-id="468d8-262">The runtime probes the following URLs:</span></span>

- `http://www.code.microsoft.com/de/myAssembly.dll`

- `http://www.code.microsoft.com/de/myAssembly/myAssembly.dll`

- `http://www.code.microsoft.com/bin/de/myAssembly.dll`

- `http://www.code.microsoft.com/bin/de/myAssembly/myAssembly.dll`

##### <a name="multiple-assemblies-with-the-same-name"></a><span data-ttu-id="468d8-263">同じ名前の複数のアセンブリ</span><span class="sxs-lookup"><span data-stu-id="468d8-263">Multiple Assemblies with the Same Name</span></span>

<span data-ttu-id="468d8-264">同じ名前を持つ複数のアセンブリを設定する方法を次の例に示します。</span><span class="sxs-lookup"><span data-stu-id="468d8-264">The following example shows how to configure multiple assemblies with the same name.</span></span>

```xml
<dependentAssembly>
   <assemblyIdentity name="Server" publicKeyToken="c0305c36380ba429" />
   <codeBase version="1.0.0.0" href="v1/Server.dll" />
   <codeBase version="2.0.0.0" href="v2/Server.dll" />
</dependentAssembly>
```

#### <a name="other-locations-probed"></a><span data-ttu-id="468d8-265">プローブされるその他の場所</span><span class="sxs-lookup"><span data-stu-id="468d8-265">Other Locations Probed</span></span>

<span data-ttu-id="468d8-266">現在のバインディング コンテキストを使用して、アセンブリの場所を特定することもできます。</span><span class="sxs-lookup"><span data-stu-id="468d8-266">Assembly location can also be determined using the current binding context.</span></span> <span data-ttu-id="468d8-267">この方法が最もよく使用されるのは、 <xref:System.Reflection.Assembly.LoadFrom%2A?displayProperty=nameWithType> メソッドが使用されている場合と、COM 相互運用のシナリオの場合です。</span><span class="sxs-lookup"><span data-stu-id="468d8-267">This most often occurs when the <xref:System.Reflection.Assembly.LoadFrom%2A?displayProperty=nameWithType> method is used and in COM interop scenarios.</span></span> <span data-ttu-id="468d8-268">アセンブリが <xref:System.Reflection.Assembly.LoadFrom%2A> メソッドを使用して別のアセンブリを参照している場合は、呼び出し元アセンブリの場所が、参照先アセンブリを検索する場所についてのヒントと見なされます。</span><span class="sxs-lookup"><span data-stu-id="468d8-268">If an assembly uses the <xref:System.Reflection.Assembly.LoadFrom%2A> method to reference another assembly, the calling assembly's location is considered to be a hint about where to find the referenced assembly.</span></span> <span data-ttu-id="468d8-269">一致するものが見つかった場合は、そのアセンブリが読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="468d8-269">If a match is found, that assembly is loaded.</span></span> <span data-ttu-id="468d8-270">一致するものが見つからない場合は、ランタイムは、その検索セマンティクスを続行した後、Windows Installer に問い合わせて、アセンブリを提供するように求めます。</span><span class="sxs-lookup"><span data-stu-id="468d8-270">If no match is found, the runtime continues with its search semantics and then queries the Windows Installer to provide the assembly.</span></span> <span data-ttu-id="468d8-271">バインド要求と一致するアセンブリが提供されない場合は、例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="468d8-271">If no assembly is provided that matches the binding request, an exception is thrown.</span></span> <span data-ttu-id="468d8-272">この例外は、型を参照していた場合はマネージド コード内の <xref:System.TypeLoadException> であり、読み込もうとするアセンブリが見つからなかった場合は、 <xref:System.IO.FileNotFoundException> です。</span><span class="sxs-lookup"><span data-stu-id="468d8-272">This exception is a <xref:System.TypeLoadException> in managed code if a type was referenced, or a <xref:System.IO.FileNotFoundException> if an assembly being loaded was not found.</span></span>

<span data-ttu-id="468d8-273">たとえば、Assembly1 が Assembly2 を参照し、Assembly1 が `http://www.code.microsoft.com/utils` からダウンロードされていた場合、この場所が、Assembly2.dll を検索する場所についてのヒントと見なされます。</span><span class="sxs-lookup"><span data-stu-id="468d8-273">For example, if Assembly1 references Assembly2 and Assembly1 was downloaded from `http://www.code.microsoft.com/utils`, that location is considered to be a hint about where to find Assembly2.dll.</span></span> <span data-ttu-id="468d8-274">次に、ランタイムは `http://www.code.microsoft.com/utils/Assembly2.dll` と `http://www.code.microsoft.com/utils/Assembly2/Assembly2.dll` のアセンブリをプローブします。</span><span class="sxs-lookup"><span data-stu-id="468d8-274">The runtime then probes for the assembly in `http://www.code.microsoft.com/utils/Assembly2.dll` and `http://www.code.microsoft.com/utils/Assembly2/Assembly2.dll`.</span></span> <span data-ttu-id="468d8-275">どちらの場所でも Assembly2 が見つからなかった場合は、ランタイムは Windows Installer に問い合わせます。</span><span class="sxs-lookup"><span data-stu-id="468d8-275">If Assembly2 is not found at either of those locations, the runtime queries the Windows Installer.</span></span>

## <a name="see-also"></a><span data-ttu-id="468d8-276">関連項目</span><span class="sxs-lookup"><span data-stu-id="468d8-276">See also</span></span>

- [<span data-ttu-id="468d8-277">アセンブリの読み込みのベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="468d8-277">Best Practices for Assembly Loading</span></span>](best-practices-for-assembly-loading.md)
- [<span data-ttu-id="468d8-278">配置</span><span class="sxs-lookup"><span data-stu-id="468d8-278">Deployment</span></span>](index.md)
