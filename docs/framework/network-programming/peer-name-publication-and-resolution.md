---
title: ピア名の公開と解決
ms.date: 03/30/2017
ms.assetid: f0370e08-9fa6-4ee5-ab78-9a58a20a7da2
ms.openlocfilehash: 4a0787972a61f5700d1e8728be96db8ef9ee749e
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/15/2020
ms.locfileid: "64623200"
---
# <a name="peer-name-publication-and-resolution"></a><span data-ttu-id="56744-102">ピア名の公開と解決</span><span class="sxs-lookup"><span data-stu-id="56744-102">Peer Name Publication and Resolution</span></span>

## <a name="publishing-a-peer-name"></a><span data-ttu-id="56744-103">ピア名の公開</span><span class="sxs-lookup"><span data-stu-id="56744-103">Publishing a peer name</span></span>  

 <span data-ttu-id="56744-104">新しい PNRP ID を発行するために、ピアは次の処理を実行します。</span><span class="sxs-lookup"><span data-stu-id="56744-104">To publish a new PNRP ID, a peer performs the following:</span></span>  
  
- <span data-ttu-id="56744-105">PNRP 発行メッセージをその近くのキャッシュ (キャッシュの最下位レベル内に PNRP ID が登録されているピア) に送信してキャッシュをシードします。</span><span class="sxs-lookup"><span data-stu-id="56744-105">Sends PNRP publication messages to its cache neighbors (the peers that have registered PNRP IDs in the lowest level of the cache) to seed their caches.</span></span>  
  
- <span data-ttu-id="56744-106">クラウド内で近くのノード以外の任意のノードを選択し、その P2P ID の PNRP 名前解決要求をそれらのノードに送信します。</span><span class="sxs-lookup"><span data-stu-id="56744-106">Chooses random nodes in the cloud that are not its neighbors and sends them PNRP name resolution requests for its own P2P ID.</span></span> <span data-ttu-id="56744-107">その結果、エンドポイント調査プロセスによって、発行側ピアの PNRP ID が格納されている、クラウド内の任意のノードのキャッシュがシードされます。</span><span class="sxs-lookup"><span data-stu-id="56744-107">The resulting endpoint determination process seeds the caches of random nodes in the cloud with the PNRP ID of the publishing peer.</span></span>  
  
<span data-ttu-id="56744-108">PNRP バージョン 2 ノードは、他の P2P ID だけを解決している場合、PNRP ID を発行しません。</span><span class="sxs-lookup"><span data-stu-id="56744-108">PNRP version 2 nodes do not publish PNRP IDs if they are only resolving other P2P IDs.</span></span> <span data-ttu-id="56744-109">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\PeerNet\PNRP\IPV6-Global\SearchOnly のレジストリ値を 1 (REG_DWORD 型) に指定すると、ピアは名前解決にだけ PNRP を使用し、名前発行には使用しません。</span><span class="sxs-lookup"><span data-stu-id="56744-109">The HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\PeerNet\PNRP\IPV6-Global\SearchOnly=1 registry value (REG_DWORD type) specifies that peers only use PNRP for name resolution, never for name publication.</span></span> <span data-ttu-id="56744-110">このレジストリ値は、グループ ポリシーを使用して構成することもできます。</span><span class="sxs-lookup"><span data-stu-id="56744-110">This registry value can also be configured through Group Policy.</span></span>  
  
## <a name="resolving-a-peer-name"></a><span data-ttu-id="56744-111">ピア名の解決</span><span class="sxs-lookup"><span data-stu-id="56744-111">Resolving a peer name</span></span>

 <span data-ttu-id="56744-112">PNRP ネットワークまたはクラウドで他のピアを検索するプロセスは、2 つのフェーズで構成されます。</span><span class="sxs-lookup"><span data-stu-id="56744-112">Locating other peers in a PNRP network or cloud is a process comprised of two phases:</span></span>  
  
1. <span data-ttu-id="56744-113">エンドポイント調査</span><span class="sxs-lookup"><span data-stu-id="56744-113">Endpoint Determination</span></span>  
  
2. <span data-ttu-id="56744-114">PNRP ID 解決</span><span class="sxs-lookup"><span data-stu-id="56744-114">PNRP ID Resolution</span></span>  
  
 <span data-ttu-id="56744-115">エンドポイント調査フェーズでは、別のコンピューター上のサービスの PNRP ID を解決しようとするピアは、そのリモート ピアの IPv6 アドレスを確認します。</span><span class="sxs-lookup"><span data-stu-id="56744-115">In the endpoint determination phase, a peer that is attempting to resolve the PNRP ID of a service on another computer determines the IPv6 address of that remote peer.</span></span>  <span data-ttu-id="56744-116">リモート ピアは、コンピューターやサービスの PNRP ID を公開したピア、またはその ID に関連付けられているピアです。</span><span class="sxs-lookup"><span data-stu-id="56744-116">The remote peer is the one that published, or is associated with, the PNRP ID of the computer or service.</span></span>  
  
 <span data-ttu-id="56744-117">リモート エンドポイントが PNRP クラウドに登録されていることを確認した後、PNRP ID 解決フェーズの要求側ピアは、そのピア エンドポイントに要求を送信して、目的のサービスの PNRP ID を調べます。</span><span class="sxs-lookup"><span data-stu-id="56744-117">After confirming that the remote endpoint has been registered into the PNRP cloud, the requesting peer in the PNRP ID resolution phase sends a request to that peer endpoint for the PNRP ID of the desired service.</span></span> <span data-ttu-id="56744-118">エンドポイントは、サービスの PNRP ID を確認する応答、コメント、および要求側ピアがその後の通信に使用できる最大 4 KB の追加情報を送信します。</span><span class="sxs-lookup"><span data-stu-id="56744-118">The endpoint sends a reply confirming the PNRP ID of the service, a comment, and up to 4 kilobytes of additional information that the requesting peer can use for future communication.</span></span> <span data-ttu-id="56744-119">たとえば、目的のエンドポイントがゲーム サーバーの場合、追加のピア名レコード データには、ゲーム、プレー レベル、現在のプレーヤー人数などの情報を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="56744-119">For example, if the desired endpoint is a gaming server, the additional peer name record data can contain information about the game, the level of play, and the current number of players.</span></span>  
  
 <span data-ttu-id="56744-120">エンドポイントを決定するフェーズでは、PNRP は反復プロセスを使用して、PNRP ID を発行したノードを探索します。その場合、解決を実行するノードが、ターゲット PNRP ID に近い方のノードに接続します。</span><span class="sxs-lookup"><span data-stu-id="56744-120">In the endpoint determination phase, PNRP uses an iterative process for locating the node that published the PNRP ID, in which the node performing the resolution is responsible for contacting nodes that are successively closer to the target PNRP ID.</span></span>  
  
 <span data-ttu-id="56744-121">PNRP で名前解決を実行するために、ピアは、キャッシュ内のエントリを調べてターゲット PNRP ID と一致するエントリを探します。</span><span class="sxs-lookup"><span data-stu-id="56744-121">To perform name resolution in PNRP, the peer examines the entries in its own cache for an entry that matches the target PNRP ID.</span></span> <span data-ttu-id="56744-122">見つかった場合、ピアは PNRP 要求メッセージを要求側ピアに送信して応答を待ちます。</span><span class="sxs-lookup"><span data-stu-id="56744-122">If found, the peer sends a PNRP Request message to the peer and waits for a response.</span></span> <span data-ttu-id="56744-123">PNRP ID のエントリが見つからない場合、ピアは、PNRP 要求メッセージを、ターゲット PNRP ID と最も近い PNRP ID を持つエントリに対応するピアに送信します。</span><span class="sxs-lookup"><span data-stu-id="56744-123">If an entry for the PNRP ID is not found, the peer sends a PNRP Request message to the peer that corresponds to the entry that has a PNRP ID that most closely matches the target PNRP ID.</span></span> <span data-ttu-id="56744-124">PNRP 要求メッセージを受信したノードは、キャッシュを調べて以下の処理を実行します。</span><span class="sxs-lookup"><span data-stu-id="56744-124">The node that receives the PNRP Request message examines its own cache and does the following:</span></span>  
  
- <span data-ttu-id="56744-125">PNRP ID が見つかると、要求されたエンドポイントは要求側ピアに直接応答します。</span><span class="sxs-lookup"><span data-stu-id="56744-125">If the PNRP ID is found, the requested endpoint peer replies directly to the requesting peer.</span></span>  
  
- <span data-ttu-id="56744-126">PNRP ID が見つからず、ターゲット PNRP ID に近い PNRP ID がキャッシュ内にあった場合、要求された側のピアは、ターゲット PNRP ID により近い PNRP ID を持つエントリを表すピアの IPv6 アドレスを示した応答を要求側ピアに送信します。</span><span class="sxs-lookup"><span data-stu-id="56744-126">If the PNRP ID is not found and a PNRP ID in the cache is closer to the target PNRP ID, the requested peer sends a response to the requesting peer containing the IPv6 address of the peer that represents the entry with a PNRP ID that more closely matches the target PNRP ID.</span></span> <span data-ttu-id="56744-127">要求側ノードは、応答に示された IP アドレスを使用して、応答するかキャッシュを調べるために別の PNRP 要求メッセージを IPv6 アドレスに送信します。</span><span class="sxs-lookup"><span data-stu-id="56744-127">Using the IP address in the response, the requesting node sends another PNRP Request message to the IPv6 address to respond or examine its cache.</span></span>  
  
- <span data-ttu-id="56744-128">PNRP ID が見つからず、ターゲット PNRP ID に近い PNRP ID がキャッシュにもなかった場合、要求された側のピアは、この状態を示す応答を要求側ピアに送信します。</span><span class="sxs-lookup"><span data-stu-id="56744-128">If the PNRP ID is not found and there is no PNRP ID in its cache that is closer to the target PNRP ID, the requested peer sends the requesting peer a response that indicates this condition.</span></span> <span data-ttu-id="56744-129">その後、要求側ピアは 2 番目に近い PNRP ID を選択します。</span><span class="sxs-lookup"><span data-stu-id="56744-129">The requesting peer then chooses the next-closest PNRP ID.</span></span>  
  
<span data-ttu-id="56744-130">要求側ピアは連続反復手法でこのプロセスを続行し、最終的に、PNRP ID が登録されているノードを割り出します。</span><span class="sxs-lookup"><span data-stu-id="56744-130">The requesting peer continues this process with successive iterations, eventually locating the node that registered the PNRP ID.</span></span>  
  
 <span data-ttu-id="56744-131"><xref:System.Net.PeerToPeer> 名前空間内では、<xref:System.Net.PeerToPeer.PeerName> レコード (エンドポイントと、エンドポイントが通信する RNRP クラウドまたはメッシュ) の間に多対多の関係が存在します。</span><span class="sxs-lookup"><span data-stu-id="56744-131">Within the <xref:System.Net.PeerToPeer> namespace, there is a many-to-many relationship between the <xref:System.Net.PeerToPeer.PeerName> records that contain endpoints and PNRP clouds or meshes in which they communicate.</span></span> <span data-ttu-id="56744-132">重複しているか古くなったエントリ、または同じピア名を持つ複数のノードがある場合、PNRP ノードは <xref:System.Net.PeerToPeer.PeerNameResolver> クラスを使用して最新の情報を取得できます。</span><span class="sxs-lookup"><span data-stu-id="56744-132">When there are duplicate or stale entries, or multiple nodes with the same peer name, PNRP nodes can obtain current information using the <xref:System.Net.PeerToPeer.PeerNameResolver> class.</span></span> <span data-ttu-id="56744-133"><xref:System.Net.PeerToPeer.PeerNameResolver> のメソッドは、1 つのピア名を使用して、1 つのピア対多数のピア名レコードおよび同じ 1 つのピア対多数のクラウドにパースペクティブを簡素化します。</span><span class="sxs-lookup"><span data-stu-id="56744-133">The <xref:System.Net.PeerToPeer.PeerNameResolver> methods use a single peer name to simplify the perspective to one peer-to-many peer name records and the same one peer to many clouds.</span></span> <span data-ttu-id="56744-134">これは、リレーショナル テーブル結合を使用して実行されるクエリに似ています。</span><span class="sxs-lookup"><span data-stu-id="56744-134">This is similar to a query performed using a relational-table join.</span></span> <span data-ttu-id="56744-135">正常に完了した場合、リゾルバー オブジェクトは指定されたピア名の <xref:System.Net.PeerToPeer.PeerNameRecordCollection> を返します。</span><span class="sxs-lookup"><span data-stu-id="56744-135">Upon successful completion, the Resolver object returns a <xref:System.Net.PeerToPeer.PeerNameRecordCollection> for the specified peer name.</span></span>  <span data-ttu-id="56744-136">たとえば、クラウドによって順序付けられたとおりに、コレクション内のすべてのピア名レコードのピア名が表示されます。</span><span class="sxs-lookup"><span data-stu-id="56744-136">For example, a peer name would occur in all the peer name records in the collection, ordered by cloud.</span></span> <span data-ttu-id="56744-137">これらは、サポートしているデータが PNRP ベースのアプリケーションによって要求されるピア名のインスタンスです。</span><span class="sxs-lookup"><span data-stu-id="56744-137">These are the instances of the peer name whose supporting data may be requested by a PNRP-based application.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="56744-138">参照</span><span class="sxs-lookup"><span data-stu-id="56744-138">See also</span></span>

- <xref:System.Net.PeerToPeer>
