---
title: 統合 Windows 認証と拡張保護
ms.date: 03/30/2017
ms.assetid: 81731998-d5e7-49e4-ad38-c8e6d01689d0
ms.openlocfilehash: d69471f4be0f102381dee4fc5037e8f8b0c625c3
ms.sourcegitcommit: ee5b798427f81237a3c23d1fd81fff7fdc21e8d3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/28/2020
ms.locfileid: "84144852"
---
# <a name="integrated-windows-authentication-with-extended-protection"></a><span data-ttu-id="f62d7-102">統合 Windows 認証と拡張保護</span><span class="sxs-lookup"><span data-stu-id="f62d7-102">Integrated Windows Authentication with Extended Protection</span></span>
<span data-ttu-id="f62d7-103"><xref:System.Net> 名前空間および関連名前空間の <xref:System.Net.HttpWebRequest>、<xref:System.Net.HttpListener>、<xref:System.Net.Mail.SmtpClient>、<xref:System.Net.Security.SslStream>、<xref:System.Net.Security.NegotiateStream>、および関連クラスによる統合 Windows 認証の処理方法に影響を与える、機能強化が行われました。</span><span class="sxs-lookup"><span data-stu-id="f62d7-103">Enhancements were made that affect how integrated Windows authentication is handled by the <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Mail.SmtpClient>, <xref:System.Net.Security.SslStream>, <xref:System.Net.Security.NegotiateStream>, and related classes in the <xref:System.Net> and related namespaces.</span></span> <span data-ttu-id="f62d7-104">セキュリティ強化のため、拡張保護のサポートが追加されました。</span><span class="sxs-lookup"><span data-stu-id="f62d7-104">Support was added for extended protection to enhance security.</span></span>  
  
 <span data-ttu-id="f62d7-105">これらの変更は、これらのクラスを使用して Web 要求を作成し、統合 Windows 認証が使用されている応答を受信するアプリケーションに影響を及ぼす場合があります。</span><span class="sxs-lookup"><span data-stu-id="f62d7-105">These changes can affect applications that use these classes to make web requests and receive responses where integrated Windows authentication is used.</span></span> <span data-ttu-id="f62d7-106">この変更は、統合 Windows 認証を使用するように構成されている Web サーバーおよびクライアント アプリケーションにも影響を与える可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f62d7-106">This change can also impact web servers and client applications that are configured to use integrated Windows authentication.</span></span>  
  
 <span data-ttu-id="f62d7-107">これらの変更は、これらのクラスを使用して他の種類の要求を作成し、統合 Windows 認証が使用されている応答を受信するアプリケーションにも影響を及ぼす場合があります。</span><span class="sxs-lookup"><span data-stu-id="f62d7-107">These changes can also affect applications that use these classes to make other types of requests and receive responses where integrated Windows authentication is used.</span></span>  
  
 <span data-ttu-id="f62d7-108">拡張保護をサポートするための変更は、Windows 7 と Windows Server 2008 R2 でのアプリケーションでのみ使用できます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-108">The changes to support extended protection are available only for applications on Windows 7 and Windows Server 2008 R2.</span></span> <span data-ttu-id="f62d7-109">拡張保護機能は、Windows の以前のバージョンではご利用いただけません。</span><span class="sxs-lookup"><span data-stu-id="f62d7-109">The extended protection features are not available on earlier versions of Windows.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="f62d7-110">概要</span><span class="sxs-lookup"><span data-stu-id="f62d7-110">Overview</span></span>  
 <span data-ttu-id="f62d7-111">統合 Windows 認証の設計では、一部の資格情報のチャレンジ応答をユニバーサルにすることを許可しています。つまり、これらを再利用または転送することができます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-111">The design of integrated Windows authentication allows for some credential challenge responses to be universal, meaning they can be re-used or forwarded.</span></span> <span data-ttu-id="f62d7-112">チャレンジ応答は、少なくともターゲット固有の情報と、可能であればいくつかのチャネル固有の情報で構築する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f62d7-112">The challenge responses should be constructed at a minimum with target specific information and preferably also with some channel specific information.</span></span> <span data-ttu-id="f62d7-113">これによりサービスは拡張保護を提供して、資格情報のチャレンジ応答にサービス プリンシパル名 (SPN) などのサービス固有の情報が確実に含まれるようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-113">Services can then provide extended protection to ensure that credential challenge responses contain service specific information such as a Service Principal Name (SPN).</span></span> <span data-ttu-id="f62d7-114">資格情報の交換でこの情報を使用すると、不適切に使用されている可能性がある資格情報のチャレンジ応答の悪用に対してサービスの保護を強化することができます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-114">With this information in the credential exchanges, services are able to better protect against malicious use of credential challenge responses that might have been improperly used.</span></span>  
  
 <span data-ttu-id="f62d7-115">拡張保護の設計は、認証リレー攻撃を軽減することを目的とした認証プロトコルの拡張機能です。</span><span class="sxs-lookup"><span data-stu-id="f62d7-115">The extended protection design is an enhancement to authentication protocols designed to mitigate authentication relay attacks.</span></span> <span data-ttu-id="f62d7-116">これはチャネルとサービス バインディング情報の概念を中心に展開しています。</span><span class="sxs-lookup"><span data-stu-id="f62d7-116">It revolves around the concept of channel and service binding information.</span></span>  
  
 <span data-ttu-id="f62d7-117">全体的な目標は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="f62d7-117">The overall objectives are the following:</span></span>  
  
1. <span data-ttu-id="f62d7-118">拡張保護をサポートするためにクライアントが更新された場合、アプリケーションがチャネル バインディングとサービス バインディングの情報をサポートされるすべての認証プロトコルに提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f62d7-118">If the client is updated to support the extended protection, applications should supply a channel binding and service binding information to all supported authentication protocols.</span></span> <span data-ttu-id="f62d7-119">チャネル バインディング情報は、バインドするチャネル (TLS) がある場合にのみ提供できます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-119">Channel binding information can only be supplied when there is a channel (TLS) to bind to.</span></span> <span data-ttu-id="f62d7-120">サービス バインディング情報は、常に提供される必要があります。</span><span class="sxs-lookup"><span data-stu-id="f62d7-120">Service binding information should always be supplied.</span></span>  
  
2. <span data-ttu-id="f62d7-121">正しく構成されている更新されたサーバーは、チャネル バインディング情報およびサービス バインディング情報がクライアントの認証トークンにある場合にそれを検証し、チャネル バインディングが一致しない場合は、認証の試行を拒否する場合があります。</span><span class="sxs-lookup"><span data-stu-id="f62d7-121">Updated servers which are properly configured may verify the channel and service binding information when it is present in the client authentication token and reject the authentication attempt if the channel bindings do not match.</span></span> <span data-ttu-id="f62d7-122">展開シナリオによっては、サーバーはチャネル バインディング、サービス バインディングの一方または両方の検証ができます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-122">Depending on the deployment scenario, servers may verify channel binding, service binding or both.</span></span>  
  
3. <span data-ttu-id="f62d7-123">更新されたサーバーには、ポリシーに基づいて、チャネル バインディング情報を含まない下位クライアントの要求を承認または拒否することができます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-123">Updated servers have the ability to accept or reject down-level client requests that do not contain the channel binding information based on policy.</span></span>  
  
 <span data-ttu-id="f62d7-124">拡張保護で使用される情報は、次の 2 つの部分の一方または両方で構成されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-124">Information used by extended protection consists of one or both of the following two parts:</span></span>  
  
1. <span data-ttu-id="f62d7-125">チャネル バインディング トークンまたは CBT。</span><span class="sxs-lookup"><span data-stu-id="f62d7-125">A Channel Binding Token or CBT.</span></span>  
  
2. <span data-ttu-id="f62d7-126">サービス プリンシパル名 (SPN) 形式でのサービス バインディング情報。</span><span class="sxs-lookup"><span data-stu-id="f62d7-126">Service Binding information in the form of a Service Principal Name or SPN.</span></span>  
  
 <span data-ttu-id="f62d7-127">サービス バインディング情報は、特定のサービス エンドポイントを認証するクライアントの意思表示です。</span><span class="sxs-lookup"><span data-stu-id="f62d7-127">Service Binding information is an indication of a client’s intent to authenticate to a particular service endpoint.</span></span> <span data-ttu-id="f62d7-128">これは、次のプロパティを使用してクライアントからサーバーに伝達されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-128">It is communicated from client to server with the following properties:</span></span>  
  
- <span data-ttu-id="f62d7-129">SPN 値は、クライアント認証を実行するサーバーにクリア テキスト形式で提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f62d7-129">The SPN value must be available to the server performing client authentication in clear text form.</span></span>  
  
- <span data-ttu-id="f62d7-130">SPN の値はパブリックです。</span><span class="sxs-lookup"><span data-stu-id="f62d7-130">The value of the SPN is public.</span></span>  
  
- <span data-ttu-id="f62d7-131">SPN は、man-in-the-middle 攻撃で値が挿入、削除、または変更されないように、転送中は暗号で保護する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f62d7-131">The SPN must be cryptographically protected in transit such that a man-in-the-middle attack cannot insert, remove or modify its value.</span></span>  
  
 <span data-ttu-id="f62d7-132">CBT は、クライアントが認証した内部チャネルを介して会話に結び付ける (バインド) ために使用されるセキュリティで保護された外部チャネル (TLS など) のプロパティです。</span><span class="sxs-lookup"><span data-stu-id="f62d7-132">A CBT is a property of the outer secure channel (such as TLS) used to tie (bind) it to a conversation over an inner, client-authenticated channel.</span></span> <span data-ttu-id="f62d7-133">CBT には、次のプロパティ (これらも IETF RFC 5056 で定義されています) が必要です。</span><span class="sxs-lookup"><span data-stu-id="f62d7-133">The CBT must have the following properties (also defined by IETF RFC 5056):</span></span>  
  
- <span data-ttu-id="f62d7-134">外部チャネルが存在する場合は、CBT の値は、外部チャネル、またはサーバーのエンドポイントのどちらが、会話のクライアント側とサーバー側の両方によって個別に到着したかを識別するプロパティである必要があります。</span><span class="sxs-lookup"><span data-stu-id="f62d7-134">When an outer channel exists, the value of the CBT must be a property identifying either the outer channel or the server endpoint, independently arrived at by both client and server sides of a conversation.</span></span>  
  
- <span data-ttu-id="f62d7-135">クライアントによって送信された CBT の値は、攻撃者が影響を与えられるものであってはなりません。</span><span class="sxs-lookup"><span data-stu-id="f62d7-135">Value of the CBT sent by the client must not be something an attacker can influence.</span></span>  
  
- <span data-ttu-id="f62d7-136">CBT 値の機密性については、保証は一切されません。</span><span class="sxs-lookup"><span data-stu-id="f62d7-136">No guarantees are made about secrecy of the CBT value.</span></span> <span data-ttu-id="f62d7-137">ただしこれは、CBT を実行するプロトコルが暗号化している可能性があるため、サービス バインディング情報とチャネル バインディング情報の値が、認証を実行するサーバー以外で常に検査されることを意味しているわけではありません。</span><span class="sxs-lookup"><span data-stu-id="f62d7-137">This does not however mean that the value of the service binding as well as channel binding information can always be examined by any other but the server performing authentication, as the protocol carrying the CBT may be encrypting it.</span></span>  
  
- <span data-ttu-id="f62d7-138">CBT は、攻撃者が値を挿入、削除、または変更できないようにするため、転送中は暗号で完全に保護する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f62d7-138">The CBT must be cryptographically integrity protected in transit such that an attacker cannot insert, remove or modify its value.</span></span>  
  
 <span data-ttu-id="f62d7-139">チャネル バインディングは、クライアントが改ざんを防止する方法で SPN および CBT をサーバーに転送することで実現されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-139">Channel binding is accomplished by the client transferring the SPN and the CBT to the server in a tamperproof fashion.</span></span> <span data-ttu-id="f62d7-140">サーバーは、そのポリシーに従ってチャネル バインディング情報を検証し、目的のターゲットであると信じられない認証試行を拒否します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-140">The server validates the channel binding information in accordance with its policy and rejects authentication attempts for which it does not believe itself to have been the intended target.</span></span> <span data-ttu-id="f62d7-141">これにより、2 つのチャンネルが暗号でバインドされます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-141">This way, the two channels become cryptographically bound together.</span></span>  
  
 <span data-ttu-id="f62d7-142">既存のクライアントとアプリケーションとの互換性を維持するため、拡張保護をまだサポートしていないクライアントによるサーバー認証の試行を許可するようにサーバーを構成できます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-142">To preserve compatibility with existing clients and applications, a server may be configured to allow authentication attempts by clients that do not yet support extended protection.</span></span> <span data-ttu-id="f62d7-143">これは、"完全にセキュリティを強化した" 構成と対比して、"部分的にセキュリティを強化した" 構成と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-143">This is referred to as a "partially hardened" configuration, in contrast to a "fully hardened" configuration.</span></span>  
  
 <span data-ttu-id="f62d7-144"><xref:System.Net> 名前空間と <xref:System.Net.Security> 名前空間内の複数のコンポーネントは、呼び出し元のアプリケーションに代わって統合 Windows 認証を実行します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-144">Multiple components in the <xref:System.Net> and <xref:System.Net.Security> namespaces perform integrated Windows authentication on behalf of a calling application.</span></span> <span data-ttu-id="f62d7-145">このセクションでは、統合 Windows 認証の使用で拡張保護を追加するための System.Net コンポーネントへの変更について説明します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-145">This section describes changes to System.Net components to add extended protection in their use of integrated Windows authentication.</span></span>  
  
 <span data-ttu-id="f62d7-146">拡張保護は、Windows 7 で現在サポートされています。</span><span class="sxs-lookup"><span data-stu-id="f62d7-146">Extended protection is currently supported on Windows 7.</span></span> <span data-ttu-id="f62d7-147">オペレーティング システムで拡張保護がサポートされているかをどうかをアプリケーションが判断できるように、メカニズムが提供されています。</span><span class="sxs-lookup"><span data-stu-id="f62d7-147">A mechanism is provided so an application can determine if the operating system supports extended protection.</span></span>  
  
## <a name="changes-to-support-extended-protection"></a><span data-ttu-id="f62d7-148">拡張保護をサポートするための変更</span><span class="sxs-lookup"><span data-stu-id="f62d7-148">Changes to Support Extended Protection</span></span>  
 <span data-ttu-id="f62d7-149">使用される認証プロトコルに応じて、統合 Windows 認証で使用される認証プロセスには、多くの場合、ターゲット コンピューターによって発行され、クライアント コンピューターに送り返されるチャレンジが含まれています。</span><span class="sxs-lookup"><span data-stu-id="f62d7-149">The authentication process used with integrated Windows authentication, depending on the authentication protocol used, often includes a challenge issued by the destination computer and sent back to the client computer.</span></span> <span data-ttu-id="f62d7-150">拡張保護によりこの認証プロセスに新しい機能が追加されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-150">Extended protection adds new features to this authentication process</span></span>  
  
 <span data-ttu-id="f62d7-151"><xref:System.Security.Authentication.ExtendedProtection> 名前空間は、アプリケーションの拡張保護を使用した認証のサポートを提供します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-151">The <xref:System.Security.Authentication.ExtendedProtection> namespace provides support for authentication using extended protection for applications.</span></span> <span data-ttu-id="f62d7-152">この名前空間内の <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> クラスは、チャネル バインディングを表します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-152">The <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> class in this namespace represents a channel binding.</span></span> <span data-ttu-id="f62d7-153">この名前空間内の <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> クラスは、受信クライアント接続を検証するためにサーバーで使用される拡張保護ポリシーを表します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-153">The <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> class in this namespace represents the extended protection policy used by the server to validate incoming client connections.</span></span> <span data-ttu-id="f62d7-154">他のクラス メンバーは、拡張保護で使用されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-154">Other class members are used with extended protection.</span></span>  
  
 <span data-ttu-id="f62d7-155">サーバー アプリケーションの場合、これらのクラスには次が含まれます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-155">For server applications, these classes include the following:</span></span>  
  
 <span data-ttu-id="f62d7-156">次の要素を持つ <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy>:</span><span class="sxs-lookup"><span data-stu-id="f62d7-156">A <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> that has the following elements:</span></span>  
  
- <span data-ttu-id="f62d7-157">オペレーティング システムが統合 Windows 認証と拡張保護をサポートしているかどうかを示す <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy.OSSupportsExtendedProtection%2A> プロパティ。</span><span class="sxs-lookup"><span data-stu-id="f62d7-157">An <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy.OSSupportsExtendedProtection%2A> property that indicates whether the operating system supports integrated windows authentication with extended protection.</span></span>  
  
- <span data-ttu-id="f62d7-158">拡張保護ポリシーを適用するタイミングを示す <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> 値。</span><span class="sxs-lookup"><span data-stu-id="f62d7-158">A <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> value that indicates when the extended protection policy should be enforced.</span></span>  
  
- <span data-ttu-id="f62d7-159">展開シナリオを示す <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> 値。</span><span class="sxs-lookup"><span data-stu-id="f62d7-159">A <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> value that indicates the deployment scenario.</span></span> <span data-ttu-id="f62d7-160">これは、拡張保護がチェックされる方法に影響します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-160">This influences how extended protection is checked.</span></span>  
  
- <span data-ttu-id="f62d7-161">認証の目的のターゲットとしてクライアントから提供された SPN と照合するために使用されるカスタム SPN のリストを含む <xref:System.Security.Authentication.ExtendedProtection.ServiceNameCollection> (省略可能)。</span><span class="sxs-lookup"><span data-stu-id="f62d7-161">An optional <xref:System.Security.Authentication.ExtendedProtection.ServiceNameCollection> that contains the custom SPN list that is used to match against the SPN provided by the client as the intended target of the authentication.</span></span>  
  
- <span data-ttu-id="f62d7-162">検証に使用するカスタム チャネル バインディングを含む <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> (省略可能)。</span><span class="sxs-lookup"><span data-stu-id="f62d7-162">An optional <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> that contains a custom channel binding to use for validation.</span></span> <span data-ttu-id="f62d7-163">このシナリオは、一般的なケースではありません。</span><span class="sxs-lookup"><span data-stu-id="f62d7-163">This scenario is not a common case</span></span>  
  
 <span data-ttu-id="f62d7-164"><xref:System.Security.Authentication.ExtendedProtection.Configuration> 名前空間は、アプリケーションの拡張保護を使用した認証の構成のサポートを提供します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-164">The <xref:System.Security.Authentication.ExtendedProtection.Configuration> namespace provides support for configuration of authentication using extended protection for applications.</span></span>  
  
 <span data-ttu-id="f62d7-165">既存の <xref:System.Net> 名前空間で拡張保護をサポートするため、多くの機能変更が行われました。</span><span class="sxs-lookup"><span data-stu-id="f62d7-165">A number of feature changes were made to support extended protection in the existing <xref:System.Net> namespace.</span></span> <span data-ttu-id="f62d7-166">主な変更点は以下のとおりです。</span><span class="sxs-lookup"><span data-stu-id="f62d7-166">These changes include the following:</span></span>  
  
- <span data-ttu-id="f62d7-167">トランスポート コンテキストを表す <xref:System.Net> 名前空間に追加された新しい <xref:System.Net.TransportContext> クラス。</span><span class="sxs-lookup"><span data-stu-id="f62d7-167">A new <xref:System.Net.TransportContext> class added to the <xref:System.Net> namespace that represents a transport context.</span></span>  
  
- <span data-ttu-id="f62d7-168">クライアント アプリケーションの拡張保護をサポートするために <xref:System.Net.TransportContext> の取得を許可する <xref:System.Net.HttpWebRequest> クラス内の新しい <xref:System.Net.HttpWebRequest.EndGetRequestStream%2A> および <xref:System.Net.HttpWebRequest.GetRequestStream%2A> オーバーロード メソッド。</span><span class="sxs-lookup"><span data-stu-id="f62d7-168">New <xref:System.Net.HttpWebRequest.EndGetRequestStream%2A> and <xref:System.Net.HttpWebRequest.GetRequestStream%2A> overload methods in the <xref:System.Net.HttpWebRequest> class that allow retrieving the <xref:System.Net.TransportContext> to support extended protection for client applications.</span></span>  
  
- <span data-ttu-id="f62d7-169">サーバー アプリケーションをサポートするための <xref:System.Net.HttpListener> クラスと <xref:System.Net.HttpListenerRequest> クラスへの追加。</span><span class="sxs-lookup"><span data-stu-id="f62d7-169">Additions to the <xref:System.Net.HttpListener> and <xref:System.Net.HttpListenerRequest> classes to support server applications.</span></span>  
  
 <span data-ttu-id="f62d7-170">既存の <xref:System.Net.Mail> 名前空間で SMTP クライアント アプリケーションの拡張保護をサポートするため、次の機能変更が行われました。</span><span class="sxs-lookup"><span data-stu-id="f62d7-170">A feature change was made to support extended protection for SMTP client applications in the existing <xref:System.Net.Mail> namespace:</span></span>  
  
- <span data-ttu-id="f62d7-171">SMTP クライアント アプリケーションに拡張保護を使用する際に、認証に使用する SPN を表す <xref:System.Net.Mail.SmtpClient> クラス内の <xref:System.Net.Mail.SmtpClient.TargetName%2A> プロパティ。</span><span class="sxs-lookup"><span data-stu-id="f62d7-171">A <xref:System.Net.Mail.SmtpClient.TargetName%2A> property in the <xref:System.Net.Mail.SmtpClient> class that represents the SPN to use for authentication when using extended protection for SMTP client applications.</span></span>  
  
 <span data-ttu-id="f62d7-172">既存の <xref:System.Net.Security> 名前空間で拡張保護をサポートするため、多くの機能変更が行われました。</span><span class="sxs-lookup"><span data-stu-id="f62d7-172">A number of feature changes were made to support extended protection in the existing <xref:System.Net.Security> namespace.</span></span> <span data-ttu-id="f62d7-173">主な変更点は以下のとおりです。</span><span class="sxs-lookup"><span data-stu-id="f62d7-173">These changes include the following:</span></span>  
  
- <span data-ttu-id="f62d7-174">クライアント アプリケーションの拡張保護をサポートするために CBT を渡すことを許可する <xref:System.Net.Security.NegotiateStream> クラス内の新しい <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsClient%2A> および <xref:System.Net.Security.NegotiateStream.AuthenticateAsClient%2A> オーバーロード メソッド。</span><span class="sxs-lookup"><span data-stu-id="f62d7-174">New <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsClient%2A> and <xref:System.Net.Security.NegotiateStream.AuthenticateAsClient%2A> overload methods in the <xref:System.Net.Security.NegotiateStream> class that allow passing a CBT to support extended protection for client applications.</span></span>  
  
- <span data-ttu-id="f62d7-175">サーバー アプリケーションの拡張保護をサポートするために <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> を渡すことを許可する <xref:System.Net.Security.NegotiateStream> クラス内の新しい <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsServer%2A> および <xref:System.Net.Security.NegotiateStream.AuthenticateAsServer%2A> オーバーロード メソッド。</span><span class="sxs-lookup"><span data-stu-id="f62d7-175">New <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsServer%2A> and <xref:System.Net.Security.NegotiateStream.AuthenticateAsServer%2A> overload methods in the <xref:System.Net.Security.NegotiateStream> class that allow passing an <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> to support extended protection for server applications.</span></span>  
  
- <span data-ttu-id="f62d7-176">クライアントおよびサーバー アプリケーションの拡張保護をサポートするための <xref:System.Net.Security.SslStream> クラス内の新しい <xref:System.Net.Security.SslStream.TransportContext%2A> プロパティ。</span><span class="sxs-lookup"><span data-stu-id="f62d7-176">A new <xref:System.Net.Security.SslStream.TransportContext%2A> property in the <xref:System.Net.Security.SslStream> class to support extended protection for client and server applications.</span></span>  
  
 <span data-ttu-id="f62d7-177"><xref:System.Net.Security> 名前空間で SMTP クライアントに拡張保護の構成をサポートするため、<xref:System.Net.Configuration.SmtpNetworkElement> プロパティが追加されました。</span><span class="sxs-lookup"><span data-stu-id="f62d7-177">A <xref:System.Net.Configuration.SmtpNetworkElement> property was added to support configuration of extended protection for SMTP clients in the <xref:System.Net.Security> namespace.</span></span>  
  
## <a name="extended-protection-for-client-applications"></a><span data-ttu-id="f62d7-178">クライアント アプリケーションの拡張保護</span><span class="sxs-lookup"><span data-stu-id="f62d7-178">Extended Protection for Client Applications</span></span>  
 <span data-ttu-id="f62d7-179">ほとんどのクライアント アプリケーションの拡張保護のサポートは自動的に行われます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-179">Extended protection support for most client applications happens automatically.</span></span> <span data-ttu-id="f62d7-180"><xref:System.Net.HttpWebRequest> クラスと <xref:System.Net.Mail.SmtpClient> クラスは、基本の Windows のバージョンが拡張保護をサポートしている場合は常に、拡張保護をサポートします。</span><span class="sxs-lookup"><span data-stu-id="f62d7-180">The <xref:System.Net.HttpWebRequest> and <xref:System.Net.Mail.SmtpClient> classes support extended protection whenever the underlying version of Windows supports extended protection.</span></span> <span data-ttu-id="f62d7-181"><xref:System.Net.HttpWebRequest> インスタンスは <xref:System.Uri> から構築された SPN を送信します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-181">An <xref:System.Net.HttpWebRequest> instance sends an SPN constructed from the <xref:System.Uri>.</span></span> <span data-ttu-id="f62d7-182">既定では、<xref:System.Net.Mail.SmtpClient> インスタンスは SMTP メール サーバーのホスト名から構築された SPN を送信します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-182">By default, an <xref:System.Net.Mail.SmtpClient> instance sends an SPN constructed from the host name of the SMTP mail server.</span></span>  
  
 <span data-ttu-id="f62d7-183">カスタム認証の場合、クライアント アプリケーションは、<xref:System.Net.TransportContext.GetChannelBinding%2A> メソッドを使用して <xref:System.Net.TransportContext> および CBT の取得を許可する <xref:System.Net.HttpWebRequest> クラス内で <xref:System.Net.HttpWebRequest.EndGetRequestStream%28System.IAsyncResult%2CSystem.Net.TransportContext%40%29?displayProperty=nameWithType> メソッドまたは <xref:System.Net.HttpWebRequest.GetRequestStream%28System.Net.TransportContext%40%29?displayProperty=nameWithType> メソッドを使用できます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-183">For custom authentication, client applications can use the <xref:System.Net.HttpWebRequest.EndGetRequestStream%28System.IAsyncResult%2CSystem.Net.TransportContext%40%29?displayProperty=nameWithType> or <xref:System.Net.HttpWebRequest.GetRequestStream%28System.Net.TransportContext%40%29?displayProperty=nameWithType> methods in the <xref:System.Net.HttpWebRequest> class that allow retrieving the <xref:System.Net.TransportContext> and the CBT using the <xref:System.Net.TransportContext.GetChannelBinding%2A> method.</span></span>  
  
 <span data-ttu-id="f62d7-184"><xref:System.Net.HttpWebRequest> インスタンスによって指定されたサービスに送信された統合 Windows 認証に使用する SPN は、<xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> プロパティを設定することでオーバーライドすることができます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-184">The SPN to use for integrated Windows authentication sent by an <xref:System.Net.HttpWebRequest> instance to a given service can be overridden by setting the <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> property.</span></span>  
  
 <span data-ttu-id="f62d7-185"><xref:System.Net.Mail.SmtpClient.TargetName%2A> プロパティは、SMTP 接続の統合 Windows 認証にカスタム SPN を使用するように設定するために使用できます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-185">The <xref:System.Net.Mail.SmtpClient.TargetName%2A> property can be used to set a custom SPN to use for integrated Windows authentication for the SMTP connection.</span></span>  
  
## <a name="extended-protection-for-server-applications"></a><span data-ttu-id="f62d7-186">サーバー アプリケーションの拡張保護</span><span class="sxs-lookup"><span data-stu-id="f62d7-186">Extended Protection for Server Applications</span></span>  
 <span data-ttu-id="f62d7-187"><xref:System.Net.HttpListener> は、HTTP 認証を実行するときに、サービス バインディングを検証するためのメカニズムを提供します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-187"><xref:System.Net.HttpListener> automatically provides mechanisms for validating service bindings when performing HTTP authentication.</span></span>  
  
 <span data-ttu-id="f62d7-188">最も安全なシナリオは、`HTTPS://` プレフィックスの拡張保護を有効にすることです。</span><span class="sxs-lookup"><span data-stu-id="f62d7-188">The most secure scenario is to enable extended protection for `HTTPS://` prefixes.</span></span> <span data-ttu-id="f62d7-189">この場合、<xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> または <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> に設定された <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> を使用して <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=nameWithType> を <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> に設定し、<xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> を <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected> に設定します。<xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> の値は、<xref:System.Net.HttpListener> を部分的にセキュリティを強化したモードにし、同時に <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> は完全にセキュリティを強化したモードに対応します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-189">In this case, set <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=nameWithType> to an <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> with <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> set to <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> or <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>, and <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> set to <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected> A value of  <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> puts <xref:System.Net.HttpListener> in partially hardened mode, while <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> corresponds to fully hardened mode.</span></span>  
  
 <span data-ttu-id="f62d7-190">この構成では、セキュリティで保護された外部チャネル経由でサーバーに要求が作成されると、その外部チャネルがチャネル バインディングに対して照会されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-190">In this configuration when a request is made to the server through an outer secure channel, the outer channel is queried for a channel binding.</span></span> <span data-ttu-id="f62d7-191">このチャネル バインディングは、認証 BLOB でチャネル バインディングが一致することを検証する認証の SSPI 呼び出しに渡されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-191">This channel binding is passed to the authentication SSPI calls, which validate that the channel binding in the authentication blob matches.</span></span> <span data-ttu-id="f62d7-192">考えられる結果は 3 つあります。</span><span class="sxs-lookup"><span data-stu-id="f62d7-192">There are three possible outcomes:</span></span>  
  
1. <span data-ttu-id="f62d7-193">サーバーの基本のオペレーティング システムが拡張保護をサポートしません。</span><span class="sxs-lookup"><span data-stu-id="f62d7-193">The server’s underlying operating system does not support extended protection.</span></span> <span data-ttu-id="f62d7-194">要求がアプリケーションに公開されず、権限がないという応答 (401) がクライアントに返されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-194">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="f62d7-195">失敗の理由を明らかにするメッセージが <xref:System.Net.HttpListener> トレース ソースに記録されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-195">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
2. <span data-ttu-id="f62d7-196">SSPI 呼び出しの失敗は、クライアントが外部チャネルから取得した予期される値と一致しなかったチャネル バインディングを指定したか、またはサーバーで拡張保護ポリシーが <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> に設定された場合に、クライアントがチャネル バインディングの提供に失敗したことを示します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-196">The SSPI call fails indicating that either the client specified a channel binding that did not match the expected value retrieved from the outer channel or the client failed to supply a channel binding when the extended protection policy on the server was configured for <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>.</span></span> <span data-ttu-id="f62d7-197">どちらの場合も、要求はアプリケーションに公開されず、権限がないという応答 (401) がクライアントに返されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-197">In both cases, the request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="f62d7-198">失敗の理由を明らかにするメッセージが <xref:System.Net.HttpListener> トレース ソースに記録されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-198">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
3. <span data-ttu-id="f62d7-199">クライアントは正しいチャネル バインディングを指定します。または、サーバーで拡張保護ポリシーが <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> で構成されているため、チャネル バインディングを指定せずにクライアントは接続することができます。要求は処理のためにアプリケーションに返されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-199">The client specifies the correct channel binding or is allowed to connect without specifying a channel binding since the extended protection policy on the server is configured with <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> The request is returned to the application for processing.</span></span> <span data-ttu-id="f62d7-200">サービス名チェックは自動的に実行されません。</span><span class="sxs-lookup"><span data-stu-id="f62d7-200">No service name check is performed automatically.</span></span> <span data-ttu-id="f62d7-201">アプリケーションは、<xref:System.Net.HttpListenerRequest.ServiceName%2A> プロパティを使用して独自のサービス名の検証を実行するように選択できますが、こうした状況では冗長です。</span><span class="sxs-lookup"><span data-stu-id="f62d7-201">An application may choose to perform its own service name validation using the <xref:System.Net.HttpListenerRequest.ServiceName%2A> property, but under these circumstances it is redundant.</span></span>  
  
 <span data-ttu-id="f62d7-202">アプリケーションが独自の SSPI 呼び出しを作成して、HTTP 要求の本体内でやり取りされた BLOB に基づいて認証を実行し、チャネル バインディングをサポートする場合は、チャネル バインディングをネイティブ Win32 [AcceptSecurityContext](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) 関数に渡すため、<xref:System.Net.HttpListener> を使用して、セキュリティで保護された外部チャネルから、期待されるチャネル バインディングを取得する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f62d7-202">If an application makes its own SSPI calls to perform authentication based on blobs passed back and forth within the body of an HTTP request and wishes to support channel binding, it needs to retrieve the expected channel binding from the outer secure channel using <xref:System.Net.HttpListener> in order to pass it to native Win32 [AcceptSecurityContext](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) function.</span></span> <span data-ttu-id="f62d7-203">これを行うには、<xref:System.Net.HttpListenerRequest.TransportContext%2A> プロパティを使用して <xref:System.Net.TransportContext.GetChannelBinding%2A> メソッドを呼び出して CBT を取得します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-203">To do this, use the <xref:System.Net.HttpListenerRequest.TransportContext%2A> property and call <xref:System.Net.TransportContext.GetChannelBinding%2A> method to retrieve the CBT.</span></span> <span data-ttu-id="f62d7-204">エンドポイント バインディングのみがサポートされます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-204">Only endpoint bindings are supported.</span></span> <span data-ttu-id="f62d7-205"><xref:System.Security.Authentication.ExtendedProtection.ChannelBindingKind.Endpoint> 以外のものが指定されると、<xref:System.NotSupportedException> がスローされます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-205">If anything other <xref:System.Security.Authentication.ExtendedProtection.ChannelBindingKind.Endpoint> is specified, a <xref:System.NotSupportedException> will be thrown.</span></span> <span data-ttu-id="f62d7-206">基本のオペレーティング システムがチャネル バインディングをサポートしている場合、<xref:System.Net.TransportContext.GetChannelBinding%2A> メソッドがポインターをラップする <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding><xref:System.Runtime.InteropServices.SafeHandle> を、[AcceptSecurityContext](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) 関数に `pInput` パラメーターで渡される SecBuffer 構造体の pvBuffer メンバーとして渡すのに適したチャネル バインディングに返します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-206">If the underlying operating system supports channel binding, the <xref:System.Net.TransportContext.GetChannelBinding%2A> method will return a <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding><xref:System.Runtime.InteropServices.SafeHandle> wrapping a pointer to a channel binding suitable for passing to [AcceptSecurityContext](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) function as the pvBuffer member of a SecBuffer structure passed in the `pInput` parameter.</span></span> <span data-ttu-id="f62d7-207"><xref:System.Security.Authentication.ExtendedProtection.ChannelBinding.Size%2A> プロパティには、チャネル バインディングの長さ (バイト単位) が含まれます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-207">The <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding.Size%2A> property contains the length, in bytes, of the channel binding.</span></span> <span data-ttu-id="f62d7-208">基本のオペレーティング システムがチャネル バインディングをサポートしていない場合、関数は `null` を返します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-208">If the underlying operating system does not support channel bindings, the function will return `null`.</span></span>  
  
 <span data-ttu-id="f62d7-209">もう 1 つの考えられるシナリオは、プロキシが使用されていないときに、`HTTP://` プレフィックスの拡張保護を有効にすることです。</span><span class="sxs-lookup"><span data-stu-id="f62d7-209">Another possible scenario is to enable extended protection for `HTTP://` prefixes when proxies are not used.</span></span> <span data-ttu-id="f62d7-210">この場合、<xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> または <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> に設定された <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> を使用して <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=nameWithType> を <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> に設定し、<xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> を <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected> に設定します。<xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> の値は、<xref:System.Net.HttpListener> を部分的にセキュリティを強化したモードにし、同時に <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> は完全にセキュリティを強化したモードに対応します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-210">In this case, set <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=nameWithType> to an <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> with <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> set to <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> or <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>, and <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> set to <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected> A value of  <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> puts <xref:System.Net.HttpListener> in partially hardened mode, while <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> corresponds to fully hardened mode.</span></span>  
  
 <span data-ttu-id="f62d7-211">許可されているサービス名の既定のリストが、<xref:System.Net.HttpListener> に登録されているプレフィックスに基づいて作成されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-211">A default list of allowed service names is created based on the prefixes which have been registered with the <xref:System.Net.HttpListener>.</span></span> <span data-ttu-id="f62d7-212">この既定のリストは、<xref:System.Net.HttpListener.DefaultServiceNames%2A> プロパティを通じて調べることができます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-212">This default list can be examined through the <xref:System.Net.HttpListener.DefaultServiceNames%2A> property.</span></span> <span data-ttu-id="f62d7-213">このリストが包括的なものでない場合、アプリケーションは、既定のサービス名のリストの代わりに使用される <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> クラスのコンストラクターでカスタム サービス名のコレクションを指定できます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-213">If this list is not comprehensive, an application can specify a custom service name collection in the constructor for the <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> class which will be used instead of the default service name list.</span></span>  
  
 <span data-ttu-id="f62d7-214">この構成では、セキュリティで保護された外部チャネルなしでサーバーに対して要求が作成された場合に、認証は通常、チャネル バインディングのチェックなしで実行されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-214">In this configuration, when a request is made to the server without an outer secure channel authentication proceeds normally without a channel binding check.</span></span> <span data-ttu-id="f62d7-215">認証に成功した場合、クライアントが提供したサービス名に対してコンテキストが照会され、許容されるサービス名のリストに照らして検証されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-215">If the authentication succeeds, the context is queried for the service name that the client provided and validated against the list of acceptable service names.</span></span> <span data-ttu-id="f62d7-216">考えられる結果は 4 つあります。</span><span class="sxs-lookup"><span data-stu-id="f62d7-216">There are four possible outcomes:</span></span>  
  
1. <span data-ttu-id="f62d7-217">サーバーの基本のオペレーティング システムが拡張保護をサポートしません。</span><span class="sxs-lookup"><span data-stu-id="f62d7-217">The server’s underlying operating system does not support extended protection.</span></span> <span data-ttu-id="f62d7-218">要求がアプリケーションに公開されず、権限がないという応答 (401) がクライアントに返されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-218">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="f62d7-219">失敗の理由を明らかにするメッセージが <xref:System.Net.HttpListener> トレース ソースに記録されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-219">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
2. <span data-ttu-id="f62d7-220">クライアントの基本のオペレーティング システムが拡張保護をサポートしません。</span><span class="sxs-lookup"><span data-stu-id="f62d7-220">The client’s underlying operating system does not support extended protection.</span></span> <span data-ttu-id="f62d7-221"><xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> 構成では、認証の試行が成功し、要求がアプリケーションに返されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-221">In the <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> configuration, the authentication attempt will succeed and the request will be returned to the application.</span></span> <span data-ttu-id="f62d7-222"><xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> 構成では、認証の試行は失敗します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-222">In the <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> configuration, the authentication attempt will fail.</span></span> <span data-ttu-id="f62d7-223">要求がアプリケーションに公開されず、権限がないという応答 (401) がクライアントに返されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-223">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="f62d7-224">失敗の理由を明らかにするメッセージが <xref:System.Net.HttpListener> トレース ソースに記録されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-224">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
3. <span data-ttu-id="f62d7-225">クライアントの基本のオペレーティング システムは拡張保護をサポートしますが、アプリケーションはサービス バインディングを指定しませんでした。</span><span class="sxs-lookup"><span data-stu-id="f62d7-225">The client’s underlying operating system supports extended protection, but the application did not specify a service binding.</span></span> <span data-ttu-id="f62d7-226">要求がアプリケーションに公開されず、権限がないという応答 (401) がクライアントに返されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-226">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="f62d7-227">失敗の理由を明らかにするメッセージが <xref:System.Net.HttpListener> トレース ソースに記録されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-227">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
4. <span data-ttu-id="f62d7-228">クライアントはサービス バインディングを指定しました。</span><span class="sxs-lookup"><span data-stu-id="f62d7-228">The client specified a service binding.</span></span> <span data-ttu-id="f62d7-229">サービス バインディングは、許可されているサービス バインディングのリストと比較されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-229">The service binding is compared to the list of allowed service bindings.</span></span> <span data-ttu-id="f62d7-230">一致すると、要求がアプリケーションに返されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-230">If it matches, the request is returned to the application.</span></span> <span data-ttu-id="f62d7-231">そうでない場合、要求がアプリケーションに公開されず、権限がないという応答 (401) が自動的にクライアントに返されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-231">Otherwise, the request will not be exposed to the application, and an unauthorized (401) response will be automatically returned to the client.</span></span> <span data-ttu-id="f62d7-232">失敗の理由を明らかにするメッセージが <xref:System.Net.HttpListener> トレース ソースに記録されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-232">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
 <span data-ttu-id="f62d7-233">許容されるサービス名の許可リストを使用するこの単純な方法が不十分な場合、アプリケーションは <xref:System.Net.HttpListenerRequest.ServiceName%2A> プロパティのクエリを実行することで、独自のサービス名の検証を提供できます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-233">If this simple approach using an allowed list of acceptable service names is insufficient, an application may provide its own service name validation by querying the <xref:System.Net.HttpListenerRequest.ServiceName%2A> property.</span></span> <span data-ttu-id="f62d7-234">上記の 1 および 2 の場合、プロパティは `null` を返します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-234">In cases 1 and 2 above, the property will return `null`.</span></span> <span data-ttu-id="f62d7-235">3 の場合、空の文字列を返します。</span><span class="sxs-lookup"><span data-stu-id="f62d7-235">In case 3, it will return an empty string.</span></span> <span data-ttu-id="f62d7-236">4 の場合、クライアントによって指定されたサービス名が返されます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-236">In case 4, the service name specified by the client will be returned.</span></span>  
  
 <span data-ttu-id="f62d7-237">これらの拡張保護機能は、サーバー アプリケーションによって、他の種類の要求での認証に使用したり、信頼されたプロキシが使用されている場合に使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="f62d7-237">These extended protection features can also be used by server applications for authentication with other types of requests and when trusted proxies are used.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f62d7-238">関連項目</span><span class="sxs-lookup"><span data-stu-id="f62d7-238">See also</span></span>

- <xref:System.Security.Authentication.ExtendedProtection>
- <xref:System.Security.Authentication.ExtendedProtection.Configuration>
