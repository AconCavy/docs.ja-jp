---
title: データの並列化 (タスク並列ライブラリ)
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- parallelism, data
ms.assetid: 3f05f33f-f1da-4b16-81c2-9ceff1bef449
ms.openlocfilehash: 72696a41cd3b71f47fdcf43e4ece70ebeb7d34d1
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/30/2019
ms.locfileid: "73123161"
---
# <a name="data-parallelism-task-parallel-library"></a><span data-ttu-id="ddf02-102">データの並列化 (タスク並列ライブラリ)</span><span class="sxs-lookup"><span data-stu-id="ddf02-102">Data Parallelism (Task Parallel Library)</span></span>
<span data-ttu-id="ddf02-103">"*データの並列化*" とは、ソース コレクションまたは配列の要素に対して、同じ操作を同時に (つまり、並列で) 実行するシナリオを意味します。</span><span class="sxs-lookup"><span data-stu-id="ddf02-103">*Data parallelism* refers to scenarios in which the same operation is performed concurrently (that is, in parallel) on elements in a source collection or array.</span></span> <span data-ttu-id="ddf02-104">データの並列化操作では、複数のスレッドが異なるセグメント上で同時に操作できるようにソース コレクションがパーティション分割されます。</span><span class="sxs-lookup"><span data-stu-id="ddf02-104">In data parallel operations, the source collection is partitioned so that multiple threads can operate on different segments concurrently.</span></span>  
  
 <span data-ttu-id="ddf02-105">タスク並列ライブラリ (TPL) は <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> クラスによって、データの並列化をサポートします。</span><span class="sxs-lookup"><span data-stu-id="ddf02-105">The Task Parallel Library (TPL) supports data parallelism through the <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> class.</span></span> <span data-ttu-id="ddf02-106">このクラスでは、[for](../../csharp/language-reference/keywords/for.md) ループおよび [foreach](../../csharp/language-reference/keywords/foreach-in.md) ループ (Visual Basic では `For` および `For Each`) をメソッド ベースで並列実装できます。</span><span class="sxs-lookup"><span data-stu-id="ddf02-106">This class provides method-based parallel implementations of [for](../../csharp/language-reference/keywords/for.md) and [foreach](../../csharp/language-reference/keywords/foreach-in.md) loops (`For` and `For Each` in Visual Basic).</span></span> <span data-ttu-id="ddf02-107"><xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> ループまたは <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> ループに対するループのロジックは、順次ループを記述する場合と同等に記述します。</span><span class="sxs-lookup"><span data-stu-id="ddf02-107">You write the loop logic for a <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> or <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> loop much as you would write a sequential loop.</span></span> <span data-ttu-id="ddf02-108">スレッドまたはキューの作業項目を作成する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="ddf02-108">You do not have to create threads or queue work items.</span></span> <span data-ttu-id="ddf02-109">基本のループでは、ロックを取得する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="ddf02-109">In basic loops, you do not have to take locks.</span></span> <span data-ttu-id="ddf02-110">TPL では低水準の作業はすべて自動的に行われます。</span><span class="sxs-lookup"><span data-stu-id="ddf02-110">The TPL handles all the low-level work for you.</span></span> <span data-ttu-id="ddf02-111"><xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> および <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> の使用の詳細については、ドキュメント「[並列プログラミングのパターン: .NET Framework 4 での並列パターンの理解と適用](https://www.microsoft.com/download/details.aspx?id=19222)」をダウンロードしてください。</span><span class="sxs-lookup"><span data-stu-id="ddf02-111">For in-depth information about the use of <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType>, download the document [Patterns for Parallel Programming: Understanding and Applying Parallel Patterns with the .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=19222).</span></span> <span data-ttu-id="ddf02-112">次のコード例では、単純な `foreach` ループおよびそのループに相当する並列を示しています。</span><span class="sxs-lookup"><span data-stu-id="ddf02-112">The following code example shows a simple `foreach` loop and its parallel equivalent.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="ddf02-113">ここでは、ラムダ式を使用して TPL でデリゲートを定義します。</span><span class="sxs-lookup"><span data-stu-id="ddf02-113">This documentation uses lambda expressions to define delegates in TPL.</span></span> <span data-ttu-id="ddf02-114">C# または Visual Basic のラムダ式についての情報が必要な場合は、「[Lambda Expressions in PLINQ and TPL (PLINQ および TPL のラムダ式)](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ddf02-114">If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).</span></span>  
  
 [!code-csharp[TPL#20](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl/cs/tpl.cs#20)]
 [!code-vb[TPL#20](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl/vb/tpl_vb.vb#20)]  
  
 <span data-ttu-id="ddf02-115">並列ループを実行すると、TPL はデータ ソースをパーティション分割して、ループで複数の部分を同時に操作できるようにします。</span><span class="sxs-lookup"><span data-stu-id="ddf02-115">When a parallel loop runs, the TPL partitions the data source so that the loop can operate on multiple parts concurrently.</span></span> <span data-ttu-id="ddf02-116">背後では、タスク スケジューラが、システム リソースおよび作業負荷に基づいてタスクをパーティション分割します。</span><span class="sxs-lookup"><span data-stu-id="ddf02-116">Behind the scenes, the Task Scheduler partitions the task based on system resources and workload.</span></span> <span data-ttu-id="ddf02-117">作業負荷のバランスが崩れると、可能な場合、スケジューラは複数のスレッドとプロセッサ間で作業を再配分します。</span><span class="sxs-lookup"><span data-stu-id="ddf02-117">When possible, the scheduler redistributes work among multiple threads and processors if the workload becomes unbalanced.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="ddf02-118">固有のカスタム パーティショナーまたはスケジューラを使うこともできます。</span><span class="sxs-lookup"><span data-stu-id="ddf02-118">You can also supply your own custom partitioner or scheduler.</span></span> <span data-ttu-id="ddf02-119">詳細については、「[PLINQ および TPL 用のカスタム パーティショナー](../../../docs/standard/parallel-programming/custom-partitioners-for-plinq-and-tpl.md)」および[TaskScheduler](xref:System.Threading.Tasks.TaskScheduler)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="ddf02-119">For more information, see [Custom Partitioners for PLINQ and TPL](../../../docs/standard/parallel-programming/custom-partitioners-for-plinq-and-tpl.md) and [Task Schedulers](xref:System.Threading.Tasks.TaskScheduler).</span></span>  
  
 <span data-ttu-id="ddf02-120"><xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> メソッドおよび <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> メソッドの両方に、ループの実行を停止または中断させるオーバーロードが複数ある場合は、その他のスレッドのループ状態の監視、スレッド ローカルの状態の維持、スレッド ローカル オブジェクトの終了、コンカレンシーの程度の制御などを行います。</span><span class="sxs-lookup"><span data-stu-id="ddf02-120">Both the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> methods have several overloads that let you stop or break loop execution, monitor the state of the loop on other threads, maintain thread-local state, finalize thread-local objects, control the degree of concurrency, and so on.</span></span> <span data-ttu-id="ddf02-121">この機能を有効にするヘルパー要素には、<xref:System.Threading.Tasks.ParallelLoopState>、<xref:System.Threading.Tasks.ParallelOptions>、<xref:System.Threading.Tasks.ParallelLoopResult>、<xref:System.Threading.CancellationToken>、および <xref:System.Threading.CancellationTokenSource> があります。</span><span class="sxs-lookup"><span data-stu-id="ddf02-121">The helper types that enable this functionality include <xref:System.Threading.Tasks.ParallelLoopState>, <xref:System.Threading.Tasks.ParallelOptions>, <xref:System.Threading.Tasks.ParallelLoopResult>, <xref:System.Threading.CancellationToken>, and <xref:System.Threading.CancellationTokenSource>.</span></span>  
  
 <span data-ttu-id="ddf02-122">詳細については、「[並列プログラミングのパターン: .NET Framework 4 での並列パターンの理解と適用](https://www.microsoft.com/download/details.aspx?id=19222)」をダウンロードしてください。</span><span class="sxs-lookup"><span data-stu-id="ddf02-122">For more information, see [Patterns for Parallel Programming: Understanding and Applying Parallel Patterns with the .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=19222).</span></span>  
  
 <span data-ttu-id="ddf02-123">PLINQ では、宣言構文またはクエリ形式の構文によるデータの並列化がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="ddf02-123">Data parallelism with declarative, or query-like, syntax is supported by PLINQ.</span></span> <span data-ttu-id="ddf02-124">詳細については、「[Parallel LINQ (PLINQ)](../../../docs/standard/parallel-programming/parallel-linq-plinq.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ddf02-124">For more information, see [Parallel LINQ (PLINQ)](../../../docs/standard/parallel-programming/parallel-linq-plinq.md).</span></span>  
  
## <a name="related-topics"></a><span data-ttu-id="ddf02-125">関連トピック</span><span class="sxs-lookup"><span data-stu-id="ddf02-125">Related Topics</span></span>  
  
|<span data-ttu-id="ddf02-126">Title</span><span class="sxs-lookup"><span data-stu-id="ddf02-126">Title</span></span>|<span data-ttu-id="ddf02-127">説明</span><span class="sxs-lookup"><span data-stu-id="ddf02-127">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="ddf02-128">方法: 単純な Parallel.For ループを記述する</span><span class="sxs-lookup"><span data-stu-id="ddf02-128">How to: Write a Simple Parallel.For Loop</span></span>](../../../docs/standard/parallel-programming/how-to-write-a-simple-parallel-for-loop.md)|<span data-ttu-id="ddf02-129">任意の配列またはインデックス可能な <xref:System.Threading.Tasks.Parallel.For%2A> ソース コレクションに対して <xref:System.Collections.Generic.IEnumerable%601> ループを記述する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ddf02-129">Describes how to write a <xref:System.Threading.Tasks.Parallel.For%2A> loop over any array or indexable <xref:System.Collections.Generic.IEnumerable%601> source collection.</span></span>|  
|[<span data-ttu-id="ddf02-130">方法: 単純な Parallel.ForEach ループを記述する</span><span class="sxs-lookup"><span data-stu-id="ddf02-130">How to: Write a Simple Parallel.ForEach Loop</span></span>](../../../docs/standard/parallel-programming/how-to-write-a-simple-parallel-foreach-loop.md)|<span data-ttu-id="ddf02-131">任意の <xref:System.Threading.Tasks.Parallel.ForEach%2A> ソース コレクションに対して <xref:System.Collections.Generic.IEnumerable%601> ループを記述する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ddf02-131">Describes how to write a <xref:System.Threading.Tasks.Parallel.ForEach%2A> loop over any <xref:System.Collections.Generic.IEnumerable%601> source collection.</span></span>|  
|<span data-ttu-id="ddf02-132">[方法: Stop または Break を使用して Parallel.For ループから抜ける](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd460721(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="ddf02-132">[How to: Stop or Break from a Parallel.For Loop](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd460721(v=vs.100))</span></span>|<span data-ttu-id="ddf02-133">並列ループを停止するかまたは抜けて、そのアクションがすべてのスレッドに通知されるようにする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ddf02-133">Describes how to stop or break from a parallel loop so that all threads are informed of the action.</span></span>|  
|[<span data-ttu-id="ddf02-134">方法: スレッド ローカル変数を使用する Parallel.For ループを記述する</span><span class="sxs-lookup"><span data-stu-id="ddf02-134">How to: Write a Parallel.For Loop with Thread-Local Variables</span></span>](../../../docs/standard/parallel-programming/how-to-write-a-parallel-for-loop-with-thread-local-variables.md)|<span data-ttu-id="ddf02-135">各スレッドが他のスレッドからは見えないプライベート変数を維持する <xref:System.Threading.Tasks.Parallel.For%2A> ループを記述する方法と、ループが完了したときにすべてのスレッドの結果を同期する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ddf02-135">Describes how to write a <xref:System.Threading.Tasks.Parallel.For%2A> loop in which each thread maintains a private variable that is not visible to any other threads, and how to synchronize the results from all threads when the loop completes.</span></span>|  
|[<span data-ttu-id="ddf02-136">方法: パーティション ローカル変数を使用する Parallel.ForEach ループを記述する</span><span class="sxs-lookup"><span data-stu-id="ddf02-136">How to: Write a Parallel.ForEach Loop with Partition-Local Variables</span></span>](../../../docs/standard/parallel-programming/how-to-write-a-parallel-foreach-loop-with-partition-local-variables.md)|<span data-ttu-id="ddf02-137">各スレッドが他のスレッドからは見えないプライベート変数を維持する <xref:System.Threading.Tasks.Parallel.ForEach%2A> ループを記述する方法と、ループが完了したときにすべてのスレッドの結果を同期する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ddf02-137">Describes how to write a <xref:System.Threading.Tasks.Parallel.ForEach%2A> loop in which each thread maintains a private variable that is not visible to any other threads, and how to synchronize the results from all threads when the loop completes.</span></span>|  
|[<span data-ttu-id="ddf02-138">方法: Parallel.For または ForEach ループを取り消す</span><span class="sxs-lookup"><span data-stu-id="ddf02-138">How to: Cancel a Parallel.For or ForEach Loop</span></span>](../../../docs/standard/parallel-programming/how-to-cancel-a-parallel-for-or-foreach-loop.md)|<span data-ttu-id="ddf02-139"><xref:System.Threading.CancellationToken?displayProperty=nameWithType> を使用して並列ループを取り消す方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ddf02-139">Describes how to cancel a parallel loop by using a <xref:System.Threading.CancellationToken?displayProperty=nameWithType></span></span>|  
|[<span data-ttu-id="ddf02-140">方法: 小さいループ本体を高速化する</span><span class="sxs-lookup"><span data-stu-id="ddf02-140">How to: Speed Up Small Loop Bodies</span></span>](../../../docs/standard/parallel-programming/how-to-speed-up-small-loop-bodies.md)|<span data-ttu-id="ddf02-141">ループの本体がごく小さい場合に実行速度を向上させる方法の 1 つを説明します。</span><span class="sxs-lookup"><span data-stu-id="ddf02-141">Describes one way to speed up execution when a loop body is very small.</span></span>|  
|[<span data-ttu-id="ddf02-142">タスク並列ライブラリ (TPL)</span><span class="sxs-lookup"><span data-stu-id="ddf02-142">Task Parallel Library (TPL)</span></span>](../../../docs/standard/parallel-programming/task-parallel-library-tpl.md)|<span data-ttu-id="ddf02-143">タスク並列ライブラリの概要を示します。</span><span class="sxs-lookup"><span data-stu-id="ddf02-143">Provides an overview of the Task Parallel Library.</span></span>|  
|[<span data-ttu-id="ddf02-144">並列プログラミング</span><span class="sxs-lookup"><span data-stu-id="ddf02-144">Parallel Programming</span></span>](../../../docs/standard/parallel-programming/index.md)|<span data-ttu-id="ddf02-145">.NET Framework の並列プログラミングについて説明します。</span><span class="sxs-lookup"><span data-stu-id="ddf02-145">Introduces Parallel Programming in the .NET Framework.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="ddf02-146">関連項目</span><span class="sxs-lookup"><span data-stu-id="ddf02-146">See also</span></span>

- [<span data-ttu-id="ddf02-147">並列プログラミング</span><span class="sxs-lookup"><span data-stu-id="ddf02-147">Parallel Programming</span></span>](../../../docs/standard/parallel-programming/index.md)
