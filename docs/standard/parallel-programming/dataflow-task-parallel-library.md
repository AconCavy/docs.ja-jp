---
title: データフロー (タスク並列ライブラリ)
description: タスク並列ライブラリ (TPL) でデータフロー コンポーネントを使用して、コンカレンシー対応アプリケーションの堅牢性を向上させる方法について説明します。
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Task Parallel Library, dataflows
- TPL dataflow library
ms.assetid: 643575d0-d26d-4c35-8de7-a9c403e97dd6
ms.openlocfilehash: 67b5cfaa987b3f37d68597d22ad5f87e8d1bd018
ms.sourcegitcommit: d8020797a6657d0fbbdff362b80300815f682f94
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/24/2020
ms.locfileid: "95728694"
---
# <a name="dataflow-task-parallel-library"></a><span data-ttu-id="94516-103">データフロー (タスク並列ライブラリ)</span><span class="sxs-lookup"><span data-stu-id="94516-103">Dataflow (Task Parallel Library)</span></span>

<span data-ttu-id="94516-104">タスク並列ライブラリ (TPL) で提供されるデータ フロー コンポーネントは、コンカレンシー対応アプリケーションの堅牢性の強化に役立てることができます。</span><span class="sxs-lookup"><span data-stu-id="94516-104">The Task Parallel Library (TPL) provides dataflow components to help increase the robustness of concurrency-enabled applications.</span></span> <span data-ttu-id="94516-105">これらのデータ フロー コンポーネントは *TPL データ フロー ライブラリ* と総称されます。</span><span class="sxs-lookup"><span data-stu-id="94516-105">These dataflow components are collectively referred to as the *TPL Dataflow Library*.</span></span> <span data-ttu-id="94516-106">データ フロー モデルは、粒度の粗いデータ フローおよびパイプライン処理タスクのためのインプロセス メッセージ パッシングを提供し、アクター ベースのプログラミング モデルを推進します。</span><span class="sxs-lookup"><span data-stu-id="94516-106">This dataflow model promotes actor-based programming by providing in-process message passing for coarse-grained dataflow and pipelining tasks.</span></span> <span data-ttu-id="94516-107">データ フロー コンポーネントは、TPL の種類とスケジュール インフラストラクチャの上でビルドされ、非同期プログラミングをサポートするために C#、Visual Basic、および F# 言語と統合されています。</span><span class="sxs-lookup"><span data-stu-id="94516-107">The dataflow components build on the types and scheduling infrastructure of the TPL and integrate with the C#, Visual Basic, and F# language support for asynchronous programming.</span></span> <span data-ttu-id="94516-108">相互に非同期通信を行う必要がある複数の操作を行う場合、またはデータが使用可能になったときにデータを処理する場合に、これらのデータ フロー コンポーネントは役立ちます。</span><span class="sxs-lookup"><span data-stu-id="94516-108">These dataflow components are useful when you have multiple operations that must communicate with one another asynchronously or when you want to process data as it becomes available.</span></span> <span data-ttu-id="94516-109">たとえば、Web カメラからのイメージ データを処理するアプリケーションを考えてみます。</span><span class="sxs-lookup"><span data-stu-id="94516-109">For example, consider an application that processes image data from a web camera.</span></span> <span data-ttu-id="94516-110">データ フロー モデルを使用すると、イメージ フレームが使用可能になったときに、それをアプリケーションで処理できます。</span><span class="sxs-lookup"><span data-stu-id="94516-110">By using the dataflow model, the application can process image frames as they become available.</span></span> <span data-ttu-id="94516-111">たとえば、アプリケーションが輝度修正や赤目補正などを実行してイメージ フレームを向上させる場合、データ フロー コンポーネントの *パイプライン* を作成できます。</span><span class="sxs-lookup"><span data-stu-id="94516-111">If the application enhances image frames, for example, by performing light correction or red-eye reduction, you can create a *pipeline* of dataflow components.</span></span> <span data-ttu-id="94516-112">パイプラインの各ステージは、イメージを変換するために、TPL が提供する機能のような、粒度の粗い並列機能を使用する場合があります。</span><span class="sxs-lookup"><span data-stu-id="94516-112">Each stage of the pipeline might use more coarse-grained parallelism functionality, such as the functionality that is provided by the TPL, to transform the image.</span></span>  
  
 <span data-ttu-id="94516-113">ここでは、TPL データ フロー ライブラリの概要を示します。</span><span class="sxs-lookup"><span data-stu-id="94516-113">This document provides an overview of the TPL Dataflow Library.</span></span> <span data-ttu-id="94516-114">プログラミング モデル、定義済みのデータ フロー ブロックの型、およびアプリケーションの特定の要件を満たすためのデータ フロー ブロックの構成方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="94516-114">It describes the programming model, the predefined dataflow block types, and how to configure dataflow blocks to meet the specific requirements of your applications.</span></span>  

[!INCLUDE [tpl-install-instructions](../../../includes/tpl-install-instructions.md)]

## <a name="programming-model"></a><span data-ttu-id="94516-115">プログラミング モデル</span><span class="sxs-lookup"><span data-stu-id="94516-115">Programming Model</span></span>

 <span data-ttu-id="94516-116">TPL データ フロー ライブラリはメッセージ パッシングおよび、並列化され、CPU 負荷が高く、I/O 負荷が高く、スループットが高く、待機時間が短いアプリケーションのための基盤を提供します。</span><span class="sxs-lookup"><span data-stu-id="94516-116">The TPL Dataflow Library provides a foundation for message passing and parallelizing CPU-intensive and I/O-intensive applications that have high throughput and low latency.</span></span> <span data-ttu-id="94516-117">また、システム上でのデータのバッファリング方法や移動について、明示的に制御できます。</span><span class="sxs-lookup"><span data-stu-id="94516-117">It also gives you explicit control over how data is buffered and moves around the system.</span></span> <span data-ttu-id="94516-118">データ フロー プログラミング モデルの理解を深めるため、非同期的にディスクからイメージを読み込み、それらの合成イメージを作成するアプリケーションを考えてみます。</span><span class="sxs-lookup"><span data-stu-id="94516-118">To better understand the dataflow programming model, consider an application that asynchronously loads images from disk and creates a composite of those images.</span></span> <span data-ttu-id="94516-119">従来のプログラミング モデルでは、通常、タスクを協調させ、共有データにアクセスするには、コールバックおよびロックなどの同期オブジェクトを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="94516-119">Traditional programming models typically require that you use callbacks and synchronization objects, such as locks, to coordinate tasks and access to shared data.</span></span> <span data-ttu-id="94516-120">データ フロー プログラミング モデルを使用すると、イメージがディスクから読み込まれたときにそれを処理する、データ フロー オブジェクトを作成できます。</span><span class="sxs-lookup"><span data-stu-id="94516-120">By using the dataflow programming model, you can create dataflow objects that process images as they are read from disk.</span></span> <span data-ttu-id="94516-121">データ フロー モデルでは、データが使用可能になったときの処理方法と、データ間の依存関係を宣言します。</span><span class="sxs-lookup"><span data-stu-id="94516-121">Under the dataflow model, you declare how data is handled when it becomes available, and also any dependencies between data.</span></span> <span data-ttu-id="94516-122">ランタイムがデータ間の依存関係を管理するため、通常は共有データへのアクセスの同期要件を回避できます。</span><span class="sxs-lookup"><span data-stu-id="94516-122">Because the runtime manages dependencies between data, you can often avoid the requirement to synchronize access to shared data.</span></span> <span data-ttu-id="94516-123">さらに、ランタイムのスケジュールは非同期のデータの到着に基づいて動作するため、基になるスレッドを効率的に管理することによって、データ フローの応答性とスループットが向上します。</span><span class="sxs-lookup"><span data-stu-id="94516-123">In addition, because the runtime schedules work based on the asynchronous arrival of data, dataflow can improve responsiveness and throughput by efficiently managing the underlying threads.</span></span> <span data-ttu-id="94516-124">Windows フォーム アプリケーションでイメージ処理を実装するためにデータフロー プログラミング モデルを使う例については、「[チュートリアル:Windows フォーム アプリケーションでのデータフローの使用](walkthrough-using-dataflow-in-a-windows-forms-application.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-124">For an example that uses the dataflow programming model to implement image processing in a Windows Forms application, see [Walkthrough: Using Dataflow in a Windows Forms Application](walkthrough-using-dataflow-in-a-windows-forms-application.md).</span></span>  
  
### <a name="sources-and-targets"></a><span data-ttu-id="94516-125">ソースとターゲット</span><span class="sxs-lookup"><span data-stu-id="94516-125">Sources and Targets</span></span>  

 <span data-ttu-id="94516-126">TPL データ フロー ライブラリは、データのバッファリングと処理を行うデータ構造体である *データ フロー ブロック* で構成されます。</span><span class="sxs-lookup"><span data-stu-id="94516-126">The TPL Dataflow Library consists of *dataflow blocks*, which are data structures that buffer and process data.</span></span> <span data-ttu-id="94516-127">TPL は *ソース ブロック*、*ターゲット ブロック*、および *伝達子ブロック* の 3 種類のデータ フロー ブロックを定義します。</span><span class="sxs-lookup"><span data-stu-id="94516-127">The TPL defines three kinds of dataflow blocks: *source blocks*, *target blocks*, and *propagator blocks*.</span></span> <span data-ttu-id="94516-128">ソース ブロックはデータのソースとして機能し、それを読み取ることができます。</span><span class="sxs-lookup"><span data-stu-id="94516-128">A source block acts as a source of data and can be read from.</span></span> <span data-ttu-id="94516-129">ターゲット ブロックはデータのレシーバーとして機能し、それに書き込むことができます。</span><span class="sxs-lookup"><span data-stu-id="94516-129">A target block acts as a receiver of data and can be written to.</span></span> <span data-ttu-id="94516-130">伝達子ブロックは、ソース ブロックとターゲット ブロックのどちらとしても機能し、読み取りも書き込みもできます。</span><span class="sxs-lookup"><span data-stu-id="94516-130">A propagator block acts as both a source block and a target block, and can be read from and written to.</span></span> <span data-ttu-id="94516-131">TPL は <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601?displayProperty=nameWithType> インターフェイスを定義してソースを表し、<xref:System.Threading.Tasks.Dataflow.ITargetBlock%601?displayProperty=nameWithType> によってターゲットを表し、<xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602?displayProperty=nameWithType> によって伝達子を表します。</span><span class="sxs-lookup"><span data-stu-id="94516-131">The TPL defines the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601?displayProperty=nameWithType> interface to represent sources, <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601?displayProperty=nameWithType> to represent targets, and <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602?displayProperty=nameWithType> to represent propagators.</span></span> <span data-ttu-id="94516-132"><xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602> は、<xref:System.Threading.Tasks.Dataflow.ISourceBlock%601> と <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> の両方から継承します。</span><span class="sxs-lookup"><span data-stu-id="94516-132"><xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602> inherits from both <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601>, and <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>.</span></span>  
  
 <span data-ttu-id="94516-133">TPL データ フロー ライブラリは、<xref:System.Threading.Tasks.Dataflow.ISourceBlock%601>、<xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>、および <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602> のインターフェイスを実装する、複数の定義済みのデータ フロー ブロックの型を提供します。</span><span class="sxs-lookup"><span data-stu-id="94516-133">The TPL Dataflow Library provides several predefined dataflow block types that implement the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601>, <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>, and <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602> interfaces.</span></span> <span data-ttu-id="94516-134">これらのデータ フロー ブロックの型については、このドキュメントの「[定義済みのデータ フロー ブロックの型](#predefined-dataflow-block-types)」のセクションで説明します。</span><span class="sxs-lookup"><span data-stu-id="94516-134">These dataflow block types are described in this document in the section [Predefined Dataflow Block Types](#predefined-dataflow-block-types).</span></span>  
  
### <a name="connecting-blocks"></a><span data-ttu-id="94516-135">ブロックの接続</span><span class="sxs-lookup"><span data-stu-id="94516-135">Connecting Blocks</span></span>  

 <span data-ttu-id="94516-136">データ フロー ブロックを接続して、データ フロー ブロックのリニア シーケンスである *パイプライン* を作成するか、またはデータ フロー ブロックのグラフである *ネットワーク* を作成できます。</span><span class="sxs-lookup"><span data-stu-id="94516-136">You can connect dataflow blocks to form *pipelines*, which are linear sequences of dataflow blocks, or *networks*, which are graphs of dataflow blocks.</span></span> <span data-ttu-id="94516-137">パイプラインは、ネットワークの 1 つの形態です。</span><span class="sxs-lookup"><span data-stu-id="94516-137">A pipeline is one form of network.</span></span> <span data-ttu-id="94516-138">パイプラインまたはネットワークでは、データが使用可能になると、ソースはターゲットに非同期的にデータを伝達します。</span><span class="sxs-lookup"><span data-stu-id="94516-138">In a pipeline or network, sources asynchronously propagate data to targets as that data becomes available.</span></span> <span data-ttu-id="94516-139"><xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A?displayProperty=nameWithType> メソッドは、ターゲット ブロックにソースのデータ フロー ブロックをリンクします。</span><span class="sxs-lookup"><span data-stu-id="94516-139">The <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A?displayProperty=nameWithType> method links a source dataflow block to a target block.</span></span> <span data-ttu-id="94516-140">ソースは、ターゲットにリンクしないか、または複数のターゲットにリンクできます。ターゲットはソースからリンクされないか、または複数のソースからリンクできます。</span><span class="sxs-lookup"><span data-stu-id="94516-140">A source can be linked to zero or more targets; targets can be linked from zero or more sources.</span></span> <span data-ttu-id="94516-141">パイプラインまたはネットワークとの間でデータ フロー ブロックを同時に追加または削除できます。</span><span class="sxs-lookup"><span data-stu-id="94516-141">You can add or remove dataflow blocks to or from a pipeline or network concurrently.</span></span> <span data-ttu-id="94516-142">定義済みのデータ フロー ブロックの型は、リンクとリンク解除のすべてのスレッド セーフな側面を処理します。</span><span class="sxs-lookup"><span data-stu-id="94516-142">The predefined dataflow block types handle all thread-safety aspects of linking and unlinking.</span></span>  
  
 <span data-ttu-id="94516-143">データフロー ブロックを接続して基本的なパイプラインを作成する例については、「[チュートリアル:データフロー パイプラインの作成](walkthrough-creating-a-dataflow-pipeline.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-143">For an example that connects dataflow blocks to form a basic pipeline, see [Walkthrough: Creating a Dataflow Pipeline](walkthrough-creating-a-dataflow-pipeline.md).</span></span> <span data-ttu-id="94516-144">データフロー ブロックを接続して、より複雑なネットワークを作成する例については、「[チュートリアル:Windows フォーム アプリケーションでのデータフローの使用](walkthrough-using-dataflow-in-a-windows-forms-application.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-144">For an example that connects dataflow blocks to form a more complex network, see [Walkthrough: Using Dataflow in a Windows Forms Application](walkthrough-using-dataflow-in-a-windows-forms-application.md).</span></span> <span data-ttu-id="94516-145">ソースがターゲットにメッセージを提供した後でソースからターゲットのリンクを解除する例については、「[方法:データ フロー ブロックのリンクを解除する](how-to-unlink-dataflow-blocks.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-145">For an example that unlinks a target from a source after the source offers the target a message, see [How to: Unlink Dataflow Blocks](how-to-unlink-dataflow-blocks.md).</span></span>  
  
#### <a name="filtering"></a><span data-ttu-id="94516-146">フィルター処理</span><span class="sxs-lookup"><span data-stu-id="94516-146">Filtering</span></span>  

 <span data-ttu-id="94516-147"><xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A?displayProperty=nameWithType> メソッドを呼び出してソースをターゲットにリンクする場合、デリゲートを指定して、ターゲット ブロックがメッセージの値に基づいて、メッセージを受け入れるか拒否するかを決めることができます。</span><span class="sxs-lookup"><span data-stu-id="94516-147">When you call the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A?displayProperty=nameWithType> method to link a source to a target, you can supply a delegate that determines whether the target block accepts or rejects a message based on the value of that message.</span></span> <span data-ttu-id="94516-148">このフィルター機構は、データ フロー ブロックが特定の値のみを確実に受信するために便利な方法です。</span><span class="sxs-lookup"><span data-stu-id="94516-148">This filtering mechanism is a useful way to guarantee that a dataflow block receives only certain values.</span></span> <span data-ttu-id="94516-149">定義済みのデータ フロー ブロックの型のほとんどの場合に、ソース ブロックが複数のターゲット ブロックに接続されている場合は、ターゲット ブロックがメッセージを拒否すると、ソースはそのメッセージを次のターゲットに提供します。</span><span class="sxs-lookup"><span data-stu-id="94516-149">For most of the predefined dataflow block types, if a source block is connected to multiple target blocks, when a target block rejects a message, the source offers that message to the next target.</span></span> <span data-ttu-id="94516-150">ソースがターゲットにメッセージを提供する順序はソースによって定義され、ソースの種類によって異なる場合があります。</span><span class="sxs-lookup"><span data-stu-id="94516-150">The order in which a source offers messages to targets is defined by the source and can vary according to the type of the source.</span></span> <span data-ttu-id="94516-151">1 つのターゲットがメッセージを受け入れると、ほとんどのソース ブロックの型がメッセージの提供を停止します。</span><span class="sxs-lookup"><span data-stu-id="94516-151">Most source block types stop offering a message after one target accepts that message.</span></span> <span data-ttu-id="94516-152">この規則の 1 つの例外は、<xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> クラスです。いくつかのターゲットがメッセージを拒否した場合でも、各メッセージをすべてのターゲットに提供します。</span><span class="sxs-lookup"><span data-stu-id="94516-152">One exception to this rule is the <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> class, which offers each message to all targets, even if some targets reject the message.</span></span> <span data-ttu-id="94516-153">フィルター処理を使って、特定のメッセージのみを処理する例については、「[チュートリアル:Windows フォーム アプリケーションでのデータフローの使用](walkthrough-using-dataflow-in-a-windows-forms-application.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-153">For an example that uses filtering to process only certain messages, see [Walkthrough: Using Dataflow in a Windows Forms Application](walkthrough-using-dataflow-in-a-windows-forms-application.md).</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="94516-154">それぞれの定義済みのソースのデータ フロー ブロックの型は、メッセージを受信した順にそれが伝達されることを保証するため、ソース ブロックは各メッセージを読み取ってから、次のメッセージを処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="94516-154">Because each predefined source dataflow block type guarantees that messages are propagated out in the order in which they are received, every message must be read from the source block before the source block can process the next message.</span></span> <span data-ttu-id="94516-155">したがって、フィルター処理を使用して複数のターゲットをソースに接続する場合、各メッセージを少なくとも 1 つのターゲット ブロックが受信するようにします。</span><span class="sxs-lookup"><span data-stu-id="94516-155">Therefore, when you use filtering to connect multiple targets to a source, make sure that at least one target block receives each message.</span></span> <span data-ttu-id="94516-156">そうしない場合、アプリケーションでデッドロックが発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="94516-156">Otherwise, your application might deadlock.</span></span>  
  
### <a name="message-passing"></a><span data-ttu-id="94516-157">メッセージ パッシング</span><span class="sxs-lookup"><span data-stu-id="94516-157">Message Passing</span></span>  

 <span data-ttu-id="94516-158">データ フロー プログラミング モデルは、プログラムの独立したコンポーネントがメッセージの送信によって相互に通信する、*メッセージ パッシング* の概念に関連しています。</span><span class="sxs-lookup"><span data-stu-id="94516-158">The dataflow programming model is related to the concept of *message passing*, where independent components of a program communicate with one another by sending messages.</span></span> <span data-ttu-id="94516-159">アプリケーション コンポーネントの間でメッセージを伝達する方法の 1 つは、<xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A> および <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A?displayProperty=nameWithType> メソッドを呼び出して、ターゲット データ フロー ブロック ポストにメッセージを送信し (<xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A> は同期的に動作し、<xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A> は非同期的に動作します)、<xref:System.Threading.Tasks.Dataflow.DataflowBlock.Receive%2A>、<xref:System.Threading.Tasks.Dataflow.DataflowBlock.ReceiveAsync%2A>、および <xref:System.Threading.Tasks.Dataflow.DataflowBlock.TryReceive%2A> メソッドを呼び出して、ソース ブロックからメッセージを受け取ることです。</span><span class="sxs-lookup"><span data-stu-id="94516-159">One way to propagate messages among application components is to call the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A> and <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A?displayProperty=nameWithType> methods to send messages to target dataflow blocks post (<xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A> acts synchronously; <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A> acts asynchronously) and the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Receive%2A>, <xref:System.Threading.Tasks.Dataflow.DataflowBlock.ReceiveAsync%2A>, and <xref:System.Threading.Tasks.Dataflow.DataflowBlock.TryReceive%2A> methods to receive messages from source blocks.</span></span> <span data-ttu-id="94516-160">入力データをヘッド ノード (ターゲット ブロック) に送信し、出力データをパイプラインのターミナル ノードまたはネットワーク (1 つ以上のソース ブロック) のターミナル ノードから受信することにより、これらのメソッドとデータ フロー パイプラインまたはネットワークを結合することができます。</span><span class="sxs-lookup"><span data-stu-id="94516-160">You can combine these methods with dataflow pipelines or networks by sending input data to the head node (a target block), and receiving output data from the terminal node of the pipeline or the terminal nodes of the network (one or more source blocks).</span></span> <span data-ttu-id="94516-161"><xref:System.Threading.Tasks.Dataflow.DataflowBlock.Choose%2A> メソッドを使用して、データが使用可能な、指定されたソースの先頭から読み取り、そのデータにアクションを実行することもできます。</span><span class="sxs-lookup"><span data-stu-id="94516-161">You can also use the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Choose%2A> method to read from the first of the provided sources that has data available and perform action on that data.</span></span>  
  
 <span data-ttu-id="94516-162">ソース ブロックは、<xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A?displayProperty=nameWithType> メソッドを呼び出して、ターゲット ブロックにデータを提供します。</span><span class="sxs-lookup"><span data-stu-id="94516-162">Source blocks offer data to target blocks by calling the <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="94516-163">ターゲット ブロックは、提供されたメッセージに、3 つの方法のうちの 1 つで応答します。メッセージを受け入れるか、メッセージを拒否するか、またはメッセージを延期できます。</span><span class="sxs-lookup"><span data-stu-id="94516-163">The target block responds to an offered message in one of three ways: it can accept the message, decline the message, or postpone the message.</span></span> <span data-ttu-id="94516-164">ターゲットがメッセージを受け入れると、<xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> メソッドは <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.Accepted> を返します。</span><span class="sxs-lookup"><span data-stu-id="94516-164">When the target accepts the message, the <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> method returns <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.Accepted>.</span></span> <span data-ttu-id="94516-165">ターゲットがメッセージを拒否すると、<xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> メソッドは <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.Declined> を返します。</span><span class="sxs-lookup"><span data-stu-id="94516-165">When the target declines the message, the <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> method returns <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.Declined>.</span></span> <span data-ttu-id="94516-166">ターゲットがソースからメッセージを受け取らないことを要求すると、<xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> は <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.DecliningPermanently> を返します。</span><span class="sxs-lookup"><span data-stu-id="94516-166">When the target requires that it no longer receives any messages from the source, <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> returns <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.DecliningPermanently>.</span></span> <span data-ttu-id="94516-167">その戻り値を受信した後は、定義済みのソース ブロックの型は、リンクされたターゲットにメッセージを提供せず、自動的にそのターゲットからリンク解除します。</span><span class="sxs-lookup"><span data-stu-id="94516-167">The predefined source block types do not offer messages to linked targets after such a return value is received, and they automatically unlink from such targets.</span></span>  
  
 <span data-ttu-id="94516-168">後で使用するために、ターゲット ブロックがメッセージを延期すると、<xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> メソッドは <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.Postponed> を返します。</span><span class="sxs-lookup"><span data-stu-id="94516-168">When a target block postpones the message for later use, the <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> method returns <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.Postponed>.</span></span> <span data-ttu-id="94516-169">メッセージを延期したターゲット ブロックは、後から <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ReserveMessage%2A?displayProperty=nameWithType> メソッドを呼び出して、提供されたメッセージの予約を試みることができます。</span><span class="sxs-lookup"><span data-stu-id="94516-169">A target block that postpones a message can later call the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ReserveMessage%2A?displayProperty=nameWithType> method to try to reserve the offered message.</span></span> <span data-ttu-id="94516-170">この時点で、メッセージはまだ使用できてターゲット ブロックから使用できるか、または他のターゲットに取得されています。</span><span class="sxs-lookup"><span data-stu-id="94516-170">At this point, the message is either still available and can be used by the target block, or the message has been taken by another target.</span></span> <span data-ttu-id="94516-171">ターゲット ブロックがメッセージを後から必要とする場合、またはメッセージを必要としない場合には、それぞれ <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ConsumeMessage%2A?displayProperty=nameWithType> または <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ReleaseReservation%2A> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="94516-171">When the target block later requires the message or no longer needs the message, it calls the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ConsumeMessage%2A?displayProperty=nameWithType> or <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ReleaseReservation%2A> method, respectively.</span></span> <span data-ttu-id="94516-172">通常は、メッセージの予約は、最短一致のモードで動作するデータ フロー ブロックの型で使用されます。</span><span class="sxs-lookup"><span data-stu-id="94516-172">Message reservation is typically used by the dataflow block types that operate in non-greedy mode.</span></span> <span data-ttu-id="94516-173">最短一致のモードについては、このドキュメントの後で説明します。</span><span class="sxs-lookup"><span data-stu-id="94516-173">Non-greedy mode is explained later in this document.</span></span> <span data-ttu-id="94516-174">延期されたメッセージを予約せずに、ターゲット ブロックは <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ConsumeMessage%2A?displayProperty=nameWithType> メソッドを使用して、直接延期されたメッセージを使用しようとすることもできます。</span><span class="sxs-lookup"><span data-stu-id="94516-174">Instead of reserving a postponed message, a target block can also use the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ConsumeMessage%2A?displayProperty=nameWithType> method to attempt to directly consume the postponed message.</span></span>  
  
### <a name="dataflow-block-completion"></a><span data-ttu-id="94516-175">データ フロー ブロックの完了</span><span class="sxs-lookup"><span data-stu-id="94516-175">Dataflow Block Completion</span></span>  

 <span data-ttu-id="94516-176">データ フロー ブロックは、*完了* の概念をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="94516-176">Dataflow blocks also support the concept of *completion*.</span></span> <span data-ttu-id="94516-177">完了した状態にあるデータ フロー ブロックは、処理を実行しません。</span><span class="sxs-lookup"><span data-stu-id="94516-177">A dataflow block that is in the completed state does not perform any further work.</span></span> <span data-ttu-id="94516-178">各データ フロー ブロックには、ブロックの完了ステータスを表す "*完了タスク*" と呼ばれる <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> オブジェクトが関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="94516-178">Each dataflow block has an associated <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> object, known as a *completion task*, that represents the completion status of the block.</span></span> <span data-ttu-id="94516-179"><xref:System.Threading.Tasks.Task> オブジェクトの終了を待機できるため、完了タスクを使用して、データ フロー ネットワークの 1 つ以上のターミナル ノードが終了するまで待機できます。</span><span class="sxs-lookup"><span data-stu-id="94516-179">Because you can wait for a <xref:System.Threading.Tasks.Task> object to finish, by using completion tasks, you can wait for one or more terminal nodes of a dataflow network to finish.</span></span> <span data-ttu-id="94516-180"><xref:System.Threading.Tasks.Dataflow.IDataflowBlock> インターフェイスは、データ フロー ブロックに完了の要求を通知する <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A> メソッドを定義し、またデータ フロー ブロックの完了タスクを返す <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Completion%2A> プロパティを定義します。</span><span class="sxs-lookup"><span data-stu-id="94516-180">The <xref:System.Threading.Tasks.Dataflow.IDataflowBlock> interface defines the <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A> method, which informs the dataflow block of a request for it to complete, and the <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Completion%2A> property, which returns the completion task for the dataflow block.</span></span> <span data-ttu-id="94516-181"><xref:System.Threading.Tasks.Dataflow.ISourceBlock%601> と <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> はどちらも <xref:System.Threading.Tasks.Dataflow.IDataflowBlock> インターフェイスを継承します。</span><span class="sxs-lookup"><span data-stu-id="94516-181">Both <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601> and <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> inherit the <xref:System.Threading.Tasks.Dataflow.IDataflowBlock> interface.</span></span>  
  
 <span data-ttu-id="94516-182">データ フロー ブロックがエラーなしで完了したか、1 つのエラーが発生したか、複数のエラーが発生したか、取り消されたかを知る 2 つの方法があります。</span><span class="sxs-lookup"><span data-stu-id="94516-182">There are two ways to determine whether a dataflow block completed without error, encountered one or more errors, or was canceled.</span></span> <span data-ttu-id="94516-183">最初の方法は、`try`-`catch` ブロック (Visual Basic では `Try`-`Catch`) の完了タスクで <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> メソッドを呼び出すことです。</span><span class="sxs-lookup"><span data-stu-id="94516-183">The first way is to call the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method on the completion task in a `try`-`catch` block (`Try`-`Catch` in Visual Basic).</span></span> <span data-ttu-id="94516-184">次の例では、入力値が 0 未満の場合に <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> をスローする <xref:System.ArgumentOutOfRangeException> オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="94516-184">The following example creates an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object that throws <xref:System.ArgumentOutOfRangeException> if its input value is less than zero.</span></span> <span data-ttu-id="94516-185">この例では、完了タスクで <xref:System.AggregateException> を呼び出すと、<xref:System.Threading.Tasks.Task.Wait%2A> がスローされます。</span><span class="sxs-lookup"><span data-stu-id="94516-185"><xref:System.AggregateException> is thrown when this example calls <xref:System.Threading.Tasks.Task.Wait%2A> on the completion task.</span></span> <span data-ttu-id="94516-186"><xref:System.ArgumentOutOfRangeException> には <xref:System.AggregateException.InnerExceptions%2A> オブジェクトの <xref:System.AggregateException> プロパティを使用してアクセスします。</span><span class="sxs-lookup"><span data-stu-id="94516-186">The <xref:System.ArgumentOutOfRangeException> is accessed through the <xref:System.AggregateException.InnerExceptions%2A> property of the <xref:System.AggregateException> object.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#10](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#10)]
 [!code-vb[TPLDataflow_Overview#10](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#10)]  
  
 <span data-ttu-id="94516-187">この例は、例外が実行データ フロー ブロックのデリゲートで処理されない場合を示します。</span><span class="sxs-lookup"><span data-stu-id="94516-187">This example demonstrates the case in which an exception goes unhandled in the delegate of an execution dataflow block.</span></span> <span data-ttu-id="94516-188">そのようなブロックの本体で例外を処理することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="94516-188">We recommend that you handle exceptions in the bodies of such blocks.</span></span> <span data-ttu-id="94516-189">そのようにできない場合は、ブロックはそれが取り消されたように動作し、受信メッセージを処理しません。</span><span class="sxs-lookup"><span data-stu-id="94516-189">However, if you are unable to do so, the block behaves as though it was canceled and does not process incoming messages.</span></span>  
  
 <span data-ttu-id="94516-190">データ フロー ブロックが明示的に取り消されると、<xref:System.AggregateException> オブジェクトには <xref:System.OperationCanceledException> プロパティの <xref:System.AggregateException.InnerExceptions%2A> が含まれます。</span><span class="sxs-lookup"><span data-stu-id="94516-190">When a dataflow block is canceled explicitly, the <xref:System.AggregateException> object contains <xref:System.OperationCanceledException> in the <xref:System.AggregateException.InnerExceptions%2A> property.</span></span> <span data-ttu-id="94516-191">データ フローの取り消しの詳細については、「[取り消しの有効化](#enabling-cancellation)」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-191">For more information about dataflow cancellation, see [Enabling Cancellation](#enabling-cancellation) section.</span></span>  
  
 <span data-ttu-id="94516-192">データ フロー ブロックの完了ステータスを判定する 2 番目の方法は、完了タスクの継続を使用するか、または C# と Visual Basic の非同期言語機能を使用して、完了したタスクを非同期的に待つことです。</span><span class="sxs-lookup"><span data-stu-id="94516-192">The second way to determine the completion status of a dataflow block is to use a continuation of the completion task, or to use the asynchronous language features of C# and Visual Basic to asynchronously wait for the completion task.</span></span> <span data-ttu-id="94516-193"><xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> メソッドに提供するデリゲートは、継続元タスクを表す <xref:System.Threading.Tasks.Task> オブジェクトを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="94516-193">The delegate that you provide to the <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> method takes a <xref:System.Threading.Tasks.Task> object that represents the antecedent task.</span></span> <span data-ttu-id="94516-194"><xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Completion%2A> プロパティの場合は、継続のデリゲートは完了タスクを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="94516-194">In the case of the <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Completion%2A> property, the delegate for the continuation takes the completion task itself.</span></span> <span data-ttu-id="94516-195">次の例は前の例に似ていますが、<xref:System.Threading.Tasks.Task.ContinueWith%2A> メソッドを使用してデータ フロー操作全体のステータスを出力する継続タスクも作成している点が異なります。</span><span class="sxs-lookup"><span data-stu-id="94516-195">The following example resembles the previous one, except that it also uses the <xref:System.Threading.Tasks.Task.ContinueWith%2A> method to create a continuation task that prints the status of the overall dataflow operation.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#11](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#11)]
 [!code-vb[TPLDataflow_Overview#11](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#11)]  
  
 <span data-ttu-id="94516-196">また、継続タスクの本体で <xref:System.Threading.Tasks.Task.IsCanceled%2A> などのプロパティを使用して、データ フロー ブロックの完了ステータスに関する追加情報を決定することもできます。</span><span class="sxs-lookup"><span data-stu-id="94516-196">You can also use properties such as <xref:System.Threading.Tasks.Task.IsCanceled%2A> in the body of the continuation task to determine additional information about the completion status of a dataflow block.</span></span> <span data-ttu-id="94516-197">継続タスク、および継続タスクと取り消し処理やエラー処理との関連の詳細については、「[継続タスクを使用したタスクの連結](chaining-tasks-by-using-continuation-tasks.md)」、「[タスクのキャンセル](task-cancellation.md)」、および[例外処理](exception-handling-task-parallel-library.md)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-197">For more information about continuation tasks and how they relate to cancellation and error handling, see [Chaining Tasks by Using Continuation Tasks](chaining-tasks-by-using-continuation-tasks.md), [Task Cancellation](task-cancellation.md), and [Exception Handling](exception-handling-task-parallel-library.md).</span></span>  

## <a name="predefined-dataflow-block-types"></a><span data-ttu-id="94516-198">定義済みのデータ フロー ブロックの型</span><span class="sxs-lookup"><span data-stu-id="94516-198">Predefined Dataflow Block Types</span></span>  

 <span data-ttu-id="94516-199">TPL データ フロー ライブラリは、いくつかの定義済みのデータ フロー ブロックの型を提供します。</span><span class="sxs-lookup"><span data-stu-id="94516-199">The TPL Dataflow Library provides several predefined dataflow block types.</span></span> <span data-ttu-id="94516-200">これらの型は、*バッファリング ブロック*、*実行ブロック*、*グループ化ブロック* の 3 種類に分けられます。</span><span class="sxs-lookup"><span data-stu-id="94516-200">These types are divided into three categories: *buffering blocks*, *execution blocks*, and *grouping blocks*.</span></span> <span data-ttu-id="94516-201">次のセクションでは、これらの種類を構成するブロックの型について説明します。</span><span class="sxs-lookup"><span data-stu-id="94516-201">The following sections describe the block types that make up these categories.</span></span>  
  
### <a name="buffering-blocks"></a><span data-ttu-id="94516-202">バッファリング ブロック</span><span class="sxs-lookup"><span data-stu-id="94516-202">Buffering Blocks</span></span>  

 <span data-ttu-id="94516-203">バッファリング ブロックはデータ コンシューマーが使用するデータを保持します。</span><span class="sxs-lookup"><span data-stu-id="94516-203">Buffering blocks hold data for use by data consumers.</span></span> <span data-ttu-id="94516-204">TPL データ フロー ライブラリは <xref:System.Threading.Tasks.Dataflow.BufferBlock%601?displayProperty=nameWithType>、<xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601?displayProperty=nameWithType> と <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601?displayProperty=nameWithType> の 3 つのバッファリング ブロックの型を提供します。</span><span class="sxs-lookup"><span data-stu-id="94516-204">The TPL Dataflow Library provides three buffering block types: <xref:System.Threading.Tasks.Dataflow.BufferBlock%601?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601?displayProperty=nameWithType>, and <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601?displayProperty=nameWithType>.</span></span>  
  
#### <a name="bufferblockt"></a><span data-ttu-id="94516-205">BufferBlock(T)</span><span class="sxs-lookup"><span data-stu-id="94516-205">BufferBlock(T)</span></span>  

 <span data-ttu-id="94516-206"><xref:System.Threading.Tasks.Dataflow.BufferBlock%601> クラスは、汎用的な非同期メッセージング構造体を表します。</span><span class="sxs-lookup"><span data-stu-id="94516-206">The <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> class represents a general-purpose asynchronous messaging structure.</span></span> <span data-ttu-id="94516-207">このクラスでは、複数のソースが書き込むことができるメッセージ、または複数のターゲットが読み取ることができるメッセージの先入れ先出し (FIFO) のキューを格納します。</span><span class="sxs-lookup"><span data-stu-id="94516-207">This class stores a first in, first out (FIFO) queue of messages that can be written to by multiple sources or read from by multiple targets.</span></span> <span data-ttu-id="94516-208">ターゲットが <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> オブジェクトからメッセージを受信すると、そのメッセージはメッセージ キューから削除されます。</span><span class="sxs-lookup"><span data-stu-id="94516-208">When a target receives a message from a <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> object, that message is removed from the message queue.</span></span> <span data-ttu-id="94516-209">そのため、<xref:System.Threading.Tasks.Dataflow.BufferBlock%601> オブジェクトには複数のターゲットを設定できますが、各メッセージを受信するターゲットは 1 つだけです。</span><span class="sxs-lookup"><span data-stu-id="94516-209">Therefore, although a <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> object can have multiple targets, only one target will receive each message.</span></span> <span data-ttu-id="94516-210"><xref:System.Threading.Tasks.Dataflow.BufferBlock%601> クラスは、複数のメッセージを別のコンポーネントに渡し、そのコンポーネントで各メッセージを受信する必要がある場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="94516-210">The <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> class is useful when you want to pass multiple messages to another component, and that component must receive each message.</span></span>  
  
 <span data-ttu-id="94516-211">次の基本的な例は、<xref:System.Int32> オブジェクトに複数の <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> の値をポストし、その値をそのオブジェクトから読み込みます。</span><span class="sxs-lookup"><span data-stu-id="94516-211">The following basic example posts several <xref:System.Int32> values to a <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> object and then reads those values back from that object.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#1)]
 [!code-vb[TPLDataflow_Overview#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#1)]  
  
 <span data-ttu-id="94516-212"><xref:System.Threading.Tasks.Dataflow.BufferBlock%601> オブジェクトに対するメッセージの書き込みと読み取りの方法を示す詳しい例については、「[方法:データフロー ブロックに対してメッセージの読み取りと書き込みを行う](how-to-write-messages-to-and-read-messages-from-a-dataflow-block.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-212">For a complete example that demonstrates how to write messages to and read messages from a <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> object, see [How to: Write Messages to and Read Messages from a Dataflow Block](how-to-write-messages-to-and-read-messages-from-a-dataflow-block.md).</span></span>  
  
#### <a name="broadcastblockt"></a><span data-ttu-id="94516-213">BroadcastBlock(T)</span><span class="sxs-lookup"><span data-stu-id="94516-213">BroadcastBlock(T)</span></span>  

 <span data-ttu-id="94516-214"><xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> クラスは、複数のメッセージを別のコンポーネントに渡すときに、そのコンポーネントで必要になるのが最新の値のみである場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="94516-214">The <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> class is useful when you must pass multiple messages to another component, but that component needs only the most recent value.</span></span> <span data-ttu-id="94516-215">また、このクラスは、メッセージを複数のコンポーネントにブロードキャストする場合にも便利です。</span><span class="sxs-lookup"><span data-stu-id="94516-215">This class is also useful when you want to broadcast a message to multiple components.</span></span>  
  
 <span data-ttu-id="94516-216">次の基本的な例は、<xref:System.Double> の値を <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> オブジェクトにポストし、その値をそのオブジェクトから複数回読み込みます。</span><span class="sxs-lookup"><span data-stu-id="94516-216">The following basic example posts a <xref:System.Double> value to a <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> object and then reads that value back from that object several times.</span></span> <span data-ttu-id="94516-217">値は読み取られた後も <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> オブジェクトから削除されないため、毎回同じ値を使用できます。</span><span class="sxs-lookup"><span data-stu-id="94516-217">Because values are not removed from <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> objects after they are read, the same value is available every time.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#2)]
 [!code-vb[TPLDataflow_Overview#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#2)]  
  
 <span data-ttu-id="94516-218"><xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> を使って複数のターゲット ブロックにメッセージをブロードキャストする方法を示す詳しい例については、「[方法:データフロー ブロックのタスク スケジューラを指定する](how-to-specify-a-task-scheduler-in-a-dataflow-block.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-218">For a complete example that demonstrates how to use <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> to broadcast a message to multiple target blocks, see [How to: Specify a Task Scheduler in a Dataflow Block](how-to-specify-a-task-scheduler-in-a-dataflow-block.md).</span></span>  
  
#### <a name="writeonceblockt"></a><span data-ttu-id="94516-219">WriteOnceBlock(T)</span><span class="sxs-lookup"><span data-stu-id="94516-219">WriteOnceBlock(T)</span></span>  

 <span data-ttu-id="94516-220"><xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> クラスは <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> クラスに似ていますが、<xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> オブジェクトに 1 回しか書き込むことができない点が異なります。</span><span class="sxs-lookup"><span data-stu-id="94516-220">The <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> class resembles the <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> class, except that a <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> object can be written to one time only.</span></span> <span data-ttu-id="94516-221"><xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> は C# の [readonly](../../csharp/language-reference/keywords/readonly.md) (Visual Basic では [ReadOnly](../../visual-basic/language-reference/modifiers/readonly.md)) キーワードと似ていると考えることができますが、構築時でなく、値を読み取った後は、<xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> オブジェクトを変更できなくなる点が異なります。</span><span class="sxs-lookup"><span data-stu-id="94516-221">You can think of <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> as being similar to the C# [readonly](../../csharp/language-reference/keywords/readonly.md) ([ReadOnly](../../visual-basic/language-reference/modifiers/readonly.md) in Visual Basic) keyword, except that a <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> object becomes immutable after it receives a value instead of at construction.</span></span> <span data-ttu-id="94516-222"><xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> クラスと同様に、ターゲットが <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> オブジェクトからメッセージを受信しても、そのメッセージはそのオブジェクトから削除されません。</span><span class="sxs-lookup"><span data-stu-id="94516-222">Like the <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> class, when a target receives a message from a <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> object, that message is not removed from that object.</span></span> <span data-ttu-id="94516-223">そのため、複数のターゲットがメッセージのコピーを受信します。</span><span class="sxs-lookup"><span data-stu-id="94516-223">Therefore, multiple targets receive a copy of the message.</span></span> <span data-ttu-id="94516-224"><xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> のクラスは、複数のメッセージの最初のメッセージだけを伝達する場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="94516-224">The <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> class is useful when you want to propagate only the first of multiple messages.</span></span>  
  
 <span data-ttu-id="94516-225">次の基本的な例は、<xref:System.String> オブジェクトに複数の <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> の値をポストし、その値をそのオブジェクトから読み込みます。</span><span class="sxs-lookup"><span data-stu-id="94516-225">The following basic example posts multiple <xref:System.String> values to a <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> object and then reads the value back from that object.</span></span> <span data-ttu-id="94516-226"><xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> オブジェクトには 1 回だけ書き込むことができるため、<xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> オブジェクトは 1 つのメッセージを受信した後は、それ以降のメッセージを破棄します。</span><span class="sxs-lookup"><span data-stu-id="94516-226">Because a <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> object can be written to one time only, after a <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> object receives a message, it discards subsequent messages.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#3)]
 [!code-vb[TPLDataflow_Overview#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#3)]  
  
 <span data-ttu-id="94516-227"><xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> を使って終了した最初の操作の値を受け取る方法を示した詳しい例については、「[方法:データフロー ブロックのリンクを解除する](how-to-unlink-dataflow-blocks.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-227">For a complete example that demonstrates how to use <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> to receive the value of the first operation that finishes, see [How to: Unlink Dataflow Blocks](how-to-unlink-dataflow-blocks.md).</span></span>  
  
### <a name="execution-blocks"></a><span data-ttu-id="94516-228">実行ブロック</span><span class="sxs-lookup"><span data-stu-id="94516-228">Execution Blocks</span></span>  

 <span data-ttu-id="94516-229">実行ブロックは、受け取ったデータのそれぞれに、ユーザーが指定したデリゲートを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="94516-229">Execution blocks call a user-provided delegate for each piece of received data.</span></span> <span data-ttu-id="94516-230">TPL データ フロー ライブラリは <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>、<xref:System.Threading.Tasks.Dataflow.TransformBlock%602?displayProperty=nameWithType> と <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602?displayProperty=nameWithType> の 3 つの実行ブロックの型を提供します。</span><span class="sxs-lookup"><span data-stu-id="94516-230">The TPL Dataflow Library provides three execution block types: <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602?displayProperty=nameWithType>, and <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602?displayProperty=nameWithType>.</span></span>  
  
#### <a name="actionblockt"></a><span data-ttu-id="94516-231">ActionBlock(T)</span><span class="sxs-lookup"><span data-stu-id="94516-231">ActionBlock(T)</span></span>  

 <span data-ttu-id="94516-232"><xref:System.Threading.Tasks.Dataflow.ActionBlock%601> クラスは、データを受け取るとデリゲートを呼び出すターゲット ブロックです。</span><span class="sxs-lookup"><span data-stu-id="94516-232">The <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> class is a target block that calls a delegate when it receives data.</span></span> <span data-ttu-id="94516-233"><xref:System.Threading.Tasks.Dataflow.ActionBlock%601> オブジェクトは、データが使用可能になったときに非同期的に実行できるデリゲートと考えることができます。</span><span class="sxs-lookup"><span data-stu-id="94516-233">Think of a <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object as a delegate that runs asynchronously when data becomes available.</span></span> <span data-ttu-id="94516-234"><xref:System.Threading.Tasks.Dataflow.ActionBlock%601> オブジェクトに提供するデリゲートは、<xref:System.Action%601> 型または`System.Func<TInput, Task>` 型を使用できます。</span><span class="sxs-lookup"><span data-stu-id="94516-234">The delegate that you provide to an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object can be of type <xref:System.Action%601> or type `System.Func<TInput, Task>`.</span></span> <span data-ttu-id="94516-235"><xref:System.Threading.Tasks.Dataflow.ActionBlock%601> オブジェクトを <xref:System.Action%601> と共に使用すると、各入力要素の処理はデリゲートが返されたときに完了したと見なされます。</span><span class="sxs-lookup"><span data-stu-id="94516-235">When you use an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object with <xref:System.Action%601>, processing of each input element is considered completed when the delegate returns.</span></span> <span data-ttu-id="94516-236"><xref:System.Threading.Tasks.Dataflow.ActionBlock%601> オブジェクトを `System.Func<TInput, Task>` と共に使用すると、各入力要素の処理は返された <xref:System.Threading.Tasks.Task> オブジェクトが終了した場合にのみ、完了したと見なされます。</span><span class="sxs-lookup"><span data-stu-id="94516-236">When you use an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object with `System.Func<TInput, Task>`, processing of each input element is considered completed only when the returned <xref:System.Threading.Tasks.Task> object is completed.</span></span> <span data-ttu-id="94516-237">この 2 つの方法を使って、<xref:System.Threading.Tasks.Dataflow.ActionBlock%601> を使用して各入力要素を同期的にも非同期的にも処理することができます。</span><span class="sxs-lookup"><span data-stu-id="94516-237">By using these two mechanisms, you can use <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> for both synchronous and asynchronous processing of each input element.</span></span>  
  
 <span data-ttu-id="94516-238">次の基本的な例では、<xref:System.Int32> オブジェクトに複数の <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> の値をポストします。</span><span class="sxs-lookup"><span data-stu-id="94516-238">The following basic example posts multiple <xref:System.Int32> values to an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object.</span></span> <span data-ttu-id="94516-239"><xref:System.Threading.Tasks.Dataflow.ActionBlock%601> オブジェクトは、コンソールにそれらの値を出力します。</span><span class="sxs-lookup"><span data-stu-id="94516-239">The <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object prints those values to the console.</span></span> <span data-ttu-id="94516-240">次にこの例では、ブロックを完了した状態に設定し、すべてのデータ フロー タスクの終了を待機します。</span><span class="sxs-lookup"><span data-stu-id="94516-240">This example then sets the block to the completed state and waits for all dataflow tasks to finish.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#4)]
 [!code-vb[TPLDataflow_Overview#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#4)]  
  
 <span data-ttu-id="94516-241"><xref:System.Threading.Tasks.Dataflow.ActionBlock%601> クラスとデリゲートの使用方法を示した詳しい例については、「[方法:データフロー ブロックでデータを受信したときにアクションを実行する](how-to-perform-action-when-a-dataflow-block-receives-data.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-241">For complete examples that demonstrate how to use delegates with the <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> class, see [How to: Perform Action When a Dataflow Block Receives Data](how-to-perform-action-when-a-dataflow-block-receives-data.md).</span></span>  
  
#### <a name="transformblocktinput-toutput"></a><span data-ttu-id="94516-242">TransformBlock(TInput, TOutput)</span><span class="sxs-lookup"><span data-stu-id="94516-242">TransformBlock(TInput, TOutput)</span></span>  

 <span data-ttu-id="94516-243"><xref:System.Threading.Tasks.Dataflow.TransformBlock%602> クラスは <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> クラスに似ていますが、ソースとしてもターゲットとしても動作する点が異なります。</span><span class="sxs-lookup"><span data-stu-id="94516-243">The <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> class resembles the <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> class, except that it acts as both a source and as a target.</span></span> <span data-ttu-id="94516-244"><xref:System.Threading.Tasks.Dataflow.TransformBlock%602> オブジェクトに渡すデリゲートは `TOutput` 型の値を返します。</span><span class="sxs-lookup"><span data-stu-id="94516-244">The delegate that you pass to a <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> object returns a value of type `TOutput`.</span></span> <span data-ttu-id="94516-245"><xref:System.Threading.Tasks.Dataflow.TransformBlock%602> オブジェクトに提供するデリゲートは、`System.Func<TInput, TOutput>` 型または`System.Func<TInput, Task<TOutput>>` 型を使用できます。</span><span class="sxs-lookup"><span data-stu-id="94516-245">The delegate that you provide to a <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> object can be of type `System.Func<TInput, TOutput>` or type `System.Func<TInput, Task<TOutput>>`.</span></span> <span data-ttu-id="94516-246"><xref:System.Threading.Tasks.Dataflow.TransformBlock%602> オブジェクトを `System.Func<TInput, TOutput>` と共に使用すると、各入力要素の処理はデリゲートが返されたときに完了したと見なされます。</span><span class="sxs-lookup"><span data-stu-id="94516-246">When you use a <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> object with `System.Func<TInput, TOutput>`, processing of each input element is considered completed when the delegate returns.</span></span> <span data-ttu-id="94516-247"><xref:System.Threading.Tasks.Dataflow.TransformBlock%602> オブジェクトを `System.Func<TInput, Task<TOutput>>` と共に使用すると、各入力要素の処理は返された <xref:System.Threading.Tasks.Task%601> オブジェクトが終了した場合にのみ、完了したと見なされます。</span><span class="sxs-lookup"><span data-stu-id="94516-247">When you use a <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> object used with `System.Func<TInput, Task<TOutput>>`, processing of each input element is considered completed only when the returned <xref:System.Threading.Tasks.Task%601> object is completed.</span></span> <span data-ttu-id="94516-248"><xref:System.Threading.Tasks.Dataflow.ActionBlock%601> と同様に、この 2 つの方法を使って、<xref:System.Threading.Tasks.Dataflow.TransformBlock%602> を使用して各入力要素を同期的にも非同期的にも処理することができます。</span><span class="sxs-lookup"><span data-stu-id="94516-248">As with <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, by using these two mechanisms, you can use <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> for both synchronous and asynchronous processing of each input element.</span></span>  
  
 <span data-ttu-id="94516-249">次の基本的な例では、入力の平方根を計算する <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="94516-249">The following basic example creates a <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> object that computes the square root of its input.</span></span> <span data-ttu-id="94516-250"><xref:System.Threading.Tasks.Dataflow.TransformBlock%602> オブジェクトは、入力として <xref:System.Int32> の値を受け取り、出力として <xref:System.Double> の値を生成します。</span><span class="sxs-lookup"><span data-stu-id="94516-250">The <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> object takes <xref:System.Int32> values as input and produces <xref:System.Double> values as output.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#5)]
 [!code-vb[TPLDataflow_Overview#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#5)]  
  
 <span data-ttu-id="94516-251">Windows フォーム アプリケーションでイメージ処理を実行するデータフロー ブロックのネットワークにおいて <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> を使用する詳しい例については、「[チュートリアル:Windows フォーム アプリケーションでのデータフローの使用](walkthrough-using-dataflow-in-a-windows-forms-application.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-251">For complete examples that uses <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> in a network of dataflow blocks that performs image processing in a Windows Forms application, see [Walkthrough: Using Dataflow in a Windows Forms Application](walkthrough-using-dataflow-in-a-windows-forms-application.md).</span></span>  
  
#### <a name="transformmanyblocktinput-toutput"></a><span data-ttu-id="94516-252">TransformManyBlock(TInput, TOutput)</span><span class="sxs-lookup"><span data-stu-id="94516-252">TransformManyBlock(TInput, TOutput)</span></span>  

 <span data-ttu-id="94516-253"><xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> クラスは <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> クラスに似ていますが、各入力値に 1 つの出力値を生成するのでなく、<xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> は各入力値に出力値を生成しないか、または 1 つ以上の出力値を生成する点が異なります。</span><span class="sxs-lookup"><span data-stu-id="94516-253">The <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> class resembles the <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> class, except that <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> produces zero or more output values for each input value, instead of only one output value for each input value.</span></span> <span data-ttu-id="94516-254"><xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> オブジェクトに提供するデリゲートは、`System.Func<TInput, IEnumerable<TOutput>>` 型または`System.Func<TInput, Task<IEnumerable<TOutput>>>` 型を使用できます。</span><span class="sxs-lookup"><span data-stu-id="94516-254">The delegate that you provide to a <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> object can be of type `System.Func<TInput, IEnumerable<TOutput>>` or type `System.Func<TInput, Task<IEnumerable<TOutput>>>`.</span></span> <span data-ttu-id="94516-255"><xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> オブジェクトを `System.Func<TInput, IEnumerable<TOutput>>` と共に使用すると、各入力要素の処理はデリゲートが返されたときに完了したと見なされます。</span><span class="sxs-lookup"><span data-stu-id="94516-255">When you use a <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> object with `System.Func<TInput, IEnumerable<TOutput>>`, processing of each input element is considered completed when the delegate returns.</span></span> <span data-ttu-id="94516-256"><xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> オブジェクトを `System.Func<TInput, Task<IEnumerable<TOutput>>>` と共に使用すると、各入力要素の処理は返された `System.Threading.Tasks.Task<IEnumerable<TOutput>>` オブジェクトが終了した場合にのみ、完了したと見なされます。</span><span class="sxs-lookup"><span data-stu-id="94516-256">When you use a <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> object with `System.Func<TInput, Task<IEnumerable<TOutput>>>`, processing of each input element is considered complete only when the returned `System.Threading.Tasks.Task<IEnumerable<TOutput>>` object is completed.</span></span>  
  
 <span data-ttu-id="94516-257">次の基本的な例は、文字列を個別の文字のシーケンスに分割する <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="94516-257">The following basic example creates a <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> object that splits strings into their individual character sequences.</span></span> <span data-ttu-id="94516-258"><xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> オブジェクトは、入力として <xref:System.String> の値を受け取り、出力として <xref:System.Char> の値を生成します。</span><span class="sxs-lookup"><span data-stu-id="94516-258">The <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> object takes <xref:System.String> values as input and produces <xref:System.Char> values as output.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#6)]
 [!code-vb[TPLDataflow_Overview#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#6)]  
  
 <span data-ttu-id="94516-259"><xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> を使ってデータフロー パイプラインの各入力に複数の独立した出力を生成する詳しい例については、「[チュートリアル:データフロー パイプラインの作成](walkthrough-creating-a-dataflow-pipeline.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-259">For complete examples that use <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> to produce multiple independent outputs for each input in a dataflow pipeline, see [Walkthrough: Creating a Dataflow Pipeline](walkthrough-creating-a-dataflow-pipeline.md).</span></span>  
  
#### <a name="degree-of-parallelism"></a><span data-ttu-id="94516-260">並列化の次数</span><span class="sxs-lookup"><span data-stu-id="94516-260">Degree of Parallelism</span></span>  

 <span data-ttu-id="94516-261">すべての <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> と <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> オブジェクトは、ブロックが入力メッセージを処理できるようになるまで、入力メッセージをバッファリングします。</span><span class="sxs-lookup"><span data-stu-id="94516-261">Every <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602>, and <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> object buffers input messages until the block is ready to process them.</span></span> <span data-ttu-id="94516-262">既定では、これらのクラスはメッセージを受信した順序で、一度に 1 つずつ処理します。</span><span class="sxs-lookup"><span data-stu-id="94516-262">By default, these classes process messages in the order in which they are received, one message at a time.</span></span> <span data-ttu-id="94516-263"><xref:System.Threading.Tasks.Dataflow.ActionBlock%601>、<xref:System.Threading.Tasks.Dataflow.TransformBlock%602> と <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> のオブジェクトを有効化し、並列化の次数を指定して、複数のメッセージを同時に処理することもできます。</span><span class="sxs-lookup"><span data-stu-id="94516-263">You can also specify the degree of parallelism to enable <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> and <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> objects to process multiple messages concurrently.</span></span> <span data-ttu-id="94516-264">同時実行に関する詳細については、このドキュメントの後の「並列化の次数の指定」のセクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-264">For more information about concurrent execution, see the section Specifying the Degree of Parallelism later in this document.</span></span> <span data-ttu-id="94516-265">並列化の次数を設定して実行データフロー ブロックを有効化し、同時に複数のメッセージを処理する例については、「[方法:データ フロー ブロックで並列処理の範囲を指定する](how-to-specify-the-degree-of-parallelism-in-a-dataflow-block.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-265">For an example that sets the degree of parallelism to enable an execution dataflow block to process more than one message at a time, see [How to: Specify the Degree of Parallelism in a Dataflow Block](how-to-specify-the-degree-of-parallelism-in-a-dataflow-block.md).</span></span>  
  
#### <a name="summary-of-delegate-types"></a><span data-ttu-id="94516-266">デリゲート型の概要</span><span class="sxs-lookup"><span data-stu-id="94516-266">Summary of Delegate Types</span></span>  

 <span data-ttu-id="94516-267">次の表に、<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>、<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>、および <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> オブジェクトに指定できるデリゲート型の概要を示します。</span><span class="sxs-lookup"><span data-stu-id="94516-267">The following table summarizes the delegate types that you can provide to <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602>, and <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> objects.</span></span> <span data-ttu-id="94516-268">このテーブルでは、デリゲート型が同期的または非同期的に動作するかどうかについても示しています。</span><span class="sxs-lookup"><span data-stu-id="94516-268">This table also specifies whether the delegate type operates synchronously or asynchronously.</span></span>  
  
|<span data-ttu-id="94516-269">種類</span><span class="sxs-lookup"><span data-stu-id="94516-269">Type</span></span>|<span data-ttu-id="94516-270">同期的なデリゲート型</span><span class="sxs-lookup"><span data-stu-id="94516-270">Synchronous Delegate Type</span></span>|<span data-ttu-id="94516-271">非同期的なデリゲート型</span><span class="sxs-lookup"><span data-stu-id="94516-271">Asynchronous Delegate Type</span></span>|  
|----------|-------------------------------|--------------------------------|  
|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|`System.Action`|`System.Func<TInput, Task>`|  
|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|`System.Func<TInput, TOutput>`|`System.Func<TInput, Task<TOutput>>`|  
|<xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>|`System.Func<TInput, IEnumerable<TOutput>>`|`System.Func<TInput, Task<IEnumerable<TOutput>>>`|  
  
 <span data-ttu-id="94516-272">実行ブロックの型を使用する場合にラムダ式を使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="94516-272">You can also use lambda expressions when you work with execution block types.</span></span> <span data-ttu-id="94516-273">実行ブロックと共にラムダ式を使用する方法を示した例については、「[方法:データフロー ブロックでデータを受信したときにアクションを実行する](how-to-perform-action-when-a-dataflow-block-receives-data.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-273">For an example that shows how to use a lambda expression with an execution block, see [How to: Perform Action When a Dataflow Block Receives Data](how-to-perform-action-when-a-dataflow-block-receives-data.md).</span></span>  
  
### <a name="grouping-blocks"></a><span data-ttu-id="94516-274">グループ化ブロック</span><span class="sxs-lookup"><span data-stu-id="94516-274">Grouping Blocks</span></span>  

 <span data-ttu-id="94516-275">グループ化ブロックは、さまざまな制約の下で 1 つ以上のソースからデータをまとめます。</span><span class="sxs-lookup"><span data-stu-id="94516-275">Grouping blocks combine data from one or more sources and under various constraints.</span></span> <span data-ttu-id="94516-276">TPL データ フロー ライブラリは <xref:System.Threading.Tasks.Dataflow.BatchBlock%601>、<xref:System.Threading.Tasks.Dataflow.JoinBlock%602> と <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> の 3 つの結合ブロックの型を提供します。</span><span class="sxs-lookup"><span data-stu-id="94516-276">The TPL Dataflow Library provides three join block types: <xref:System.Threading.Tasks.Dataflow.BatchBlock%601>, <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>, and <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602>.</span></span>  
  
#### <a name="batchblockt"></a><span data-ttu-id="94516-277">BatchBlock(T)</span><span class="sxs-lookup"><span data-stu-id="94516-277">BatchBlock(T)</span></span>  

 <span data-ttu-id="94516-278"><xref:System.Threading.Tasks.Dataflow.BatchBlock%601> クラスは、バッチと呼ばれる入力データのセットを、出力データの配列に結合します。</span><span class="sxs-lookup"><span data-stu-id="94516-278">The <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> class combines sets of input data, which are known as batches, into arrays of output data.</span></span> <span data-ttu-id="94516-279"><xref:System.Threading.Tasks.Dataflow.BatchBlock%601> オブジェクトを作成するときに、各バッチのサイズを指定します。</span><span class="sxs-lookup"><span data-stu-id="94516-279">You specify the size of each batch when you create a <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object.</span></span> <span data-ttu-id="94516-280"><xref:System.Threading.Tasks.Dataflow.BatchBlock%601> オブジェクトは、指定した数の入力要素を受け取ると、その要素を含む配列を非同期的に伝達します。</span><span class="sxs-lookup"><span data-stu-id="94516-280">When the <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object receives the specified count of input elements, it asynchronously propagates out an array that contains those elements.</span></span> <span data-ttu-id="94516-281"><xref:System.Threading.Tasks.Dataflow.BatchBlock%601> オブジェクトが完了状態に設定されているが、バッチを形成するために十分な要素を含んでいない場合には、残りの入力要素を含む最終的な配列を伝達します。</span><span class="sxs-lookup"><span data-stu-id="94516-281">If a <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object is set to the completed state but does not contain enough elements to form a batch, it propagates out a final array that contains the remaining input elements.</span></span>  
  
 <span data-ttu-id="94516-282"><xref:System.Threading.Tasks.Dataflow.BatchBlock%601> クラスは、"*最長一致*" モードまたは "*最短一致*" モードのどちらかで動作します。</span><span class="sxs-lookup"><span data-stu-id="94516-282">The <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> class operates in either *greedy* or *non-greedy* mode.</span></span> <span data-ttu-id="94516-283">既定では最長一致モードで、<xref:System.Threading.Tasks.Dataflow.BatchBlock%601> オブジェクトは提供されたすべてのメッセージを受け取り、指定された数の要素を受け取った後に、配列を伝達します。</span><span class="sxs-lookup"><span data-stu-id="94516-283">In greedy mode, which is the default, a <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object accepts every message that it is offered and propagates out an array after it receives the specified count of elements.</span></span> <span data-ttu-id="94516-284">最短一致モードでは、<xref:System.Threading.Tasks.Dataflow.BatchBlock%601> オブジェクトは、バッチを作成するために十分なソースがブロックへのメッセージを提供するまで、すべての受信メッセージを延期します。</span><span class="sxs-lookup"><span data-stu-id="94516-284">In non-greedy mode, a <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object postpones all incoming messages until enough sources have offered messages to the block to form a batch.</span></span> <span data-ttu-id="94516-285">最長一致モードでは通常、最短一致モードよりも処理のオーバーヘッドが低いため、パフォーマンスがよくなります。</span><span class="sxs-lookup"><span data-stu-id="94516-285">Greedy mode typically performs better than non-greedy mode because it requires less processing overhead.</span></span> <span data-ttu-id="94516-286">ただし、アトミックな方法で複数のソースの使用量を調整する必要がある場合、最短一致モードを使用できます。</span><span class="sxs-lookup"><span data-stu-id="94516-286">However, you can use non-greedy mode when you must coordinate consumption from multiple sources in an atomic fashion.</span></span> <span data-ttu-id="94516-287">最短一致モードを指定するには、<xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> コンストラクターの `False` パラメーターの `dataflowBlockOptions` へ <xref:System.Threading.Tasks.Dataflow.BatchBlock%601.%23ctor%2A> を設定します。</span><span class="sxs-lookup"><span data-stu-id="94516-287">Specify non-greedy mode by setting <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> to `False` in the `dataflowBlockOptions` parameter in the <xref:System.Threading.Tasks.Dataflow.BatchBlock%601.%23ctor%2A> constructor.</span></span>  
  
 <span data-ttu-id="94516-288">次の基本的な例では、複数の <xref:System.Int32> の値を、バッチに 10 個の要素を持つ <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> オブジェクトにポストします。</span><span class="sxs-lookup"><span data-stu-id="94516-288">The following basic example posts several <xref:System.Int32> values to a <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object that holds ten elements in a batch.</span></span> <span data-ttu-id="94516-289"><xref:System.Threading.Tasks.Dataflow.BatchBlock%601> からすべての値が伝達されることを保証するために、この例では <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="94516-289">To guarantee that all values propagate out of the <xref:System.Threading.Tasks.Dataflow.BatchBlock%601>, this example calls the <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A> method.</span></span> <span data-ttu-id="94516-290"><xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A> メソッドは <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> オブジェクトを完了状態に設定するため、<xref:System.Threading.Tasks.Dataflow.BatchBlock%601> オブジェクトは残りのすべての要素を最終バッチとして伝達します。</span><span class="sxs-lookup"><span data-stu-id="94516-290">The <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A> method sets the <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object to the completed state, and therefore, the <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object propagates out any remaining elements as a final batch.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#7](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#7)]
 [!code-vb[TPLDataflow_Overview#7](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#7)]  
  
 <span data-ttu-id="94516-291"><xref:System.Threading.Tasks.Dataflow.BatchBlock%601> を使用してデータベースの挿入操作の効率を向上させる詳しい例ついては、「[チュートリアル:BatchBlock および BatchedJoinBlock を使用した効率の向上](walkthrough-using-batchblock-and-batchedjoinblock-to-improve-efficiency.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-291">For a complete example that uses <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> to improve the efficiency of database insert operations, see [Walkthrough: Using BatchBlock and BatchedJoinBlock to Improve Efficiency](walkthrough-using-batchblock-and-batchedjoinblock-to-improve-efficiency.md).</span></span>  
  
#### <a name="joinblockt1-t2-"></a><span data-ttu-id="94516-292">JoinBlock(T1, T2, ...)</span><span class="sxs-lookup"><span data-stu-id="94516-292">JoinBlock(T1, T2, ...)</span></span>  

 <span data-ttu-id="94516-293"><xref:System.Threading.Tasks.Dataflow.JoinBlock%602> と <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> クラスは、入力要素を収集して、それらの要素を含む <xref:System.Tuple%602?displayProperty=nameWithType> または <xref:System.Tuple%603?displayProperty=nameWithType> オブジェクトを伝達します。</span><span class="sxs-lookup"><span data-stu-id="94516-293">The <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> and <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> classes collect input elements and propagate out <xref:System.Tuple%602?displayProperty=nameWithType> or <xref:System.Tuple%603?displayProperty=nameWithType> objects that contain those elements.</span></span> <span data-ttu-id="94516-294"><xref:System.Threading.Tasks.Dataflow.JoinBlock%602> クラスと <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> クラスは、<xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> を継承しません。</span><span class="sxs-lookup"><span data-stu-id="94516-294">The <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> and <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> classes do not inherit from <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>.</span></span> <span data-ttu-id="94516-295">代わりに、<xref:System.Threading.Tasks.Dataflow.JoinBlock%602.Target1%2A> を実装する <xref:System.Threading.Tasks.Dataflow.JoinBlock%602.Target2%2A>、<xref:System.Threading.Tasks.Dataflow.JoinBlock%603.Target3%2A>、および <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> のプロパティを提供します。</span><span class="sxs-lookup"><span data-stu-id="94516-295">Instead, they provide properties, <xref:System.Threading.Tasks.Dataflow.JoinBlock%602.Target1%2A>, <xref:System.Threading.Tasks.Dataflow.JoinBlock%602.Target2%2A>, and <xref:System.Threading.Tasks.Dataflow.JoinBlock%603.Target3%2A>, that implement <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>.</span></span>  
  
 <span data-ttu-id="94516-296"><xref:System.Threading.Tasks.Dataflow.BatchBlock%601> と同様に、<xref:System.Threading.Tasks.Dataflow.JoinBlock%602> および <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> は、最長一致モードまたは最短一致モードのどちらかで動作します。</span><span class="sxs-lookup"><span data-stu-id="94516-296">Like <xref:System.Threading.Tasks.Dataflow.BatchBlock%601>, <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> and <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> operate in either greedy or non-greedy mode.</span></span> <span data-ttu-id="94516-297">既定では最長一致モードで、<xref:System.Threading.Tasks.Dataflow.JoinBlock%602> または <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> オブジェクトは提供されたすべてのメッセージを受け取り、各ターゲットが少なくとも 1 つのメッセージを受け取った後で、タプルを伝達します。</span><span class="sxs-lookup"><span data-stu-id="94516-297">In greedy mode, which is the default, a <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> or <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> object accepts every message that it is offered and propagates out a tuple after each of its targets receives at least one message.</span></span> <span data-ttu-id="94516-298">最短一致モードでは、<xref:System.Threading.Tasks.Dataflow.JoinBlock%602> または <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> オブジェクトは、すべてのターゲットがタプルを作成するために必要なデータを提供されるまで、すべての受信メッセージを延期します。</span><span class="sxs-lookup"><span data-stu-id="94516-298">In non-greedy mode, a <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> or <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> object postpones all incoming messages until all targets have been offered the data that is required to create a tuple.</span></span> <span data-ttu-id="94516-299">この時点で、ブロックは 2 フェーズ コミット プロトコルによって、ソースからすべての必要な項目をアトミックに取得します。</span><span class="sxs-lookup"><span data-stu-id="94516-299">At this point, the block engages in a two-phase commit protocol to atomically retrieve all required items from the sources.</span></span> <span data-ttu-id="94516-300">この延期により、他のエンティティは当面の間データを使用でき、システム全体が進行できます。</span><span class="sxs-lookup"><span data-stu-id="94516-300">This postponement makes it possible for another entity to consume the data in the meantime, to allow the overall system to make forward progress.</span></span>  
  
 <span data-ttu-id="94516-301">次の基本的な例は、値を計算するために <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> オブジェクトが複数のデータを必要とするケースを示します。</span><span class="sxs-lookup"><span data-stu-id="94516-301">The following basic example demonstrates a case in which a <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> object requires multiple data to compute a value.</span></span> <span data-ttu-id="94516-302">この例では、算術演算を実行するために 2 つの <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> の値と 1 つの <xref:System.Int32> の値を必要とする <xref:System.Char> オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="94516-302">This example creates a <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> object that requires two <xref:System.Int32> values and a <xref:System.Char> value to perform an arithmetic operation.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#8](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#8)]
 [!code-vb[TPLDataflow_Overview#8](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#8)]  
  
 <span data-ttu-id="94516-303">最短一致モードで <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> オブジェクトを使って協調的にリソースを共有する詳しい例については、「[方法:JoinBlock を使用して複数のソースからデータを読み込む](how-to-use-joinblock-to-read-data-from-multiple-sources.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-303">For a complete example that uses <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects in non-greedy mode to cooperatively share a resource, see [How to: Use JoinBlock to Read Data From Multiple Sources](how-to-use-joinblock-to-read-data-from-multiple-sources.md).</span></span>  
  
#### <a name="batchedjoinblockt1-t2-"></a><span data-ttu-id="94516-304">BatchedJoinBlock(T1, T2, ...)</span><span class="sxs-lookup"><span data-stu-id="94516-304">BatchedJoinBlock(T1, T2, ...)</span></span>  

 <span data-ttu-id="94516-305"><xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> と <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%603> クラスは、入力要素のバッチを収集して、それらの要素を含む `System.Tuple(IList(T1), IList(T2))` または `System.Tuple(IList(T1), IList(T2), IList(T3))` オブジェクトを伝達します。</span><span class="sxs-lookup"><span data-stu-id="94516-305">The <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> and <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%603> classes collect batches of input elements and propagate out `System.Tuple(IList(T1), IList(T2))` or `System.Tuple(IList(T1), IList(T2), IList(T3))` objects that contain those elements.</span></span> <span data-ttu-id="94516-306"><xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> は <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> と <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> の組み合わせであると考えることができます。</span><span class="sxs-lookup"><span data-stu-id="94516-306">Think of <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> as a combination of <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> and <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>.</span></span> <span data-ttu-id="94516-307"><xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> オブジェクトを作成するときに、各バッチのサイズを指定します。</span><span class="sxs-lookup"><span data-stu-id="94516-307">Specify the size of each batch when you create a <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> object.</span></span> <span data-ttu-id="94516-308"><xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> は、<xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target1%2A> を実装する <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target2%2A> および <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> のプロパティを提供します。</span><span class="sxs-lookup"><span data-stu-id="94516-308"><xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> also provides properties, <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target1%2A> and <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target2%2A>, that implement <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>.</span></span> <span data-ttu-id="94516-309">すべてのターゲットから指定した数の入力要素を受け取ると、<xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> オブジェクトは、それらの要素を含む `System.Tuple(IList(T1), IList(T2))` オブジェクトを非同期的に伝達します。</span><span class="sxs-lookup"><span data-stu-id="94516-309">When the specified count of input elements are received from across all targets, the <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> object asynchronously propagates out a `System.Tuple(IList(T1), IList(T2))` object that contains those elements.</span></span>  
  
 <span data-ttu-id="94516-310">次の基本的な例では、結果を保持する <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> オブジェクト、<xref:System.Int32> の値、エラーである <xref:System.Exception> オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="94516-310">The following basic example creates a <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> object that holds results, <xref:System.Int32> values, and errors that are <xref:System.Exception> objects.</span></span> <span data-ttu-id="94516-311">この例では複数の操作を実行し、結果を <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target1%2A> オブジェクトの <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target2%2A> プロパティに書き込み、エラーを <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> プロパティに書き込みます。</span><span class="sxs-lookup"><span data-stu-id="94516-311">This example performs multiple operations and writes results to the <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target1%2A> property, and errors to the <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target2%2A> property, of the <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> object.</span></span> <span data-ttu-id="94516-312">操作の成功と失敗の数はあらかじめ不明であるため、<xref:System.Collections.Generic.IList%601> オブジェクトは、各ターゲット値を受け取らないことも、複数の値を受け取ることも可能です。</span><span class="sxs-lookup"><span data-stu-id="94516-312">Because the count of successful and failed operations is unknown in advance, the <xref:System.Collections.Generic.IList%601> objects enable each target to receive zero or more values.</span></span>  
  
 [!code-csharp[TPLDataflow_Overview#9](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#9)]
 [!code-vb[TPLDataflow_Overview#9](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#9)]  
  
 <span data-ttu-id="94516-313"><xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> を使って、プログラムがデータベースを読み取る間にその結果と発生する例外の両方をキャプチャする詳しい例については、「[チュートリアル:BatchBlock および BatchedJoinBlock を使用した効率の向上](walkthrough-using-batchblock-and-batchedjoinblock-to-improve-efficiency.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-313">For a complete example that uses <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> to capture both the results and any exceptions that occur while the program reads from a database, see [Walkthrough: Using BatchBlock and BatchedJoinBlock to Improve Efficiency](walkthrough-using-batchblock-and-batchedjoinblock-to-improve-efficiency.md).</span></span>  

## <a name="configuring-dataflow--block-behavior"></a><span data-ttu-id="94516-314">データフロー ブロックの動作を構成する</span><span class="sxs-lookup"><span data-stu-id="94516-314">Configuring Dataflow  Block Behavior</span></span>  

 <span data-ttu-id="94516-315">データ フロー ブロックの型のコンストラクターに <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions?displayProperty=nameWithType> のオブジェクトを提供することによって、追加のオプションを有効にできます。</span><span class="sxs-lookup"><span data-stu-id="94516-315">You can enable additional options by providing a <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions?displayProperty=nameWithType> object to the constructor of dataflow block types.</span></span> <span data-ttu-id="94516-316">これらのオプションは、基になるタスクと並列化の次数を管理するスケジューラなどの動作を制御します。</span><span class="sxs-lookup"><span data-stu-id="94516-316">These options control behavior such the scheduler that manages the underlying task and the degree of parallelism.</span></span> <span data-ttu-id="94516-317"><xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions> には、特定のデータ フロー ブロックの型に固有の動作を指定する派生型があります。</span><span class="sxs-lookup"><span data-stu-id="94516-317">The <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions> also has derived types that specify behavior that is specific to certain dataflow block types.</span></span> <span data-ttu-id="94516-318">各データ フロー ブロックの型に関連付けられているオプション型の概要を次の表に示します。</span><span class="sxs-lookup"><span data-stu-id="94516-318">The following table summarizes which options type is associated with each dataflow block type.</span></span>  
  
|<span data-ttu-id="94516-319">データ フロー ブロックの型</span><span class="sxs-lookup"><span data-stu-id="94516-319">Dataflow Block Type</span></span>|<span data-ttu-id="94516-320"><xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions> 型</span><span class="sxs-lookup"><span data-stu-id="94516-320"><xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions> type</span></span>|  
|-------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|  
|<xref:System.Threading.Tasks.Dataflow.BufferBlock%601>|<xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601>|<xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601>|<xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>|<xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.BatchBlock%601>|<xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.JoinBlock%602>|<xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602>|<xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions>|  
  
 <span data-ttu-id="94516-321">以下のセクションでは、<xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions?displayProperty=nameWithType>、<xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions?displayProperty=nameWithType> と <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions?displayProperty=nameWithType> クラスを通じて利用できる、重要なデータ フロー ブロックのオプションに関する追加情報を提供します。</span><span class="sxs-lookup"><span data-stu-id="94516-321">The following sections provide additional information about the important kinds of dataflow block options that are available through the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions?displayProperty=nameWithType>, and <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions?displayProperty=nameWithType> classes.</span></span>  
  
### <a name="specifying-the-task-scheduler"></a><span data-ttu-id="94516-322">タスク スケジューラの指定</span><span class="sxs-lookup"><span data-stu-id="94516-322">Specifying the Task Scheduler</span></span>  

 <span data-ttu-id="94516-323">すべての定義済みのデータ フロー ブロックは TPL タスク スケジューリング メカニズムを使って、ターゲットへのデータの伝達、ソースからのデータの受け取り、データが使用可能になったときのユーザー定義のデリゲートの実行、などのアクティビティを実行します。</span><span class="sxs-lookup"><span data-stu-id="94516-323">Every predefined dataflow block uses the TPL task scheduling mechanism to perform activities such as propagating data to a target, receiving data from a source, and running user-defined delegates when data becomes available.</span></span> <span data-ttu-id="94516-324"><xref:System.Threading.Tasks.TaskScheduler> は、タスクをスレッドのキューに置くタスク スケジューラを表す抽象クラスです。</span><span class="sxs-lookup"><span data-stu-id="94516-324"><xref:System.Threading.Tasks.TaskScheduler> is an abstract class that represents a task scheduler that queues tasks onto threads.</span></span> <span data-ttu-id="94516-325">既定のタスク スケジューラである <xref:System.Threading.Tasks.TaskScheduler.Default%2A> は、<xref:System.Threading.ThreadPool> クラスを使用して作業をキューに置き、実行します。</span><span class="sxs-lookup"><span data-stu-id="94516-325">The default task scheduler, <xref:System.Threading.Tasks.TaskScheduler.Default%2A>, uses the <xref:System.Threading.ThreadPool> class to queue and execute work.</span></span> <span data-ttu-id="94516-326">データ フロー ブロック オブジェクトを構成する場合、<xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> プロパティを設定して、既定のタスク スケジューラをオーバーライドできます。</span><span class="sxs-lookup"><span data-stu-id="94516-326">You can override the default task scheduler by setting the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property when you construct a dataflow block object.</span></span>  
  
 <span data-ttu-id="94516-327">同じタスク スケジューラが複数のデータ フロー ブロックを管理する場合、それらにポリシーを強制的に適用できます。</span><span class="sxs-lookup"><span data-stu-id="94516-327">When the same task scheduler manages multiple dataflow blocks, it can enforce policies across them.</span></span> <span data-ttu-id="94516-328">たとえば、複数のデータ フロー ブロックが、それぞれ同じ <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> オブジェクトの排他スケジューラを対象とするように構成されている場合、これらのブロックにわたって実行されるすべての操作がシリアル化されます。</span><span class="sxs-lookup"><span data-stu-id="94516-328">For example, if multiple dataflow blocks are each configured to target the exclusive scheduler of the same <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> object, all work that runs across these blocks is serialized.</span></span> <span data-ttu-id="94516-329">同様に、これらのブロックが同じ <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> オブジェクトのコンカレント スケジューラをターゲットとして構成され、そのスケジューラが最大コンカレンシー レベルに構成されている場合、これらのブロックのすべての操作は、そのコンカレント操作の数に制限されます。</span><span class="sxs-lookup"><span data-stu-id="94516-329">Similarly, if these blocks are configured to target the concurrent scheduler of the same <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> object, and that scheduler is configured to have a maximum concurrency level, all work from these blocks is limited to that number of concurrent operations.</span></span> <span data-ttu-id="94516-330"><xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> クラスを使って、読み取り操作は並列に行うが、書き込み操作は他のすべての操作で排他的に行う例については、「[方法:データフロー ブロックのタスク スケジューラを指定する](how-to-specify-a-task-scheduler-in-a-dataflow-block.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-330">For an example that uses the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> class to enable read operations to occur in parallel, but write operations to occur exclusively of all other operations, see [How to: Specify a Task Scheduler in a Dataflow Block](how-to-specify-a-task-scheduler-in-a-dataflow-block.md).</span></span> <span data-ttu-id="94516-331">TPL のタスク スケジューラの詳細については、<xref:System.Threading.Tasks.TaskScheduler> クラスに関するトピックを参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-331">For more information about task schedulers in the TPL, see the <xref:System.Threading.Tasks.TaskScheduler> class topic.</span></span>  
  
### <a name="specifying-the-degree-of-parallelism"></a><span data-ttu-id="94516-332">並列化の次数の指定</span><span class="sxs-lookup"><span data-stu-id="94516-332">Specifying the Degree of Parallelism</span></span>  

 <span data-ttu-id="94516-333">既定では、TPL データ フロー ライブラリが提供する 3 つの実行ブロックの型、<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>、<xref:System.Threading.Tasks.Dataflow.TransformBlock%602> および <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> は、一度に 1 つのメッセージを処理します。</span><span class="sxs-lookup"><span data-stu-id="94516-333">By default, the three execution block types that the TPL Dataflow Library provides, <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602>, and <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>, process one message at a time.</span></span> <span data-ttu-id="94516-334">これらのデータ フロー ブロックの型は、メッセージを受け取った順番でそれを処理します。</span><span class="sxs-lookup"><span data-stu-id="94516-334">These dataflow block types also process messages in the order in which they are received.</span></span> <span data-ttu-id="94516-335">データ フロー ブロックのオブジェクトを構築するときに、これらのデータ フロー ブロックがメッセージを同時に操作できるようにするには、<xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A?displayProperty=nameWithType> のプロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="94516-335">To enable these dataflow blocks to process messages concurrently, set the <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A?displayProperty=nameWithType> property when you construct the dataflow block object.</span></span>  
  
 <span data-ttu-id="94516-336"><xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> の既定値は 1 で、これはデータ フロー ブロックが一度に 1 つのメッセージを処理することを保証します。</span><span class="sxs-lookup"><span data-stu-id="94516-336">The default value of <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> is 1, which guarantees that the dataflow block processes one message at a time.</span></span> <span data-ttu-id="94516-337">このプロパティに 1 を超える値に設定すると、データ フロー ブロックは複数のメッセージを同時に処理できます。</span><span class="sxs-lookup"><span data-stu-id="94516-337">Setting this property to a value that is larger than 1 enables the dataflow block to process multiple messages concurrently.</span></span> <span data-ttu-id="94516-338">このプロパティを <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.Unbounded?displayProperty=nameWithType> に設定すると、基になるタスク スケジューラは最大のコンカレンシーの程度を管理することができます。</span><span class="sxs-lookup"><span data-stu-id="94516-338">Setting this property to <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.Unbounded?displayProperty=nameWithType> enables the underlying task scheduler to manage the maximum degree of concurrency.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="94516-339">並列処理の最大範囲に 1 を超える数を指定すると、複数のメッセージを同時に処理するため、メッセージが受信した順序で処理されない場合があります。</span><span class="sxs-lookup"><span data-stu-id="94516-339">When you specify a maximum degree of parallelism that is larger than 1, multiple messages are processed simultaneously, and therefore messages might not be processed in the order in which they are received.</span></span> <span data-ttu-id="94516-340">ただし、ブロックからのメッセージが出力される順序は、メッセージが受信された順序と同じです。</span><span class="sxs-lookup"><span data-stu-id="94516-340">The order in which the messages are output from the block is, however, the same one in which they are received.</span></span>  
  
 <span data-ttu-id="94516-341"><xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> プロパティは並列処理の最大範囲を表すため、データ フロー ブロックは、指定より低い並列化の度合いで実行される場合があります。</span><span class="sxs-lookup"><span data-stu-id="94516-341">Because the <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> property represents the maximum degree of parallelism, the dataflow block might execute with a lesser degree of parallelism than you specify.</span></span> <span data-ttu-id="94516-342">機能要件を満たすため、または使用可能なシステム リソースの不足のため、データ フロー ブロックは、より低い並列化の度合いを使う場合があります。</span><span class="sxs-lookup"><span data-stu-id="94516-342">The dataflow block might use a lesser degree of parallelism to meet its functional requirements or because there is a lack of available system resources.</span></span> <span data-ttu-id="94516-343">データ フロー ブロックは、指定より大きな並列化を選択することはありません。</span><span class="sxs-lookup"><span data-stu-id="94516-343">A dataflow block never chooses more parallelism than you specify.</span></span>  
  
 <span data-ttu-id="94516-344"><xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> プロパティの値は、各データ フロー ブロックのオブジェクトに排他的です。</span><span class="sxs-lookup"><span data-stu-id="94516-344">The value of the <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> property is exclusive to each dataflow block object.</span></span> <span data-ttu-id="94516-345">たとえば、4 つのデータ フロー ブロックのオブジェクトが並列処理の最大範囲にそれぞれ 1 を指定した場合、4 つすべてのデータ フロー ブロック オブジェクトを並列に実行できる場合もあります。</span><span class="sxs-lookup"><span data-stu-id="94516-345">For example, if four dataflow block objects each specify 1 for the maximum degree of parallelism, all four dataflow block objects can potentially run in parallel.</span></span>  
  
 <span data-ttu-id="94516-346">並列処理の最大範囲を設定して時間のかかる操作を並列に行う例については、「[方法:データ フロー ブロックで並列処理の範囲を指定する](how-to-specify-the-degree-of-parallelism-in-a-dataflow-block.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-346">For an example that sets the maximum degree of parallelism to enable lengthy operations to occur in parallel, see [How to: Specify the Degree of Parallelism in a Dataflow Block](how-to-specify-the-degree-of-parallelism-in-a-dataflow-block.md).</span></span>  
  
### <a name="specifying-the-number-of-messages-per-task"></a><span data-ttu-id="94516-347">タスクごとのメッセージ数の指定</span><span class="sxs-lookup"><span data-stu-id="94516-347">Specifying the Number of Messages per Task</span></span>  

 <span data-ttu-id="94516-348">定義済みのデータ フロー ブロックの型は、複数の入力要素を処理するタスクを使用します。</span><span class="sxs-lookup"><span data-stu-id="94516-348">The predefined dataflow block types use tasks to process multiple input elements.</span></span> <span data-ttu-id="94516-349">これによって、データを処理するために必要なタスクのオブジェクトの数を最小限に抑えることができ、アプリケーションを効率的に実行できます。</span><span class="sxs-lookup"><span data-stu-id="94516-349">This helps minimize the number of task objects that are required to process data, which enables applications to run more efficiently.</span></span> <span data-ttu-id="94516-350">ただし、一連のデータ フロー ブロックのタスクがデータを処理する場合、他のデータ フロー ブロックのタスクはメッセージをキューに置いて処理の時間を待機する必要がある場合があります。</span><span class="sxs-lookup"><span data-stu-id="94516-350">However, when the tasks from one set of dataflow blocks are processing data, the tasks from other dataflow blocks might need to wait for processing time by queuing messages.</span></span> <span data-ttu-id="94516-351">データ フロー タスク間での高い公平性を有効にするには、<xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> プロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="94516-351">To enable better fairness among dataflow tasks, set the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> property.</span></span> <span data-ttu-id="94516-352"><xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> が既定値である <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.Unbounded?displayProperty=nameWithType> に設定されている場合、データ フロー ブロックが使用するタスクは、可能な限り多くのメッセージを処理します。</span><span class="sxs-lookup"><span data-stu-id="94516-352">When <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> is set to <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.Unbounded?displayProperty=nameWithType>, which is the default, the task used by a dataflow block processes as many messages as are available.</span></span> <span data-ttu-id="94516-353"><xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> が <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.Unbounded> 以外の値に設定されている場合、データ フロー ブロックは、<xref:System.Threading.Tasks.Task> オブジェクトごとに最大でこの数のメッセージを処理します。</span><span class="sxs-lookup"><span data-stu-id="94516-353">When <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> is set to a value other than <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.Unbounded>, the dataflow block processes at most this number of messages per <xref:System.Threading.Tasks.Task> object.</span></span> <span data-ttu-id="94516-354"><xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> プロパティを設定すると、タスク間の公平性を向上できますが、システムが必要以上のタスクを作成する場合があり、その場合にはパフォーマンスが低下する場合があります。</span><span class="sxs-lookup"><span data-stu-id="94516-354">Although setting the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> property can increase fairness among tasks, it can cause the system to create more tasks than are necessary, which can decrease performance.</span></span>  
  
### <a name="enabling-cancellation"></a><span data-ttu-id="94516-355">取り消しの有効化</span><span class="sxs-lookup"><span data-stu-id="94516-355">Enabling Cancellation</span></span>  

 <span data-ttu-id="94516-356">TPL はタスクが協調的な方法によって取り消しの調整をできる機構を提供します。</span><span class="sxs-lookup"><span data-stu-id="94516-356">The TPL provides a mechanism that enables tasks to coordinate cancellation in a cooperative manner.</span></span> <span data-ttu-id="94516-357">データ フロー ブロックがこの取り消し機構に参加するためには、<xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> プロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="94516-357">To enable dataflow blocks to participate in this cancellation mechanism, set the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> property.</span></span> <span data-ttu-id="94516-358"><xref:System.Threading.CancellationToken> オブジェクトを取り消し状態に設定すると、このトークンを監視するすべてのデータ フロー ブロックは現在の項目の実行を終了しますが、後続の項目を開始しません。</span><span class="sxs-lookup"><span data-stu-id="94516-358">When this <xref:System.Threading.CancellationToken> object is set to the canceled state, all dataflow blocks that monitor this token finish execution of their current item but do not start processing subsequent items.</span></span> <span data-ttu-id="94516-359">また、これらのデータ フロー ブロックはすべてのバッファリングされたメッセージをクリアし、すべてのソースとターゲット ブロックへの接続を解放し、取り消し状態に遷移します。</span><span class="sxs-lookup"><span data-stu-id="94516-359">These dataflow blocks also clear any buffered messages, release connections to any source and target blocks, and transition to the canceled state.</span></span> <span data-ttu-id="94516-360">取り消し状態に遷移すると、処理中に例外が発生しない限り、<xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Completion%2A> プロパティは <xref:System.Threading.Tasks.Task.Status%2A> プロパティを <xref:System.Threading.Tasks.TaskStatus.Canceled> に設定します。</span><span class="sxs-lookup"><span data-stu-id="94516-360">By transitioning to the canceled state, the <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Completion%2A> property has the <xref:System.Threading.Tasks.Task.Status%2A> property set to <xref:System.Threading.Tasks.TaskStatus.Canceled>, unless an exception occurred during processing.</span></span> <span data-ttu-id="94516-361">この場合、<xref:System.Threading.Tasks.Task.Status%2A> は <xref:System.Threading.Tasks.TaskStatus.Faulted> に設定されます。</span><span class="sxs-lookup"><span data-stu-id="94516-361">In that case, <xref:System.Threading.Tasks.Task.Status%2A> is set to <xref:System.Threading.Tasks.TaskStatus.Faulted>.</span></span>  
  
 <span data-ttu-id="94516-362">Windows フォーム アプリケーションで取り消しを使う方法を示した例については、「[方法:データフロー ブロックをキャンセルする](how-to-cancel-a-dataflow-block.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="94516-362">For an example that demonstrates how to use cancellation in a Windows Forms application, see [How to: Cancel a Dataflow Block](how-to-cancel-a-dataflow-block.md).</span></span> <span data-ttu-id="94516-363">TPL での取り消し処理の詳細については、「[タスクのキャンセル](task-cancellation.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-363">For more information about cancellation in the TPL, see [Task Cancellation](task-cancellation.md).</span></span>  
  
### <a name="specifying-greedy-versus-non-greedy-behavior"></a><span data-ttu-id="94516-364">最長一致と最短一致の動作の指定</span><span class="sxs-lookup"><span data-stu-id="94516-364">Specifying Greedy Versus Non-Greedy Behavior</span></span>  

 <span data-ttu-id="94516-365">複数のグループ化データ フロー ブロックの型は *最長一致* モードまたは *最短一致* モードのどちらかで動作します。</span><span class="sxs-lookup"><span data-stu-id="94516-365">Several grouping dataflow block types can operate in either *greedy* or *non-greedy* mode.</span></span> <span data-ttu-id="94516-366">既定では、定義済みのデータ フロー ブロックの型は、最長一致モードで動作します。</span><span class="sxs-lookup"><span data-stu-id="94516-366">By default, the predefined dataflow block types operate in greedy mode.</span></span>  
  
 <span data-ttu-id="94516-367"><xref:System.Threading.Tasks.Dataflow.JoinBlock%602> などの結合ブロックでは、最長一致モードは、対応する結合データが使用できない場合でも、ブロックが直ちにデータを受け入れることを意味します。</span><span class="sxs-lookup"><span data-stu-id="94516-367">For join block types such as <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>, greedy mode means that the block immediately accepts data even if the corresponding data with which to join is not yet available.</span></span> <span data-ttu-id="94516-368">最短一致モードは、ターゲットのそれぞれで結合が完了できるように使用可能になるまで、ブロックがすべての受信メッセージを延期することを意味します。</span><span class="sxs-lookup"><span data-stu-id="94516-368">Non-greedy mode means that the block postpones all incoming messages until one is available on each of its targets to complete the join.</span></span> <span data-ttu-id="94516-369">延期されたメッセージのいずれかが使用できなくなった場合、結合ブロックは延期されたすべてのメッセージを解放し、プロセスを再起動します。</span><span class="sxs-lookup"><span data-stu-id="94516-369">If any of the postponed messages are no longer available, the join block releases all postponed messages and restarts the process.</span></span> <span data-ttu-id="94516-370"><xref:System.Threading.Tasks.Dataflow.BatchBlock%601> クラスにおいては、最長一致と最短一致の動作は似ていますが、最短一致の場合には、バッチを完了するために十分なメッセージを別のソースから使用できるようになるまで <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> オブジェクトがすべての受信メッセージを延期する点が異なります。</span><span class="sxs-lookup"><span data-stu-id="94516-370">For the <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> class, greedy and non-greedy behavior is similar, except that under non-greedy mode, a <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> object postpones all incoming messages until enough are available from distinct sources to complete a batch.</span></span>  
  
 <span data-ttu-id="94516-371">データ フロー ブロックに最短一致モードを指定するには、<xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> を `False` に設定します。</span><span class="sxs-lookup"><span data-stu-id="94516-371">To specify non-greedy mode for a dataflow block, set <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> to `False`.</span></span> <span data-ttu-id="94516-372">最短一致モードを使い、複数の結合ブロックを有効にして、データ ソースをより効率的に共有する例については、「[方法:JoinBlock を使用して複数のソースからデータを読み込む](how-to-use-joinblock-to-read-data-from-multiple-sources.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-372">For an example that demonstrates how to use non-greedy mode to enable multiple join blocks to share a data source more efficiently, see [How to: Use JoinBlock to Read Data From Multiple Sources](how-to-use-joinblock-to-read-data-from-multiple-sources.md).</span></span>

## <a name="custom-dataflow-blocks"></a><span data-ttu-id="94516-373">カスタム データ フロー ブロック</span><span class="sxs-lookup"><span data-stu-id="94516-373">Custom Dataflow Blocks</span></span>  

 <span data-ttu-id="94516-374">TPL データ フロー ライブラリは多くの定義済みブロックの型を提供しますが、カスタム動作を実行する追加のブロックの型を作成できます。</span><span class="sxs-lookup"><span data-stu-id="94516-374">Although the TPL Dataflow Library provides many predefined block types, you can create additional block types that perform custom behavior.</span></span> <span data-ttu-id="94516-375"><xref:System.Threading.Tasks.Dataflow.ISourceBlock%601> または <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> インターフェイスを直接実装するか、または <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Encapsulate%2A> メソッドを使用して、既存のブロックの型の動作をカプセル化する複雑なブロックをビルドします。</span><span class="sxs-lookup"><span data-stu-id="94516-375">Implement the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601> or <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> interfaces directly or use the  <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Encapsulate%2A> method to build a complex block that encapsulates the behavior of existing block types.</span></span> <span data-ttu-id="94516-376">カスタム データフロー ブロック機能の実装方法を示した例については、「[チュートリアル:カスタム データフロー ブロックの型の作成](walkthrough-creating-a-custom-dataflow-block-type.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="94516-376">For examples that show how to implement custom dataflow block functionality, see [Walkthrough: Creating a Custom Dataflow Block Type](walkthrough-creating-a-custom-dataflow-block-type.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="94516-377">関連トピック</span><span class="sxs-lookup"><span data-stu-id="94516-377">Related Topics</span></span>  
  
|<span data-ttu-id="94516-378">Title</span><span class="sxs-lookup"><span data-stu-id="94516-378">Title</span></span>|<span data-ttu-id="94516-379">説明</span><span class="sxs-lookup"><span data-stu-id="94516-379">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="94516-380">方法: データフロー ブロックに対してメッセージの読み取りと書き込みを行う</span><span class="sxs-lookup"><span data-stu-id="94516-380">How to: Write Messages to and Read Messages from a Dataflow Block</span></span>](how-to-write-messages-to-and-read-messages-from-a-dataflow-block.md)|<span data-ttu-id="94516-381"><xref:System.Threading.Tasks.Dataflow.BufferBlock%601> オブジェクトにメッセージを書き込む方法とメッセージを読み取る方法を示します。</span><span class="sxs-lookup"><span data-stu-id="94516-381">Demonstrates how to write messages to and read messages from a <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> object.</span></span>|  
|[<span data-ttu-id="94516-382">方法: プロデューサー/コンシューマーのデータフロー パターンを実装する</span><span class="sxs-lookup"><span data-stu-id="94516-382">How to: Implement a Producer-Consumer Dataflow Pattern</span></span>](how-to-implement-a-producer-consumer-dataflow-pattern.md)|<span data-ttu-id="94516-383">データ フロー モデルを使ってプロデューサー/コンシューマー パターンを実装し、プロデューサーがデータ フロー ブロックにメッセージを送信して、コンシューマーがそのブロックからメッセージを読み取る方法を示します。</span><span class="sxs-lookup"><span data-stu-id="94516-383">Describes how to use the dataflow model to implement a producer-consumer pattern, where the producer sends messages to a dataflow block, and the consumer reads messages from that block.</span></span>|  
|[<span data-ttu-id="94516-384">方法: データフロー ブロックでデータを受信したときにアクションを実行する</span><span class="sxs-lookup"><span data-stu-id="94516-384">How to: Perform Action When a Dataflow Block Receives Data</span></span>](how-to-perform-action-when-a-dataflow-block-receives-data.md)|<span data-ttu-id="94516-385">デリゲートを実行データ フロー ブロックの型である、<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>、<xref:System.Threading.Tasks.Dataflow.TransformBlock%602> と <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> に提供する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="94516-385">Describes how to provide delegates to the execution dataflow block types, <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602>, and <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>.</span></span>|  
|[<span data-ttu-id="94516-386">チュートリアル: データフロー パイプラインの作成</span><span class="sxs-lookup"><span data-stu-id="94516-386">Walkthrough: Creating a Dataflow Pipeline</span></span>](walkthrough-creating-a-dataflow-pipeline.md)|<span data-ttu-id="94516-387">Web からテキストをダウンロードし、そのテキストの操作を実行する、データ フロー パイプラインを作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="94516-387">Describes how to create a dataflow pipeline that downloads text from the web and performs operations on that text.</span></span>|  
|[<span data-ttu-id="94516-388">方法: データフロー ブロックのリンクを解除する</span><span class="sxs-lookup"><span data-stu-id="94516-388">How to: Unlink Dataflow Blocks</span></span>](how-to-unlink-dataflow-blocks.md)|<span data-ttu-id="94516-389"><xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> メソッドを使って、ソースがターゲットにメッセージを提供した後に、ターゲット ブロックをソースからリンク解除する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="94516-389">Demonstrates how to use the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> method to unlink a target block from its source after the source offers a message to the target.</span></span>|  
|[<span data-ttu-id="94516-390">チュートリアル: Windows フォーム アプリケーションでのデータフローの使用</span><span class="sxs-lookup"><span data-stu-id="94516-390">Walkthrough: Using Dataflow in a Windows Forms Application</span></span>](walkthrough-using-dataflow-in-a-windows-forms-application.md)|<span data-ttu-id="94516-391">Windows フォーム アプリケーションでイメージ処理を実行する、データ フロー ブロックのネットワークを作成する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="94516-391">Demonstrates how to create a network of dataflow blocks that perform image processing in a Windows Forms application.</span></span>|  
|[<span data-ttu-id="94516-392">方法: データフロー ブロックをキャンセルする</span><span class="sxs-lookup"><span data-stu-id="94516-392">How to: Cancel a Dataflow Block</span></span>](how-to-cancel-a-dataflow-block.md)|<span data-ttu-id="94516-393">Windows フォーム アプリケーションで取り消しを使う方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="94516-393">Demonstrates how to use cancellation in a Windows Forms application.</span></span>|  
|[<span data-ttu-id="94516-394">方法: JoinBlock を使用して複数のソースからデータを読み込む</span><span class="sxs-lookup"><span data-stu-id="94516-394">How to: Use JoinBlock to Read Data From Multiple Sources</span></span>](how-to-use-joinblock-to-read-data-from-multiple-sources.md)|<span data-ttu-id="94516-395">データが複数のソースから使用できるようになった場合に <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> クラスを使って操作を実行する方法、および最短一致モードを使って、複数の結合ブロックがデータ ソースをより効率的に共有できる方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="94516-395">Explains how to use the <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> class to perform an operation when data is available from multiple sources, and how to use non-greedy mode to enable multiple join blocks to share a data source more efficiently.</span></span>|  
|[<span data-ttu-id="94516-396">方法: データフロー ブロックで並列処理の範囲を指定する</span><span class="sxs-lookup"><span data-stu-id="94516-396">How to: Specify the Degree of Parallelism in a Dataflow Block</span></span>](how-to-specify-the-degree-of-parallelism-in-a-dataflow-block.md)|<span data-ttu-id="94516-397"><xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> プロパティを設定して、実行データ フロー ブロックが一度に 1 つ以上のメッセージを処理できる方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="94516-397">Describes how to set the <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> property to enable an execution dataflow block to process more than one message at a time.</span></span>|  
|[<span data-ttu-id="94516-398">方法: データフロー ブロックのタスク スケジューラを指定する</span><span class="sxs-lookup"><span data-stu-id="94516-398">How to: Specify a Task Scheduler in a Dataflow Block</span></span>](how-to-specify-a-task-scheduler-in-a-dataflow-block.md)|<span data-ttu-id="94516-399">アプリケーションでデータ フローを使用する場合に特定のタスク スケジューラを関連付ける方法を示します。</span><span class="sxs-lookup"><span data-stu-id="94516-399">Demonstrates how to associate a specific task scheduler when you use dataflow in your application.</span></span>|  
|[<span data-ttu-id="94516-400">チュートリアル: BatchBlock および BatchedJoinBlock を使用した効率の向上</span><span class="sxs-lookup"><span data-stu-id="94516-400">Walkthrough: Using BatchBlock and BatchedJoinBlock to Improve Efficiency</span></span>](walkthrough-using-batchblock-and-batchedjoinblock-to-improve-efficiency.md)|<span data-ttu-id="94516-401"><xref:System.Threading.Tasks.Dataflow.BatchBlock%601> クラスを使用してデータベースの挿入操作の効率を向上する方法、および <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> クラスを使用して、プログラムがデータベースを読み取る間にその結果と発生する例外の両方をキャプチャする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="94516-401">Describes how to use the <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> class to improve the efficiency of database insert operations, and how to use the <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> class to capture both the results and any exceptions that occur while the program reads from a database.</span></span>|  
|[<span data-ttu-id="94516-402">チュートリアル: カスタム データフロー ブロックの型の作成</span><span class="sxs-lookup"><span data-stu-id="94516-402">Walkthrough: Creating a Custom Dataflow Block Type</span></span>](walkthrough-creating-a-custom-dataflow-block-type.md)|<span data-ttu-id="94516-403">カスタム動作を実装するデータ フロー ブロックの型を作成する 2 とおりの方法を示します。</span><span class="sxs-lookup"><span data-stu-id="94516-403">Demonstrates two ways to create a dataflow block type that implements custom behavior.</span></span>|  
|[<span data-ttu-id="94516-404">タスク並列ライブラリ (TPL)</span><span class="sxs-lookup"><span data-stu-id="94516-404">Task Parallel Library (TPL)</span></span>](task-parallel-library-tpl.md)|<span data-ttu-id="94516-405">.NET Framework アプリケーションの並列処理と並列プログラミングを簡略化するライブラリである TPL を紹介します。</span><span class="sxs-lookup"><span data-stu-id="94516-405">Introduces the TPL, a library that simplifies parallel and concurrent programming in .NET Framework applications.</span></span>|
