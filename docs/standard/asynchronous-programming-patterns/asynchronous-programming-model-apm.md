---
title: 非同期プログラミング モデル (APM)
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- ending asynchronous operations
- starting asynchronous operations
- beginning asynchronous operations
- asynchronous programming, ending operations
- asynchronous programming
- stopping asynchronous operations
- asynchronous programming, beginning operations
ms.assetid: c9b3501e-6bc6-40f9-8efd-4b6d9e39ccf0
ms.openlocfilehash: 0a9ea3c8c9c589bb5954fa9771ffd1bb095f6d73
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/15/2020
ms.locfileid: "73140141"
---
# <a name="asynchronous-programming-model-apm"></a><span data-ttu-id="8411d-102">非同期プログラミング モデル (APM)</span><span class="sxs-lookup"><span data-stu-id="8411d-102">Asynchronous Programming Model (APM)</span></span>
<span data-ttu-id="8411d-103"><xref:System.IAsyncResult> デザイン パターンを使用する非同期操作は `BeginOperationName` と `EndOperationName` という名前の、各 *OperationName* 非同期操作を開始および終了する 2 種類のメソッドとして実装されます。</span><span class="sxs-lookup"><span data-stu-id="8411d-103">An asynchronous operation that uses the <xref:System.IAsyncResult> design pattern is implemented as two methods named `BeginOperationName` and `EndOperationName` that begin and end the asynchronous operation *OperationName* respectively.</span></span> <span data-ttu-id="8411d-104">たとえば、 <xref:System.IO.FileStream> クラスは、 <xref:System.IO.FileStream.BeginRead%2A> および <xref:System.IO.FileStream.EndRead%2A> メソッドを提供して、非同期的にファイルからバイトを読み取ります。</span><span class="sxs-lookup"><span data-stu-id="8411d-104">For example, the <xref:System.IO.FileStream> class provides the <xref:System.IO.FileStream.BeginRead%2A> and <xref:System.IO.FileStream.EndRead%2A> methods to asynchronously read bytes from a file.</span></span> <span data-ttu-id="8411d-105">これらのメソッドは非同期バージョンの <xref:System.IO.FileStream.Read%2A> メソッドを実装します。</span><span class="sxs-lookup"><span data-stu-id="8411d-105">These methods implement the asynchronous version of the <xref:System.IO.FileStream.Read%2A> method.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="8411d-106">.NET Framework 4 以降では、タスク並列ライブラリによって非同期/並列プログラミングの新しいモデルが提供されます。</span><span class="sxs-lookup"><span data-stu-id="8411d-106">Starting with the .NET Framework 4, the Task Parallel Library provides a new model for asynchronous and parallel programming.</span></span> <span data-ttu-id="8411d-107">詳細については、「 [タスク並列ライブラリ (TPL)](../../../docs/standard/parallel-programming/task-parallel-library-tpl.md) 」および「 [タスク ベースの非同期パターン (TAP)](../../../docs/standard/asynchronous-programming-patterns/task-based-asynchronous-pattern-tap.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8411d-107">For more information, see [Task Parallel Library (TPL)](../../../docs/standard/parallel-programming/task-parallel-library-tpl.md) and [Task-based Asynchronous Pattern (TAP)](../../../docs/standard/asynchronous-programming-patterns/task-based-asynchronous-pattern-tap.md)).</span></span>  
  
 <span data-ttu-id="8411d-108">`BeginOperationName` を呼び出した後、アプリケーションは別のスレッドで非同期操作が行われている間も、スレッドの呼び出しに関する命令の実行を続行できます。</span><span class="sxs-lookup"><span data-stu-id="8411d-108">After calling `BeginOperationName`, an application can continue executing instructions on the calling thread while the asynchronous operation takes place on a different thread.</span></span> <span data-ttu-id="8411d-109">`BeginOperationName` の呼び出しごとに、アプリケーションでは `EndOperationName` も呼び出して、操作の結果を取得する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8411d-109">For each call to `BeginOperationName`, the application should also call `EndOperationName` to get the results of the operation.</span></span>  
  
## <a name="beginning-an-asynchronous-operation"></a><span data-ttu-id="8411d-110">非同期操作の開始</span><span class="sxs-lookup"><span data-stu-id="8411d-110">Beginning an Asynchronous Operation</span></span>  
 <span data-ttu-id="8411d-111">`BeginOperationName` メソッドは非同期操作 *OperationName* を開始し、<xref:System.IAsyncResult> インターフェイスを実装するオブジェクトを返します。</span><span class="sxs-lookup"><span data-stu-id="8411d-111">The `BeginOperationName` method begins asynchronous operation *OperationName* and returns an object that implements the <xref:System.IAsyncResult> interface.</span></span> <span data-ttu-id="8411d-112"><xref:System.IAsyncResult> オブジェクトは非同期操作に関する情報を格納します。</span><span class="sxs-lookup"><span data-stu-id="8411d-112"><xref:System.IAsyncResult> objects store information about an asynchronous operation.</span></span> <span data-ttu-id="8411d-113">非同期操作に関する情報を次の表に示します。</span><span class="sxs-lookup"><span data-stu-id="8411d-113">The following table shows information about an asynchronous operation.</span></span>  
  
|<span data-ttu-id="8411d-114">メンバー</span><span class="sxs-lookup"><span data-stu-id="8411d-114">Member</span></span>|<span data-ttu-id="8411d-115">[説明]</span><span class="sxs-lookup"><span data-stu-id="8411d-115">Description</span></span>|  
|------------|-----------------|  
|<xref:System.IAsyncResult.AsyncState%2A>|<span data-ttu-id="8411d-116">非同期操作についての情報を格納するオプションのアプリケーション固有オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="8411d-116">An optional application-specific object that contains information about the asynchronous operation.</span></span>|  
|<xref:System.IAsyncResult.AsyncWaitHandle%2A>|<span data-ttu-id="8411d-117"><xref:System.Threading.WaitHandle> 。非同期操作が完了するまでアプリケーションの実行をブロックするために使用できます。</span><span class="sxs-lookup"><span data-stu-id="8411d-117">A <xref:System.Threading.WaitHandle> that can be used to block application execution until the asynchronous operation completes.</span></span>|  
|<xref:System.IAsyncResult.CompletedSynchronously%2A>|<span data-ttu-id="8411d-118">非同期操作が別の <xref:System.Threading.ThreadPool> スレッドで完了する代わりに、`BeginOperationName` の呼び出しに使用されたスレッドで完了したかどうかを示す値。</span><span class="sxs-lookup"><span data-stu-id="8411d-118">A value that indicates whether the asynchronous operation completed on the thread used to call `BeginOperationName` instead of completing on a separate <xref:System.Threading.ThreadPool> thread.</span></span>|  
|<xref:System.IAsyncResult.IsCompleted%2A>|<span data-ttu-id="8411d-119">非同期操作が完了したかどうかを示す値。</span><span class="sxs-lookup"><span data-stu-id="8411d-119">A value that indicates whether the asynchronous operation has completed.</span></span>|  
  
 <span data-ttu-id="8411d-120">`BeginOperationName` メソッドは、同期バージョンのメソッドのシグネチャで宣言された、値渡しまたは参照渡しのパラメーターを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="8411d-120">A `BeginOperationName` method takes any parameters declared in the signature of the synchronous version of the method that are passed by value or by reference.</span></span> <span data-ttu-id="8411d-121">どの out パラメーターも、`BeginOperationName` メソッド シグネチャの一部ではありません。</span><span class="sxs-lookup"><span data-stu-id="8411d-121">Any out parameters are not part of the `BeginOperationName` method signature.</span></span> <span data-ttu-id="8411d-122">`BeginOperationName` メソッド シグネチャには、2 種類の追加のパラメーターが含まれます。</span><span class="sxs-lookup"><span data-stu-id="8411d-122">The `BeginOperationName` method signature also includes two additional parameters.</span></span> <span data-ttu-id="8411d-123">1 つ目のパラメーターは、非同期操作が完了したときに呼び出されるメソッドを参照する <xref:System.AsyncCallback> デリゲートを定義します。</span><span class="sxs-lookup"><span data-stu-id="8411d-123">The first of these defines an <xref:System.AsyncCallback> delegate that references a method that is called when the asynchronous operation completes.</span></span> <span data-ttu-id="8411d-124">操作完了時にメソッドを呼び出さない場合、呼び出し元は `null` (Visual Basic では`Nothing` ) を指定できます。</span><span class="sxs-lookup"><span data-stu-id="8411d-124">The caller can specify `null` (`Nothing` in Visual Basic) if it does not want a method invoked when the operation completes.</span></span> <span data-ttu-id="8411d-125">2 つ目の追加のパラメーターは、ユーザー定義オブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="8411d-125">The second additional parameter is a user-defined object.</span></span> <span data-ttu-id="8411d-126">このオブジェクトは、アプリケーション固有の状態情報を、非同期操作が完了したときに呼び出されるメソッドに渡すために使用できます。</span><span class="sxs-lookup"><span data-stu-id="8411d-126">This object can be used to pass application-specific state information to the method invoked when the asynchronous operation completes.</span></span> <span data-ttu-id="8411d-127">`BeginOperationName` メソッドが、ファイルから読み取ったバイトを格納するバイト配列など操作固有の追加のパラメーターを受け取る場合は、<xref:System.AsyncCallback> とアプリケーション状態オブジェクトが `BeginOperationName` メソッド シグネチャの最後のパラメーターになります。</span><span class="sxs-lookup"><span data-stu-id="8411d-127">If a `BeginOperationName` method takes additional operation-specific parameters, such as a byte array to store bytes read from a file, the <xref:System.AsyncCallback> and application state object are the last parameters in the `BeginOperationName` method signature.</span></span>  
  
 <span data-ttu-id="8411d-128">`BeginOperationName` は、瞬時にコントロールを呼び出し元スレッドに返します。</span><span class="sxs-lookup"><span data-stu-id="8411d-128">`BeginOperationName` returns control to the calling thread immediately.</span></span> <span data-ttu-id="8411d-129">`BeginOperationName` メソッドが例外をスローする場合は、非同期操作が開始される前に例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="8411d-129">If the `BeginOperationName` method throws exceptions, the exceptions are thrown before the asynchronous operation is started.</span></span> <span data-ttu-id="8411d-130">`BeginOperationName` メソッドが例外をスローする場合、コールバック メソッドは呼び出されません。</span><span class="sxs-lookup"><span data-stu-id="8411d-130">If the `BeginOperationName` method throws exceptions, the callback method is not invoked.</span></span>  
  
## <a name="ending-an-asynchronous-operation"></a><span data-ttu-id="8411d-131">非同期操作の終了</span><span class="sxs-lookup"><span data-stu-id="8411d-131">Ending an Asynchronous Operation</span></span>  
 <span data-ttu-id="8411d-132">`EndOperationName` メソッドは非同期操作の *OperationName* を終了します。</span><span class="sxs-lookup"><span data-stu-id="8411d-132">The `EndOperationName` method ends asynchronous operation *OperationName*.</span></span> <span data-ttu-id="8411d-133">`EndOperationName` メソッドの戻り値は、このメソッドの対応する同期操作によって返される型と同じ型であり、非同期操作に固有です。</span><span class="sxs-lookup"><span data-stu-id="8411d-133">The return value of the `EndOperationName` method is the same type returned by its synchronous counterpart and is specific to the asynchronous operation.</span></span> <span data-ttu-id="8411d-134">たとえば、 <xref:System.IO.FileStream.EndRead%2A> メソッドは <xref:System.IO.FileStream> から読み取ったバイト数を返し、 <xref:System.Net.Dns.EndGetHostByName%2A> メソッドはホスト コンピューターに関する情報を含む <xref:System.Net.IPHostEntry> オブジェクトを返します。</span><span class="sxs-lookup"><span data-stu-id="8411d-134">For example, the <xref:System.IO.FileStream.EndRead%2A> method returns the number of bytes read from a <xref:System.IO.FileStream> and the <xref:System.Net.Dns.EndGetHostByName%2A> method returns an <xref:System.Net.IPHostEntry> object that contains information about a host computer.</span></span> <span data-ttu-id="8411d-135">`EndOperationName` メソッドは、メソッドの同期バージョンのシグネチャで宣言された out パラメーターや ref パラメーターをすべて受け取ります。</span><span class="sxs-lookup"><span data-stu-id="8411d-135">The `EndOperationName` method takes any out or ref parameters declared in the signature of the synchronous version of the method.</span></span> <span data-ttu-id="8411d-136">`EndOperationName` メソッドには、同期メソッドからのパラメーターに加えて <xref:System.IAsyncResult> パラメーターが含まれています。</span><span class="sxs-lookup"><span data-stu-id="8411d-136">In addition to the parameters from the synchronous method, the `EndOperationName` method also includes an <xref:System.IAsyncResult> parameter.</span></span> <span data-ttu-id="8411d-137">呼び出し元は、対応する呼び出しから返されたインスタンスを `BeginOperationName` に渡す必要があります。</span><span class="sxs-lookup"><span data-stu-id="8411d-137">Callers must pass the instance returned by the corresponding call to `BeginOperationName`.</span></span>  
  
 <span data-ttu-id="8411d-138">`EndOperationName` が呼び出されるときに <xref:System.IAsyncResult> オブジェクトによって表される非同期操作が完了していない場合、`EndOperationName` は非同期操作が完了するまで、呼び出し元スレッドをブロックします。</span><span class="sxs-lookup"><span data-stu-id="8411d-138">If the asynchronous operation represented by the <xref:System.IAsyncResult> object has not completed when `EndOperationName` is called, `EndOperationName` blocks the calling thread until the asynchronous operation is complete.</span></span> <span data-ttu-id="8411d-139">非同期操作によってスローされた例外は、`EndOperationName` メソッドからスローされます。</span><span class="sxs-lookup"><span data-stu-id="8411d-139">Exceptions thrown by the asynchronous operation are thrown from the `EndOperationName` method.</span></span> <span data-ttu-id="8411d-140">同じ <xref:System.IAsyncResult> を使用して `EndOperationName` メソッドを複数回呼び出す場合の効果は定義されません。</span><span class="sxs-lookup"><span data-stu-id="8411d-140">The effect of calling the `EndOperationName` method multiple times with the same <xref:System.IAsyncResult> is not defined.</span></span> <span data-ttu-id="8411d-141">同様に、関連する Begin メソッドによって返されたのではない <xref:System.IAsyncResult> を使用した `EndOperationName` メソッドの呼び出しも定義されません。</span><span class="sxs-lookup"><span data-stu-id="8411d-141">Likewise, calling the `EndOperationName` method with an <xref:System.IAsyncResult> that was not returned by the related Begin method is also not defined.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="8411d-142">どちらの未定義シナリオの場合でも、実装者は <xref:System.InvalidOperationException>のスローを検討する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8411d-142">For either of the undefined scenarios, implementers should consider throwing <xref:System.InvalidOperationException>.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="8411d-143">このデザイン パターンの実装者は <xref:System.IAsyncResult.IsCompleted%2A> を true に設定し、非同期コールバック メソッドを呼び出して (指定されている場合)、 <xref:System.IAsyncResult.AsyncWaitHandle%2A>をシグナリングすることで、非同期操作の完了を呼び出し元に通知する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8411d-143">Implementers of this design pattern should notify the caller that the asynchronous operation completed by setting <xref:System.IAsyncResult.IsCompleted%2A> to true, calling the asynchronous callback method (if one was specified) and signaling the <xref:System.IAsyncResult.AsyncWaitHandle%2A>.</span></span>  
  
 <span data-ttu-id="8411d-144">アプリケーション開発者には、非同期操作の結果にアクセスするための、デザイン上の選択肢がいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="8411d-144">Application developers have several design choices for accessing the results of the asynchronous operation.</span></span> <span data-ttu-id="8411d-145">どの選択が適切になるかは、アプリケーションが操作の完了前に実行できる命令を持っているかどうかによって変わります。</span><span class="sxs-lookup"><span data-stu-id="8411d-145">The correct choice depends on whether the application has instructions that can execute while the operation completes.</span></span> <span data-ttu-id="8411d-146">非同期操作の結果を受け取るまで、アプリケーションが別の作業を実行できない場合は、結果が使用可能になるまで、そのアプリケーションをブロックする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8411d-146">If an application cannot perform any additional work until it receives the results of the asynchronous operation, the application must block until the results are available.</span></span> <span data-ttu-id="8411d-147">非同期操作が完了するまでブロックするには、次に示す方法の 1 つを使用します。</span><span class="sxs-lookup"><span data-stu-id="8411d-147">To block until an asynchronous operation completes, you can use one of the following approaches:</span></span>  
  
- <span data-ttu-id="8411d-148">アプリケーションのメイン スレッドから `EndOperationName` を呼び出し、操作が完了するまでアプリケーションの実行をブロックします。</span><span class="sxs-lookup"><span data-stu-id="8411d-148">Call `EndOperationName` from the application’s main thread, blocking application execution until the operation is complete.</span></span> <span data-ttu-id="8411d-149">この手法の例については、「[非同期操作の終了によるアプリケーション実行のブロック](../../../docs/standard/asynchronous-programming-patterns/blocking-application-execution-by-ending-an-async-operation.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8411d-149">For an example that illustrates this technique, see [Blocking Application Execution by Ending an Async Operation](../../../docs/standard/asynchronous-programming-patterns/blocking-application-execution-by-ending-an-async-operation.md).</span></span>  
  
- <span data-ttu-id="8411d-150"><xref:System.IAsyncResult.AsyncWaitHandle%2A> を使用して、1 つ以上の操作が完了するまでアプリケーションの実行をブロックします。</span><span class="sxs-lookup"><span data-stu-id="8411d-150">Use the <xref:System.IAsyncResult.AsyncWaitHandle%2A> to block application execution until one or more operations are complete.</span></span> <span data-ttu-id="8411d-151">この手法の例については、「 [AsyncWaitHandle の使用によるアプリケーション実行のブロック](../../../docs/standard/asynchronous-programming-patterns/blocking-application-execution-using-an-asyncwaithandle.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8411d-151">For an example that illustrates this technique, see [Blocking Application Execution Using an AsyncWaitHandle](../../../docs/standard/asynchronous-programming-patterns/blocking-application-execution-using-an-asyncwaithandle.md).</span></span>  
  
 <span data-ttu-id="8411d-152">非同期操作が完了するまでアプリケーションをブロックする必要がない場合は、次のいずれかの方法を使用します。</span><span class="sxs-lookup"><span data-stu-id="8411d-152">Applications that do not need to block while the asynchronous operation completes can use one of the following approaches:</span></span>  
  
- <span data-ttu-id="8411d-153"><xref:System.IAsyncResult.IsCompleted%2A> プロパティを定期的に確認し、操作が完了したときに `EndOperationName` を呼び出して、操作完了ステータスをポーリングします。</span><span class="sxs-lookup"><span data-stu-id="8411d-153">Poll for operation completion status by checking the <xref:System.IAsyncResult.IsCompleted%2A> property periodically and calling `EndOperationName` when the operation is complete.</span></span> <span data-ttu-id="8411d-154">この手法の例については、「 [非同期操作のステータスのポーリング](../../../docs/standard/asynchronous-programming-patterns/polling-for-the-status-of-an-asynchronous-operation.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8411d-154">For an example that illustrates this technique, see [Polling for the Status of an Asynchronous Operation](../../../docs/standard/asynchronous-programming-patterns/polling-for-the-status-of-an-asynchronous-operation.md).</span></span>  
  
- <span data-ttu-id="8411d-155"><xref:System.AsyncCallback> デリゲートを使用して、操作が完了したときに呼び出されるメソッドを指定します。</span><span class="sxs-lookup"><span data-stu-id="8411d-155">Use an <xref:System.AsyncCallback> delegate to specify a method to be invoked when the operation is complete.</span></span> <span data-ttu-id="8411d-156">この手法の例については、「 [AsyncCallback デリゲートの使用による非同期操作の終了](../../../docs/standard/asynchronous-programming-patterns/using-an-asynccallback-delegate-to-end-an-asynchronous-operation.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8411d-156">For an example that illustrates this technique, see [Using an AsyncCallback Delegate to End an Asynchronous Operation](../../../docs/standard/asynchronous-programming-patterns/using-an-asynccallback-delegate-to-end-an-asynchronous-operation.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8411d-157">参照</span><span class="sxs-lookup"><span data-stu-id="8411d-157">See also</span></span>

- [<span data-ttu-id="8411d-158">イベント ベースの非同期パターン (EAP)</span><span class="sxs-lookup"><span data-stu-id="8411d-158">Event-based Asynchronous Pattern (EAP)</span></span>](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-eap.md)
- [<span data-ttu-id="8411d-159">同期メソッドの非同期呼び出し</span><span class="sxs-lookup"><span data-stu-id="8411d-159">Calling Synchronous Methods Asynchronously</span></span>](../../../docs/standard/asynchronous-programming-patterns/calling-synchronous-methods-asynchronously.md)
- [<span data-ttu-id="8411d-160">AsyncCallback デリゲートおよび状態オブジェクトの使用</span><span class="sxs-lookup"><span data-stu-id="8411d-160">Using an AsyncCallback Delegate and State Object</span></span>](../../../docs/standard/asynchronous-programming-patterns/using-an-asynccallback-delegate-and-state-object.md)
