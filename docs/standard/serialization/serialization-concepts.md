---
title: シリアル化の概念
description: シリアル化は、オブジェクトの状態をキャプチャするために使用できます。これにより、コピーを作成したり、アプリケーション ドメイン間でオブジェクトを値渡しで送信したりできます。
ms.date: 08/07/2017
ms.assetid: e1ff4740-20a1-4c76-a8ad-d857db307054
ms.openlocfilehash: 35addd2dd2bed8ce878f2f159f1caefe89922d88
ms.sourcegitcommit: b16c00371ea06398859ecd157defc81301c9070f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/06/2020
ms.locfileid: "84291319"
---
# <a name="serialization-concepts"></a><span data-ttu-id="dd215-103">シリアル化の概念</span><span class="sxs-lookup"><span data-stu-id="dd215-103">Serialization concepts</span></span>
<span data-ttu-id="dd215-104">シリアル化が必要となる理由について考えてみます。</span><span class="sxs-lookup"><span data-stu-id="dd215-104">Why would you want to use serialization?</span></span> <span data-ttu-id="dd215-105">最も重要な理由として、オブジェクトの状態をストレージ メディアに保持し、後の段階で同一コピーを再作成できるようにすることと、アプリケーション ドメイン間でオブジェクトを値渡しで送信することの 2 つが挙げられます。</span><span class="sxs-lookup"><span data-stu-id="dd215-105">The two most important reasons are to persist the state of an object to a storage medium so an exact copy can be re-created at a later stage, and to send the object by value from one application domain to another.</span></span> <span data-ttu-id="dd215-106">たとえば、シリアル化は ASP.NET でのセッション状態を保存したり、オブジェクトを Windows フォームのクリップボードにコピーしたりするために使用されます。</span><span class="sxs-lookup"><span data-stu-id="dd215-106">For example, serialization is used to save session state in ASP.NET and to copy objects to the Clipboard in Windows Forms.</span></span> <span data-ttu-id="dd215-107">また、リモート処理でオブジェクトを 1 つのアプリケーション ドメインから別のアプリケーション ドメインに値渡しするためにも使用されます。</span><span class="sxs-lookup"><span data-stu-id="dd215-107">It is also used by remoting to pass objects by value from one application domain to another.</span></span>

[!INCLUDE [binary-serialization-warning](../../../includes/binary-serialization-warning.md)]

## <a name="persistent-storage"></a><span data-ttu-id="dd215-108">永続ストレージ</span><span class="sxs-lookup"><span data-stu-id="dd215-108">Persistent storage</span></span>
<span data-ttu-id="dd215-109">オブジェクトのフィールドの値をディスクに格納しておき、後でこのデータを取得する必要が生じることはよくあります。</span><span class="sxs-lookup"><span data-stu-id="dd215-109">It is often necessary to store the value of the fields of an object to disk and then, later, retrieve this data.</span></span> <span data-ttu-id="dd215-110">これはシリアル化を使用しなくても簡単に実現できますが、シリアル化を使用しない方法は煩雑でエラーの原因となることが多く、オブジェクトの階層を追跡する必要がある場合にはさらに複雑になります。</span><span class="sxs-lookup"><span data-stu-id="dd215-110">Although this is easy to achieve without relying on serialization, this approach is often cumbersome and error prone, and becomes progressively more complex when you need to track a hierarchy of objects.</span></span> <span data-ttu-id="dd215-111">何千ものオブジェクトを含む大規模なビジネス アプリケーションを作成し、それぞれのオブジェクトのフィールドやプロパティをディスクに保存したり、ディスクから復元したりするコードを記述することを想像してみてください。</span><span class="sxs-lookup"><span data-stu-id="dd215-111">Imagine writing a large business application, that contains thousands of objects, and having to write code to save and restore the fields and properties to and from disk for each object.</span></span> <span data-ttu-id="dd215-112">シリアル化は、この目的を実現するための便利なメカニズムを提供します。</span><span class="sxs-lookup"><span data-stu-id="dd215-112">Serialization provides a convenient mechanism for achieving this objective.</span></span>

<span data-ttu-id="dd215-113">共通言語ランタイムは、オブジェクトがメモリに格納される方法を管理し、[リフレクション](../../framework/reflection-and-codedom/reflection.md)を使用して自動シリアル化のメカニズムを提供します。</span><span class="sxs-lookup"><span data-stu-id="dd215-113">The common language runtime manages how objects are stored in memory and provides an automated serialization mechanism by using [reflection](../../framework/reflection-and-codedom/reflection.md).</span></span> <span data-ttu-id="dd215-114">オブジェクトをシリアル化すると、クラスの名前、アセンブリ、およびそのクラス インスタンスのすべてのデータ メンバーがストレージに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="dd215-114">When an object is serialized, the name of the class, the assembly, and all the data members of the class instance are written to storage.</span></span> <span data-ttu-id="dd215-115">オブジェクトのメンバー変数には、他のインスタンスへの参照が格納されていることがよくあります。</span><span class="sxs-lookup"><span data-stu-id="dd215-115">Objects often store references to other instances in member variables.</span></span> <span data-ttu-id="dd215-116">クラスをシリアル化するとき、シリアル化エンジンは、既にシリアル化されている参照先オブジェクトを追跡し、同じオブジェクトが複数回シリアル化されないようにします。</span><span class="sxs-lookup"><span data-stu-id="dd215-116">When the class is serialized, the serialization engine tracks referenced objects, already serialized, to ensure that the same object is not serialized more than once.</span></span> <span data-ttu-id="dd215-117">.NET Framework に用意されているシリアル化アーキテクチャは、オブジェクト グラフおよび循環参照を自動的に正しく処理します。</span><span class="sxs-lookup"><span data-stu-id="dd215-117">The serialization architecture provided with the .NET Framework correctly handles object graphs and circular references automatically.</span></span> <span data-ttu-id="dd215-118">オブジェクト グラフに対する唯一の要件は、シリアル化されたオブジェクトによって参照されるすべてのオブジェクトを、`Serializable` としてもマークすることです (詳細については、「[基本的なシリアル化](basic-serialization.md)」を参照)。</span><span class="sxs-lookup"><span data-stu-id="dd215-118">The only requirement placed on object graphs is that all objects, referenced by the serialized object, must also be marked as `Serializable` (for more information, see [Basic Serialization](basic-serialization.md)).</span></span> <span data-ttu-id="dd215-119">Serializable としてマークしないと、マークされていないオブジェクトをシリアライザーがシリアル化しようとしたときに例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="dd215-119">If this is not done, an exception will be thrown when the serializer attempts to serialize the unmarked object.</span></span>

<span data-ttu-id="dd215-120">シリアル化されたクラスを逆シリアル化すると、そのクラスが再作成され、すべてのデータ メンバーの値は自動的に復元されます。</span><span class="sxs-lookup"><span data-stu-id="dd215-120">When the serialized class is deserialized, the class is recreated and the values of all the data members are automatically restored.</span></span>

## <a name="marshal-by-value"></a><span data-ttu-id="dd215-121">値渡しによるマーシャリング</span><span class="sxs-lookup"><span data-stu-id="dd215-121">Marshal by value</span></span>
<span data-ttu-id="dd215-122">オブジェクトは、作成されたアプリケーション ドメイン内でのみ有効です。</span><span class="sxs-lookup"><span data-stu-id="dd215-122">Objects are valid only in the application domain where they are created.</span></span> <span data-ttu-id="dd215-123">オブジェクトをパラメーターとして渡したり、結果として返したりする処理を試行すると、そのオブジェクトが `MarshalByRefObject` から派生しているか、または `Serializable` としてマークされている場合を除いて、その試行は失敗します。</span><span class="sxs-lookup"><span data-stu-id="dd215-123">Any attempt to pass the object as a parameter or return it as a result will fail unless the object derives from `MarshalByRefObject` or is marked as `Serializable`.</span></span> <span data-ttu-id="dd215-124">`Serializable` としてマークされていると、オブジェクトは自動的にシリアル化され、アプリケーション ドメイン間で転送されます。その後、逆シリアル化され、転送先のアプリケーション ドメインにそのオブジェクトの同一コピーが作成されます。</span><span class="sxs-lookup"><span data-stu-id="dd215-124">If the object is marked as `Serializable`, the object will automatically be serialized, transported from the one application domain to the other, and then deserialized to produce an exact copy of the object in the second application domain.</span></span> <span data-ttu-id="dd215-125">この処理は一般に、値渡しによるマーシャリングと呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="dd215-125">This process is typically referred to as marshal-by-value.</span></span>

<span data-ttu-id="dd215-126">オブジェクトが `MarshalByRefObject` から派生している場合は、そのオブジェクト自体ではなく、オブジェクト参照がアプリケーション ドメイン間で渡されます。</span><span class="sxs-lookup"><span data-stu-id="dd215-126">When an object derives from `MarshalByRefObject`, an object reference is passed from one application domain to another, rather than the object itself.</span></span> <span data-ttu-id="dd215-127">`MarshalByRefObject` から派生したオブジェクトを `Serializable` としてマークすることもできます。</span><span class="sxs-lookup"><span data-stu-id="dd215-127">You can also mark an object that derives from `MarshalByRefObject` as `Serializable`.</span></span> <span data-ttu-id="dd215-128">このオブジェクトがリモート処理で使用されると、サロゲート セレクター (`SurrogateSelector`) によって事前構成された、シリアル化を実行するフォーマッタがシリアル化プロセスを制御し、`MarshalByRefObject` から派生したすべてのオブジェクトをプロキシに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="dd215-128">When this object is used with remoting, the formatter responsible for serialization, which has been preconfigured with a surrogate selector (`SurrogateSelector`), takes control of the serialization process, and replaces all objects derived from `MarshalByRefObject` with a proxy.</span></span> <span data-ttu-id="dd215-129">`SurrogateSelector` を使用しない場合、シリアル化アーキテクチャは「[シリアル化プロセスの手順](steps-in-the-serialization-process.md)」で説明されている標準のシリアル化のルールに従います。</span><span class="sxs-lookup"><span data-stu-id="dd215-129">Without the `SurrogateSelector` in place, the serialization architecture follows the standard serialization rules described in [Steps in the Serialization Process](steps-in-the-serialization-process.md).</span></span>  

## <a name="related-sections"></a><span data-ttu-id="dd215-130">関連項目</span><span class="sxs-lookup"><span data-stu-id="dd215-130">Related sections</span></span>  
 [<span data-ttu-id="dd215-131">バイナリ シリアル化</span><span class="sxs-lookup"><span data-stu-id="dd215-131">Binary Serialization</span></span>](binary-serialization.md)  
 <span data-ttu-id="dd215-132">共通言語ランタイムに付属しているバイナル シリアル化機構について説明します。</span><span class="sxs-lookup"><span data-stu-id="dd215-132">Describes the binary serialization mechanism that is included with the common language runtime.</span></span>  
  
 <span data-ttu-id="dd215-133">[.NET リモート処理](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/72x4h507(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="dd215-133">[.NET Remoting](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/72x4h507(v=vs.100))</span></span>\
 <span data-ttu-id="dd215-134">.NET Framework でリモート通信に利用できるさまざまな通信方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="dd215-134">Describes the various communications methods available in the .NET Framework for remote communications.</span></span>  
  
 [<span data-ttu-id="dd215-135">XML シリアル化および SOAP シリアル化</span><span class="sxs-lookup"><span data-stu-id="dd215-135">XML and SOAP Serialization</span></span>](xml-and-soap-serialization.md)  
 <span data-ttu-id="dd215-136">共通言語ランタイムに付属している XML シリアル化および SOAP シリアル化機構について説明します。</span><span class="sxs-lookup"><span data-stu-id="dd215-136">Describes the XML and SOAP serialization mechanism that is included with the common language runtime.</span></span>
