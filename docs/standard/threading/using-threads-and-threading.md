---
title: スレッドの使用とスレッド処理
ms.date: 08/08/2018
ms.technology: dotnet-standard
helpviewer_keywords:
- threading [.NET Framework], about threading
- managed threading
ms.assetid: 9b5ec2cd-121b-4d49-b075-222cf26f2344
ms.openlocfilehash: 14159ff9a6ca39108aec14b0ad46004e95fa3cf2
ms.sourcegitcommit: 961ec21c22d2f1d55c9cc8a7edf2ade1d1fd92e3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/02/2020
ms.locfileid: "80588425"
---
# <a name="using-threads-and-threading"></a><span data-ttu-id="8c184-102">スレッドの使用とスレッド処理</span><span class="sxs-lookup"><span data-stu-id="8c184-102">Using threads and threading</span></span>

<span data-ttu-id="8c184-103">.NET では、複数の操作を同時に実行するアプリケーションを記述できます。</span><span class="sxs-lookup"><span data-stu-id="8c184-103">With .NET, you can write applications that perform multiple operations at the same time.</span></span> <span data-ttu-id="8c184-104">他の操作を止める可能性がある操作は個別のスレッドで実行できます。これは*マルチスレッド*や*フリー スレッド*と呼ばれているプロセスです。</span><span class="sxs-lookup"><span data-stu-id="8c184-104">Operations with the potential of holding up other operations can execute on separate threads, a process known as *multithreading* or *free threading*.</span></span>  
  
<span data-ttu-id="8c184-105">マルチスレッドを利用するアプリケーションはユーザーの入力に対する応答性が良くなります。プロセッサを集中的に利用するタスクが個別のスレッドで実行されるため、ユーザー インターフェイスの動作が妨げられません。</span><span class="sxs-lookup"><span data-stu-id="8c184-105">Applications that use multithreading are more responsive to user input because the user interface stays active as processor-intensive tasks execute on separate threads.</span></span> <span data-ttu-id="8c184-106">マルチスレッドはまた、スケーラブルなアプリケーションの開発にも便利です。ワークロードが増えたとき、スレッドを追加できるからです。</span><span class="sxs-lookup"><span data-stu-id="8c184-106">Multithreading is also useful when you create scalable applications, because you can add threads as the workload increases.</span></span>

> [!NOTE]
> <span data-ttu-id="8c184-107">アプリケーションのスレッドの動作をさらに細かく制御するには、スレッドを自分で管理します。</span><span class="sxs-lookup"><span data-stu-id="8c184-107">If you need more control over the behavior of the application's threads, you can manage the threads yourself.</span></span> <span data-ttu-id="8c184-108">しかし、.NET Framework 4 以降では、<xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> クラスおよび <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> クラス、[Parallel LINQ (PLINQ)](../parallel-programming/introduction-to-plinq.md)、<xref:System.Collections.Concurrent?displayProperty=nameWithType> 名前空間の新しい同時実行コレクション クラス、スレッドではなくタスクの概念を基にした新しいプログラミング モデルにより、マルチスレッド プログラミングが大幅に簡略化されています。</span><span class="sxs-lookup"><span data-stu-id="8c184-108">However, starting with the .NET Framework 4, multithreaded programming is greatly simplified with the <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> classes, [Parallel LINQ (PLINQ)](../parallel-programming/introduction-to-plinq.md), new concurrent collection classes in the <xref:System.Collections.Concurrent?displayProperty=nameWithType> namespace, and a new programming model that is based on the concept of tasks rather than threads.</span></span> <span data-ttu-id="8c184-109">詳細については、「[.NET での並列プログラミング](../parallel-programming/index.md)」と「[タスク並列ライブラリ (TPL)](../parallel-programming/task-parallel-library-tpl.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c184-109">For more information, see [Parallel Programming](../parallel-programming/index.md) and [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md).</span></span>

## <a name="how-to-create-and-start-a-new-thread"></a><span data-ttu-id="8c184-110">方法: 新しいスレッドを作成して開始する</span><span class="sxs-lookup"><span data-stu-id="8c184-110">How to: Create and start a new thread</span></span>

<span data-ttu-id="8c184-111"><xref:System.Threading.Thread?displayProperty=nameWithType> クラスの新しいインスタンスを作成し、コンストラクターに対して新しいスレッドで実行するメソッド名を指定して、新しいスレッドを作成します。</span><span class="sxs-lookup"><span data-stu-id="8c184-111">You create a new thread by creating a new instance of the <xref:System.Threading.Thread?displayProperty=nameWithType> class and providing the name of the method that you want to execute on a new thread to the constructor.</span></span> <span data-ttu-id="8c184-112">作成したスレッドを開始するには、<xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="8c184-112">To start a created thread, call the <xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="8c184-113">詳細と例については、「[スレッドを作成し、開始時にデータを渡す](creating-threads-and-passing-data-at-start-time.md)」の記事と <xref:System.Threading.Thread> API リファレンスを参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c184-113">For more information and examples, see the [Creating threads and passing data at start time](creating-threads-and-passing-data-at-start-time.md) article and the <xref:System.Threading.Thread> API reference.</span></span>

## <a name="how-to-stop-a-thread"></a><span data-ttu-id="8c184-114">方法: スレッドを停止する</span><span class="sxs-lookup"><span data-stu-id="8c184-114">How to: Stop a thread</span></span>

<span data-ttu-id="8c184-115">スレッドの実行を終了するには、<xref:System.Threading.CancellationToken?displayProperty=nameWithType> を使用します。</span><span class="sxs-lookup"><span data-stu-id="8c184-115">To terminate the execution of a thread, use the <xref:System.Threading.CancellationToken?displayProperty=nameWithType>.</span></span> <span data-ttu-id="8c184-116">これにより、統一された方法で協調的にスレッドを停止することができます。</span><span class="sxs-lookup"><span data-stu-id="8c184-116">It provides a unified way to stop threads cooperatively.</span></span> <span data-ttu-id="8c184-117">詳細については、「[マネージド スレッドのキャンセル](cancellation-in-managed-threads.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c184-117">For more information, see [Cancellation in managed threads](cancellation-in-managed-threads.md).</span></span>

<span data-ttu-id="8c184-118">協調的なキャンセルを行うように設計されていないサード パーティのコードがスレッドで実行されているために、スレッドを協調的に停止できない場合があります。</span><span class="sxs-lookup"><span data-stu-id="8c184-118">Sometimes it is not possible to stop a thread cooperatively, because it runs third-party code not designed for cooperative cancellation.</span></span> <span data-ttu-id="8c184-119">この場合は、その実行を強制的に終了することができます。</span><span class="sxs-lookup"><span data-stu-id="8c184-119">In this case, you might want to terminate its execution forcibly.</span></span> <span data-ttu-id="8c184-120">スレッドの実行を強制的に終了する場合、.NET Framework では <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> メソッドを使用できます。</span><span class="sxs-lookup"><span data-stu-id="8c184-120">To terminate the execution of a thread forcibly, in .NET Framework you can use the <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="8c184-121">このメソッドでは、呼び出されたスレッド上で <xref:System.Threading.ThreadAbortException> が生成されます。</span><span class="sxs-lookup"><span data-stu-id="8c184-121">That method raises a <xref:System.Threading.ThreadAbortException> on the thread on which it's invoked.</span></span> <span data-ttu-id="8c184-122">詳細については、「[スレッドの破棄](destroying-threads.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c184-122">For more information, see [Destroying threads](destroying-threads.md).</span></span> <span data-ttu-id="8c184-123"><xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> メソッドは、.NET Core ではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="8c184-123">The <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> method is not supported in .NET Core.</span></span> <span data-ttu-id="8c184-124">.NET Core でサード パーティのコードの実行を強制的に終了する必要がある場合は、それを別のプロセスで実行し、<xref:System.Diagnostics.Process.Kill%2A?displayProperty=nameWithType> を使用します。</span><span class="sxs-lookup"><span data-stu-id="8c184-124">If you need to terminate the execution of third-party code forcibly in .NET Core, run it in the separate process and use <xref:System.Diagnostics.Process.Kill%2A?displayProperty=nameWithType>.</span></span>

<span data-ttu-id="8c184-125">.NET Framework 4 よりも前では、<xref:System.Threading.CancellationToken?displayProperty=nameWithType> は使用できません。</span><span class="sxs-lookup"><span data-stu-id="8c184-125">The <xref:System.Threading.CancellationToken?displayProperty=nameWithType> is not available before .NET Framework 4.</span></span> <span data-ttu-id="8c184-126">以前の .NET Framework バージョンでスレッドを停止するには、スレッド同期の手法を使用して、協調的なキャンセルを手動で実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c184-126">To stop a thread in older .NET Framework versions, you should implement the cooperative cancellation manually using the thread synchronization techniques.</span></span> <span data-ttu-id="8c184-127">たとえば、volatile bool 型のフィールド `shouldStop` を作成し、それを使ってスレッドで実行されるコードの停止を要求することができます。</span><span class="sxs-lookup"><span data-stu-id="8c184-127">For example, you can create the volatile boolean field `shouldStop` and use it to request the code executed by the thread to stop.</span></span> <span data-ttu-id="8c184-128">詳細については、C# リファレンスの [volatile](../../csharp/language-reference/keywords/volatile.md) に関する記事と、<xref:System.Threading.Volatile?displayProperty=nameWithType> に関する記事をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="8c184-128">For more information, see [volatile](../../csharp/language-reference/keywords/volatile.md) in C# Reference and <xref:System.Threading.Volatile?displayProperty=nameWithType>.</span></span>

<span data-ttu-id="8c184-129"><xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType> メソッドを使用すると、停止させるスレッドが終了するまで、呼び出し元のスレッドを待機させることができます。</span><span class="sxs-lookup"><span data-stu-id="8c184-129">Use the <xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType> method to make the calling thread wait for the termination of the thread being stopped.</span></span>

## <a name="how-to-pause-or-interrupt-a-thread"></a><span data-ttu-id="8c184-130">方法: スレッドを一時停止または中断する</span><span class="sxs-lookup"><span data-stu-id="8c184-130">How to: Pause or interrupt a thread</span></span>

<span data-ttu-id="8c184-131"><xref:System.Threading.Thread.Sleep%2A?displayProperty=nameWithType> メソッドを使用して、現在のスレッドを指定した時間一時停止します。</span><span class="sxs-lookup"><span data-stu-id="8c184-131">You use the <xref:System.Threading.Thread.Sleep%2A?displayProperty=nameWithType> method to pause the current thread for a specified amount of time.</span></span> <span data-ttu-id="8c184-132"><xref:System.Threading.Thread.Interrupt%2A?displayProperty=nameWithType> メソッドを呼び出すことによって、ブロックされたスレッドを中断できます。</span><span class="sxs-lookup"><span data-stu-id="8c184-132">You can interrupt a blocked thread by calling the <xref:System.Threading.Thread.Interrupt%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="8c184-133">詳細については、「[スレッドの一時中断と再開](pausing-and-resuming-threads.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c184-133">For more information, see [Pausing and interrupting threads](pausing-and-resuming-threads.md).</span></span>

## <a name="thread-properties"></a><span data-ttu-id="8c184-134">スレッド プロパティ</span><span class="sxs-lookup"><span data-stu-id="8c184-134">Thread properties</span></span>

<span data-ttu-id="8c184-135"><xref:System.Threading.Thread> プロパティの一部を次の表に示します。</span><span class="sxs-lookup"><span data-stu-id="8c184-135">The following table presents some of the <xref:System.Threading.Thread> properties:</span></span>  
  
|<span data-ttu-id="8c184-136">property</span><span class="sxs-lookup"><span data-stu-id="8c184-136">Property</span></span>|<span data-ttu-id="8c184-137">[説明]</span><span class="sxs-lookup"><span data-stu-id="8c184-137">Description</span></span>|  
|--------------|-----------|  
|<xref:System.Threading.Thread.IsAlive%2A>|<span data-ttu-id="8c184-138">スレッドが起動していて、正常終了しておらず中止されてもいない場合は、`true` が返されます。</span><span class="sxs-lookup"><span data-stu-id="8c184-138">Returns `true` if a thread has been started and has not yet terminated normally or aborted.</span></span>|  
|<xref:System.Threading.Thread.IsBackground%2A>|<span data-ttu-id="8c184-139">スレッドがバックグラウンド スレッドかどうかを示すブール値を取得または設定します。</span><span class="sxs-lookup"><span data-stu-id="8c184-139">Gets or sets a Boolean that indicates if a thread is a background thread.</span></span> <span data-ttu-id="8c184-140">バックグラウンド スレッドはフォアグラウンド スレッドに似ていますが、プロセスの停止を防ぐことはありません。</span><span class="sxs-lookup"><span data-stu-id="8c184-140">Background threads are like foreground threads, but a background thread doesn't prevent a process from stopping.</span></span> <span data-ttu-id="8c184-141">あるプロセスに属するフォアグラウンド スレッドがすべて停止すると、共通言語ランタイムは、アライブ状態のバックグラウンド スレッドで <xref:System.Threading.Thread.Abort%2A> メソッドを呼び出し、プロセスを終了します。</span><span class="sxs-lookup"><span data-stu-id="8c184-141">Once all foreground threads that belong to a process have stopped, the common language runtime ends the process by calling the <xref:System.Threading.Thread.Abort%2A> method on background threads that are still alive.</span></span> <span data-ttu-id="8c184-142">詳細については、「[フォアグラウンド スレッドとバックグラウンド スレッド](foreground-and-background-threads.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c184-142">For more information, see [Foreground and Background Threads](foreground-and-background-threads.md).</span></span>|  
|<xref:System.Threading.Thread.Name%2A>|<span data-ttu-id="8c184-143">スレッドの名前を取得または設定します。</span><span class="sxs-lookup"><span data-stu-id="8c184-143">Gets or sets the name of a thread.</span></span> <span data-ttu-id="8c184-144">デバッグ時、個々のスレッドを検出するために頻繁に使用されます。</span><span class="sxs-lookup"><span data-stu-id="8c184-144">Most frequently used to discover individual threads when you debug.</span></span>|  
|<xref:System.Threading.Thread.Priority%2A>|<span data-ttu-id="8c184-145">オペレーティング システムがスレッド スケジュールに優先順位を設定するために使用する <xref:System.Threading.ThreadPriority> 値を取得または設定します。</span><span class="sxs-lookup"><span data-stu-id="8c184-145">Gets or sets a <xref:System.Threading.ThreadPriority> value that is used by the operating system to prioritize thread scheduling.</span></span> <span data-ttu-id="8c184-146">詳細については、「[スレッドのスケジューリング](scheduling-threads.md)」と <xref:System.Threading.ThreadPriority> リファレンスを参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c184-146">For more information, see [Scheduling threads](scheduling-threads.md) and the <xref:System.Threading.ThreadPriority> reference.</span></span>|  
|<xref:System.Threading.Thread.ThreadState%2A>|<span data-ttu-id="8c184-147">スレッドの現在の状態を示す <xref:System.Threading.ThreadState> 値を取得します。</span><span class="sxs-lookup"><span data-stu-id="8c184-147">Gets a <xref:System.Threading.ThreadState> value containing the current states of a thread.</span></span>|  

## <a name="see-also"></a><span data-ttu-id="8c184-148">参照</span><span class="sxs-lookup"><span data-stu-id="8c184-148">See also</span></span>

- <xref:System.Threading.Thread?displayProperty=nameWithType>
- [<span data-ttu-id="8c184-149">スレッドおよびスレッド処理</span><span class="sxs-lookup"><span data-stu-id="8c184-149">Threads and Threading</span></span>](threads-and-threading.md)
- [<span data-ttu-id="8c184-150">並列プログラミング</span><span class="sxs-lookup"><span data-stu-id="8c184-150">Parallel Programming</span></span>](../parallel-programming/index.md)
