---
title: project.json からの .NET Core の移行
description: project.json を使って以前の .NET Core プロジェクトを移行する方法について説明します
ms.date: 07/19/2017
ms.openlocfilehash: 8a9dc05c82fd5476a70ee36a294a287abbfb68c4
ms.sourcegitcommit: 700ea803fb06c5ce98de017c7f76463ba33ff4a9
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/19/2020
ms.locfileid: "77450688"
---
# <a name="migrating-net-core-projects-from-projectjson"></a><span data-ttu-id="a8ca6-103">project.json からの .NET Core プロジェクトの移行</span><span class="sxs-lookup"><span data-stu-id="a8ca6-103">Migrating .NET Core projects from project.json</span></span>

<span data-ttu-id="a8ca6-104">このドキュメントでは、.NET Core プロジェクトの次の 3 つの移行シナリオについて説明します。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-104">This document covers the following three migration scenarios for .NET Core projects:</span></span>

1. [<span data-ttu-id="a8ca6-105">有効な最新スキーマの *project.json* から *csproj* への移行</span><span class="sxs-lookup"><span data-stu-id="a8ca6-105">Migration from a valid latest schema of *project.json* to *csproj*</span></span>](#migration-from-projectjson-to-csproj)
2. [<span data-ttu-id="a8ca6-106">DNX から csproj への移行</span><span class="sxs-lookup"><span data-stu-id="a8ca6-106">Migration from DNX to csproj</span></span>](#migration-from-dnx-to-csproj)
3. [<span data-ttu-id="a8ca6-107">RC3 と以前の .NET Core csproj プロジェクトから最終形式への移行</span><span class="sxs-lookup"><span data-stu-id="a8ca6-107">Migration from RC3 and previous .NET Core csproj projects to the final format</span></span>](#migration-from-earlier-net-core-csproj-formats-to-rtm-csproj)

<span data-ttu-id="a8ca6-108">このドキュメントは、project.json を使っている、以前の .NET Core プロジェクトのみに適用されます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-108">This document is only applicable to older .NET Core projects that use project.json.</span></span> <span data-ttu-id="a8ca6-109">.NET Framework から .NET Core への移行には適用されません。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-109">It does not apply to migrating from .NET Framework to .NET Core.</span></span>

## <a name="migration-from-projectjson-to-csproj"></a><span data-ttu-id="a8ca6-110">project.json から csproj への移行</span><span class="sxs-lookup"><span data-stu-id="a8ca6-110">Migration from project.json to csproj</span></span>

<span data-ttu-id="a8ca6-111">*project.json* から *.csproj* への移行は、次のいずれかの方法で実行できます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-111">Migration from *project.json* to *.csproj* can be done using one of the following methods:</span></span>

- [<span data-ttu-id="a8ca6-112">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="a8ca6-112">Visual Studio</span></span>](#visual-studio)
- [<span data-ttu-id="a8ca6-113">dotnet 移行コマンドライン ツール</span><span class="sxs-lookup"><span data-stu-id="a8ca6-113">dotnet migrate command-line tool</span></span>](#dotnet-migrate)

<span data-ttu-id="a8ca6-114">いずれの方法も、同じ基本エンジンを使用してプロジェクトを移行するので、両方の結果は同じです。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-114">Both methods use the same underlying engine to migrate the projects, so the results will be the same for both.</span></span> <span data-ttu-id="a8ca6-115">ほとんどの場合、2 つの方法のいずれかを使用して *project.json* を *csproj* に移行するだけで完了します。プロジェクト ファイルをさらに手動で編集する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-115">In most cases, using one of these two ways to migrate the *project.json* to *csproj* is the only thing that is needed, and no further manual editing of the project file is necessary.</span></span> <span data-ttu-id="a8ca6-116">結果の *.csproj* ファイルには、格納しているディレクトリ名と同じ名前が付けられます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-116">The resulting *.csproj* file will be named the same as the containing directory name.</span></span>

### <a name="visual-studio"></a><span data-ttu-id="a8ca6-117">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="a8ca6-117">Visual Studio</span></span>

<span data-ttu-id="a8ca6-118">Visual Studio 2017 または Visual Studio 2019 バージョン 16.2 以前で *.xproj* ファイル、または *.xproj* ファイルを参照するソリューション ファイルを開くと、 **[一方向のアップグレード]** ダイアログが表示されます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-118">When you open an *.xproj* file or a solution file that references *.xproj* files in Visual Studio 2017 or Visual Studio 2019 version 16.2 and earlier, the **One-way upgrade** dialog appears.</span></span> <span data-ttu-id="a8ca6-119">このダイアログには、移行されるプロジェクトが表示されます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-119">The dialog displays the projects to be migrated.</span></span> <span data-ttu-id="a8ca6-120">ソリューション ファイルを開くと、ソリューション ファイルに指定されているすべてのプロジェクトが表示されます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-120">If you open a solution file, all the projects specified in the solution file are listed.</span></span> <span data-ttu-id="a8ca6-121">移行されるプロジェクトの一覧を確認し、 **[OK]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-121">Review the list of projects to be migrated and select **OK**.</span></span>

![移行されるプロジェクトの一覧が表示された [一方向のアップグレード] ダイアログ](media/one-way-upgrade.jpg)

<span data-ttu-id="a8ca6-123">選択したプロジェクトは、Visual Studio によって自動的に移行されます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-123">Visual Studio migrates the selected projects automatically.</span></span> <span data-ttu-id="a8ca6-124">すべてのプロジェクトを選択していない状態でソリューションを移行すると、同じダイアログが開き、そのソリューションの残りのプロジェクトをアップグレードすることを確認するメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-124">When migrating a solution, if you don't choose all projects, the same dialog appears asking you to upgrade the remaining projects from that solution.</span></span> <span data-ttu-id="a8ca6-125">プロジェクトが移行されたら、**ソリューション エクスプローラー** ウィンドウでプロジェクトを右クリックして、 **[編集 \<プロジェクト名.csproj]** を選択し、そのコンテンツを表示して変更することができます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-125">After the project is migrated, you can see and modify its contents by right-clicking the project in the **Solution Explorer** window and selecting **Edit \<project name>.csproj**.</span></span>

<span data-ttu-id="a8ca6-126">移行されたファイル (*project.json*、*global.json*、 *.xproj*、およびソリューション ファイル) は *Backup* フォルダーに移動されます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-126">Files that were migrated (*project.json*, *global.json*, *.xproj*, and solution file) are moved to a *Backup* folder.</span></span> <span data-ttu-id="a8ca6-127">移行されるソリューション ファイルは Visual Studio 2017 または Visual Studio 2019 にアップグレードされ、Visual Studio 2015 以前のバージョンではそのソリューション ファイルを開くことができなくなります。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-127">The migrated solution file is upgraded to Visual Studio 2017 or Visual Studio 2019 and you won't be able to open that solution file in Visual Studio 2015 or earlier versions.</span></span> <span data-ttu-id="a8ca6-128">移行レポートを含む *UpgradeLog.htm* というファイルも保存され、自動的に開かれます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-128">A file named *UpgradeLog.htm* that contains a migration report is also saved and opened automatically.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a8ca6-129">Visual Studio 2019 バージョン 16.3 以降では、 *.xproj* ファイルの読み込みまたは移行はできません。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-129">In Visual Studio 2019 version 16.3 and later, you cannot load or migrate an *.xproj* file.</span></span> <span data-ttu-id="a8ca6-130">また、Visual Studio 2015 では、 *.xproj* ファイルを移行する機能は提供されていません。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-130">Additionally, Visual Studio 2015 doesn't provide the ability to migrate an *.xproj* file.</span></span> <span data-ttu-id="a8ca6-131">これらの Visual Studio バージョンのいずれかを使用している場合は、適切なバージョンの Visual Studio をインストールするか、次に説明するコマンド ライン移行ツールを使用します。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-131">If you're using one of these Visual Studio versions, either install a suitable version of Visual Studio, or use the command line migration tool that's described next.</span></span>

### <a name="dotnet-migrate"></a><span data-ttu-id="a8ca6-132">dotnet migrate</span><span class="sxs-lookup"><span data-stu-id="a8ca6-132">dotnet migrate</span></span>

<span data-ttu-id="a8ca6-133">コマンドラインのシナリオでは、[`dotnet migrate`](../tools/dotnet-migrate.md) コマンドを使用できます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-133">In the command-line scenario, you can use the [`dotnet migrate`](../tools/dotnet-migrate.md) command.</span></span> <span data-ttu-id="a8ca6-134">検出されたものに応じて、プロジェクト、ソリューション、または一連のフォルダーの順に移行されます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-134">It migrates a project, a solution, or a set of folders in that order, depending on which ones were found.</span></span> <span data-ttu-id="a8ca6-135">プロジェクトを移行すると、プロジェクトとそのすべての依存ファイルが移行されます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-135">When you migrate a project, the project and all its dependencies are migrated.</span></span>

<span data-ttu-id="a8ca6-136">移行されたファイル (*project.json*、*global.json*、および *.xproj*) は *Backup* フォルダーに移動されます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-136">Files that were migrated (*project.json*, *global.json*, and *.xproj*) are moved to a *backup* folder.</span></span>

> [!NOTE]
> <span data-ttu-id="a8ca6-137">Visual Studio Code を使用している場合、`dotnet migrate` コマンドを実行しても、*tasks.json* などの Visual Studio Code 固有のファイルは変更されません。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-137">If you are using Visual Studio Code, the `dotnet migrate` command does not modify Visual Studio Code-specific files such as *tasks.json*.</span></span> <span data-ttu-id="a8ca6-138">これらのファイルは手動で変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-138">These files need to be changed manually.</span></span>
> <span data-ttu-id="a8ca6-139">これは、Visual Studio ではないエディターまたは統合開発環境 (IDE) を使用している場合にも該当します。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-139">This is also true if you are using an editor or Integrated Development Environment (IDE) other than Visual Studio.</span></span>

<span data-ttu-id="a8ca6-140">*project.json* および *.csproj* 形式の比較については、「[project.json プロパティと csproj プロパティの間のマッピング](../tools/project-json-to-csproj.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-140">See [A mapping between project.json and csproj properties](../tools/project-json-to-csproj.md) for a comparison of *project.json* and *.csproj* formats.</span></span>

<span data-ttu-id="a8ca6-141">次のエラーが発生する場合:</span><span class="sxs-lookup"><span data-stu-id="a8ca6-141">If you get an error:</span></span>

> <span data-ttu-id="a8ca6-142">No executable found matching command dotnet-migrate (コマンド dotnet-migrate と一致する実行可能ファイルが見つかりません)</span><span class="sxs-lookup"><span data-stu-id="a8ca6-142">No executable found matching command dotnet-migrate</span></span>

<span data-ttu-id="a8ca6-143">`dotnet --version` を実行して使用しているバージョンを確認します。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-143">Run `dotnet --version` to see which version you are using.</span></span> <span data-ttu-id="a8ca6-144">[`dotnet migrate`](../tools/dotnet-migrate.md) は、.NET Core SDK 1.0.0 で導入され、バージョン 3.0.100 で削除されました。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-144">[`dotnet migrate`](../tools/dotnet-migrate.md) was introduced in .NET Core SDK 1.0.0 and removed in version 3.0.100.</span></span>
<span data-ttu-id="a8ca6-145">現在のディレクトリまたは親ディレクトリに *global.json* ファイルがあり、それに指定されている `sdk` バージョンがこの範囲外である場合に、このエラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-145">You'll get this error if you have a *global.json* file in the current or parent directory, and the `sdk` version it specifies is outside this range.</span></span>

## <a name="migration-from-dnx-to-csproj"></a><span data-ttu-id="a8ca6-146">DNX から csproj への移行</span><span class="sxs-lookup"><span data-stu-id="a8ca6-146">Migration from DNX to csproj</span></span>

<span data-ttu-id="a8ca6-147">.NET Core 開発にまだ DNX を使用している場合、移行プロセスは次の 2 段階で実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-147">If you are still using DNX for .NET Core development, your migration process should be done in two stages:</span></span>

1. <span data-ttu-id="a8ca6-148">[既存の DNX 移行ガイダンス](from-dnx.md)を使用して DNX から project-json 対応の CLI に移行します。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-148">Use the [existing DNX migration guidance](from-dnx.md) to migrate from DNX to project-json enabled CLI.</span></span>
2. <span data-ttu-id="a8ca6-149">前のセクションの手順に従って、*project.json* から *.csproj* に移行します。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-149">Follow the steps from the previous section to migrate from *project.json* to *.csproj*.</span></span>

> [!NOTE]
> <span data-ttu-id="a8ca6-150">Preview 1 リリースの .NET Core CLI で、DNX は公式に非推奨になりました。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-150">DNX has become officially deprecated during the Preview 1 release of the .NET Core CLI.</span></span>

## <a name="migration-from-earlier-net-core-csproj-formats-to-rtm-csproj"></a><span data-ttu-id="a8ca6-151">以前の .NET Core csproj 形式から RTM csproj への移行</span><span class="sxs-lookup"><span data-stu-id="a8ca6-151">Migration from earlier .NET Core csproj formats to RTM csproj</span></span>

<span data-ttu-id="a8ca6-152">.NET Core csproj 形式は、ツールの新しいプレリリース バージョンごとに変化し、進化しています。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-152">The .NET Core csproj format has been changing and evolving with each new pre-release version of the tooling.</span></span> <span data-ttu-id="a8ca6-153">以前のバージョンの csproj から最新バージョンにプロジェクト ファイルを移行するツールはないため、プロジェクト ファイルを手動で編集する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-153">There is no tool that will migrate your project file from earlier versions of csproj to the latest, so you need to manually edit the project file.</span></span> <span data-ttu-id="a8ca6-154">実際の手順は、移行するプロジェクト ファイルのバージョンによって異なります。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-154">The actual steps depend on the version of the project file you are migrating.</span></span> <span data-ttu-id="a8ca6-155">バージョン間で加えられた変更内容に基づいて、考慮する必要があるガイダンスの一部を次に示します。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-155">The following is some guidance to consider based on the changes that happened between versions:</span></span>

- <span data-ttu-id="a8ca6-156">`<Project>` 要素からツールのバージョン プロパティを削除します (存在する場合)。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-156">Remove the tools version property from the `<Project>` element, if it exists.</span></span>
- <span data-ttu-id="a8ca6-157">`<Project>` 要素から XML 名前空間 (`xmlns`) を削除します。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-157">Remove the XML namespace (`xmlns`) from the `<Project>` element.</span></span>
- <span data-ttu-id="a8ca6-158">存在しない場合は、`<Project>` 要素に `Sdk` 属性を追加し、`Microsoft.NET.Sdk` または `Microsoft.NET.Sdk.Web` に設定します。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-158">If it doesn't exist, add the `Sdk` attribute to the `<Project>` element and set it to `Microsoft.NET.Sdk` or `Microsoft.NET.Sdk.Web`.</span></span> <span data-ttu-id="a8ca6-159">この属性は、プロジェクトが SDK を使用することを指定するために使用します。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-159">This attribute specifies that the project uses the SDK to be used.</span></span> <span data-ttu-id="a8ca6-160">`Microsoft.NET.Sdk.Web` は Web アプリに使用されます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-160">`Microsoft.NET.Sdk.Web` is used for web apps.</span></span>
- <span data-ttu-id="a8ca6-161">プロジェクトの一番上と一番下から `<Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" />` および `<Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />` ステートメントを削除します。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-161">Remove the `<Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" />` and `<Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />` statements from the top and bottom of the project.</span></span> <span data-ttu-id="a8ca6-162">これらの import ステートメントは SDK で暗黙的に指定されているので、プロジェクトに含める必要はありません。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-162">These import statements are implied by the SDK, so there is no need for them to be in the project.</span></span>
- <span data-ttu-id="a8ca6-163">プロジェクト内に `Microsoft.NETCore.App` または `NETStandard.Library` `<PackageReference>` アイテムがある場合は、削除することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-163">If you have `Microsoft.NETCore.App` or `NETStandard.Library` `<PackageReference>` items in your project, you should remove them.</span></span> <span data-ttu-id="a8ca6-164">これらのパッケージ参照は、[SDK で暗黙的に指定されています](https://aka.ms/sdkimplicitrefs)。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-164">These package references are [implied by the SDK](https://aka.ms/sdkimplicitrefs).</span></span>
- <span data-ttu-id="a8ca6-165">`Microsoft.NET.Sdk` `<PackageReference>` 要素がある場合は削除します。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-165">Remove the `Microsoft.NET.Sdk` `<PackageReference>` element, if it exists.</span></span> <span data-ttu-id="a8ca6-166">SDK の参照は、`<Project>` 要素の `Sdk` 属性によって行われます。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-166">The SDK reference comes through the `Sdk` attribute on the `<Project>` element.</span></span>
- <span data-ttu-id="a8ca6-167">[SDK で暗黙的に指定](../project-sdk/overview.md#default-compilation-includes)されている [glob](https://en.wikipedia.org/wiki/Glob_(programming)) を削除します。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-167">Remove the [globs](https://en.wikipedia.org/wiki/Glob_(programming)) that are [implied by the SDK](../project-sdk/overview.md#default-compilation-includes).</span></span> <span data-ttu-id="a8ca6-168">プロジェクトにこれらの glob を残すと、コンパイル アイテムが重複するため、ビルド時にエラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-168">Leaving these globs in your project will cause an error on build because compile items will be duplicated.</span></span>

<span data-ttu-id="a8ca6-169">これらの手順を実行すると、RTM .NET Core csproj 形式と完全に互換性のあるプロジェクトになります。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-169">After these steps your project should be fully compatible with the RTM .NET Core csproj format.</span></span>

<span data-ttu-id="a8ca6-170">古い csproj 形式から新しい形式に移行する前と後の例については、.NET ブログの記事「[Updating Visual Studio 2017 RC – .NET Core Tooling improvements](https://devblogs.microsoft.com/dotnet/updating-visual-studio-2017-rc-net-core-tooling-improvements/)」 (Visual Studio 2017 RC の更新 - .NET Core ツールの改善) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a8ca6-170">For examples of before and after the migration from old csproj format to the new one, see the [Updating Visual Studio 2017 RC – .NET Core Tooling improvements](https://devblogs.microsoft.com/dotnet/updating-visual-studio-2017-rc-net-core-tooling-improvements/) article on the .NET blog.</span></span>

## <a name="see-also"></a><span data-ttu-id="a8ca6-171">関連項目</span><span class="sxs-lookup"><span data-stu-id="a8ca6-171">See also</span></span>

- [<span data-ttu-id="a8ca6-172">Visual Studio プロジェクトのポート、移行、アップグレード</span><span class="sxs-lookup"><span data-stu-id="a8ca6-172">Port, Migrate, and Upgrade Visual Studio Projects</span></span>](/visualstudio/porting/port-migrate-and-upgrade-visual-studio-projects)
