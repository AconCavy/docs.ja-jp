---
title: モデル ビルダーの概要としくみ
description: ML.NET モデル ビルダーを使用し、機械学習モデルを自動的にトレーニングする方法
author: natke
ms.date: 06/26/2019
ms.custom: overview
ms.openlocfilehash: 6049db79753986544de18faebfd047aa190af153
ms.sourcegitcommit: b5c59eaaf8bf48ef3ec259f228cb328d6d4c0ceb
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/03/2019
ms.locfileid: "67539809"
---
# <a name="what-is-model-builder-and-how-does-it-work"></a>モデル ビルダーの概要としくみ

ML.NET モデル ビルダーはわかりやすいグラフィックスでカスタムの機械学習モデルを構築、トレーニング、展開できる Visual Studio 拡張機能です。

モデル ビルダーでは自動化された機械学習 (AutoML) を利用してさまざまな機械学習のアルゴリズムや設定を見つけます。自分のシナリオに最適なものを見つけるのに役立ちます。

モデル ビルダーは機械学習の専門知識がなくても使用できます。 必要なものはいくつかのデータと解決すべき問題です。 モデル ビルダーでは、.NET アプリケーションにモデルを追加するコードが生成されます。

![モデル ビルダー Visual Studio 拡張機能のユーザー インターフェイスのアニメーション](media/ml-dotnet-model-builder.gif)

> [!NOTE]
> モデル ビルダーは現在のところ、プレビュー段階です。

## <a name="scenarios"></a>シナリオ

さまざまなシナリオをモデル ビルダーに取り込み、自分のアプリケーションのための機械学習モデルを生成できます。

シナリオは、データで行う予測の種類を説明するものです。 次に例を示します。
- 過去の販売データに基づいて今後の製品売上高を予測する
- 顧客のレビューに基づいてセンチメントを肯定的と否定的に分類する
- 銀行取引が詐欺かどうかを検出する
- 顧客がフィードバックした問題を社内の該当チームに送信する

モデル ビルダーでは、シナリオを [ML.NET タスク](resources/tasks.md)にマッピングする必要があります。 モデル ビルダーは**回帰** (数値の予測) と**分類** (カテゴリの予測) に使用できます。

### <a name="which-machine-learning-scenario-is-right-for-me"></a>自分に最適な機械学習シナリオとは?

モデル ビルダーには、センチメント分析、問題分類、価格予測、カスタム シナリオ向けのテンプレートが付属しています。 このようなテンプレートは、特定の ML.NET シナリオを始める際に使用できます。

#### <a name="sentiment-analysis-binary-classification"></a>センチメント分析 (二項分類)

センチメント分析は、顧客からのフィードバックの肯定性/否定性を予測する目的で利用できます。 これは二項分類タスクの一例です。

二項分類は、データを 2 つのクラス (はい/いいえ、合格/不合格、真/偽、肯定的/否定的) に分類する目的で利用されます。 次のような質問に答える目的で利用できます。

- この電子メールはスパムですか? (迷惑メールの検出)
- 会員になる資格があるのはどちらの応募者ですか? (申請の選別)
- 請求書が期日どおりに支払われない可能性があるのはどちらのアカウントですか? (リスクの軽減)
- このクレジット カード取引は詐欺ですか? (詐欺の検出)

2 つのカテゴリに分類することが自分のシナリオで求められる場合、独自のデータセットと共にこのテンプレートを使用できます。

#### <a name="issue-classification-multiclass-classification"></a>問題の分類 (多クラス分類)

問題分類は、顧客からのフィードバック (たとえば、GitHub で) に含まれる問題を問題のタイトルや説明で分類する目的で利用できます。 これは多クラス分類タスクの一例です。

多クラス分類は、データを 3 つ以上のクラスに分類する目的で利用できます。 次のような質問に答える目的で利用できます。

- サポート チケットはどの部門に送信しますか? (サポート チケットの送信)
- 顧客問題の優先度とは何ですか? (顧客問題の優先順位)
- 製品はどのカテゴリに属していますか? (製品分類)
- ドキュメントの種類は何ですか? (ドキュメント/電子メールの分類)

データを 3 つ以上のカテゴリに分類する場合、シナリオに問題分類テンプレートを使用できます。

#### <a name="price-prediction-regression"></a>料金の予測 (回帰)

価格予測は、家の場所、規模、その他の特徴を利用し、家の価格を予測する目的で利用できます。 これは回帰タスクの一例です。

回帰は、数値を予測する目的で利用されます。 次のような質問に答える目的で利用できます。

- 家はいくらで売られていますか? (価格の予測)
- どのくらいの時間が経過すれば、機械部品に保守整備が必要になりますか? (予測的なメンテナンス)
- この乾燥機の水分率は何ですか? (機械監視)
- この地域の年間売上合計はどのくらいになりますか? (売上予測)

独自のデータセットで数値を予測する場合、自分のシナリオに価格予測テンプレートを使用できます。

#### <a name="custom-scenario-choose-your-task"></a>カスタム シナリオ (タスクを選択します)

カスタム シナリオでは、独自のタスクを選択できます。 問題に最適なシナリオを選択してください。

カスタム シナリオでは、独自の機械学習タスクを選択できます。 前のテンプレートでは、機械学習タスクがシナリオ (二項分類、多クラス分類、回帰) に固定されていました。 このテンプレートでは、自分のデータで使用する ML タスクを選択できます。

## <a name="data"></a>データ

シナリオをタスクにマップすると、モデル ビルダーからデータセットを提供するように求められます。 このデータはモデルをトレーニングし、評価し、シナリオに最適なモデルを選択するために使用されます。 また、予測する出力を選択する必要があります。

### <a name="choose-the-output-to-predict-label"></a>予測する出力を選択します (ラベル)

データセットは、トレーニング サンプルの行と属性の列からなるテーブルです。 各行の内容:
- **ラベル** (予測する属性)
- **特徴** (ラベルを予測するための入力として使用される属性)。

家の価格予測シナリオの場合、特徴は次のようになります。
- 家の面積
- 寝室と浴室の数
- 郵便番号

ラベルは、面積、寝室数、浴室数、郵便番号からなるその行の過去の住宅価格です。

![サイズ、部屋数、郵便番号、価格ラベルから構成される特徴を持つ住宅価格データからなる行と列を示す表](media/model-builder-data.png)

### <a name="data-formats"></a>データ形式

モデル ビルダーでは、データに次の制限があります。

- データはファイル (ヘッダー行のある .csv または .tsv) または SQL Server データベースに格納する必要があります
- トレーニング データセットには 1 GB までの制限があります
- SQL Server のトレーニング用の行は 10 万行までの制限があります。
- SQL Server からのデータは、トレーニング前に、サーバーからローカル コンピューターにコピーされます

### <a name="example-datasets"></a>データセットの例

独自のデータをまだ用意していない場合、次のいずれかのデータセットをお試しください。

|シナリオ|ML タスク|データ|group1|フィーチャー|
|-|-|-|-|-|
|価格の予測|回帰|[タクシーの料金データ](https://github.com/dotnet/machinelearning-samples/blob/master/datasets/taxi-fare-train.csv)|料金|乗車時間、距離|
|異常検出|二項分類|[製品の売上データ](https://github.com/dotnet/machinelearning-samples/blob/master/samples/csharp/getting-started/AnomalyDetection_Sales/SpikeDetection/Data/product-sales.csv)|製品の売上|月|
|センチメント分析|二項分類|[Web サイトのコメント データ](https://github.com/dotnet/machinelearning-samples/blob/master/samples/csharp/getting-started/BinaryClassification_SentimentAnalysis/SentimentAnalysis/Data/wikiDetoxAnnotated40kRows.tsv)|ラベル (否定的なセンチメントのときは 0、肯定的なセンチメントのときは 1)|コメント、年度|
|不正行為の検出|二項分類|[クレジット カードのデータ](https://github.com/dotnet/machinelearning-samples/blob/master/samples/csharp/getting-started/BinaryClassification_CreditCardFraudDetection/CreditCardFraudDetection.Trainer/assets/input/creditcardfraud-dataset.zip)|クラス (詐欺の場合は 1、それ以外の場合 0)|金額、V1-V28 (匿名化された特徴)|
|テキスト分類|多クラス分類|[GitHub 問題のデータ](https://github.com/dotnet/machinelearning-samples/blob/master/samples/csharp/end-to-end-apps/MulticlassClassification-GitHubLabeler/GitHubLabeler/Data/corefx-issues-train.tsv)|区分|タイトル、説明|

## <a name="train"></a>トレーニング

シナリオ、データ、ラベルを選択すると、モデル ビルダーによってモデルがトレーニングされます。

### <a name="what-is-training"></a>トレーニングとは何か?

トレーニングとは、モデル ビルダーがシナリオの質問に対する回答方法をモデルに教える自動プロセスです。 トレーニングが終わると、モデルは以前に見たことがない入力データで予測できます。 たとえば、住宅価格を予測しているなら、新しい住宅が市場に出たとき、その販売価格を予測できます。

モデル ビルダーで使用される機械学習は自動化されているため (AutoML)、トレーニング中に、ユーザーが入力したり、調整したりする必要がありません。

### <a name="how-long-should-i-train-for"></a>どのくらいの時間、トレーニングしますか?

トレーニング時間を指定できます。 一般的に、トレーニング時間が長ければ、それだけモデルの精度が上がります。 また、トレーニング データセットの規模が増えると、それだけ多くのトレーニング時間が必要になります。 次の表には、データセットの規模を増やしたときのトレーニング時間の目安をまとめています。

データセットのサイズ  | データセットの種類       | Avg.トレーニング時間
------------- | ------------------ | --------------
0 - 10 Mb     | 数値とテキスト   | 10 秒
10 - 100 Mb   | 数値とテキスト   | 10 分
100 - 500 Mb  | 数値とテキスト   | 30 分
500 - 1 Gb    | 数値とテキスト   | 60 分
1 Gb 超         | 数値とテキスト   | 3 時間超

正確なトレーニング時間は次にも左右されます。

- 列の種類 (テキストまたは数値)
- 機械学習タスクの種類 (回帰または分類)
- トレーニングに使用される行の数
- トレーニングに使用される列の数

モデル ビルダーは 1-TB データセットの規模で試験済みですが、その規模のデータセットで高品質のモデルを作るとなると最大で 4 日かかります。

## <a name="evaluate"></a>評価

評価は、トレーニングしたモデルを使用し、新しいテスト データで予測し、予測の精度を測定するプロセスです。

モデル ビルダーでは、トレーニング セットとテスト セットにトレーニング データが分割されます。 トレーニング データ (80%) はモデルのトレーニングに使用されます。テスト データ (20%) はモデルの評価のための控えとなります。  評価のために使用されるメトリックは、ML タスクによって異なります。 詳しくは、[モデルの評価メトリック](resources/metrics.md)に関する記事をご覧ください。

### <a name="sentiment-analysis-binary-classification"></a>センチメント分析 (二項分類)

二項分類問題の既定のメトリックは**正解率**です。 正解率は、テスト データセットに基づいてモデルが正しく予測する比率を定めるものです。 **100% に近ければ、近いほど良い**ということになります。

真陽率と偽陽率を測定する AUC (曲線下面積) など、報告されるその他のメトリックは 0.50 以上であれば、モデルは許容されます。

F1 スコアなど、追加のメトリックは、適合率 (正しい予測とそのクラスの予測合計の比率) と再現率 (正しい予測とそのクラスの実際のメンバー合計の比率) のバランスを調整する目的で使用できます。

### <a name="issue-classification-multiclass-classification"></a>問題の分類 (多クラス分類)

多クラス分類問題の既定のメトリックは**マイクロ正解率**です。 **100% に近ければ、近いほど良い**ということになります。

データが多クラスに分類される問題の場合、正解率には 2 つの種類があります。

- マイクロ正解率: 予測のうち、インスタンス全体で正しくなる部分。 問題分類シナリオでは、マイクロ正解率は、入ってきた問題のうち、正しいカテゴリに割り当てられた問題の比率となります。
- マクロ正解率: クラス レベルでの平均正解率。 問題分類シナリオでは、正解率はカテゴリごとに測定され、測定後、カテゴリ正解率の平均が求められます。 このメトリックの場合、すべてのクラスに等しい重みが与えられます。 完全にバランスの取れたデータセットの場合 (各カテゴリに等しい数の例がある)、マイクロ正解率とマクロ正解率は同じになります。

### <a name="price-prediction-regression"></a>料金の予測 (回帰)

回帰問題の既定のメトリックは **RSquared** です。 1 は考えられる最適値です。 RSquared が 1 に近づくほど優れたモデルになります。

絶対損失、二乗損失、RMS 損失など、報告されるその他のメトリックは、モデルを理解し、それを他の回帰モデルと比較する目的で使用できます。

## <a name="improve"></a>改善

モデルのパフォーマンス スコアが予想ほど良くない場合、次のことができます。

* トレーニングの時間を長くします。 時間を増やせば、自動化された機械学習エンジンは試行するアルゴリズムや設定をそれだけ増やします。

* データを追加します。 高品質の機械学習モデルをトレーニングするにはデータ量が十分ではないことがあります。

* データのバランスを調整します。 分類タスクの場合、カテゴリ全体でトレーニング セットのバランスが取れていることを確認します。 たとえば、100 のトレーニング例に対してクラスが 4 つあるとき、90 個のレコードに最初の 2 つのクラス (tag1 と tag2) を使用するが、残りの 2 つ (tag3 と tag4) は残りの 10 個のレコードでのみ使用する場合、データにバランスが欠け、tag3 か tag4 を正しく予測することがモデルにとって難しくなります。

## <a name="code"></a>コード

評価フェーズ後、モデル ビルダーからモデル ファイルとコードが出力されます。このコードを使用し、モデルをアプリケーションに追加できます。 ML.NET モデルは zip ファイルで保存されます。 モデルを読み込み、使用するためのコードがソリューションに新しいプロジェクトとして追加されます。 モデル ビルダーからはサンプル コンソール アプリも追加されます。これを実行すると、実際に動作するモデルを確認できます。

さらに、モデル ビルダーからはモデルを生成したコードが出力されます。モデルの生成に使用された手順を理解できます。 モデル トレーニング コードを使用し、モデルを新しいデータで再トレーニングすることもできます。

## <a name="whats-next"></a>次の内容

[価格予測または回帰のシナリオ](tutorials/predict-prices-with-model-builder.md)をお試しください。
